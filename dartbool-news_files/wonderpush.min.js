!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=34)}([function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}));const o="[amp-web-push]",r={NOTIFICATION_PERMISSION:"amp-web-push-notification-permission"},i={GRANTED:"granted",DENIED:"denied",DEFAULT:"default"}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var o=n(0),r=n(4);function i(e){return e.data}class s{constructor(e){e||(e={debug:!1,windowContext:window}),this.messages_={},this.listeners_={},this.debug_=e.debug,this.listening_=!1,this.connecting_=!1,this.connected_=!1,this.channel_=null,this.messagePort_=null,this.onListenConnectionMessageReceivedProc_=null,this.onConnectConnectionMessageReceivedProc_=null,this.onChannelMessageReceivedProc_=null,this.window_=e.windowContext||window}listen(e){return new Promise((t,n)=>{this.connected_?n(new Error("Already connected.")):this.listening_?n(new Error("Already listening for connections.")):Array.isArray(e)?(this.onListenConnectionMessageReceivedProc_=this.onListenConnectionMessageReceived_.bind(this,e,t,n),this.window_.addEventListener("message",this.onListenConnectionMessageReceivedProc_),this.debug_&&console.debug(o.c,"Listening for a connection message...")):n(new Error("allowedOrigins should be a string array of allowed origins to accept messages from. Got:",e))}).then(()=>{this.send(s.Topics.CONNECT_HANDSHAKE,null),this.connected_=!0})}isAllowedOrigin_(e,t){const n=Object(r.b)(e).origin;for(let e=0;e<t.length;e++){const o=t[e];if(Object(r.b)(o).origin===n)return!0}return!1}onListenConnectionMessageReceived_(e,t,n,r){const a=i(r),{origin:c,ports:p}=r;this.debug_&&console.debug(o.c,"Window message for listen() connection received:",a),this.isAllowedOrigin_(c,e)?a&&a.topic===s.Topics.CONNECT_HANDSHAKE?(console.debug(o.c,"Received expected connection handshake message:",a),this.window_.removeEventListener("message",this.onListenConnectionMessageReceivedProc_),this.messagePort_=p[0],this.onChannelMessageReceivedProc_=this.onChannelMessageReceived_.bind(this),this.messagePort_.addEventListener("message",this.onChannelMessageReceivedProc_,!1),this.messagePort_.start(),t()):console.debug(o.c,"Discarding connection message because it did not contain our expected handshake:",a):console.debug(o.c,`Discarding connection message from ${c} because it isn't an allowed origin:`,a," (allowed  origins are)",e)}connect(e,t){return new Promise((n,i)=>{e||i(new Error("Provide a valid Window context to connect to.")),t||i(new Error("Provide an expected origin for the remote Window or provide the wildcard *.")),this.connected_?i(new Error("Already connected.")):this.connecting_?i(new Error("Already connecting.")):(this.channel_=new MessageChannel,this.messagePort_=this.channel_.port1,this.onConnectConnectionMessageReceivedProc_=this.onConnectConnectionMessageReceived_.bind(this,this.messagePort_,t,n),this.messagePort_.addEventListener("message",this.onConnectConnectionMessageReceivedProc_),this.messagePort_.start(),e.postMessage({topic:s.Topics.CONNECT_HANDSHAKE},"*"===t?"*":Object(r.b)(t).origin,[this.channel_.port2]),console.debug(o.c,`Opening channel to ${t}...`))})}onConnectConnectionMessageReceived_(e,t,n){this.connected_=!0,this.debug_&&console.debug(o.c,`Messenger channel to ${t} established.`),e.removeEventListener("message",this.onConnectConnectionMessageReceivedProc_),this.onChannelMessageReceivedProc_=this.onChannelMessageReceived_.bind(this),e.addEventListener("message",this.onChannelMessageReceivedProc_,!1),n()}static get Topics(){return{CONNECT_HANDSHAKE:"topic-connect-handshake",NOTIFICATION_PERMISSION_STATE:"topic-notification-permission-state",SERVICE_WORKER_STATE:"topic-service-worker-state",SERVICE_WORKER_REGISTRATION:"topic-service-worker-registration",SERVICE_WORKER_QUERY:"topic-service-worker-query",STORAGE_GET:"topic-storage-get"}}onChannelMessageReceived_(e){const t=i(e);if(this.messages_[t.id]&&t.isReply){const e=this.messages_[t.id];delete this.messages_[t.id];const{promiseResolver:n}=e;e.message=t.data,this.debug_&&console.debug(o.c,"Received reply for topic '%s': %s",t.topic,t.data),n([t.data,this.sendReply_.bind(this,t.id,e.topic)])}else{const e=this.listeners_[t.topic];if(!e)return;this.debug_&&console.debug(o.c,`Received new message for topic '${t.topic}': ${t.data}`);for(let n=0;n<e.length;n++)(0,e[n])(t.data,this.sendReply_.bind(this,t.id,t.topic))}}on(e,t){this.listeners_[e]?this.listeners_[e].push(t):this.listeners_[e]=[t]}off(e,t){if(t){const n=this.listeners_[e].indexOf(t);-1!==n&&this.listeners_[e].splice(n,1)}else this.listeners_[e]&&delete this.listeners_[e]}sendReply_(e,t,n){const o={id:e,topic:t,data:n,isReply:!0};return this.messagePort_.postMessage(o),new Promise(e=>{this.messages_[o.id]={message:n,topic:t,promiseResolver:e}})}send(e,t){const n={id:crypto.getRandomValues(new Uint8Array(10)).join(""),topic:e,data:t};return this.debug_&&console.debug(o.c,"Sending %s: %s",e,t),this.messagePort_.postMessage(n),new Promise(o=>{this.messages_[n.id]={message:t,topic:e,promiseResolver:o}})}}},function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.DEBUG="debug",e.TRACE="trace",e.LOG="log",e.INFO="info",e.WARN="warn",e.ERROR="error"}(o=t.LogLevel||(t.LogLevel={}));class r{constructor(e){this._log_retained=[],this._log_reentrant=0,this._debugCollapsed_cache={},this.runMode="??????",(null==e?void 0:e.runMode)&&(this.runMode=e.runMode),this.sdkName=null==e?void 0:e.sdkName}_log(e){++this._log_reentrant;try{var t=new Date,n=console[e];console[e]instanceof Function||(n=console.log);const o=[];if(this._log_reentrant>1?o.unshift("[REENTRANT]"):o.unshift(this.runMode),this.sdkName&&o.unshift("["+this.sdkName+"]"),o.unshift("["+t.toLocaleTimeString("en-GB")+"."+("00"+t.getMilliseconds()).slice(-3)+"]"),!Object({debug:!1})["debug-unresolved"]||"trace"!==e&&"debug"!==e)return Function.prototype.bind.apply(n,[console].concat(o));{const e=this;return function(){var t;null===(t=e._log_retained)||void 0===t||t.push([n,o.concat(Array.prototype.slice.call(arguments))])}}}catch(e){return console.log}finally{--this._log_reentrant}}noop(...e){return()=>{}}get level(){return o.INFO}get trace(){return this.noop()}get debug(){return this.noop()}debugResolved(){Object({debug:!1})["debug-unresolved"]||(this._log_retained=void 0)}get log(){return this._log(o.LOG)}get info(){return this._log(o.INFO)}get warn(){return this._log(o.WARN)}get error(){return this._log(o.ERROR)}debugCollapsed(e,...t){var n=JSON.stringify(t);this._debugCollapsed_cache[e]!==n&&(this._debugCollapsed_cache[e]=n,this.debug(t))}}t.SimpleLogger=r,t.defaultLogger=new r,t.setDefaultLogger=e=>{t.defaultLogger=e},t.trace=(...e)=>t.defaultLogger.trace(...e),t.debug=(...e)=>t.defaultLogger.debug(...e),t.log=(...e)=>t.defaultLogger.log(...e),t.info=(...e)=>t.defaultLogger.info(...e),t.warn=(...e)=>t.defaultLogger.warn(...e),t.error=(...e)=>t.defaultLogger.error(...e),t.debugCollapsed=(e,...n)=>t.defaultLogger.debugCollapsed(e,...n),t.debugResolved=()=>t.defaultLogger.debugResolved()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(5);var r;!function(e){e.ON_FOREGROUND="ON_FOREGROUND",e.APP_LAUNCH="APP_LAUNCH",e.ON_EXIT="ON_EXIT"}(t.SystemEvent||(t.SystemEvent={})),function(e){e.FADE_IN="fadeIn",e.SLIDE_IN_FROM_RIGHT="slideInFromRight",e.SLIDE_IN_FROM_LEFT="slideInFromLeft",e.SLIDE_IN_FROM_TOP="slideInFromTop",e.SLIDE_IN_FROM_BOTTOM="slideInFromBottom"}(t.EntryAnimation||(t.EntryAnimation={})),function(e){e.FADE_OUT="fadeOut",e.SLIDE_OUT_RIGHT="slideOutRight",e.SLIDE_OUT_LEFT="slideOutLeft",e.SLIDE_OUT_TOP="slideOutUp",e.SLIDE_OUT_DOWN="slideOutDown"}(t.ExitAnimation||(t.ExitAnimation={})),t.urlPassesFilters=(e,t)=>{if(!t)return!0;const n=e.href;if(t.whiteList&&t.whiteList.filter(e=>!!e).length>0){let e=!1;for(const o of t.whiteList)if(o&&n.indexOf(o)>=0){e=!0;break}if(!e)return!1}if(t.blackList&&t.blackList.filter(e=>!!e).length>0)for(const e of t.blackList)if(e&&n.indexOf(e)>=0)return!1;return!0},t.CampaignWrapper=class{constructor(e){this.campaign=e}get campaignId(){for(const e of this.campaign.notifications){const t=o.ReportingDataUtil.extract(e);if("string"==typeof t.campaignId)return t.campaignId}throw new Error("campaign without identifier")}get active(){const e=+new Date;return!(this.campaign.scheduling.startDate&&this.campaign.scheduling.startDate>e||this.campaign.scheduling.endDate&&this.campaign.scheduling.endDate<e)}triggersMatchingEvent(e){return this.campaign.triggers.filter(t=>{var n;return t.systemEvent===e||(null===(n=t.event)||void 0===n?void 0:n.type)===e})}},function(e){e.BANNER="banner",e.CARD="card",e.IMAGEONLY="imageOnly",e.MODAL="modal"}(r=t.InAppMessageType||(t.InAppMessageType={})),t.InAppMessage=class{constructor(e,t,n,o){this.messageType=e,this.content=t,this.reportingData=n,this.payload=o}buttonTypeOfActions(e){const t=t=>{if(!e||!t||e.length!==t.length)return!1;if(!e.length)return!1;for(let n=0;n<e.length&&t[n]===e[n];n++)if(n===e.length-1)return!0;return!1};switch(this.messageType){case r.BANNER:case r.IMAGEONLY:case r.MODAL:if(t(this.content.actions))return"primary";break;case r.CARD:{const e=this.content;if(t(e.primaryActions))return"primary";if(t(e.secondaryActions))return"secondary";break}}}},function(e){e.SWIPE="swipe",e.TAP="tap",e.AUTO="auto"}(t.DismissType||(t.DismissType={}))},function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));const o=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function r(e,t=""){try{return decodeURIComponent(e)}catch(e){return t}}function i(e){const t=Object.create(null);if(!e)return t;let n;for(;n=o.exec(e);){const e=r(n[1],n[1]),o=n[2]?r(n[2],n[2]):"";t[e]=o}return t}let s;function a(e){return s||(s=self.document.createElement("a")),function(e,t){e.href=t,e.protocol||(e.href=e.href);const n={href:e.href,protocol:e.protocol,host:e.host,hostname:e.hostname,port:"0"==e.port?"":e.port,pathname:e.pathname,search:e.search,hash:e.hash,origin:null};let o;return"/"!==n.pathname[0]&&(n.pathname="/"+n.pathname),("http:"==n.protocol&&80==n.port||"https:"==n.protocol&&443==n.port)&&(n.port="",n.host=n.hostname),o=e.origin&&"null"!=e.origin?e.origin:"data:"!=n.protocol&&n.host?n.protocol+"//"+n.host:n.href,n.origin=o,!1}(s,e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(2),r="eventAttribution",i="[attribution ]";t.isReportingData=e=>"object"==typeof e&&!("string"!=typeof e.notificationId||void 0!==e.campaignId&&null!==e.campaignId&&"string"!=typeof e.campaignId||void 0!==e.viewId&&null!==e.viewId&&"string"!=typeof e.viewId||void 0!==e.reporting&&null!=e.reporting&&"object"!=typeof e.reporting),t.ReportingDataUtil=class{static extract(e){function t(e){return null===e||"string"==typeof e}function n(e){return"string"==typeof e?e:null}function o(e){return"object"==typeof e?e:null}return t(e.n)||t(e.c)||t(e.v)?{notificationId:n(e.n),campaignId:n(e.c),viewId:n(e.v),reporting:o(e.reporting)}:t(e.notificationId)||t(e.campaignId)||t(e.viewId)?{notificationId:n(e.notificationId),campaignId:n(e.campaignId),viewId:n(e.viewId),reporting:o(e.reporting)}:"object"==typeof e.reporting?{notificationId:n(e.reporting.notificationId),campaignId:n(e.reporting.campaignId),viewId:n(e.reporting.viewId),reporting:e.reporting}:{notificationId:null,campaignId:null,viewId:null,reporting:null}}static hasReportingEventData(e){return"notificationId"in e||"campaignId"in e||"viewId"in e||"reporting"in e}static assignEventData(e,t){t&&!this.hasReportingEventData(e)&&(null!==t.notificationId&&(e.notificationId=t.notificationId),null!==t.campaignId&&(e.campaignId=t.campaignId),null!==t.viewId&&(e.viewId=t.viewId),null!==t.reporting&&(e.reporting=t.reporting))}static withEventData(e,t){if(!t||this.hasReportingEventData(e))return e;const n=Object.assign({},e);return this.assignEventData(n,t),n}},t.EventAttributionManager=class{constructor(e){this.storage=e}setCurrentAttribution(e,t){const n={data:e,expirationTime:+new Date+t};return o.debug(i,"[setCurrentAttribution]",e,t),this.storage.set(r,n).then(()=>{o.debug(i,"[setCurrentAttribution] done",n)})}currentAttribution(){return this.storage.get(r,void 0).then(e=>{if(e&&(new Date).getTime()<e.expirationTime)return e.data})}renewCurrentAttribution(e){return o.debug(i,"[renewCurrentAttribution]",e),this.storage.bulk([{test:{key:r,defaultValue:void 0,operationsCb:t=>t?{put:{key:r,value:Object.assign(Object.assign({},t),{expirationTime:+new Date+e})}}:[]}}]).then(()=>{o.debug(i,"[renewCurrentAttribution] done",e)})}resetCurrentAttribution(){return o.debug(i,"[resetCurrentAttribution]"),this.storage.rm(r).then(()=>{o.debug(i,"[resetCurrentAttribution] done")})}}},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n,o,r,i=e[1]||"",s=e[3];if(!s)return i;if(t&&"function"==typeof btoa){var a=(n=s,o=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),"/*# ".concat(r," */")),c=s.sources.map((function(e){return"/*# sourceURL=".concat(s.sourceRoot||"").concat(e," */")}));return[i].concat(c).concat([a]).join("\n")}return[i].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,o){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(o)for(var i=0;i<this.length;i++){var s=this[i][0];null!=s&&(r[s]=!0)}for(var a=0;a<e.length;a++){var c=[].concat(e[a]);o&&r[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),t.push(c))}},t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o{constructor(e){this.context=e}}t.ASTCriterionNode=o,t.ASTUnknownCriterionNode=class extends o{constructor(e,t,n){super(e),this.key=t,this.value=n}accept(e){return e.visitASTUnknownCriterionNode(this)}};class r{constructor(e,t){this.context=e,this.value=t}}t.ASTValueNode=r,t.ASTUnknownValueNode=class extends r{constructor(e,t,n){super(e,void 0),this.key=t,this.value=n}accept(e){return e.visitUnknownValueNode(this)}}},function(e,t,n){"use strict";var o,r=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),i=[];function s(e){for(var t=-1,n=0;n<i.length;n++)if(i[n].identifier===e){t=n;break}return t}function a(e,t){for(var n={},o=[],r=0;r<e.length;r++){var a=e[r],c=t.base?a[0]+t.base:a[0],p=n[c]||0,d="".concat(c," ").concat(p);n[c]=p+1;var u=s(d),l={css:a[1],media:a[2],sourceMap:a[3]};-1!==u?(i[u].references++,i[u].updater(l)):i.push({identifier:d,updater:g(l,t),references:1}),o.push(d)}return o}function c(e){var t=document.createElement("style"),o=e.attributes||{};if(void 0===o.nonce){var i=n.nc;i&&(o.nonce=i)}if(Object.keys(o).forEach((function(e){t.setAttribute(e,o[e])})),"function"==typeof e.insert)e.insert(t);else{var s=r(e.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(t)}return t}var p,d=(p=[],function(e,t){return p[e]=t,p.filter(Boolean).join("\n")});function u(e,t,n,o){var r=n?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(e.styleSheet)e.styleSheet.cssText=d(t,r);else{var i=document.createTextNode(r),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(i,s[t]):e.appendChild(i)}}var l=null,h=0;function g(e,t){var n,o,r;if(t.singleton){var i=h++;n=l||(l=c(t)),o=u.bind(null,n,i,!1),r=u.bind(null,n,i,!0)}else n=c(t),o=function(e,t,n){var o=n.css,r=n.media,i=n.sourceMap;if(r?e.setAttribute("media",r):e.removeAttribute("media"),i&&btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleSheet)e.styleSheet.cssText=o;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(o))}}.bind(null,n,t),r=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return o(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;o(e=t)}else r()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o));var n=a(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var o=0;o<n.length;o++){var r=s(n[o]);i[r].references--}for(var c=a(e,t),p=0;p<n.length;p++){var d=s(n[p]);0===i[d].references&&(i[d].updater(),i.splice(d,1))}n=c}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o extends Error{}t.SegmentationDSLError=o,t.BadInputError=class extends o{},t.UnknownCriterionError=class extends o{constructor(e){super(`Unknown criterion "${e.key}"`),this.node=e}},t.UnknownValueError=class extends o{constructor(e){super(`Unknown value type "${e.key}"`),this.node=e}}},function(e,t,n){e.exports=function(){"use strict";var e=Object.freeze||function(e){return e},t=e(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),n=e(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","audio","canvas","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","video","view","vkern"]),o=e(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),r=e(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),i=e(["#text"]),s=Object.freeze||function(e){return e},a=s(["accept","action","align","alt","autocomplete","background","bgcolor","border","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","coords","crossorigin","datetime","default","dir","disabled","download","enctype","face","for","headers","height","hidden","high","href","hreflang","id","integrity","ismap","label","lang","list","loop","low","max","maxlength","media","method","min","minlength","multiple","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","type","usemap","valign","value","width","xmlns"]),c=s(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","tabindex","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),p=s(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),d=s(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),u=Object.hasOwnProperty,l=Object.setPrototypeOf,h=("undefined"!=typeof Reflect&&Reflect).apply;function g(e,t){l&&l(e,null);for(var n=t.length;n--;){var o=t[n];if("string"==typeof o){var r=o.toLowerCase();r!==o&&(Object.isFrozen(t)||(t[n]=r),o=r)}e[o]=!0}return e}function f(e){var t={},n=void 0;for(n in e)h(u,e,[n])&&(t[n]=e[n]);return t}h||(h=function(e,t,n){return e.apply(t,n)});var m=Object.seal||function(e){return e},_=m(/\{\{[\s\S]*|[\s\S]*\}\}/gm),v=m(/<%[\s\S]*|[\s\S]*%>/gm),w=m(/^data-[\-\w.\u00B7-\uFFFF]/),y=m(/^aria-[\-\w]+$/),b=m(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),S=m(/^(?:\w+script|data):/i),E=m(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g),I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function C(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var T=("undefined"!=typeof Reflect&&Reflect).apply,P=Array.prototype.slice,N=Object.freeze,A=function(){return"undefined"==typeof window?null:window};T||(T=function(e,t,n){return e.apply(t,n)});var M=function(e,t){if("object"!==(void 0===e?"undefined":I(e))||"function"!=typeof e.createPolicy)return null;var n=null;t.currentScript&&t.currentScript.hasAttribute("data-tt-policy-suffix")&&(n=t.currentScript.getAttribute("data-tt-policy-suffix"));var o="dompurify"+(n?"#"+n:"");try{return e.createPolicy(o,{createHTML:function(e){return e}})}catch(e){return console.warn("TrustedTypes policy "+o+" could not be created."),null}};return function e(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A(),u=function(t){return e(t)};if(u.version="2.0.5",u.removed=[],!s||!s.document||9!==s.document.nodeType)return u.isSupported=!1,u;var l=s.document,h=!1,m=!1,x=!1,O=s.document,D=s.DocumentFragment,k=s.HTMLTemplateElement,R=s.Node,L=s.NodeFilter,U=s.NamedNodeMap,j=void 0===U?s.NamedNodeMap||s.MozNamedAttrMap:U,W=s.Text,B=s.Comment,z=s.DOMParser,V=s.TrustedTypes;if("function"==typeof k){var F=O.createElement("template");F.content&&F.content.ownerDocument&&(O=F.content.ownerDocument)}var H=M(V,l),G=H?H.createHTML(""):"",K=O,Y=K.implementation,J=K.createNodeIterator,q=K.getElementsByTagName,Q=K.createDocumentFragment,Z=l.importNode,X={};u.isSupported=Y&&void 0!==Y.createHTMLDocument&&9!==O.documentMode;var $=_,ee=v,te=w,ne=y,oe=S,re=E,ie=b,se=null,ae=g({},[].concat(C(t),C(n),C(o),C(r),C(i))),ce=null,pe=g({},[].concat(C(a),C(c),C(p),C(d))),de=null,ue=null,le=!0,he=!0,ge=!1,fe=!1,me=!1,_e=!1,ve=!1,we=!1,ye=!1,be=!1,Se=!1,Ee=!1,Ie=!0,Ce=!0,Te=!1,Pe={},Ne=g({},["audio","colgroup","head","math","script","style","template","thead","svg","video"]),Ae=g({},["audio","video","img","source","image"]),Me=null,xe=g({},["alt","class","for","id","label","name","pattern","placeholder","summary","title","value","style","xmlns"]),Oe=null,De=O.createElement("form"),ke=function(e){Oe&&Oe===e||(e&&"object"===(void 0===e?"undefined":I(e))||(e={}),se="ALLOWED_TAGS"in e?g({},e.ALLOWED_TAGS):ae,ce="ALLOWED_ATTR"in e?g({},e.ALLOWED_ATTR):pe,Me="ADD_URI_SAFE_ATTR"in e?g(f(xe),e.ADD_URI_SAFE_ATTR):xe,de="FORBID_TAGS"in e?g({},e.FORBID_TAGS):{},ue="FORBID_ATTR"in e?g({},e.FORBID_ATTR):{},Pe="USE_PROFILES"in e&&e.USE_PROFILES,le=!1!==e.ALLOW_ARIA_ATTR,he=!1!==e.ALLOW_DATA_ATTR,ge=e.ALLOW_UNKNOWN_PROTOCOLS||!1,fe=e.SAFE_FOR_JQUERY||!1,me=e.SAFE_FOR_TEMPLATES||!1,_e=e.WHOLE_DOCUMENT||!1,ye=e.RETURN_DOM||!1,be=e.RETURN_DOM_FRAGMENT||!1,Se=e.RETURN_DOM_IMPORT||!1,Ee=e.RETURN_TRUSTED_TYPE||!1,we=e.FORCE_BODY||!1,Ie=!1!==e.SANITIZE_DOM,Ce=!1!==e.KEEP_CONTENT,Te=e.IN_PLACE||!1,ie=e.ALLOWED_URI_REGEXP||ie,me&&(he=!1),be&&(ye=!0),Pe&&(se=g({},[].concat(C(i))),ce=[],!0===Pe.html&&(g(se,t),g(ce,a)),!0===Pe.svg&&(g(se,n),g(ce,c),g(ce,d)),!0===Pe.svgFilters&&(g(se,o),g(ce,c),g(ce,d)),!0===Pe.mathMl&&(g(se,r),g(ce,p),g(ce,d))),e.ADD_TAGS&&(se===ae&&(se=f(se)),g(se,e.ADD_TAGS)),e.ADD_ATTR&&(ce===pe&&(ce=f(ce)),g(ce,e.ADD_ATTR)),e.ADD_URI_SAFE_ATTR&&g(Me,e.ADD_URI_SAFE_ATTR),Ce&&(se["#text"]=!0),_e&&g(se,["html","head","body"]),se.table&&(g(se,["tbody"]),delete de.tbody),N&&N(e),Oe=e)},Re=function(e){u.removed.push({element:e});try{e.parentNode.removeChild(e)}catch(t){e.outerHTML=G}},Le=function(e,t){try{u.removed.push({attribute:t.getAttributeNode(e),from:t})}catch(e){u.removed.push({attribute:null,from:t})}t.removeAttribute(e)},Ue=function(e){var t=void 0,n=void 0;if(we)e="<remove></remove>"+e;else{var o=e.match(/^[\s]+/);(n=o&&o[0])&&(e=e.slice(n.length))}if(h)try{t=(new z).parseFromString(e,"text/html")}catch(e){}if(x&&g(de,["title"]),!t||!t.documentElement){var r=(t=Y.createHTMLDocument("")).body;r.parentNode.removeChild(r.parentNode.firstElementChild),r.outerHTML=H?H.createHTML(e):e}return n&&t.body.insertBefore(O.createTextNode(n),t.body.childNodes[0]||null),q.call(t,_e?"html":"body")[0]};u.isSupported&&(function(){try{Ue('<svg><p><textarea><img src="</textarea><img src=x abc=1//">').querySelector("svg img")&&(h=!0)}catch(e){}}(),function(){try{var e=Ue("<x/><title>&lt;/title&gt;&lt;img&gt;");/<\/title/.test(e.querySelector("title").innerHTML)&&(x=!0)}catch(e){}}(),function(){try{Ue("<svg></p></svg>").querySelector("svg p")&&(m=!0)}catch(e){}}());var je=function(e){return J.call(e.ownerDocument||e,e,L.SHOW_ELEMENT|L.SHOW_COMMENT|L.SHOW_TEXT,(function(){return L.FILTER_ACCEPT}),!1)},We=function(e){return"object"===(void 0===R?"undefined":I(R))?e instanceof R:e&&"object"===(void 0===e?"undefined":I(e))&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},Be=function(e,t,n){X[e]&&X[e].forEach((function(e){e.call(u,t,n,Oe)}))},ze=function(e){var t,n=void 0;if(Be("beforeSanitizeElements",e,null),!((t=e)instanceof W||t instanceof B||"string"==typeof t.nodeName&&"string"==typeof t.textContent&&"function"==typeof t.removeChild&&t.attributes instanceof j&&"function"==typeof t.removeAttribute&&"function"==typeof t.setAttribute&&"string"==typeof t.namespaceURI))return Re(e),!0;var o=e.nodeName.toLowerCase();if(Be("uponSanitizeElement",e,{tagName:o,allowedTags:se}),!se[o]||de[o]){if(Ce&&!Ne[o]&&"function"==typeof e.insertAdjacentHTML)try{var r=e.innerHTML;e.insertAdjacentHTML("AfterEnd",H?H.createHTML(r):r)}catch(e){}return Re(e),!0}return"noscript"===o&&/<\/noscript/i.test(e.innerHTML)||"noembed"===o&&/<\/noembed/i.test(e.innerHTML)||e.namespaceURI&&/svg|math/i.test(e.namespaceURI)&&e.textContent&&new RegExp("</"+o,"i").test(e.textContent)?(Re(e),!0):"svg"!==o&&"math"!==o||0===e.querySelectorAll("template, svg, math").length?(!fe||e.firstElementChild||e.content&&e.content.firstElementChild||!/</g.test(e.textContent)||(u.removed.push({element:e.cloneNode()}),e.innerHTML?e.innerHTML=e.innerHTML.replace(/</g,"&lt;"):e.innerHTML=e.textContent.replace(/</g,"&lt;")),me&&3===e.nodeType&&(n=(n=(n=e.textContent).replace($," ")).replace(ee," "),e.textContent!==n&&(u.removed.push({element:e.cloneNode()}),e.textContent=n)),Be("afterSanitizeElements",e,null),!1):(Re(e),!0)},Ve=function(e,t,n){if(Ie&&("id"===t||"name"===t)&&(n in O||n in De))return!1;if(he&&te.test(t));else if(le&&ne.test(t));else{if(!ce[t]||ue[t])return!1;if(Me[t]);else if(ie.test(n.replace(re,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==n.indexOf("data:")||!Ae[e])if(ge&&!oe.test(n.replace(re,"")));else if(n)return!1}return!0},Fe=function(e){var t=void 0,n=void 0,o=void 0,r=void 0,i=void 0;Be("beforeSanitizeAttributes",e,null);var s=e.attributes;if(s){var a={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ce};for(i=s.length;i--;){var c=t=s[i],p=c.name,d=c.namespaceURI;if(n=t.value.trim(),o=p.toLowerCase(),a.attrName=o,a.attrValue=n,a.keepAttr=!0,Be("uponSanitizeAttribute",e,a),n=a.attrValue,(se.svg&&!de.svg||se.math&&!de.math)&&m&&/<\//.test(n)&&Re(e),"name"===o&&"IMG"===e.nodeName&&s.id)r=s.id,s=T(P,s,[]),Le("id",e),Le(p,e),s.indexOf(r)>i&&e.setAttribute("id",r.value);else{if("INPUT"===e.nodeName&&"type"===o&&"file"===n&&a.keepAttr&&(ce[o]||!ue[o]))continue;"id"===p&&e.setAttribute(p,""),Le(p,e)}if(a.keepAttr){me&&(n=(n=n.replace($," ")).replace(ee," "));var l=e.nodeName.toLowerCase();if(Ve(l,o,n))try{d?e.setAttributeNS(d,p,n):e.setAttribute(p,n),u.removed.pop()}catch(e){}}}Be("afterSanitizeAttributes",e,null)}},He=function e(t){var n=void 0,o=je(t);for(Be("beforeSanitizeShadowDOM",t,null);n=o.nextNode();)Be("uponSanitizeShadowNode",n,null),ze(n)||(n.content instanceof D&&e(n.content),Fe(n));Be("afterSanitizeShadowDOM",t,null)};return u.sanitize=function(e,t){var n=void 0,o=void 0,r=void 0,i=void 0,a=void 0;if(e||(e="\x3c!--\x3e"),"string"!=typeof e&&!We(e)){if("function"!=typeof e.toString)throw new TypeError("toString is not a function");if("string"!=typeof(e=e.toString()))throw new TypeError("dirty is not a string, aborting")}if(!u.isSupported){if("object"===I(s.toStaticHTML)||"function"==typeof s.toStaticHTML){if("string"==typeof e)return s.toStaticHTML(e);if(We(e))return s.toStaticHTML(e.outerHTML)}return e}if(ve||ke(t),u.removed=[],Te);else if(e instanceof R)1===(o=(n=Ue("\x3c!--\x3e")).ownerDocument.importNode(e,!0)).nodeType&&"BODY"===o.nodeName||"HTML"===o.nodeName?n=o:n.appendChild(o);else{if(!ye&&!me&&!_e&&Ee&&-1===e.indexOf("<"))return H?H.createHTML(e):e;if(!(n=Ue(e)))return ye?null:G}n&&we&&Re(n.firstChild);for(var c=je(Te?e:n);r=c.nextNode();)3===r.nodeType&&r===i||ze(r)||(r.content instanceof D&&He(r.content),Fe(r),i=r);if(i=null,Te)return e;if(ye){if(be)for(a=Q.call(n.ownerDocument);n.firstChild;)a.appendChild(n.firstChild);else a=n;return Se&&(a=Z.call(l,a,!0)),a}var p=_e?n.outerHTML:n.innerHTML;return me&&(p=(p=p.replace($," ")).replace(ee," ")),H&&Ee?H.createHTML(p):p},u.setConfig=function(e){ke(e),ve=!0},u.clearConfig=function(){Oe=null,ve=!1},u.isValidAttribute=function(e,t,n){Oe||ke({});var o=e.toLowerCase(),r=t.toLowerCase();return Ve(o,r,n)},u.addHook=function(e,t){"function"==typeof t&&(X[e]=X[e]||[],X[e].push(t))},u.removeHook=function(e){X[e]&&X[e].pop()},u.removeHooks=function(e){X[e]&&(X[e]=[])},u.removeAllHooks=function(){X={}},u}()}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(3);t.Controller=class{constructor(e){this.baseOptions=e,this.resizeListener=this.handleResize.bind(this),window.addEventListener("resize",this.resizeListener)}attachAndAnimateEntry(){return this.attach().then(()=>this.performEntryAnimation())}performEntryAnimation(){const e=this.animationElement;return e&&e.animate?(this.dimBackgroundElement&&this.dimBackgroundElement.animate([{opacity:0},{opacity:1}],{duration:250}),new Promise(t=>{let n;switch(this.baseOptions.entryAnimation){case o.EntryAnimation.FADE_IN:n=e.animate([{opacity:0},{opacity:1}],{duration:250});break;case o.EntryAnimation.SLIDE_IN_FROM_BOTTOM:{const t=e.clientHeight;n=e.animate([{transform:"translateY("+Math.round(t)+"px)"},{transform:"translateX(0)"}],{duration:250})}break;case o.EntryAnimation.SLIDE_IN_FROM_LEFT:{const t=-e.clientWidth;n=e.animate([{transform:"translateX("+Math.round(t)+"px)"},{transform:"translateX(0)"}],{duration:250})}break;case o.EntryAnimation.SLIDE_IN_FROM_RIGHT:{const t=e.clientWidth;n=e.animate([{transform:"translateX("+Math.round(t)+"px)"},{transform:"translateX(0)"}],{duration:250})}break;case o.EntryAnimation.SLIDE_IN_FROM_TOP:{const t=-e.clientHeight;n=e.animate([{transform:"translateY("+Math.round(t)+"px)"},{transform:"translateX(0)"}],{duration:250})}break;default:t()}n&&(n.onfinish=n.oncancel=()=>t())})):Promise.resolve()}performExitAnimation(){const e=this.animationElement;return e&&e.animate?new Promise(t=>{let n;switch(this.dimBackgroundElement&&this.dimBackgroundElement.animate([{opacity:1},{opacity:0}],{duration:250}),this.baseOptions.exitAnimation){case o.ExitAnimation.FADE_OUT:n=e.animate([{opacity:0}],{duration:250});break;case o.ExitAnimation.SLIDE_OUT_DOWN:{const t=e.clientHeight;n=e.animate([{transform:"translateY("+Math.round(t)+"px)"}],{duration:250})}break;case o.ExitAnimation.SLIDE_OUT_LEFT:{const t=-e.clientWidth;n=e.animate([{transform:"translateX("+Math.round(t)+"px)"}],{duration:250})}break;case o.ExitAnimation.SLIDE_OUT_RIGHT:{const t=e.clientWidth;n=e.animate([{transform:"translateX("+Math.round(t)+"px)"}],{duration:250})}break;case o.ExitAnimation.SLIDE_OUT_TOP:{const t=-e.clientHeight;n=e.animate([{transform:"translateY("+Math.round(t)+"px)"}],{duration:250})}break;default:t()}n&&(n.onfinish=n.oncancel=()=>t())}):Promise.resolve()}get isLandscape(){return window.innerWidth>=window.innerHeight}destroy(){window.removeEventListener("resize",this.resizeListener)}click(e,t){this.active&&(this.clickCallback&&this.clickCallback(e,t),this.performExitAnimation().catch(console.error).then(()=>this.detach()),this.destroy())}dismiss(e){this.active&&(this.dismissType=e,this.dismissCallback&&this.dismissCallback(e),this.performExitAnimation().catch(console.error).then(()=>this.detach()),this.destroy())}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(7);t.MatchAllCriterionNode=class extends o.ASTCriterionNode{constructor(e){super(e)}accept(e){return e.visitMatchAllCriterionNode(this)}},t.AndCriterionNode=class extends o.ASTCriterionNode{constructor(e,t){super(e),this.children=t}accept(e){return e.visitAndCriterionNode(this)}},t.OrCriterionNode=class extends o.ASTCriterionNode{constructor(e,t){super(e),this.children=t}accept(e){return e.visitOrCriterionNode(this)}},t.NotCriterionNode=class extends o.ASTCriterionNode{constructor(e,t){super(e),this.child=t}accept(e){return e.visitNotCriterionNode(this)}},t.SegmentCriterionNode=class extends o.ASTCriterionNode{constructor(e,t){super(e),this.segmentId=t}accept(e){return e.visitSegmentCriterionNode(this)}},t.LastActivityDateCriterionNode=class extends o.ASTCriterionNode{constructor(e,t){super(e),this.dateComparison=t}accept(e){return e.visitLastActivityDateCriterionNode(this)}},t.PresenceCriterionNode=class extends o.ASTCriterionNode{constructor(e,t,n,o){super(e),this.present=t,this.sinceDateComparison=n,this.elapsedTimeComparison=o}accept(e){return e.visitPresenceCriterionNode(this)}},t.JoinCriterionNode=class extends o.ASTCriterionNode{constructor(e,t){super(e),this.child=t}accept(e){return e.visitJoinCriterionNode(this)}},t.EqualityCriterionNode=class extends o.ASTCriterionNode{constructor(e,t){super(e),this.value=t}accept(e){return e.visitEqualityCriterionNode(this)}},t.AllCriterionNode=class extends o.ASTCriterionNode{constructor(e,t){super(e),this.values=t}accept(e){return e.visitAllCriterionNode(this)}},t.AnyCriterionNode=class extends o.ASTCriterionNode{constructor(e,t){super(e),this.values=t}accept(e){return e.visitAnyCriterionNode(this)}},t.ComparisonCriterionNode=class extends o.ASTCriterionNode{constructor(e,t,n){super(e),this.comparator=t,this.value=n}accept(e){return e.visitComparisonCriterionNode(this)}},t.PrefixCriterionNode=class extends o.ASTCriterionNode{constructor(e,t){super(e),this.value=t}accept(e){return e.visitPrefixCriterionNode(this)}},t.SuffixCriterionNode=class extends o.ASTCriterionNode{constructor(e,t){super(e),this.value=t}accept(e){return e.visitSuffixCriterionNode(this)}},t.ContainsCriterionNode=class extends o.ASTCriterionNode{constructor(e,t){super(e),this.value=t}accept(e){return e.visitContainsCriterionNode(this)}},t.InsideCriterionNode=class extends o.ASTCriterionNode{constructor(e,t){super(e),this.value=t}accept(e){return e.visitInsideCriterionNode(this)}},t.GeoCriterionNode=class extends o.ASTCriterionNode{constructor(e,t,n){super(e),this.locationComparison=t,this.dateComparison=n}accept(e){return e.visitGeoCriterionNode(this)}},t.SubscriptionStatusCriterionNode=class extends o.ASTCriterionNode{constructor(e,t){super(e),this.subscriptionStatus=t}accept(e){return e.visitSubscriptionStatusCriterionNode(this)}},t.PushUnsupportedCriterionNode=class extends o.ASTCriterionNode{constructor(e,t){super(e),this.pushUnsupported=t}accept(e){return e.visitPushUnsupportedCriterionNode(this)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(7);t.NullValueNode=class extends o.ASTValueNode{constructor(e){super(e,null)}accept(e){return e.visitNullValueNode(this)}},t.BooleanValueNode=class extends o.ASTValueNode{accept(e){return e.visitBooleanValueNode(this)}},t.NumberValueNode=class extends o.ASTValueNode{accept(e){return e.visitNumberValueNode(this)}},t.StringValueNode=class extends o.ASTValueNode{accept(e){return e.visitStringValueNode(this)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(9);class r{constructor(e,t,n,o,r,i,s,a){this.positive=e,this.years=t,this.months=n,this.weeks=o,this.days=r,this.hours=i,this.minutes=s,this.seconds=a}static parse(e){if("string"!=typeof e)throw new o.BadInputError('"PT" ISO 8601 duration expects a string');const t="\\d+(?:(?:[.,])\\d*)?",n=new RegExp(`^([+-])?P(${t}Y)?(${t}M)?(${t}W)?(${t}D)?(?:T(${t}H)?(${t}M)?(${t}S)?)?$`).exec(e);if(null===n)throw new o.BadInputError('invalid "PT" ISO 8601 duration given');const i="-"!==n[1],s=e=>parseFloat((n[e]||"").replace(",","."))||0,a=s(2),c=s(3),p=s(4),d=s(5),u=s(6),l=s(7),h=s(8);return new r(i,a,c,p,d,u,l,h)}applyTo(e){const t=this.positive?1:-1,n=e.getUTCFullYear()+t*this.years,o=e.getUTCMonth()+t*this.months,r=e.getUTCDate()+t*(7*this.weeks+this.days),i=e.getUTCHours()+t*this.hours,s=e.getUTCMinutes()+t*this.minutes,a=e.getUTCSeconds()+e.getUTCMilliseconds()/1e3+t*this.seconds,c=Math.trunc(a),p=Math.round(1e3*(a-c));return new Date(Date.UTC(n,o,r,i,s,c,p))}}t.ISO8601Duration=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoLocation=class{constructor(e,t){this.lat=e,this.lon=t}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o{constructor(e,t,n,o){this.top=e,this.right=t,this.bottom=n,this.left=o}static fromTopRightBottomLeft(e,t,n,r){return new o(e,t,n,r)}static fromTopRightAndBottomLeft(e,t){return new o(e.lat,e.lon,t.lat,t.lon)}static fromTopLeftAndBottomRight(e,t){return new o(e.lat,t.lon,t.lat,e.lon)}}t.GeoBox=o},function(e,t,n){"use strict";n.r(t),n.d(t,"WorkerMessengerCommand",(function(){return o})),n.d(t,"registerListeners",(function(){return r}));const o={AMP_SUBSCRIPTION_STATE:"amp-web-push-subscription-state",AMP_SUBSCRIBE:"amp-web-push-subscribe",AMP_UNSUBSCRIBE:"amp-web-push-unsubscribe"};function r(e,t){const n=e();t("message",e=>{const{command:t}=e.data;switch(t){case o.AMP_SUBSCRIPTION_STATE:n.then(e=>{!function(e){let t=null;Promise.all([self.registration.pushManager.getSubscription().then(e=>(t=e,e?self.registration.pushManager.permissionState(e.options):null)),e.getManuallyUnsubscribed()]).then(([e,n])=>{if(null==e||n)i(o.AMP_SUBSCRIPTION_STATE,!1);else{const n=!!t&&"granted"===e;i(o.AMP_SUBSCRIPTION_STATE,n)}})}({getManuallyUnsubscribed:e.getManuallyUnsubscribed})});break;case o.AMP_SUBSCRIBE:n.then(e=>{e={applicationServerKey:e.applicationServerKey,onSubscribe:e.onSubscribe},self.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e.applicationServerKey}).then(t=>e.onSubscribe(t)).then(()=>{i(o.AMP_SUBSCRIBE,null)})});break;case o.AMP_UNSUBSCRIBE:n.then(e=>{!function(e){e&&e.onUnsubscribe&&e.onUnsubscribe().then(()=>{i(o.AMP_UNSUBSCRIBE,null)})}({onUnsubscribe:e.onUnsubscribe})})}})}function i(e,t){self.clients.matchAll().then(n=>{for(let o=0;o<n.length;o++)n[o].postMessage({command:e,payload:t})})}},function(e,t,n){var o;void 0===(o=function(){return function(e){var t=function(){var e=JSON.parse(JSON.stringify(o));return delete e._mergeStoredOptions,delete e._mode,delete e._popup,delete e._hiddenFrame,delete e._syncInit,e},n="[options     ]",o=JSON.parse(JSON.stringify(e._protected.options||{})),r=t();Object.freeze(r),delete e._protected.options;var i=new e._protected.Promise.Deferred;return e._protected.Options=new function(){var s=!1,a={webKey:!0,_mode:!0,_hiddenFrame:!0,_popup:!0};function c(t,r){return s||t in a||e._protected.Helper.warn(n,new e._protected.Errors.InternalOptionsNotYetAvailableError("Option "+t+" read before options get filled")),e._protected.Helper.plainObjectCopy(t in o?o[t]:r)}function p(t){return s||t in a||e._protected.Helper.warn(n,new e._protected.Errors.InternalOptionsNotYetAvailableError("Option "+t+" tested before options get filled")),t in o}function d(e){delete o[e]}e.preInstantiationPromise.then((function(){p.debug&&e._protected.Helper.debug(n,"storage module initialization…"),e._protected.Storage.getModuleInitializationPromise().then((function(){return p.debug&&e._protected.Helper.debug(n,"storage module initialization resolved"),e._protected.Storage.isDefaultContainerAvailable()?e._protected.RunModes.Behaviors.ModeServiceWorker||!0===o._mergeStoredOptions?(p.debug&&e._protected.Helper.debug(n,"read stored options…"),e._protected.Storage.get("options",{webKey:o.webKey}).then((function(i){p.debug&&e._protected.Helper.debug(n,"read stored options resolved",i),e._protected.Helper.mergeObjectInplaceRecursive(i,o),!0===(o=i)._mergeStoredOptions&&(r=t(),Object.freeze(r))}))):void 0:(s=!0,i.resolve(),void(p.debug&&e._protected.Helper.debug(n,"module initialized without Storage support")))})).then((function(){s=!0,e._protected.Helper._debugResolved(),p.debug&&e._protected.Helper.debug(n,"options:",o),p.debug&&e._protected.Helper.debug(n,"module initialized")})).then((function(){if(e._protected.RunModes.Behaviors.ModeFrame||e._protected.RunModes.Behaviors.ModeWebSite&&e._protected.Integration.isOnRightDomain())return p.debug&&e._protected.Helper.debug(n,"storing options…",r),e._protected.Storage.set("options",r).then((function(){p.debug&&e._protected.Helper.debug(n,"storing options resolved")}))})).then(()=>{i.resolve()})})),this.get=c,this.has=p,this.getModuleInitializationPromise=function(){return i.promise},this.exportCurrent=t,this.exportInitial=function(){return e._protected.Helper.plainObjectCopy(r)},this.merge=function(t,r){p.debug&&e._protected.Helper.debug(n,"merging",o,"with default =",t,"and override =",r),o=e._protected.Options._merge3Way(JSON.parse(JSON.stringify(t||{})),JSON.parse(JSON.stringify(o||{})),JSON.parse(JSON.stringify(r||{}))),p.debug&&e._protected.Helper.debug(n,"merged options =",o)},this._merge3Way=function(t,n,r){var i=JSON.parse(JSON.stringify(t));return e._protected.Helper.mergeObjectInplaceRecursive(i,JSON.parse(JSON.stringify(o))),e._protected.Helper.mergeObjectInplaceRecursive(i,JSON.parse(JSON.stringify(r))),i},this.isDebug=function(){return!!c("debug",!1)},this.getFrameUrl=function(){return c("frameUrl",e._protected.Constants.FRAME_URL)},this.getServiceWorkerUrl=function(){return c("serviceWorkerUrl",e._protected.Constants.SERVICE_WORKER_URL)},this.getWebKey=function(){return c("webKey")},this.getTranslations=function(){return c("translations")||{}},this.getServiceWorkerScope=function(){return c("serviceWorkerScope")},this.getRedirectionPageUrl=function(t){var n=c("redirectionPageUrl",e._protected.Constants.REDIRECT_URL);return t&&(n=n.replace("${url}",encodeURIComponent(t))),n},this.get_mode=function(){return void 0===c("_mode")?e._protected.gscope.ServiceWorkerGlobalScope?e._protected.RunModes.Modes.ServiceWorker:e._protected.Options.get_hiddenFrame()?e._protected.RunModes.Modes.Frame:e._protected.Options.get_popup()?e._protected.RunModes.Modes.Popup:e._protected.RunModes.Modes.WebSite:c("_mode")},this.remove_mode=function(){return e._protected.Options.remove_hiddenFrame(),e._protected.Options.remove_popup(),d("_mode")},this.get_hiddenFrame=function(){return c("_hiddenFrame")},this.remove_hiddenFrame=function(){return d("_hiddenFrame")},this.get_popup=function(){return c("_popup")},this.remove_popup=function(){return d("_popup")},this.getLanguage=function(){return c("language")}},e._protected.RunModes.setCurrentMode(e._protected.Options.get_mode()),e._protected.Options.remove_mode(),i.promise}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t=e._protected.Options._merge3Way;e._protected.Options._merge3Way=function(n,o,r){var i=t(n,o,r);return i.plugins=e._protected.Plugins.mergeOptionsPlugins(n.plugins||{},o.plugins||{},r.plugins||{}),i},e._protected.Options.getRequiresUserConsent=function(){return e._protected.Options.get("requiresUserConsent")||!1},e._protected.Options.getStylesheetUrl=function(){return e._protected.Options.get("stylesheetUrl")},e._protected.Options.getCustomDomain=function(){return e._protected.Options.get("customDomain")},e._protected.Options.getServiceWorkerUrl=function(){var t=e._protected.Options.get("serviceWorkerUrl",e._protected.Constants.SERVICE_WORKER_URL);return t.replace("${webKey}",encodeURIComponent(e._protected.Options.getWebKey()))},e._protected.Options.getManifestUrl=function(){return e._protected.Options.get("manifestUrl",e._protected.Constants.MANIFEST_URL)},e._protected.Options.getUserId=function(){return e._protected.Options.get("userId",null)},e._protected.Options.hasUserId=function(){return e._protected.Options.has("userId")},e._protected.Options.getApiUrlPrefix=function(){return"https://"+e._protected.Options.get("_rootApiUrl",e._protected.Constants.ROOT_API_URL)+"/"+e._protected.Options.get("_apiVersion",e._protected.Constants.API_VERSION)},e._protected.Options.getMeasurementsApiUrlPrefix=function(){let t=e._protected.Options.get("_measurementApiUrl",e._protected.Constants.MEASUREMENTS_API_BASE_URL);return t.replace(/\/*$/,"")},e._protected.Options.getApplicationVersion=function(){return e._protected.Options.get("applicationVersion")},e._protected.Options.getIntegrator=function(){return e._protected.Options.get("integrator")},e._protected.Options.getGeolocation=function(){return e._protected.Options.get("geolocation","auto")},e._protected.Options.getNotificationIcon=function(){return e._protected.Options.get("notificationIcon")},e._protected.Options.getDefaultNotificationUrl=function(){return e._protected.Options.get("notificationDefaultUrl")},e._protected.Options.getApplicationName=function(){return e._protected.Options.get("applicationName",location.hostname)},e._protected.Options.getOptInOptions=function(){return e._protected.Options.get("optInOptions",{})},e._protected.Options.getPlugins=function(){return e._protected.Options.get("plugins")},e._protected.Options.getSubscriptionOptions=function(){return e._protected.Options.get("subscriptionOptions",{})},e._protected.Options.getApplicationServerKey=function(){return e._protected.Options.get("applicationServerKey")},e._protected.Options.getAllowedSubscriptionDomains=function(){return e._protected.Options.get("allowedSubscriptionDomains")}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t,n=!1,o=e.prototype.SessionState.INIT_UNSTARTED,r=new Promise((function(t,n){var o=function(n){"session"===(n.detail||{}).name&&n.detail.state===e.this.SessionState.INIT_SUCCESS&&(t(),e._protected.Events.unlisten(o))};e._protected.Events.listen(o)})),i=function(){if(!e._protected.Init.isInitialized()){var t=function(){n=!0,s(e.this.SessionState.INIT_SUCCESS)},o=function(){s(e.this.SessionState.INIT_FAILED)};e._protected.Blocker.category("accessToken").add("initNeedsConfig"),e._protected.Config.getModuleInitializationPromise().then(()=>{e._protected.Integration.isOnRightDomain()&&e._protected.Blocker.category("accessToken").remove("isOnRightDomain"),e._protected.RunModes.Behaviors.CoreProperties&&e._protected.Installation.updateInstallationCoreProperties()}),e._protected.Config.getModuleInitializationPromise().then((function(){e._protected.RunModes.Behaviors.AccessToken&&e._protected.Integration.isOnRightDomain()&&(s(e.this.SessionState.INIT_INPROGRESS),e.instantiationPromise.then((function(){e._protected.getUserId().then(n=>e._protected.Init.fetchAccessTokenIfNeeded(n,t,o))}))),e._protected.Blocker.category("accessToken").remove("initNeedsConfig")}))}e._protected.Blocker.category("ready").remove("init")};e._protected.Init.isInitialized=function(){return n},e._protected.Init.getSessionState=function(){return o};var s=function(n){t!==(o=n)&&(t=o,e._protected.Events.fire(e._protected.Events.WonderPushSessionEvent(e._protected.Init.getSessionState())),e._protected.RunModes.Behaviors.ModeFrame&&e._protected.Init.setSessionStateOnParentWindow(n),n===e.prototype.SessionState.INIT_SUCCESS&&((e._protected.RunModes.Behaviors.ModeFrame||e._protected.RunModes.Behaviors.ModeWebSite&&e._protected.Integration.isOnRightDomain())&&e._protected.Helper.supportsServiceWorker()&&e._protected.Init.setSessionStateOnServiceWorker(n),e._protected.RunModes.Behaviors.ModeServiceWorker&&e._protected.Init.setSessionStateOnServiceWorkerClients(n)))};e._protected.Init.setSessionStateOnParentWindow=e._protected.Integration.proxifyToParentWindow("WonderPushSDK._protected.Init.setSessionStateOnParentWindow",(function(e){s(e)})),e._protected.Init.setSessionStateOnServiceWorker=e._protected.Integration.proxifyToServiceWorker("WonderPushSDK._protected.Init.setSessionStateOnServiceWorker",(function(e){s(e)})),e._protected.Init.setSessionStateOnServiceWorkerClients=e._protected.Integration.proxifyToServiceWorkerClients("WonderPushSDK._protected.Init.setSessionStateOnServiceWorkerClients",(function(e){s(e)})),e.prototype.getInitializationPromise=function(){return r},e._protected.Init.getDeviceId=function(){return e._protected.Storage.get("deviceId",null).then((function(t){if(t)return t;var n=e._protected.Helper.uuidv4()+"-"+(+new Date).toString(16);return e._protected.Storage.set("deviceId",n).then((function(){return n}))}))},e._protected.Init.getFederatedDeviceId=function(){const t=e._protected.Helper.detectBrowser();return t&&"Safari"===t.name?Promise.resolve(null):e._protected.Storage.get("federatedDeviceId",null).then((function(t){return t||(e._protected.RunModes.Behaviors.ContextWindow?new Promise((function(t){e._protected.Integration.isOnFederatedDomain()?t(e._protected.Helper.uuidv4()+"-"+(+new Date).toString(16)):t(e._protected.Federated.call("WonderPushSDK._protected.Init.getFederatedDeviceId",[]))})).then((function(t){return e._protected.Promise.catchNoop(e._protected.Storage.set("federatedDeviceId",t)).then((function(){return t}))})):null)}))},e._protected.Blocker.category("accessToken").wait().then(()=>e._protected.getUserId()).then((function(t){e._protected.Init.fetchAccessTokenIfNeeded(t)}));var a={},c=function(e,t,n,o){for(var r=0;r<e.length;++r)e[r][t].call(n,o);e.splice(0)};e._protected.Init.fetchAccessTokenIfNeeded=function(t,n,o){e._protected.RunModes.Behaviors.AccessToken&&e._protected.Integration.isOnRightDomain()?e._protected.Consent.awaitUserConsent().then(()=>{var r=function(){};"function"!=typeof n&&(n=r),"function"!=typeof o&&(o=r),a[t]||(a[t]=[]),a[t].push({onload:n,onerror:o}),e._protected.Blocker.category("accessToken").unblocked()&&(n=function(){c(a[t],"onload",this)},o=function(){c(a[t],"onerror",this)},e._protected.Session.getSession(t).then((function(r){if(r&&r.accessToken&&r.installationId)setTimeout(n,0);else{var i=new e._protected.Locking.ExpiringUnfairNamedGlobalMutex("fetchAccessToken:userId="+(t||""),3e4);i.tryAcquire().then((function(){var r=new e._protected.Promise.Deferred;i.renewWhile({interval:15e3,release:!0},r.promise),e._protected.Promise.catchNoop(r.promise),function(t,n){e._protected.RunModes.Behaviors.AccessToken&&e._protected.Integration.isOnRightDomain()?e._protected.Init.getDeviceId().then((function(o){var r={clientId:e._protected.Options.getWebKey(),devicePlatform:"Web",deviceId:o,userId:t};r.userId||delete r.userId,e._protected.Rest.post(t,"/authentication/accessToken",r,void 0,n)}),(function(e){console.warn("Failed to read deviceId",e),n.onerror&&n.onerror.call(null,e)})):console.error("fetchAccessToken should not be called from this mode")}(t,{onload:function(t){e._protected.Promise.do(function(t){var o=function(t){var o=(t=t||{}).token||null,r=(t.data||{}).sid||null,s=(t.data||{}).installationId||null,a=(t.data||{}).userId||null;return o&&s?i.renew().then((function(){var i=[];return t._installation instanceof Object&&i.push(e._protected.JsonSyncInstallationCustom.receiveStateForUser(a,t._installation.custom||{},!1)),i.push(e._protected.Session.setSession({accessToken:o,sid:r,installationId:s,userId:a})),Promise.all(i).then((function(){setTimeout((function(){n()}),0)}))}),(function(){return Promise.reject()})):Promise.reject("invalid access token")};return"function"==typeof Response&&t instanceof Response?t.json().then(o):o(this.responseJSON)}.call(this,t),r.resolve).catch((function(e){o.call(this,e)}))},onerror:function(e){r.reject(e),o.call(this,e)}})}),(function(){setTimeout((function(){e._protected.Init.fetchAccessTokenIfNeeded(t,null,null)}),2e3)}))}})))}):console.error("fetchAccessToken should not be called from this mode")},e._protected.Blocker.category("ready").add("init"),e._protected.RunModes.Behaviors.AccessToken||e._protected.Blocker.category("accessToken").add("mode"),e._protected.Blocker.category("accessToken").add("isOnRightDomain"),setTimeout((function(){e.preInstantiationPromise.then(i)}),0)}}.apply(t,[]))||(e.exports=o)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(2),r="InAppRateLimiter",i="[rate-limiter]";t.RateLimiter=class{constructor(e,t){this.storage=e,this.locking=t}makeMutex(e){return this.locking.getModuleInitializationPromise().then(()=>this.locking.remoteMutexManager.create("RateLimit_"+e.key,500))}increment(e){let t;return o.debug(i,"[increment   ]","try increment",e.key),this.makeMutex(e).then(n=>(t=n,o.debug(i,"[increment   ]","acquiring mutex",e.key),this.locking.remoteMutexManager.acquire(t,{timeout:500}))).catch(n=>{throw o.debug(i,"[increment   ]","could not acquire mutex",n,e.key),t=void 0,n}).then(()=>{let t;return o.debug(i,"[increment   ]","got mutex",e.key),this.storage.bulk([{test:{key:r,defaultValue:{},operationsCb:n=>{o.debug(i,"[increment   ]","got storage result",e.key,JSON.parse(JSON.stringify(n)));const s=n[e.key]||{count:0,createdAt:+new Date};n[e.key]=s;const a=new Date;return s.createdAt+e.timeToLive<=a.getTime()&&(o.debug(i,"[increment   ]","reset",e.key),s.createdAt=a.getTime(),s.count=0),s.count>=e.limit?(o.debug(i,"[increment   ]","limit reached",e.key),t=new Error(`Cannot increment rate limit ${e.key}: limit reached`),[]):(s.count++,o.debug(i,"[increment   ]","increment",e.key,s.count),[{put:{key:r,value:n}}])}}}]).then(()=>{if(t)throw t})}).catch(e=>{throw t&&this.locking.remoteMutexManager.release(t).catch(e=>o.error(i,"[increment   ]","could not release mutex",e)),e}).then(()=>(o.debug(i,"[increment   ]","increment done",e.key),this.locking.remoteMutexManager.release(t)))}isRateLimited(e){let t;return this.makeMutex(e).then(e=>(t=e,this.locking.remoteMutexManager.acquire(t,{timeout:500}))).catch(n=>{throw o.debug(i,"[isRateLimit…]","could not acquire mutex",n,e.key),t=void 0,n}).then(()=>(o.debug(i,"[isRateLimit…]","mutex acquired",e.key),this.storage.get(r,{}))).then(t=>{o.debug(i,"[isRateLimit…]","got cache",JSON.parse(JSON.stringify(t)),e.key);const n=t[e.key];return!!n&&!(n.createdAt+e.timeToLive<+new Date)&&n.count>=e.limit}).catch(e=>{throw o.debug(i,"[isRateLimit…]","error",e),t&&this.locking.remoteMutexManager.release(t).catch(e=>o.error(i,"[isRateLimit…]","could not release mutex",e)),e}).then(n=>(o.debug(i,"[isRateLimit…]",e.key,n?"is":"is not","rate limited"),o.debug(i,"[isRateLimit…]","releasing mutex",e.key),this.locking.remoteMutexManager.release(t).then(()=>n)))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(3);t.EventRateLimits=[{limit:1,timeToLive:6e4,eventType:o.SystemEvent.ON_FOREGROUND,key:"system-event"},{limit:1,timeToLive:6e4,eventType:o.SystemEvent.APP_LAUNCH,key:"system-event"},{limit:1,timeToLive:6e4,eventType:o.SystemEvent.ON_EXIT,key:"system-event"}]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisplayHelper=class{static makeCloseButton(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");return e.setAttribute("height","24"),e.setAttribute("width","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("class","wpiam-cancel-button"),e.innerHTML='<circle fill="#FFFFFF" cx="12" cy="12" r="8"/><path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z" /><path d="M0 0h24v24H0z" fill="none" />',e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(124),r=n(2),i="[inapp-segme…]";class s{constructor(e,t,n,r,i,s,a){this.segment=e,this.installationCoreProperties=t,this.installationCustomProperties=n,this.tags=r,this.allEvents=i,this.presenceInfo=s,this.subscriptionState=a,this.dslParser=o.defaultParserLenient,this.installationSource=new o.InstallationSource}matches(){if(!this.segment)return!0;const e=this.dslParser.parse(this.segment,this.installationSource);return this.matchesSegment(e)}matchesSegment(e){return e.accept(new u(this.installationCoreProperties,this.installationCustomProperties,this.tags,this.allEvents,this.presenceInfo,this.subscriptionState))}static toJsValue(e){return e instanceof o.BooleanValueNode||e instanceof o.NumberValueNode||e instanceof o.StringValueNode||e instanceof o.DateValueNode||e instanceof o.DurationValueNode||e instanceof o.NullValueNode?e.value:e instanceof o.RelativeDateValueNode?e.duration.applyTo(new Date).getTime():void r.warn(i,"[toJsValue   ]","Unsupported value",e)}}t.Segmenter=s;class a{constructor(e,t,n,o,r,i){this.installationCoreProperties=e,this.installationCustomProperties=t,this.tags=n,this.allEvents=o,this.presenceInfo=r,this.subscriptionState=i}visitSubscriptionStatusCriterionNode(e){return e.subscriptionStatus===this.subscriptionState}visitPushUnsupportedCriterionNode(e){return e.pushUnsupported===("undefined"==typeof PushManager)}visitLastActivityDateCriterionNode(e){return e.dateComparison?e.dateComparison.accept(this):this.lastVisitDate()>0}visitASTValueNode(e){return r.warn(i,"[visitASTVal…]","not implemented"),!1}visitAllCriterionNode(e){const t=e.context.dataSource.accept(this);for(const n of e.values){let o=!1;const a=s.toJsValue(n);if(null===a)0===t.length&&(o=!0);else for(const e of t)if(e===a){o=!0;break}if(!o)return r.debug(i,"[visitAllCri…]","return false because",t,"!==",a,e),!1}return r.debug(i,"[visitAllCri…]","return true",t,e),!0}visitAndCriterionNode(e){for(const t of e.children)if(!t.accept(this))return r.debug(i,"[visitAndCri…]","return false because",t,"is false.",e),!1;return r.debug(i,"[visitAndCri…]","return true",e),!0}visitAnyCriterionNode(e){const t=e.context.dataSource.accept(this);for(const n of e.values){const o=s.toJsValue(n);if(null===o&&0===t.length)return r.debug(i,"[visitAnyCri…] return true for ",t),!0;for(const n of t)if(n===o)return r.debug(i,"[visitAnyCri…]","return true because",n,"===",o,e),!0}return r.debug(i,"[visitAnyCri…]","return false",e),!1}visitComparisonCriterionNode(e){const t=e.context.dataSource.accept(this);let n=!1;const o=s.toJsValue(e.value);for(const r of t){switch(e.comparator){case"gt":n=r>o;break;case"lt":n=r<o;break;case"gte":n=r>=o;break;case"lte":n=r<=o}if(n)break}return r.debug(i,"[visitCompar…]","return",n,"because",t,e.comparator,o,e),n}visitEqualityCriterionNode(e){const t=e.context.dataSource.accept(this),n=s.toJsValue(e.value);if(null===n)return 0===t.length;let o=!1;for(const e of t)if(o=e===n)break;return r.debug(i,"[visitEquali…]","return",o,"because",t,o?"===":"!==",n,e),o}visitGeoCriterionNode(e){return r.warn(i,"[visitGeoCri…]","not implemented"),!1}visitInsideCriterionNode(e){return r.warn(i,"[visitInside…]","not implemented"),!1}visitJoinCriterionNode(e){if(e.context.dataSource instanceof o.EventSource){for(const t of this.allEvents){const n=new l(this.installationCoreProperties,this.installationCustomProperties,this.tags,this.allEvents,this.presenceInfo,this.subscriptionState,t);if(e.child.accept(n))return!0}return!1}if(e.context.dataSource instanceof o.InstallationSource){const t=new u(this.installationCoreProperties,this.installationCustomProperties,this.tags,this.allEvents,this.presenceInfo,this.subscriptionState);return e.child.accept(t)}if(e.context.dataSource instanceof o.CurrentUrlSource){const t=new d(this.installationCoreProperties,this.installationCustomProperties,this.tags,this.allEvents,this.presenceInfo,this.subscriptionState);return e.child.accept(t)}return r.debug(i,"[visitJoinCr…] return false for unsupported",e.context.dataSource),!1}visitMatchAllCriterionNode(e){return r.debug(i,"[visitMatchA…]","return true",e),!0}visitNotCriterionNode(e){const t=!e.child.accept(this);return r.debug(i,"[visitNotCri…]","return",t,e),t}visitOrCriterionNode(e){for(const t of e.children)if(t.accept(this))return r.debug(i,"[visitOrCrit…]","return true because",t,"is true",e),!0;return r.debug(i,"[visitOrCrit…]","return false",e),!1}visitPrefixCriterionNode(e){const t=e.context.dataSource.accept(this),n=s.toJsValue(e.value);if("string"!=typeof n)return r.warn(i,"[visitPrefix…]",n,"is not a string",e),!1;let o=!1;for(const s of t)if("string"==typeof s){if(o=s.startsWith(n))break}else r.warn(i,"[visitPrefix…]",s,"is not a string",e);return r.debug(i,"[visitPrefix…]","return",o,"because",t,o?"does":"does not","start with",n,e),o}visitSuffixCriterionNode(e){const t=e.context.dataSource.accept(this),n=s.toJsValue(e.value);if("string"!=typeof n)return r.warn(i,"[visitSuffix…]",n,"is not a string",e),!1;let o=!1;for(const s of t)if("string"==typeof s){if(o=s.endsWith(n))break}else r.warn(i,"[visitSuffix…]",s,"is not a string",e);return r.debug(i,"[visitSuffix…]","return",o,"because",t,o?"does":"does not","end with",n,e),o}visitContainsCriterionNode(e){const t=e.context.dataSource.accept(this),n=s.toJsValue(e.value);if("string"!=typeof n)return r.warn(i,"[visitContai…]",n,"is not a string",e),!1;let o=!1;for(const s of t)if("string"==typeof s){if(o=s.includes(n))break}else r.warn(i,"[visitContai…]",s,"is not a string",e);return r.debug(i,"[visitContai…]","return",o,"because",t,o?"does":"does not","contain",n,e),o}visitPresenceCriterionNode(e){const t=+new Date;return!((!this.presenceInfo||this.presenceInfo.untilDate>=t&&this.presenceInfo.fromDate<=t)!==e.present||e.elapsedTimeComparison&&!e.elapsedTimeComparison.accept(this)||e.sinceDateComparison&&!e.sinceDateComparison.accept(this))}visitSegmentCriterionNode(e){return r.warn(i,"[visitSegmen…]","not implemented"),!1}visitASTUnknownCriterionNode(e){return r.warn(i,"[visitASTUnk…]","not implemented"),!1}visitEventSource(e){return[]}visitGeoDateSource(e){return[]}visitGeoLocationSource(e){return[]}visitInstallationSource(e){return[]}visitCurrentUrlSource(e){return[]}visitPresenceElapsedTimeSource(e){return e.present?[this.presenceInfo?Math.max(0,+new Date-this.presenceInfo.fromDate):0]:[this.presenceInfo?this.presenceInfo.elapsedTime:0]}visitPresenceSinceDateSource(e){return e.present?[this.presenceInfo?this.presenceInfo.fromDate:+new Date]:[this.presenceInfo?this.presenceInfo.untilDate:Number.MAX_VALUE]}visitUserSource(e){return[]}visitLastActivityDateSource(e){return[this.lastVisitDate()]}lastVisitDate(){let e=0;for(const t of this.allEvents)"@VISIT"===t.type&&t.actionDate&&t.actionDate>e&&(e=t.actionDate);return e}}const c=/^(\d\d\d\d(?:-\d\d(?:-\d\d)?)?)(?:T(\d\d(?::\d\d(?::\d\d(?:.\d\d\d)?)?)?))?(Z|[+-]\d\d(?::\d\d(?::\d\d(?:.\d\d\d)?)?)?)?$/,p=e=>{const t=c.exec(e);if(!t)return;let n=t[1],o=t[2];o||(o="");let r=t[3];r||(r=""),n+="1970-01-01".substring(n.length),o+="00:00:00.000".substring(o.length),"Z"===r&&(r=""),r.length>5&&(r=r.substring(0,5));const i=n+"T"+o+(r+="+00:00".substring(r.length));try{return new Date(i)}catch(e){return}};class d extends a{visitFieldSource(e){const t=e.fullPath().parts[0];if("undefined"==typeof window)return[];const{href:n,protocol:o,host:r,hostname:i,port:s,pathname:a,search:c,hash:p,origin:d}=window.location;return[{href:n,protocol:o,host:r,hostname:i,port:s,pathname:a,search:c,hash:p,origin:d}[t]]}}class u extends a{visitFieldSource(e){const t=e.fullPath();let n,o=Object.assign(Object.assign({},this.installationCoreProperties),{custom:Object.assign(Object.assign({},this.installationCustomProperties),{tags:Array.from(this.tags)})});for(const e of t.parts)o&&(o=o[e]);if(n=Array.isArray(o)?o.filter(e=>null!=e):null==o?[]:[o],t.parts.length>=2&&"custom"===t.parts[0]&&t.parts[t.parts.length-1].startsWith("date_")){const t=n;n=[];for(let o of t){if("string"==typeof o)try{const e=p(o);o=e?e.getTime():o}catch(e){}n.push(o)}}return n}}class l extends a{constructor(e,t,n,o,r,i,s){super(e,t,n,o,r,i),this.event=s}visitFieldSource(e){const t=e.fullPath();let n=this.event;for(const e of t.parts)n&&(n=n[e]);return Array.isArray(n)?n:null==n?[]:[n]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(7),r=n(14);t.DateValueNode=class extends o.ASTValueNode{constructor(e,t){super(e,t)}accept(e){return e.visitDateValueNode(this)}},t.RelativeDateValueNode=class extends o.ASTValueNode{constructor(e,t){super(e,Number.NaN),this.duration=t}get value(){return this.duration.applyTo(new Date).getTime()}set value(e){}accept(e){return e.visitRelativeDateValueNode(this)}},t.DurationValueNode=class extends o.ASTValueNode{constructor(e,t){if(t instanceof r.ISO8601Duration){const n=new Date;super(e,t.applyTo(n).getTime()-n.getTime())}else super(e,t)}accept(e){return e.visitDurationValueNode(this)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(7);t.GeoLocationValueNode=class extends o.ASTValueNode{accept(e){return e.visitGeoLocationValueNode(this)}};class r extends o.ASTValueNode{}t.GeoAbstractAreaValueNode=r,t.GeoBoxValueNode=class extends r{accept(e){return e.visitGeoBoxValueNode(this)}},t.GeoCircleValueNode=class extends r{accept(e){return e.visitGeoCircleValueNode(this)}},t.GeoPolygonValueNode=class extends r{accept(e){return e.visitGeoPolygonValueNode(this)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o extends Error{constructor(e,t,n){super("Parser already exists for key "+JSON.stringify(e)),this.key=e,this.oldParser=t,this.newParser=n}}t.CriterionParserAlreadyExistsForKey=o,t.ConfigurableCriterionNodeParser=class{constructor(){this.exactNameParsers=new Map,this.dynamicNameParsers=[]}registerExactNameParser(e,t){const n=this.exactNameParsers.get(e);if(void 0!==n)throw new o(e,n,t);this.exactNameParsers.set(e,t)}registerDynamicNameParser(e){this.dynamicNameParsers.push(e)}parseCriterion(e,t,n){const o=this.exactNameParsers.get(t);if(void 0!==o)return o(e,t,n);for(let o=0,r=this.dynamicNameParsers.length;o<r;++o){const r=(0,this.dynamicNameParsers[o])(e,t,n);if(null!==r)return r}return null}};class r extends Error{constructor(e,t,n){super("Parser already exists for key "+JSON.stringify(e)),this.key=e,this.oldParser=t,this.newParser=n}}t.ValueParserAlreadyExistsForKey=r,t.ConfigurableValueNodeParser=class{constructor(){this.exactNameParsers=new Map,this.dynamicNameParsers=[]}registerExactNameParser(e,t){const n=this.exactNameParsers.get(e);if(void 0!==n)throw new r(e,n,t);this.exactNameParsers.set(e,t)}registerDynamicNameParser(e){this.dynamicNameParsers.push(e)}parseValue(e,t,n){const o=this.exactNameParsers.get(t);if(void 0!==o)return o(e,t,n);for(let o=0,r=this.dynamicNameParsers.length;o<r;++o){const r=(0,this.dynamicNameParsers[o])(e,t,n);if(null!==r)return r}return null}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),r=n(15),i=n(16);class s{constructor(e,t,n,o,r){this.geohash=e,this.top=t,this.right=n,this.bottom=o,this.left=r}static parse(e){if("string"!=typeof e)throw new o.BadInputError('"geohash" expects a string');e=e.toLowerCase();let t,n=!0,r=s.MAX_LAT,i=s.MIN_LAT,a=s.MAX_LON,c=s.MIN_LON;for(let p=0,d=e.length;p<d;p++){const d=e[p],u=s.BASE32_CODES_DICT[d];if(void 0===u)throw new o.BadInputError('character "'+d+'" is not valid in a geohash');for(let e=4;e>=0;e--){const o=u>>e&1;n?(t=(a+c)/2,1===o?c=t:a=t):(t=(r+i)/2,1===o?i=t:r=t),n=!n}}return new s(e,r,a,i,c)}get centerLat(){return(this.top+this.bottom)/2}get centerLon(){return(this.left+this.right)/2}getTopLeft(){return new r.GeoLocation(this.top,this.left)}getTopRight(){return new r.GeoLocation(this.top,this.right)}getBottomLeft(){return new r.GeoLocation(this.bottom,this.left)}getBottomRight(){return new r.GeoLocation(this.bottom,this.right)}toGeoLocation(){return new r.GeoLocation(this.centerLat,this.centerLon)}toGeoBox(){return i.GeoBox.fromTopRightBottomLeft(this.top,this.right,this.bottom,this.left)}}t.Geohash=s,s.BASE32_CODES="0123456789bcdefghjkmnpqrstuvwxyz",s.BASE32_CODES_DICT=(()=>{const e={};for(let t=0;t<s.BASE32_CODES.length;t++)e[s.BASE32_CODES.charAt(t)]=t;return e})(),s.MIN_LAT=-90,s.MAX_LAT=90,s.MIN_LON=-180,s.MAX_LON=180},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoCircle=class{constructor(e,t){this.center=e,this.radiusMeters=t}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoPolygon=class{constructor(e){this.points=e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o{constructor(e){this.parts=e}static parse(e){return new o(e.split("."))}}t.FieldPath=o;class r{constructor(e){this.parent=e}getRootDataSource(){return null===this.parent?this:this.parent.getRootDataSource()}}t.DataSource=r,t.UserSource=class extends r{constructor(){super(null)}getName(){return"user"}accept(e){return e.visitUserSource(this)}},t.InstallationSource=class extends r{constructor(){super(null)}getName(){return"installation"}accept(e){return e.visitInstallationSource(this)}},t.CurrentUrlSource=class extends r{constructor(){super(null)}getName(){return"currentUrl"}accept(e){return e.visitCurrentUrlSource(this)}},t.EventSource=class extends r{constructor(){super(null)}getName(){return"event"}accept(e){return e.visitEventSource(this)}};class i extends r{constructor(e,t){super(e),this.path=t}getName(){return this.parent.getName()+"."+this.path.parts.join(".")}fullPath(){let e=this;const t=[];for(;null!==e;)e instanceof i&&t.unshift(...e.path.parts),e=e.parent;return new o(t)}accept(e){return e.visitFieldSource(this)}}t.FieldSource=i,t.LastActivityDateSource=class extends r{constructor(e){super(e)}getName(){return"lastActivityDate"}accept(e){return e.visitLastActivityDateSource(this)}},t.PresenceSinceDateSource=class extends r{constructor(e,t){super(e),this.present=t}getName(){return"presence.sinceDate"}accept(e){return e.visitPresenceSinceDateSource(this)}},t.PresenceElapsedTimeSource=class extends r{constructor(e,t){super(e),this.present=t}getName(){return"presence.elapsedTime"}accept(e){return e.visitPresenceElapsedTimeSource(this)}},t.GeoLocationSource=class extends r{constructor(e){super(e)}getName(){return"geo.location"}accept(e){return e.visitGeoLocationSource(this)}},t.GeoDateSource=class extends r{constructor(e){super(e)}getName(){return"geo.date"}accept(e){return e.visitGeoDateSource(this)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(7),r=n(12),i=n(9),s=n(13),a=n(33);t.SegmentationDSLParser=class{constructor(e){this.parserConfig=e}parse(e,t){const n=new a.ParsingContext(this,null,t);return this.parseCriterion(n,e)}parseCriterion(e,t){if(null===t||"object"!=typeof t||Array.isArray(t))throw new i.BadInputError("Expects an object");if(0===Object.keys(t).length){if(e.dataSource.getRootDataSource()!==e.dataSource)throw new i.BadInputError("Missing data criterion");return new r.MatchAllCriterionNode(e)}if(Object.keys(t).length>1)return new r.AndCriterionNode(e,Object.keys(t).map(n=>this.parseCriterion(e,{[n]:t[n]})));const n=Object.keys(t)[0];if(0===n.length)throw new i.BadInputError('Bad key ""');const s=t[n],a=this.parserConfig.criterionParser.parseCriterion(e,n,s);if(null===a){const t=new o.ASTUnknownCriterionNode(e,n,s);if(this.parserConfig.throwOnUnknownCriterion)throw new i.UnknownCriterionError(t);return t}return a}parseValue(e,t){if(null==t)return new s.NullValueNode(e);if("boolean"==typeof t)return new s.BooleanValueNode(e,t);if("number"==typeof t)return new s.NumberValueNode(e,t);if("string"==typeof t)return new s.StringValueNode(e,t);if(Array.isArray(t))throw new i.BadInputError("array values are not accepted");if("object"!=typeof t)throw new i.BadInputError(typeof t+" values are not accepted");const n=Object.keys(t);if(1!==n.length)throw new i.BadInputError("object values can only have 1 key defining their type");const r=n[0],a=t[r],c=this.parserConfig.valueParser.parseValue(e,r,a);if(null===c){const t=new o.ASTUnknownValueNode(e,r,a);if(this.parserConfig.throwOnUnknownValue)throw new i.UnknownValueError(t);return t}return c}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o{constructor(e,t,n){this.parser=e,this.parentContext=t,this.dataSource=n}withDataSource(e){return new o(this.parser,this,e)}}t.ParsingContext=o},function(e,t,n){var o,r;o=[n(35),n(53),n(56),n(57),n(58),n(59),n(60),n(61),n(62),n(19),n(63),n(64),n(68),n(69),n(70),n(71),n(72),n(20),n(73),n(74),n(75),n(76),n(77),n(79),n(80),n(81),n(82),n(83),n(84),n(85),n(86),n(87),n(88),n(89),n(90),n(97),n(98),n(99),n(100),n(103)],void 0===(r=function(e,t,o,r,i,s,a,c,p,d,u,l,h,g,f,m,_,v,w,y,b,S,E,I,C,T,P,N,A,M,x,O,D,k,R,L,U,j,W,B){var z=Array.prototype.slice.call(arguments).slice(1);z.push(n(126).default),function(t){"use strict";if(!t.WonderPush||"WonderPush"!==t.WonderPush.constructor.name){var n="undefined"!=typeof document?document.currentScript:null,o=!0,r=void 0,i=[];t.WonderPush&&(r=t.WonderPush?t.WonderPush.initOpts:void 0,i=Array.isArray(t.WonderPush)?t.WonderPush:Array.isArray(t.WonderPush.q)?t.WonderPush.q:[],o=!!t.ServiceWorkerGlobalScope);var s=a(location.search);o?c():setTimeout(c,0)}function a(e){var t={};if(e){"?"===e.charAt(0)&&(e=e.substring(1));for(var n=e.split("&"),o=0;o<n.length;++o){var r=n[o].split("=");r.length>2&&r.push(r.splice(1).join("=")),r[0]=decodeURIComponent(r[0]),r.length<2?r.push(null):r[1]=decodeURIComponent(r[1]),t[r[0]]=r[1]}}return t}function c(){var o=e(t,"WonderPush",z,{postInitFunctionNames:["setUserConsent"],preInstantiationCallback:e=>{e._protected.Api.proxifyPublicSDK(),e.this.init=o.init,e.this.ready=o.ready,e.this.push=o.ready,t.WonderPush=e.this,"permission"===s.wonderpushPopupUI&&e.this.push(e._protected.PopupUI.presentPermissionUI)}});if(t.WonderPush.push=o.ready,r)o.init(r);else{var c={};try{n&&(c=a(new URL(n.src).search))}catch(e){}var p=s.wonderpushWebKey||c.webKey,d=s.wonderpushUserId||c.userId,u=s.amp,l=s.wonderpushInitOpts||c.initOpts,h=s.wonderpushUI||s.wonderpushUi;(p||l)&&(l=l?JSON.parse(l):{},p&&(l.webKey=p),void 0!==d&&(l.userId=d),h&&(l._mode=l._mode||"popup"),"frame"===u&&(l._mode="frame"),"dialog"===u&&(l._mode="popup"),l._mergeStoredOptions=!0,WonderPush.init(l))}for(const e of i)o.ready(e)}}(self)}.apply(t,o))||(e.exports=r)},function(e,t,n){var o,r;o=[n(36),n(37),n(38),n(39),n(40),n(41),n(18),n(42),n(43),n(44),n(45),n(46),n(47),n(48),n(49),n(50),n(51),n(52),n(10)],void 0===(r=function(e,t,n,o,r,i,s,a,c,p,d,u,l,h,g,f,m,_,v){"use strict";return function(e,w,y,b={}){const S=new Set(b.postInitFunctionNames||[]),E=new function(){var I,C=!1,T=[],P=new Promise((function(e,t){I=e})),N=function(e){return setTimeout(()=>e.apply(A.this),0),P};this.ready=e=>{const t=new class{constructor(e){this.payload=e}get isValid(){return!(!Array.isArray(this.payload)||"string"!=typeof this.payload[0])||"function"==typeof this.payload}get functionName(){if(this.isValid&&Array.isArray(this.payload))return this.payload[0]}apply(e){if(this.isValid&&e){if("function"==typeof this.payload)return this.payload(e);if(Array.isArray(this.payload)){const t=Array.from(this.payload),n=t.shift(),o="function"==typeof t[t.length-1]?t.pop():()=>{};e[n]?Promise.resolve(e[n].apply(e,t)).then(e=>o(null,e),e=>o(e)):o(new TypeError(`${w}.${n} is not a function`))}}}}(e);return C?N(t):("init"===t.functionName?t.apply(E):S.has(t.functionName)?x.promise.then(()=>{t.apply(A.this)}):T.push(t),P)};var A=new function(){this._protected={gscope:e,sdkName:w},this.constructor=function(){},this.prototype=this.constructor.prototype,this.this=null};t(A),n(A);var M=new A._protected.Promise.Deferred;A.preInstantiationPromise=M.promise;var x=new A._protected.Promise.Deferred;A.instantiationPromise=x.promise;var O=[];A.readyCallback=function(){R(A.this)};var D=!1;this.init=function(t){return D?k(t):(D=!0,A._protected.options=t,O.push(o(A)),O.push(r(A)),O.push(i(A)),O.push(u(A)),O.push(a(A,b.additionalRunModes)),O.push(s(A)),O.push(d(A)),O.push(c(A)),O.push(l(A)),O.push(h(A)),O.push(p(A)),O.push(g(A)),O.push(f(A)),O.push(m(A)),O.push(_(A)),y.forEach((function(e){"function"==typeof e&&O.push(e(A))})),A.this=new A.constructor,M.resolve(),b.preInstantiationCallback&&b.preInstantiationCallback(A),Promise.all(O).then((function(){return x.resolve(),A}),(function(e){return console.error("SDK instantiation failed!",e),x.reject(e),A})).then((function(){A._protected.Options.isDebug()&&(e[w+"SDK"]=A)})),Promise.resolve())};var k=function(){A._protected.Helper.warn("[sdk         ]","extra call to init() dropped, sdk already instantialized!")},R=function(e){C=!0,I(e),T.forEach((function(e){N(e)})),T=[]},L=function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")};(function(){var e=this.init.bind(this),t=this.ready.bind(this);if("undefined"!=typeof window){var n,o=w.toLowerCase();if(n=document.querySelector('HEAD>META[name="'+o+'-integration"]')){var r=(n.content||n.getAttribute("content")).trim().split(/\s*,\s*/);if(!(r.indexOf("frame")<0&&r.indexOf("popup")<0)){var i=!1;t((function(){i=!0})),window.addEventListener("message",(function(n){if(n.data instanceof Object&&n.data.sdk===w)switch(n.data.type){case"ping":n.ports&&n.ports.length>0&&n.ports[0].postMessage({type:"pong"});break;case"isReady":n.ports&&n.ports.length>0&&n.ports[0].postMessage({type:"readiness",ready:i});break;case"init":e(n.data.initOpts),t((function(){n.ports&&n.ports.length>0&&n.ports[0].postMessage({type:"ready"})}));break;case"display":for(var o=["text-content","main-content","whole-content"],r=[['onclick="window.close();"','data-onclickwindowclose="'+Math.random()+'"']],s=0;s<o.length;++s){var a=o[s];if(a in n.data){var c=n.data[a];r.forEach(([e,t])=>{c=c.replace(new RegExp(L(e),"g"),t)}),c=v.sanitize(c),r.forEach(([e,t])=>{c=c.replace(new RegExp(L(t),"g"),e)}),document.getElementById(a).innerHTML=c}}break;case"close":setTimeout((function(){window.close()}),n.data.sleep||0)}}))}}}}).bind(this)()};return e[w]||(e[w]={}),e[w].init=E.init.bind(E),e[w].ready=E.ready.bind(E),e[w]}}.apply(t,o))||(e.exports=r)},function(e,t,n){var o;void 0===(o=function(){var e;Function.prototype.bind||(Function.prototype.bind=function(e){var t=Array.prototype.slice.call(arguments,1),n=this,o=function(){},r=function(){return n.apply(this instanceof o?this:e,t.concat(Array.prototype.slice.call(arguments)))};return o.prototype=this.prototype,r.prototype=new o,r}),Object.freeze||(Object.freeze=function(e){return e}),"function"!=typeof Object.create&&(Object.create=(e=function(){},function(t){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof t)throw TypeError("Argument must be an object");e.prototype=t;var n=new e;return e.prototype=null,n}))}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.Function={delay:function(e,t){var n=e;return function(){setTimeout(Function.prototype.bind.apply(n,[e].concat(Array.prototype.slice.call(arguments))),t)}}}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){if("undefined"!=typeof Promise){var t=function(){};e._protected.Promise={setIntervalUntilSettled:function(t,n,o,r,i){var s=!1,a=function(){s=!0},c=(t.then(a,a),function(){var i;if(!s)return r?i=n():r=!0,e._protected.Promise.catchNoop(Promise.all([i]).then((function(){return e._protected.Promise.catchNoop(Promise.race([t,new e._protected.Promise.DelayedStartPromise((function(e,t){e(c())}),o)]))})))});return i?c():setTimeout(c,0),t},DelayedResultPromise:function(t,n){return new Promise((function(o,r){return t(e._protected.Function.delay(o,n),e._protected.Function.delay(r,n))}))},DelayedStartPromise:function(e,t){return new Promise((function(n,o){var r=this;setTimeout((function(){try{e.call(r,n,o)}catch(e){o(e)}}),t)}))},Poll:function(t,n,o){var r=new e._protected.Promise.Deferred,i=+new Date,s=function(){if(+new Date-i>n)r.reject(new e.prototype.Errors.TimeoutError);else{var a;try{a=!!t()}catch(e){return void r.reject(e)}a?r.resolve():setTimeout(s,o)}};s(),this.wait=function(){return r.promise},this.cancel=function(){r.reject(new e.prototype.Errors.CancellationError)}},Deferred:function(){try{this.resolve=null,this.reject=null,this.promise=new Promise(function(e,t){this.resolve=e,this.reject=t}.bind(this)),Object.freeze(this)}catch(t){throw new e.prototype.Errors.InternalError("Promise/Deferred is not available")}},DynamicPromise:function(){let e,t,n;Object.defineProperty(this,"pending",{get:()=>!!t||!!n});let o=()=>{t=void 0,n=void 0};this.setPending=()=>{this.pending||(e=new Promise((e,r)=>{t=t=>{o(),e(t)},n=e=>{o(),r(e)}}))},this.setResolved=n=>{t&&this.pending?t(n):e=Promise.resolve(n)},this.setRejected=t=>{n&&this.pending?n(t):e=Promise.reject(t)},Object.defineProperty(this,"promise",{get:()=>e}),this.setPending()},allTimeout:function(t,n,o){var r={},i=t.map((function(){return o}));return e._protected.Promise.timeout(Promise.all(t.map((function(e,t){return e.then((function(e){i[t]=e}))}))),n,r).then((function(){return i}),(function(e){return e===r?Promise.resolve(i):Promise.reject(e)}))},delay:function(t,n){var o=t;return new e._protected.Promise.DelayedStartPromise((function(e,t){o.then(e,t)}),n)},timeout:function(t,n,o,r){return void 0===n?t:Promise.race([t,new e._protected.Promise.DelayedStartPromise((function(e,t){(r?e:t)(o)}),n)])},do:function(e,t){return e.then((function(e){try{t()}catch(e){}return Promise.resolve(e)}),(function(e){try{t()}catch(e){}return Promise.reject(e)}))},log:function(e,t){var n=t?function(e){console.log(t,e)}:function(e){console.log(e)};return e.then((function(e){return n(e),Promise.resolve(e)}),(function(e){return n(e),Promise.reject(e)}))},catchNoop:function(e){return e.catch(t)}}}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.Blocker={};var t={};e._protected.Blocker.clearAllCategories=function(){t={}},e._protected.Blocker.category=function(n){var o=t[n]||new function(t){this.name=t;var n={},o=[],r=function(){const e=o.splice(0,o.length);setTimeout(()=>{e.forEach((function(e){e.resolve()}))},0)};this.add=function(e){n[e]=!0},this.remove=function(e){delete n[e],this.unblocked()&&r()},this.wait=function(){var t=new e._protected.Promise.Deferred;return o.push(t),this.unblocked()&&r(),t.promise},this.unblocked=function(){for(var e in n)if(n.hasOwnProperty(e))return!1;return!0}}(n);return t[n]=o,o}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e.prototype.Errors=new function(){this.Error=function(t){var n=e._protected.Helper.plainObjectCopy(new Error(t));delete n.name,e._protected.Helper.assign(this,n)},this.Error.prototype=Object.create(Error.prototype,{name:{value:e._protected.sdkName+"SDK.Errors.Error"},constructor:{value:this.Error}}),this.InternalError=function(t){e.prototype.Errors.Error.apply(this,arguments)},this.InternalError.prototype=Object.create(this.Error.prototype,{name:{value:e._protected.sdkName+"SDK.Errors.InternalError"},constructor:{value:this.InternalError}}),this.InvalidArgumentError=function(t){e.prototype.Errors.Error.apply(this,arguments)},this.InvalidArgumentError.prototype=Object.create(this.Error.prototype,{name:{value:e._protected.sdkName+"SDK.Errors.InvalidArgumentError"},constructor:{value:this.InvalidArgumentError}}),this.TimeoutError=function(t){e.prototype.Errors.Error.apply(this,arguments)},this.TimeoutError.prototype=Object.create(this.Error.prototype,{name:{value:"SDK.Errors.TimeoutError"},constructor:{value:this.TimeoutError}}),this.CancellationError=function(t){e.prototype.Errors.Error.apply(this,arguments)},this.CancellationError.prototype=Object.create(this.Error.prototype,{name:{value:"SDK.Errors.CancellationError"},constructor:{value:this.CancellationError}})},e._protected.Errors=new function(){this.InternalOptionsNotYetAvailableError=function(t){e.prototype.Errors.InternalError.apply(this,arguments)},this.InternalOptionsNotYetAvailableError.prototype=Object.create(e.prototype.Errors.InternalError.prototype,{name:{value:e._protected.sdkName+"SDK.Errors.InternalOptionsNotYetAvailableError"},constructor:{value:this.InternalOptionsNotYetAvailableError}}),this.InternalStorageError=function(t){e.prototype.Errors.InternalError.apply(this,arguments)},this.InternalStorageError.prototype=Object.create(e.prototype.Errors.InternalError.prototype,{name:{value:e._protected.sdkName+"SDK.Errors.InternalStorageError"},constructor:{value:this.InternalStorageError}}),this.InternalRPCTargetClosedError=function(t){e.prototype.Errors.InternalError.apply(this,arguments)},this.InternalRPCTargetClosedError.prototype=Object.create(e.prototype.Errors.InternalError.prototype,{name:{value:e._protected.sdkName+"SDK.Errors.InternalRPCTargetClosedError"},constructor:{value:this.InternalRPCTargetClosedError}})}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.Constants={},e._protected.Constants.HOME_URL="https://example.com/",e._protected.Constants.CONFIG_URL_PATTERN="https://cdn.example.com/config/webkeys/${webkey}",e._protected.Constants.CONFIG_FETCH_MAX_TRIES=5,e._protected.Constants.SERVICE_WORKER_URL="serviceworker.js",e._protected.Constants.FRAME_URL="index.html",e._protected.Constants.REDIRECT_URL="redirect.html?url=${url}",e._protected.Constants.INTEGRATION_POPUP_DEFAULT_OPTIONS={resizable:0,toolbar:0,location:0,menubar:0,status:0,directories:0,personalbar:0,dependent:"yes",scrollbars:0,center:"window"},e._protected.Constants.WINDOW_LOAD_MAX_PAGELOAD_MS=6e4,e._protected.Constants.WINDOW_LOAD_SLOW_WARN_MS=1e4,e._protected.Constants.WINDOW_LOAD_CHECK_PAGELOADED_INTERVAL_MS_MIN=100,e._protected.Constants.WINDOW_LOAD_CHECK_PAGELOADED_INTERVAL_MS_MAX=1e3,e._protected.Constants.WINDOW_LOAD_CHECK_PAGELOADED_INTERVAL_MS_EXP=1.5,e._protected.Constants.REQUEST_TIMEOUT_MS=2e4,e._protected.Constants.REQUEST_VAULT_ERROR_WAIT_MS=2e4,e._protected.Constants.REQUEST_VAULT_RUNNING_JOB_TIMEOUT_MS=Math.round(1.1*e._protected.Constants.REQUEST_TIMEOUT_MS)+1e3,e._protected.Constants.REQUEST_VAULT_IDLE_WAIT_MS=2e4,e._protected.Constants.INTEGRATION_RPC_CHECK_TARGET_CLOSED_INTERVAL_MS=250,e._protected.Constants.AVAILABLE_LANGUAGES=["en"],e._protected.Constants.I18N_TRANSLATIONS={en:{}},e._protected.Constants.GOOGLE_ANALYTICS_USER_DATA_STORAGE_KEY="analyticsStorageKey",e._protected.Constants.GOOGLE_ANALYTICS_STORAGE_DATABASE_NAME=e._protected.sdkName+"_analytics",e.preInstantiationPromise.then((function(){e._protected.Helper.assign(e._protected.Constants,e.prototype.Constants),Object.freeze(e.prototype.Constants),Object.freeze(e._protected.Constants)}))}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e,t=[]){var n="[runmodes    ]";e._protected.RunModes=new function(){var t,o;this.Modes={},this.ModeParents={},this.ModeLogTags={},this.Behaviors={},this.BehaviorResolvers={},this.knownMode=function(e){return!!e&&Object.keys(this.Modes).some(function(t){return this.Modes.hasOwnProperty(t)&&this.Modes[t]===e}.bind(this))}.bind(this),this.registerMode=function(t,n,o,r){if(!t)throw new e.prototype.Errors.InternalError("Bad mode const name");if(!n)throw new e.prototype.Errors.InternalError("Bad mode value");if(t in this.Modes||this.knownMode(n))throw new e.prototype.Errors.InternalError("Mode already registered");this.Modes[t]=n,this.ModeLogTags[n]=o,this.knownMode(r)&&(this.ModeParents[n]=r),this.registerBehavior("Mode"+t,(function(e){return e===n}))}.bind(this),this.registerBehavior=function(t,n){if(!t)throw new e.prototype.Errors.InternalError("Bad behavior name");if(!(n instanceof Function))throw new e.prototype.Errors.InternalError("Bad behavior resolver");if(t in this.Behaviors)throw new e.prototype.Errors.InternalError("Behavior already registered");Object.defineProperty(this.Behaviors,t,{enumerable:!0,get:function(){return this.hasBehavior(t)}.bind(this)}),this.BehaviorResolvers[t]=n}.bind(this),this.getCurrentMode=function(){return t},this.setCurrentMode=function(n){if(void 0!==t)throw new e.prototype.Errors.InternalError("Current mode is already set");t=n,o={},e._protected.Helper.setLogRunMode(this.ModeLogTags[n])}.bind(this),this.getCurrentModeNotForBehaviorTestingPurpose=function(){return t}.bind(this),this.hasBehavior=function(r){if(!(r in o)){for(var i,s=t;void 0!==s&&void 0===i;){try{i=this.BehaviorResolvers[r](s)}catch(o){e._protected.Helper.error(n,"mode:",t,"behavior:",r,"error while resolving value using resolver",this.BehaviorResolvers[r],o)}s=this.ModeParents[s]}void 0===i&&e._protected.Helper.error(n,"mode:",t,"behavior:",r,"resolved value is undefined"),o[r]=i}return o[r]}.bind(this)},e._protected.RunModes.registerMode("WebSite","website","[website]"),e._protected.RunModes.registerMode("Frame","frame","[frame  ]"),e._protected.RunModes.registerMode("ServiceWorker","serviceworker","[sw     ]"),e._protected.RunModes.registerMode("Popup","popup","[popup  ]"),e._protected.RunModes.registerMode("Slave","slave","[slave  ]");for(const n of t)e._protected.RunModes.registerMode(`${n.charAt(0).toUpperCase()}${n.slice(1)}`,n,`[${n}]`);e._protected.RunModes.registerBehavior("ContextWindow",(function(){return!!e._protected.gscope.window})),e._protected.RunModes.registerBehavior("ContextServiceWorker",(function(){return!!e._protected.gscope.ServiceWorkerGlobalScope})),e._protected.RunModes.registerBehavior("ContextFrame",(function(t){return[e._protected.RunModes.Modes.Frame,e._protected.RunModes.Modes.Slave].indexOf(t)>=0})),e._protected.RunModes.registerBehavior("Visible",(function(){return e._protected.RunModes.Behaviors.ContextWindow&&!e._protected.RunModes.Behaviors.ContextFrame})),e._protected.RunModes.registerBehavior("AccessToken",(function(t){return[e._protected.RunModes.Modes.ServiceWorker,e._protected.RunModes.Modes.Popup,e._protected.RunModes.Modes.Frame,e._protected.RunModes.Modes.WebSite].indexOf(t)>=0}))}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o,r;o=[n(18)],void 0===(r=function(e){return Object({debug:!1}),function(e){var t,n="[storage     ]",o=new e._protected.Promise.Deferred,r=function(t){var o,r,i;t&&t.then?i=t.then(function(e){return o=(r=e)&&r.name,this}.bind(this)):o=t;var s=function(t){e._protected.Helper.warn(t),r&&(r.close(),r=void 0,i=void 0)}.bind(this);this.ready=function(){return i||(i=function(t,o){var r,i=new e._protected.Promise.Deferred;try{r=e._protected.gscope.indexedDB.open(t,1)}catch(t){return"SecurityError"===t.name?e._protected.Helper.warn(n,"Could not open IndexedDB: cross-site tracking is probably disabled",t):e._protected.Helper.warn(n,"Could not open IndexedDB, the WonderPush SDK will not initialize",t),new Promise(()=>{})}var s=!1;return r.onupgradeneeded=function(t){s=!0;var o=t.target.result;if(1!==t.newVersion)throw new e._protected.Errors.InternalStorageError("Updating from version "+t.oldVersion+" to version "+t.newVersion+", but dbVersion in code is 1");var r=t.oldVersion,i=[];i.push((function(){0===r&&(++r,o.createObjectStore("kv-storage"),o.createObjectStore("mutex")),this.onsuccess()})),i.push((function(){if(1!==r){var o="IndexedDB upgrade chain from version "+t.oldVersion+" to version "+t.newVersion+" broken at version "+r;throw e._protected.Helper.error(n,o),new e._protected.Errors.InternalStorageError(o)}s=!1}));for(var a=i.length-2;a>=0;--a){var c=i[a],p=i[a+1];c.onsuccess=p.bind(p),c.onerror=i[i.length-1]}i[0].bind(i[0])()},r.onerror=function(o){r.error&&"InvalidStateError"===r.error.name?e._protected.Helper.debug(n,"Could not open database",r.error):(e._protected.Helper.error(n,"failed to initialize IndexedDB storage",t,o,r.error),i.reject(r.error))},r.onsuccess=function(t){s&&i.reject(new e._protected.Errors.InternalStorageError("Module storage initialization failed: error encountered or broken upgrade chain"));var n=t.target.result;Promise.resolve(e._protected.Storage.onDbOpen(n)).then(i.resolve.bind(null,n),i.resolve.bind(null,n))},i.promise}(o).then(function(e){return(r=e).addEventListener("close",s),r.addEventListener("abort",s),this}.bind(this)))},this.getKeyValueStorageStoreName=function(){return"kv-storage"},this.getMutexStoreName=function(){return"mutex"},this.get=function(e,t){return a({get:{key:e,defaultValue:t}})},this.set=function(e,t){return a({put:{key:e,value:t}})},this.rm=function(e){return a({delete:{key:e}})};var a=function(e){return this.bulk([e]).then((function(e){return e.results.byIndex[0]}))}.bind(this);this.bulk=function(t,o){t=t.slice(),o=o||{};var i=new e._protected.Promise.Deferred,s=[],a={},c=Object.keys(t.reduce((function(e,t){return e[t[Object.keys(t)[0]].store||"kv-storage"]=!0,e}),{})),p={test:!0,add:!0,put:!0,delete:!0},d=t.find((function(e){return!!p[Object.keys(e)[0]]}))?"readwrite":"readonly",u=null;try{u=r.transaction(c,d,{durability:"relaxed"})}catch(r){if("InvalidStateError"===r.name){e._protected.Helper.warn(n,r);var l=o.tries||1;if(l>=3)return Promise.reject(r);var h=1e3*Math.pow(2,l-1)*(1+.2*Math.random());e._protected.Helper.info(n,"Reopening IDBDatabase connection in ",h,"ms, cause:",r.message);const i=this;return new Promise((function(e,n){setTimeout((function(){return i.ready().then((function(){return i.bulk.call(i,t,Object.assign({},o,{tries:l+1}))})).then(e,n)}),h)}))}throw r}var g=c.reduce((function(e,t){return e[t]=u.objectStore(t),e}),{}),f=function(n){for(var o=!1,r=function(n){var r,i=t[n],c=Object.keys(i)[0],p=i[c],d=p.store||"kv-storage",l=g[d],h=p.key,m=p.alias||h,_=p.value,v=p.defaultValue;switch(c){case"test":o=!0;case"get":r=l.get(h);break;case"add":r=l.add(_,h);break;case"put":r=l.put(_,h);break;case"delete":r=l.delete(h);break;case"abort":o=!0,u.abort(),r={};break;default:throw new e._protected.Errors.InternalStorageError("Unhandled operation type "+c)}r.onsuccess=function(e){var o=void 0!==e.target.result?e.target.result:v;if(s[n]=o,a[m]=o,"test"===c){var r=p.operationsCb(o);r&&"object"==typeof r&&(r instanceof Array||(r=[r]),r.length>0&&t.splice.apply(t,[n+1,0].concat(r))),f(n+1)}},r.onerror=function(e){e.preventDefault(),s[n]=e,a[m]=e}},i=n;!o&&i<t.length;++i)r(i)};return u.onabort=u.onerror=function(e){i.reject({event:e,results:{byIndex:s,byKey:a}})},u.oncomplete=function(e){i.resolve({event:e,results:{byIndex:s,byKey:a}})},f(0),i.promise},this.listObjectStores=function(){return Array.from(r.objectStoreNames)},this.listKeyValuePairs=function(e){return new Promise((function(t,n){var o=[];try{var i=r.transaction(e);i.objectStore(e).openCursor().onsuccess=function(e){var t=e.target.result;t&&(o.push([t.key,t.value]),t.continue())},i.oncomplete=function(){t(o)},i.onerror=i.onabort=function(e){n(e)}}catch(e){n(e)}}))}};return e._protected.Storage=new function(){this.getDatabaseName=function(){return e._protected.sdkName},this.onDbOpen=function(e){};var i,s={},a=function(t){if(!t)return Promise.reject(new e._protected.Errors.InternalStorageError("Missing dbName. Storage not available."));if(s[t])return s[t].ready();var n=s[t]||new e._protected.Storage.Container(t);return n.ready().then((function(){return s[t]=n,n}))};t=function(){e._protected.Storage.getDatabaseName()?a(e._protected.Storage.getDatabaseName()).then((function(e){i=e,o.resolve()})).catch((function(e){o.reject(e)})):o.resolve()},this.getModuleInitializationPromise=function(){return o.promise},this.getKeyValueStorageStoreName=function(){return i?i.getKeyValueStorageStoreName():null},this.getMutexStoreName=function(){return i?i.getMutexStoreName():null},this.get=function(t,n,o){return o=o||e._protected.Storage.getDatabaseName(),a(o).then((function(e){return e.get(t,n)}))},this.set=function(t,n,o){return o=o||e._protected.Storage.getDatabaseName(),a(o).then((function(e){return e.set(t,n)}))},this.rm=function(t,n){return n=n||e._protected.Storage.getDatabaseName(),a(n).then((function(e){return e.rm(t)}))},this.bulk=function(t,n){return n=n||e._protected.Storage.getDatabaseName(),a(n).then((function(e){return e.bulk(t)}))},this.listObjectStores=function(t){return t=t||e._protected.Storage.getDatabaseName(),a(t).then((function(e){return e.listObjectStores()}))},this.deleteDatabase=function(t){return function(t){return new Promise((function(o,r){try{e._protected.Helper.warn(n,"deleting IndexedDB storage",t,"…");var i=e._protected.gscope.indexedDB.deleteDatabase(t);i.onerror=function(o){e._protected.Helper.error(n,"failed to delete IndexedDB storage",t,":",o,i.error),r(i.error)},i.onsuccess=function(){e._protected.Helper.warn(n,"deleting IndexedDB storage",t,"succeeded"),o()}}catch(o){e._protected.Helper.error(n,"error while deleting IndexedDB storage",t,":",o),r(o)}}))}(t=t||e._protected.Storage.getDatabaseName())},this.listKeyValuePairs=function(t,n){return n=n||e._protected.Storage.getDatabaseName(),a(n).then((function(e){return e.listKeyValuePairs(t)}))},this.isDefaultContainerAvailable=function(){return!!i},this.getDefaultContainer=function(){return i},this.Container=r,this.getKeyValueStorageStoreName=function(){return"kv-storage"},this.getMutexStoreName=function(){return"mutex"}},e.preInstantiationPromise.then(t),o.promise}}.apply(t,o))||(e.exports=r)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t,n,o=new e._protected.Promise.Deferred;return e._protected.Locking=new function(){n=function(){e.preInstantiationPromise.then((function(){e._protected.Integration.getModuleInitializationPromise().then((function(){e._protected.Integration.isOnRightDomain()&&(e._protected.Locking=t),Promise.all([e._protected.Storage.getModuleInitializationPromise(),e._protected.Integration.getModuleInitializationPromise()]).then((function(){o.resolve()}))}))}))},this.getModuleInitializationPromise=function(){return o.promise},this.isAvailable=function(){return e._protected.Storage.isDefaultContainerAvailable()},this.ExpiringUnfairNamedGlobalMutex=function(t,n,o){var r=!1,i=null,s=t,a=n,c=o;this.acquire=function(t){if((t=t||{}).interval=t.interval||250,t.ttl=t.ttl||a,0===t.timeout)return this.tryAcquire(t.ttl);if(r)return Promise.resolve();var n=new e._protected.Promise.Deferred,o=+new Date;return e._protected.Promise.setIntervalUntilSettled(n.promise,function(){if(!(t.timeout>0&&+new Date-o>=t.timeout))return this.tryAcquire(t.ttl).then(n.resolve,(function(){}));n.reject()}.bind(this),t.interval,!0,!1),n.promise},this.tryAcquire=function(t){if(r)return Promise.resolve();var n;t=t||a;var o=function(){return n=+new Date+t,e._protected.Storage.bulk([{add:{store:e._protected.Storage.getMutexStoreName(),key:s,value:{name:s,until:n}}}],c)};return o().catch((function(e){return p().then((function(){return o()}))})).then((function(){r=!0,i=n;var e=new Date(i);return e=e.toLocaleTimeString("en-GB")+"."+("00"+e.getMilliseconds()).slice(-3),Promise.resolve()}),(function(){return r=!1,Promise.reject()}))},this.renewWhile=function(t,n){return(t=t||{}).ttl=t.ttl||a,t.interval=t.interval||t.ttl/2,e._protected.Promise.setIntervalUntilSettled(n,function(){return this.renew(t.ttl)}.bind(this),t.interval,!1,!1),t.release&&e._protected.Promise.do(n,function(){this.release()}.bind(this)),n},this.renew=function(t){if(!r)throw new e.prototype.Errors.InternalError("Cannot renew unacquired mutex");i<=+new Date&&console.log("Lock",s,"probably expired",+new Date-i,"ms ago"),t=t||a;var n=+new Date+t;return e._protected.Storage.bulk([{test:{store:e._protected.Storage.getMutexStoreName(),key:s,operationsCb:function(t){return t&&t.name===s&&t.until===i?{put:{store:e._protected.Storage.getMutexStoreName(),key:s,value:{name:s,until:n}}}:(console.warn("Lock",s,"has already expired"),r=!1,void(i=null))}}}],c).then((function(){i=n;var e=new Date(i);e=e.toLocaleTimeString("en-GB")+"."+("00"+e.getMilliseconds()).slice(-3)}),(function(e){return console.error("Failed to renew lock",s,":",e),Promise.reject()}))},this.release=function(){if(!r)throw new e.prototype.Errors.InternalError("Cannot release unacquired mutex");return i<=+new Date&&console.log("Lock",s,"probably expired",+new Date-i,"ms ago"),e._protected.Storage.bulk([{test:{store:e._protected.Storage.getMutexStoreName(),key:s,operationsCb:function(t){return t&&t.name===s&&t.until===i?{delete:{store:e._protected.Storage.getMutexStoreName(),key:s}}:(console.warn("Lock",s,"has already expired"),r=!1,void(i=null))}}}],c).then((function(){r=!1,i=null}),(function(e){return console.error("Failed to release lock",s,":",e),Promise.reject()}))};var p=function(){var t=+new Date,n=!1;return e._protected.Storage.bulk([{test:{store:e._protected.Storage.getMutexStoreName(),key:s,operationsCb:function(o){if(o&&o.name===s&&o.until<t)return n=!0,{delete:{store:e._protected.Storage.getMutexStoreName(),key:s}}}}}],c).then((function(){return n?Promise.resolve():Promise.reject()}),(function(e){return console.error("Failed to purge expired lock",s," (if any):",e),Promise.reject()}))}},this.remoteMutexManager=e._protected.Integration.proxifyToCustomDomain("SDK._protected.Locking.remoteMutexManager",new function(){const t={};this.create=(n,o,r)=>{const i=e._protected.Helper.uuidv4();return t[i]||(t[i]=new e._protected.Locking.ExpiringUnfairNamedGlobalMutex(n,o,r)),Promise.resolve(i)},this.acquire=(e,n)=>t[e].acquire(n),this.tryAcquire=(e,n)=>t[e].tryAcquire(n),this.renew=(e,n)=>t[e].renew(n),this.release=e=>t[e].release()})},t=e._protected.Locking,e._protected.Locking={getModuleInitializationPromise:t.getModuleInitializationPromise,remoteMutexManager:t.remoteMutexManager},n(),o.promise}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t=e.readyCallback;delete e.readyCallback,e._protected.Init={};var n=[];e._protected.Init.addWillBecomeReadyCallback=function(e){n.push(e)},e._protected.Blocker.category("ready").add("_init"),e._protected.Blocker.category("ready").wait().then((function(){n.forEach((function(e){e()})),n=[],t()})),e.instantiationPromise.then((function(){e._protected.Blocker.category("ready").remove("_init")}))}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;const r=n(2);void 0===(o=function(){return function(e){e._protected.Helper={browserAndOSCSSClasses:function(){var e=[],t=navigator.userAgent.toLowerCase();return t.indexOf("iphone")>-1&&e.push("iphone"),t.indexOf("ipad")>-1&&e.push("ipad"),t.indexOf("ipod")>-1&&e.push("ipod"),t.indexOf("android")>-1&&e.push("android"),t.indexOf("macintosh")>-1&&e.push("macintosh"),t.indexOf("windows")>-1&&e.push("windows"),t.indexOf("linux")>-1&&e.push("linux"),t.indexOf("chrome")>-1&&e.push("chrome"),t.indexOf("firefox")>-1&&e.push("firefox"),t.indexOf("safari")>-1&&-1===t.indexOf("chrome")&&e.push("safari"),e},inArray:function(e,t){for(var n=0;n<t.length;++n)if(t[n]===e)return!0;return!1},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},uuidv4:function(){var t,n=new Array(31);if(e._protected.gscope.crypto&&crypto.getRandomValues){var o=new Uint8Array(31);for(crypto.getRandomValues(o),t=0;t<31;t++)n[t]=15&o[t]}else for(t=0;t<31;t++)n[t]=16*Math.random()|0;var r=0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=n[r++];return("x"===e?t:3&t|8).toString(16)}))},stripObject:function(t){for(var n in t){var o=t[n];if(null==o)delete t[n];else if(o instanceof Object){e._protected.Helper.stripObject(o);var r=!0;for(var i in o){r=!1;break}r&&delete t[n]}}return t},messagePassableValue:function(t){var n=t;return t instanceof Blob||(n=e._protected.Helper.plainObjectCopy(t)),n},plainObjectCopy:function(t){var n=t;if(t instanceof Array){n=[];for(var o=0;o<t.length;++o){var r=t[o];r instanceof Function||n.push(e._protected.Helper.plainObjectCopy(r))}}else if(t instanceof Object){if("undefined"!=typeof PushSubscriptionOptions&&t instanceof PushSubscriptionOptions){for(var i in n={},t)n[i]=e._protected.Helper.plainObjectCopy(t[i]);return n}if(t.toJSON instanceof Function){var s=t.toJSON();return s!==t&&(s=e._protected.Helper.plainObjectCopy(s)),t instanceof PushSubscription&&(s.keys instanceof Object&&("string"==typeof s.keys.auth&&(s.keys.auth=s.keys.auth.replace(/=+$/,"")),"string"==typeof s.keys.p256dh&&(s.keys.p256dh=s.keys.p256dh.replace(/=+$/,""))),t.options instanceof Object&&(s.options=e._protected.Helper.plainObjectCopy(t.options))),s}if(t instanceof Error)return n=e._protected.Helper.assign({},t),["name","message","stack","columnNumber","fileName","lineNumber"].forEach((function(e){void 0!==t[e]&&(n[e]=t[e])})),n;if(t instanceof ArrayBuffer||ArrayBuffer.isView(t))return e._protected.Helper.arrayBufferToBase64UrlSafe(t);n={},Object.getOwnPropertyNames(t).forEach((function(o){var r=t[o];r instanceof Function||(n[o]=e._protected.Helper.plainObjectCopy(r))}))}return n},assign:function(e,t){"use strict";if(Object.assign)return Object.assign.apply(null,arguments);if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),o=1;o<arguments.length;o++){var r=arguments[o];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])}return n},mergeObjectInplaceRecursive:function(t,n){for(var o in n)if(n.hasOwnProperty(o)){var r=t[o],i=n[o];r instanceof Object&&i instanceof Object?e._protected.Helper.mergeObjectInplaceRecursive(r,i):t[o]=i}return t},rawurlencode:function(e){return e=(e+"").toString(),encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")},decodeQueryString:function(e){var t={};if(e){"?"===e.charAt(0)&&(e=e.substring(1));for(var n=e.split("&"),o=0;o<n.length;++o){var r=n[o].split("=");r.length>2&&r.push(r.splice(1).join("=")),r[0]=decodeURIComponent(r[0]),r.length<2?r.push(null):r[1]=decodeURIComponent(r[1]),t[r[0]]=r[1]}}return t},escapeRegExp:function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},fireEvent:function(e,t,n){var o;if("function"==typeof CustomEvent)return o=new CustomEvent(t,{detail:n,bubbles:!0,cancelable:!0}),!e.dispatchEvent(o);if("function"==typeof Event)return(o=new Event(t,{bubbles:!0,cancelable:!0})).detail=n,!e.dispatchEvent(o);if("object"==typeof document&&document.createEventObject)return(o=document.createEventObject()).data=n,e.fireEvent("on"+t,o);throw Error("Cannot instantiate Event for "+t)},listenEvent:function(e,t,n){e.addEventListener(t,n,!1)},unlistenEvent:function(e,t,n){e.removeEventListener(t,n,!1)},supportsServiceWorker:function(){return navigator.serviceWorker&&"function"==typeof navigator.serviceWorker.register},supportsPushManager:function(){return"undefined"!=typeof PushManager},getLocales:function(){var t=[];e._protected.gscope.document&&(t.push(document.documentElement.getAttribute("lang")),t=(t=t.concat(Array.prototype.slice.call(document.querySelectorAll("HEAD > meta[name=language], HEAD > meta[http-equiv=content-language], HEAD > meta[http-equiv=Content-Language]")).map((function(e){return e.content})))).reduce((function(e,t){return t?e.concat(t.split(",")):e}),[])),t.push(navigator.language);var n=t.concat(navigator.languages).map(e._protected.Helper.normalizeLocale).filter((function(e){return!!e}));return n.filter((function(e,t){return n.indexOf(e)===t}))},normalizeLocale:function(e){if("string"!=typeof e)return null;var t=e.trim().toLowerCase().match(/^([a-z][a-z])(?:[-_]([a-z][a-z]))?$/);return t?t[2]?t[1]+"_"+t[2].toUpperCase():t[1]:null},parseNumber:function(e,t){var n;t=t||navigator.language;try{n=Intl.NumberFormat(t).format("1.1")}catch(e){n=Intl.NumberFormat(navigator.language).format("1.1")}var o=new RegExp("[^-+0-9"+n.charAt(1)+"]","g"),r=e.replace(o,"").replace(n.charAt(1),".");return parseFloat(r)},tryParse:function(e,t){try{return JSON.parse(e)}catch(e){}return t},detectBrowser:function(){var e,t,n,o=navigator.userAgent.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];!e&&/trident/i.test(o[1])&&(e="Internet Explorer",t=(n=/\brv[ :]+([\d\.]+)/g.exec(navigator.userAgent)||[])[1]),!e&&/msie/i.test(o[1])&&(e="Internet Explorer",t=o[2]),!e&&/chrome/i.test(o[1])&&(n=navigator.userAgent.match(/\b(OPR|Edge)\/([\d\.]+)/)||[]).length>0&&(e=n[1],t=n[2]),!e&&o[1]&&(e=o[1],t=o[2]),"OPR"===e&&(e="Opera"),null!==(n=navigator.userAgent.match(/version\/([\d\.]+)/i))&&(t=n[1]);var r=navigator.userAgent.match(/(Linux|iPad|iPhone|Android|Windows|Macintosh)/g)||[],i=null;return-1!==r.indexOf("Android")?i="Android":r.length>0&&(i=r[0]),{name:e||"",platform:i||"",version:t||""}},arrayBufferFromBase64:function(e){return Uint8Array.from(atob(e),(function(e){return e.charCodeAt(0)}))},arrayBufferFromBase64UrlSafe:function(t){return e._protected.Helper.arrayBufferFromBase64(t.replace(/-/g,"+").replace(/_/g,"/"))},arrayBufferToBase64:function(e){return btoa(String.fromCharCode.apply(null,new Uint8Array(e)))},arrayBufferToBase64UrlSafe:function(t){return e._protected.Helper.arrayBufferToBase64(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")},compareVersions:function(e,t){var n=function(e){return parseInt(e,10)};e=e.split(".").map(n),t=t.split(".").map(n);for(var o=0;o<Math.max(e.length,t.length);++o){if(o>=e.length)return-1;if(o>=t.length)return 1;if(e[o]<t[o])return-1;if(e[o]>t[o])return 1}return 0},_:void 0};const t=new r.SimpleLogger({sdkName:e._protected.sdkName});r.setDefaultLogger(t),Object.defineProperties(e._protected.Helper,{trace:{get:function(){return r.trace}},debug:{get:function(){return r.debug}},_debugResolved:{get:function(){return r.debugResolved}},log:{get:function(){return r.log}},info:{get:function(){return r.info}},warn:{get:function(){return r.warn}},error:{get:function(){return r.error}},debugCollapsed:{get:function(){return r.debugCollapsed}},setLogRunMode:{value:function(e){t.runMode=e}}})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.Consulate=function(t){var n,o,r,i,s=function(){n=null,o=null,r=!1,i=new e._protected.Promise.Deferred};s(),this.setup=function(t,s){if(this.isSetup())console.warn("cannot set up an already setup consulate");else{n=new URL(t).origin,"allow"in(o=document.createElement("IFRAME"))&&(o.allow.supports?o.allow.supports("geolocation")&&o.allow.add("geolocation"):o.allow="geolocation"),o.style.display="none",o.src=t;var a=function(){document.body.appendChild(o),o.addEventListener("load",(function(){e._protected.Integration.probeAndInitWindowObject(o.contentWindow,n,s,(function(e){r=!0,i.resolve()}),{type:"ping"},(function(e){return e.data instanceof Object&&"pong"===e.data.type}))}))};document.body?a():document.addEventListener("DOMContentLoaded",a)}}.bind(this),this.tearDown=function(){this.isSetup()&&(document.body.removeChild(o),s())}.bind(this),this.isSetup=function(){return!!o},this.isReady=function(){return r},this.getReadyPromise=function(){return i.promise},this.getPostMessageTarget=function(){return o.contentWindow},this.getPostMessageOrigin=function(){return n},this.getIFrame=function(){return o}};var t={};e._protected.Consulate.getConsulate=function(e){return t[e]||null},e._protected.Consulate.createConsulate=function(n){if(t[n])throw new e.prototype.Errors.InternalError("Consulate already created");return t[n]=new e._protected.Consulate(n),t[n]}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t,n=new e._protected.Promise.Deferred,o=new Set,r=new Map;return"undefined"!=typeof document&&document.currentScript,e._protected.Integration=new function(){var i,s,a=e._protected.Consulate.createConsulate("frame");t=function(){e._protected.RunModes.Behaviors.ModeWebSite&&!e._protected.Integration.isOnRightDomain()&&c(),e._protected.RunModes.Behaviors.ModeFrame?u():e._protected.RunModes.Behaviors.ModePopup?f():e._protected.RunModes.Behaviors.ModeSlave?_():e._protected.RunModes.Behaviors.ModeWebSite?h():e._protected.RunModes.Behaviors.ModeServiceWorker&&w(),Promise.resolve().then((function(){if(e._protected.RunModes.Behaviors.ModeFrame||e._protected.RunModes.Behaviors.ModeWebSite&&e._protected.Integration.isOnRightDomain())return e._protected.Storage.getModuleInitializationPromise().then((function(){return e._protected.Integration.incrementPageViews()}))})).catch((function(){})).then(n.resolve)},this.getModuleInitializationPromise=function(){return n.promise},this.getFrameReadyPromise=function(){return a.getReadyPromise()},this.getIFrame=function(){return a.getIFrame()},this.incrementPageViews=function(){return e._protected.RunModes.Behaviors.ModeFrame||e._protected.RunModes.Behaviors.ModeWebSite&&e._protected.Integration.isOnRightDomain()?e._protected.Storage.getModuleInitializationPromise().then((function(){return e._protected.Storage.bulk([{test:{key:"pageViews",defaultValue:0,operationsCb:function(e){return{put:{key:"pageViews",value:++e}}}}}])})):(console.error("should not be called from this domain"),Promise.resolve())},this.getHomeUrlObject=function(){return new URL(e._protected.Constants.HOME_URL)},this.getHomeHref=function(){return e._protected.Integration.getHomeUrlObject().href},this.getHomeOrigin=function(){return e._protected.Integration.getHomeUrlObject().origin},this.isOnRightDomain=function(){return e._protected.RunModes.Behaviors.ModeServiceWorker?(location.origin,e._protected.Integration.getHomeOrigin(),!0):location.origin===e._protected.Integration.getHomeOrigin()},this.areTopWindowAndSelfOnRightDomain=function(){if(e._protected.RunModes.Behaviors.ModeServiceWorker)return location.origin,e._protected.Integration.getHomeOrigin(),!0;try{return window.top.location.origin===e._protected.Integration.getHomeOrigin()}catch(e){return!1}},this.getServiceWorkerUrl=function(){var t=new URL(e._protected.Options.getServiceWorkerUrl(),e._protected.Integration.getHomeHref());return t.protocol="https:",t.href},this.getFrameUrl=function(){var t=new URL(e._protected.Options.getFrameUrl(),e._protected.Integration.getHomeHref());return t.protocol="https:",t.href},this.getRedirectionPageUrl=function(t){var n=new URL(e._protected.Options.getRedirectionPageUrl(t),e._protected.Integration.getHomeHref());return n.protocol="https:",n.href};var c=function(){if(e._protected.RunModes.Behaviors.ModeWebSite){e._protected.Blocker.category("ready").add("hiddenFrame");var t=e._protected.Options.exportInitial();t._mode=e._protected.RunModes.Modes.Frame,t._hiddenFrame=!0,a.setup(e._protected.Integration.getFrameUrl(),t),a.getReadyPromise().then(p)}};this.injectStylesheetLink=function(e){var t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=e,document.head.appendChild(t)},this.injectStylesheetInline=function(e){var t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode(e)),document.head.appendChild(t)};var p=function(t){e._protected.Blocker.category("ready").remove("hiddenFrame")},d=function(t,n,o,r){var i=e._protected.Options.exportInitial();i._mode=e._protected.RunModes.Modes.Popup,i._popup=!0,e._protected.Integration.probeAndInitWindowObject(t,e._protected.Integration.getTargetOrigin(),i,n,o,r)};this.probeWindowObject=function(t,n,o,r){var i=new e._protected.Promise.Deferred;if(!t)return Promise.reject(new Error("Missing window object"));o instanceof Object&&(o.sdk=e._protected.sdkName);var s=e._protected.Constants.WINDOW_LOAD_CHECK_PAGELOADED_INTERVAL_MS_MIN,a=((new Date).getTime(),!0),c=function(n){var c=new MessageChannel;c.port2.onmessage=function(e){a&&r(e)&&(a=!1,i.resolve())},s=Math.min(e._protected.Constants.WINDOW_LOAD_CHECK_PAGELOADED_INTERVAL_MS_MAX,s*e._protected.Constants.WINDOW_LOAD_CHECK_PAGELOADED_INTERVAL_MS_EXP),t.postMessage(o,n,[c.port1]),setTimeout(p,s)},p=function(){a&&(t.closed?(a=!1,i.reject(new Error("Window has gone away"))):c("*"))};return setTimeout(c.bind(null,n),s),i.promise},this.probeAndInitWindowObject=function(t,n,o,r,i,s){if(t){i instanceof Object&&(i.sdk=e._protected.sdkName);var a=e._protected.Constants.WINDOW_LOAD_CHECK_PAGELOADED_INTERVAL_MS_MIN,c=(new Date).getTime(),p=!0,d=function(){(new Date).getTime();var i=new MessageChannel;i.port2.onmessage=function(e){if(e.data instanceof Object)switch(e.data.type){case"ready":r(t),r=function(){}}},t.postMessage({type:"init",sdk:e._protected.sdkName,initOpts:o},n,[i.port1])},u=function(n){var o=new MessageChannel;o.port2.onmessage=function(e){p&&s(e)&&(p=!1,d())},a=Math.min(e._protected.Constants.WINDOW_LOAD_CHECK_PAGELOADED_INTERVAL_MS_MAX,a*e._protected.Constants.WINDOW_LOAD_CHECK_PAGELOADED_INTERVAL_MS_EXP),t.postMessage(i,n,[o.port1]),setTimeout(l,a)},l=function(){if(p)if(t.closed)p=!1,r(!1),r=function(){};else if((new Date).getTime()-c<e._protected.Constants.WINDOW_LOAD_MAX_PAGELOAD_MS)u("*");else{try{t.close()}catch(e){}p=!1,r(!1),r=function(){}}};setTimeout(u.bind(null,n),a),setTimeout((function(){if(p){var t=((e._protected.Constants.WINDOW_LOAD_MAX_PAGELOAD_MS-e._protected.Constants.WINDOW_LOAD_SLOW_WARN_MS)/1e3).toFixed(0);console.warn(e._protected.sdkName+" seems to be taking some time to initialize one of its external resource on the domain ",n,".\nIf you see one error or repeated errors (which will stop in about "+t+' seconds) about "postMessage" and "target origin […] not match[ing] the recipient window\'s origin", then you either:\n- have a browser extension blocking that resource;\n- see a broken integration that you would be kind to report.\nIf not, then just wait around, and everything should get loaded soon.')}}),e._protected.Constants.WINDOW_LOAD_SLOW_WARN_MS)}else r(null)},this.openPopup=function(t,n){var o=(n=e._protected.Helper.mergeObjectInplaceRecursive(e._protected.Constants.INTEGRATION_POPUP_DEFAULT_OPTIONS,n||{})).width,r=n.height;"window"===n.center?(n.left=(window.innerWidth-o)/2+window.screenX,n.top=(window.innerHeight-r)/2+window.screenY):"screen"===n.center&&(n.left=(screen.width-o)/2+screen.availLeft,n.top=(screen.height-r)/2+screen.availTop),delete n.center;var i=Object.keys(n).map((function(e){return e+"="+n[e]})).join(",");return window.open(t,"_blank",i)},this.openAndInitPopup=function(t,n,o){i=e._protected.Integration.openPopup(t,o),d(i,s=n,{type:"ping"},(function(e){return e.data instanceof Object&&"pong"===e.data.type}))},this.reloadPopup=function(){e._protected.RunModes.Behaviors.ModePopup?(window.opener.postMessage({type:"reloadPopup",sdk:e._protected.sdkName},"*"),window.location.reload()):console.error("reloadPopup() can only be called from within the popup itself")},this.reinitializePopup=function(t){e._protected.RunModes.Behaviors.ModeWebSite?i===t?d(i,s,{type:"isReady"},(function(e){return e.data instanceof Object&&"readiness"===e.data.type&&!e.data.ready})):console.error("reinitializePopup() can only be invoked from the last opened popup"):console.error("reinitializePopup() can only be called from within the popup parent window")},this.getTargetOrigin=function(){return e._protected.Integration.getHomeOrigin()};var u=function(){window.addEventListener("message",l),e._protected.ServiceWorkerClient.addMessageEventListener(b)},l=function(t){if(t.data instanceof Object&&t.data.sdk===e._protected.sdkName)switch(t.data.type){case"callOnCustomDomain":e._protected.Promise.catchNoop(I(t.data.functionName,t.data.args,t.ports[0]))}},h=function(){window.addEventListener("message",g),e._protected.ServiceWorkerClient.addMessageEventListener(b)},g=function(t){if(t.data instanceof Object&&t.origin===e._protected.Integration.getTargetOrigin()&&t.data.sdk===e._protected.sdkName)switch(t.data.type){case"callOnParentWindow":e._protected.Promise.catchNoop(I(t.data.functionName,t.data.args,t.ports[0]));break;case"reloadPopup":e._protected.Integration.reinitializePopup(t.source)}},f=function(){window.addEventListener("message",m)},m=function(t){if(t.data instanceof Object&&t.data.sdk===e._protected.sdkName)switch(t.data.type){case"callOnPopupWindow":e._protected.Promise.catchNoop(I(t.data.functionName,t.data.args,t.ports[0]))}},_=function(){window.addEventListener("message",v)},v=function(t){if(t.data instanceof Object&&t.data.sdk===e._protected.sdkName)switch(t.data.type){case"callOnSlave":e._protected.Promise.catchNoop(I(t.data.functionName,t.data.args,t.ports[0]))}},w=function(){e._protected.ServiceWorker.addMessageEventListener(y)},y=function(t){if(t.data instanceof Object&&t.data.sdk===e._protected.sdkName)switch(t.data.type){case"callOnServiceWorker":t.waitUntil(e._protected.Promise.catchNoop(I(t.data.functionName,t.data.args,t.ports[0])))}},b=function(t){if(t.data instanceof Object&&t.data.sdk===e._protected.sdkName)switch(t.data.type){case"callOnServiceWorkerClients":e._protected.Promise.catchNoop(I(t.data.functionName,t.data.args,t.ports[0]))}},S=function(t){var n=new e.prototype.Errors.InvalidArgumentError("Invalid function name");if(!t)throw n;var o=t.split(".");if(o.length<3)throw n;var r=o[1];if("this"!==r&&"_protected"!==r&&"prototype"!==r)throw n},E=function(t,n,o,r){if(!t||t.postMessage){if(r=r||[],S(o),null===t)return I(o,r);var i=new e._protected.Promise.Deferred,s=new MessageChannel;return"closed"in t&&e._protected.Promise.setIntervalUntilSettled(i.promise,(function(){if(t.closed){var n=new e._protected.Errors.InternalRPCTargetClosedError;i.reject(n)}}),e._protected.Constants.INTEGRATION_RPC_CHECK_TARGET_CLOSED_INTERVAL_MS,!1,!1),s.port2.onmessageerror=function(t){e._protected.Helper.error("[integration ]","[callOn] raised onmessageerror",t,"(for target:","<REDACTED>","type:",n,"functionName:",o,"args:",r,")"),i.reject(t)},s.port2.onmessage=function(t){if(t.data instanceof Object)if("returned"in t.data)i.resolve(t.data.returned);else if("error"in t.data&&t.data.error){var n=t.data.error;if(n&&n.name){var o=e._protected.sdkName+"SDK.Errors.",r=Error;if(n.name&&n.name.startsWith(o)&&(r=e.prototype.Errors[n.name.substring(o.length)]||e._protected.Errors[n.name.substring(o.length)]),"function"==typeof r){var s=new r(n.message);s.name===n.name&&(delete n.name,e._protected.Helper.assign(s,n),n=s)}}i.reject(n)}},"undefined"!=typeof ServiceWorker&&t instanceof ServiceWorker||"undefined"!=typeof Client&&t instanceof Client?t.postMessage({sdk:e._protected.sdkName,type:n,functionName:o,args:r},[s.port1]):t.postMessage({sdk:e._protected.sdkName,type:n,functionName:o,args:r},"*",[s.port1]),i.promise}},I=function(t,n,o){n=n||[];for(var r,i=t.split(".").slice(1),s=e,a=0;a<i.length;++a)r=s,s=(s||{})[i[a]];return new e._protected.Promise.DelayedStartPromise((function(e,t){e(s.apply(r,n))}),1).then((function(t){return o&&o.postMessage&&o.postMessage({returned:e._protected.Helper.messagePassableValue(t)}),t}),(function(t){throw o&&o.postMessage&&o.postMessage({error:e._protected.Helper.messagePassableValue(t)}),t}))},C=function(e,t,n,o,r){if("function"==typeof n)return function(){var i=!0;r instanceof Function&&(i=r());var s=Array.prototype.slice.call(arguments);return i?e(t,s):new Promise((function(e,t){e(n.apply(o,s))}))};if("object"==typeof n){for(var i in n)n.hasOwnProperty(i)&&(n[i]=C(e,t+"."+i,n[i],n,r));return n}return n};this.callOnCustomDomain=function(t,n){return S(t),e._protected.Integration.isOnRightDomain()?E(null,"callOnCustomDomain",t,n):a.getReadyPromise().then((function(){return E(a.getPostMessageTarget(),"callOnCustomDomain",t,n)}))},this.proxifyToCustomDomain=function(t,n){return C(e._protected.Integration.callOnCustomDomain,t,n,void 0,()=>!e._protected.Integration.isOnRightDomain())},this.callOnParentWindow=function(t,n){var o;return o=e._protected.RunModes.Behaviors.ContextFrame&&window.parent!==window?e._protected.RunModes.Behaviors.ModeSlave?null:window.parent:null,E(o,"callOnParentWindow",t,n)},this.proxifyToParentWindow=function(t,n){return e._protected.RunModes.Behaviors.ContextFrame?C(e._protected.Integration.callOnParentWindow,t,n,void 0,()=>window.parent!==window):n},this.callOnPopupWindow=function(e,t,n){return E(e,"callOnPopupWindow",t,n)},this.callOnSlave=function(e,t,n){return E(e,"callOnSlave",t,n)},this.callOnServiceWorker=function(t,n){return S(t),e._protected.RunModes.Behaviors.ContextServiceWorker?E(null,"callOnServiceWorker",t,n):navigator.serviceWorker?navigator.serviceWorker.ready.then((function(){return E(navigator.serviceWorker.controller,"callOnServiceWorker",t,n)})):new Promise((e,t)=>{})},this.proxifyToServiceWorker=function(t,n){return e._protected.RunModes.Behaviors.ContextServiceWorker?n:C(e._protected.Integration.callOnServiceWorker,t,n)},this.callOnServiceWorkerClients=function(t,n){return S(t),e._protected.RunModes.Behaviors.ContextServiceWorker?clients.matchAll().then((function(e){return Promise.all(e.map((function(e){return E(e,"callOnServiceWorkerClients",t,n)})))})):E(null,"callOnServiceWorkerClients",t,n)},this.proxifyToServiceWorkerClients=function(t,n){return e._protected.RunModes.Behaviors.ContextServiceWorker?C(e._protected.Integration.callOnServiceWorkerClients,t,n):n},this.broadcast=function(t,n){const o=e._protected.Helper.uuidv4();e._protected.Integration.onBroadcast(t,n,o)},this.onBroadcast=function(t,n,i){if(o.has(i))return;o.add(i);const s=r.get(t);s&&s.forEach(e=>e(t,n)),e._protected.RunModes.Behaviors.ModeWebSite&&a&&a.isSetup()?e._protected.Integration.callOnCustomDomain("SDK._protected.Integration.onBroadcast",[t,n,i]):e._protected.RunModes.Behaviors.ModeFrame?(e._protected.Integration.callOnParentWindow("SDK._protected.Integration.onBroadcast",[t,n,i]),e._protected.Helper.supportsServiceWorker()&&e._protected.Integration.callOnServiceWorker("SDK._protected.Integration.onBroadcast",[t,n,i])):e._protected.RunModes.Behaviors.ModeServiceWorker&&e._protected.Integration.callOnServiceWorkerClients("SDK._protected.Integration.onBroadcast",[t,n,i])},this.addBroadcastListener=function(e,t){let n=r.get(e);n||(n=new Set,r.set(e,n)),n.add(t)},this.removeBroadcastListener=function(e,t){let n=r.get(e);n&&(t?n.delete(t):n.clear())}},e.preInstantiationPromise.then((function(){return e._protected.Options.getModuleInitializationPromise()})).then((function(){return e._protected.Blocker.category("integration").wait()})).then(t),n.promise}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t=[];const n=n=>{t.forEach(t=>{try{t(n)}catch(t){e._protected.Helper.error("[request     ]","error running global handler",t,n)}})};e._protected.Request=new function(){this.request=function(t,o,r,i,s,a,c){c=c||{},a=a||{};var p=function(e,t){if("function"!=typeof XMLHttpRequest&&"function"!=typeof XDomainRequest)return null;var n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):"undefined"!=typeof XDomainRequest?(n=new XDomainRequest).open(e,t):n=null,n}(t,o);if(!(p&&!0!==c.fetch||"function"!=typeof fetch)){var d={};if(d.method=t||"GET",d.mode="cors",i?d.body=i:r&&(d.body=r),s)for(var u in d.headers=new Headers,s)d.headers.append(u,s[u]);var l="function"==typeof a.onload?a.onload:function(){},h=e=>{n(e),"function"==typeof a.onerror&&a.onerror(e)};return fetch(o,d).then((function(t){const n=new e._protected.Promise.Deferred;if(t.json().then(t=>{n.resolve(t);const o=t?t._configVersion:void 0;o&&e._protected.Config.getModuleInitializationPromise().then(()=>e._protected.Config.remoteConfigManager.declareVersion(o.toString()))},e=>{n.reject(e)}),t.json=()=>n.promise,0===t.status||t.status>=200&&t.status<=299)return l(t),t;throw h(t),t}),(function(e){throw h(e),e}))}if(p){if(p.timeout=e._protected.Constants.REQUEST_TIMEOUT_MS,s)for(var u in s)p.setRequestHeader(u,s[u]);a&&["onerror","ontimeout","onabort","onloadend"].forEach((function(e){a[e]&&(p[e]=a[e])})),p.onerror=function(e){n(e),"function"==typeof a.onerror&&a.onerror.apply(this,arguments)},p.onload=function(){if(a){try{p.responseJSON=e._protected.Helper.tryParse(this.responseText,null);const t=p.responseJSON?p.responseJSON._configVersion:void 0;t&&e._protected.Config.getModuleInitializationPromise().then(()=>e._protected.Config.remoteConfigManager.declareVersion(t.toString()))}catch(e){}var t=this.status;t>=200&&t<=299&&a.onload?a.onload.apply(this,arguments):a.onerror&&(n(arguments[0]),a.onerror.apply(this,arguments))}},p.onloadend=function(){a.onloadend&&a.onloadend.apply(this,arguments)},"POST"===t||"PATCH"===t?p.send(r):p.send()}},this.requestEventually=function(t,n,o,r,i){if(!e._protected.RunModes.Behaviors.AccessToken||!e._protected.Integration.isOnRightDomain())throw new e.prototype.Errors.InternalError("Should not be called in this environment");var s=new e._protected.RequestVaultJob([t,n,o,r,i]);return e._protected.RequestVault.run(s)},this.addGlobalErrorHandler=e=>{t.push(e)},this.removeGlobalErrorHandler=e=>{t=t.filter(t=>t!==e)}}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.RequestVault={JOB_STATUS_QUEUED:"queued",JOB_STATUS_RUNNING:"running",JOB_STATUS_PERFORMED:"performed",jobTypes:{},run:function(e){return this._queue(e).then(function(){this._execute(e)}.bind(this))},_queue:function(t){var n=Math.floor(1e10*Math.random());return e._protected.Storage.bulk([{test:{key:"requestVaultJobs",defaultValue:{},operationsCb:function(e){for(;n in e;)n=Math.floor(1e10*Math.random());return t._jid=n,e[n]=this.serialize(t),t._jid=null,{put:{key:"requestVaultJobs",value:e}}}.bind(this)}}]).then((function(){t._jid=n}))},_update:function(t){return e._protected.Storage.bulk([{test:{key:"requestVaultJobs",defaultValue:{},operationsCb:function(e){return t._jid in e?(e[t._jid]=this.serialize(t),{put:{key:"requestVaultJobs",value:e}}):{abort:{}}}.bind(this)}}]).then((function(){}))},_unqueue:function(t){return t instanceof Array||(t=[t]),t.length?e._protected.Storage.bulk([{test:{key:"requestVaultJobs",defaultValue:{},operationsCb:function(e){for(var n=0;n<t.length;++n)job=t[n],job._jid,delete e[job._jid];return{put:{key:"requestVaultJobs",value:e}}}.bind(this)}}]).then((function(){})):Promise.resolve()},_runQueued:function(){var t=new e._protected.Locking.ExpiringUnfairNamedGlobalMutex("requestvault",1e4);return t.tryAcquire().then(function(){var n=+new Date,o=n+e._protected.Constants.REQUEST_VAULT_IDLE_WAIT_MS;return e._protected.Promise.do(t.renewWhile({release:!0},e._protected.Storage.get("requestVaultJobs",{}).then(function(t){var r=[];for(var i in t)if(t.hasOwnProperty(i)){var s=this.unserialize(t[i]);switch(s.getStatus()){case this.JOB_STATUS_PERFORMED:r.push(s);break;case this.JOB_STATUS_QUEUED:n>=s.getWaitUntilDate()?this._executing[s._jid]||this._execute(s):o=Math.min(o,s.getWaitUntilDate());break;case this.JOB_STATUS_RUNNING:n>=s.getRunningSinceDate()+e._protected.Constants.REQUEST_VAULT_RUNNING_JOB_TIMEOUT_MS&&(this._executing[s._jid]||this._execute(s))}}return this._unqueue(r)}.bind(this))),function(){var e=o-n;e+=100+Math.round(1e3*Math.random()),setTimeout(this._runQueued.bind(this),e)}.bind(this))}.bind(this),function(){var t=Math.round(e._protected.Constants.REQUEST_VAULT_IDLE_WAIT_MS*(1+.2*Math.random()));setTimeout(this._runQueued.bind(this),t)}.bind(this))},_executing:{},_execute:function(t){e._protected.Blocker.category("requestvault").wait().then(()=>{if(!this._executing[t._jid]&&(t.getStatus()!==this.JOB_STATUS_RUNNING||+new Date>=t.getRunningSinceDate()+e._protected.Constants.REQUEST_VAULT_RUNNING_JOB_TIMEOUT_MS)){this._executing[t._jid]=!0;var n=e._protected.Constants.REQUEST_VAULT_RUNNING_JOB_TIMEOUT_MS,o=new e._protected.Locking.ExpiringUnfairNamedGlobalMutex("requestvault-job-"+t._jid,n);return e._protected.Promise.do(o.tryAcquire().then(function(){return t.setStatus(this.JOB_STATUS_RUNNING),e._protected.Promise.do(this._update(t).then(function(){return e._protected.Promise.do(t.run().then((function(){}),(function(){})),function(){this._update(t)}.bind(this))}.bind(this)),(function(){return o.release()}))}.bind(this),(function(){})),function(){delete this._executing[t._jid]}.bind(this))}})},_init:function(){e._protected.Locking.getModuleInitializationPromise().then(function(){e._protected.Locking.isAvailable()&&this._runQueued()}.bind(this))},serialize:function(e){return e.toJSONObject()},unserialize:function(t){"string"==typeof t&&((t=JSON.parse(t)).v=t.v||1,t.status=t.status||e._protected.RequestVault.JOB_STATUS_QUEUED,t.id=t.id||Math.floor(1e10*Math.random()));var n=t.type;return this.jobTypes[n].fromJSONObject(t)}},e._protected.RequestVaultJob=function(t){var n,o=e._protected.RequestVault.JOB_STATUS_QUEUED,r=+new Date,i=0,s=0,a=this,c={onload:function(){a.setStatus(e._protected.RequestVault.JOB_STATUS_PERFORMED),n.resolve(),n=void 0},onerror:function(t){t&&t.target&&(0===t.target.status||e._protected.Helper.inArray(t.target.status,[500,503]))||"undefined"!=typeof TypeError&&t instanceof TypeError?(a.setWaitUntilDate(e._protected.Constants.REQUEST_VAULT_ERROR_WAIT_MS+ +new Date),a.setStatus(e._protected.RequestVault.JOB_STATUS_QUEUED)):a.setStatus(e._protected.RequestVault.JOB_STATUS_PERFORMED),n.resolve(),n=void 0},ontimeout:function(){a.setWaitUntilDate(e._protected.Constants.REQUEST_VAULT_ERROR_WAIT_MS+ +new Date),a.setStatus(e._protected.RequestVault.JOB_STATUS_QUEUED),n.resolve(),n=void 0},onabort:function(){a.setWaitUntilDate(e._protected.Constants.REQUEST_VAULT_ERROR_WAIT_MS+ +new Date),a.setStatus(e._protected.RequestVault.JOB_STATUS_QUEUED),n.resolve(),n=void 0}},p=t.slice();p.push(c),this._jid=null,this.getStatus=function(){return o},this.setStatus=function(t){0===t&&(t=e._protected.RequestVault.JOB_STATUS_QUEUED),1===t&&(t=e._protected.RequestVault.JOB_STATUS_RUNNING),2===t&&(t=e._protected.RequestVault.JOB_STATUS_PERFORMED),o=t},this.getCreationDate=function(){return r},this.setCreationDate=function(e){r=e},this.getWaitUntilDate=function(){return i},this.setWaitUntilDate=function(e){i=e||0},this.getRunningSinceDate=function(){return s},this.setRunningSinceDate=function(e){s=e||0},this.run=function(){return n||(n=new e._protected.Promise.Deferred,s=+new Date,e._protected.Request.request.apply(e._protected.Request.request,p)),n.promise},this.toJSONObject=function(){return{type:"RequestVaultJob",v:1,id:a._jid,status:o,creationDate:r,waitUntilDate:i,runningSinceDate:s,args:t}}},e._protected.RequestVaultJob.fromJSONObject=function(t){var n=new e._protected.RequestVaultJob(t.args);return n._jid=t.id,n.setStatus(t.status),t.creationDate&&n.setCreationDate(t.creationDate),n.setWaitUntilDate(t.waitUntilDate),n.setRunningSinceDate(t.runningSinceDate),n},e._protected.RequestVault.jobTypes.RequestVaultJob=e._protected.RequestVaultJob,e.preInstantiationPromise.then((function(){e._protected.RunModes.Behaviors.AccessToken&&e._protected.Integration.getModuleInitializationPromise().then((function(){e._protected.Integration.isOnRightDomain()&&e._protected.RequestVault._init()}))}))}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t;e._protected.ServiceWorkerClient=new function(){var n=[];t=function(){e._protected.Integration.getModuleInitializationPromise().then((function(){e._protected.RunModes.Behaviors.RegisterServiceWorker&&e._protected.Helper.supportsServiceWorker()&&"https:"===location.protocol&&o()}))};var o=function(){addEventListener("message",r),navigator.serviceWorker&&navigator.serviceWorker.addEventListener("message",r)};this.isCurrentURLInScope=()=>{const t=e._protected.Integration.getServiceWorkerUrl(),n=e._protected.Options.getServiceWorkerScope(),o=new URL("./",n?new URL(n,e._protected.Integration.getHomeHref()).href:t);return new URL("./",location.href).href.startsWith(o.href)},this.registerServiceWorker=function(){const t=e._protected.Integration.getServiceWorkerUrl(),n={scope:e._protected.Options.getServiceWorkerScope()};return navigator.serviceWorker?navigator.serviceWorker.register(t,n).catch((function(e){})).then((function(e){return e}),(function(e){if(console.error("Cannot register the ServiceWorker / no ServiceWorker ready",e),e)throw e})):new Promise((e,t)=>{})}.bind(this),this.getPushSubscriptionAndRegisterServiceWorkerIfNecessary=e._protected.Integration.proxifyToCustomDomain("SDK._protected.ServiceWorkerClient.getPushSubscriptionAndRegisterServiceWorkerIfNecessary",function(){return navigator.serviceWorker?this.isCurrentURLInScope()&&!navigator.serviceWorker.controller?Promise.resolve(null):e._protected.ServiceWorkerClient.registerServiceWorker().then((function(e){return e.pushManager.getSubscription()})):new Promise((e,t)=>{})}.bind(this)),this.getPushSubscriptionFromServiceWorker=e._protected.Integration.proxifyToServiceWorker("SDK._protected.ServiceWorkerClient.getPushSubscriptionFromServiceWorker",(function(){return"granted"!==Notification.permission?Promise.resolve(null):registration.pushManager.getSubscription()}));var r=function(t){if("undefined"==typeof ServiceWorkerMessageEvent||t instanceof ServiceWorkerMessageEvent){if(t.data instanceof Object&&t.data.sdk!==e._protected.sdkName)switch(t.data.type){case"ping":"ports"in t&&t.ports.length>0&&t.ports[0].postMessage({type:"pong",data:t.data})}n.forEach((function(e){try{e.call(this,t)}catch(e){console.error("ServiceWorkerClient message handler threw",e)}}))}};this.addMessageEventListener=function(e){n.push(e)},this.removeMessageEventListener=function(e){var t=n.indexOf(e);t>=0&&n.splice(t,1)}},t()}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){if(e._protected.RunModes.Behaviors.ContextServiceWorker){var t=e._protected.gscope;e._protected.ServiceWorker=new function(){this.addEventListener=t._wp_worker_addEventListener||function(e,n){t.addEventListener(e,(function(e){var t=n(e);t instanceof Promise&&e.waitUntil(t)}))},this.removeEventListener=t._wp_worker_removeEventListener||function(e,n){t.removeEventListener(e,n)};var n=function(){this.addEventListener("message",(function(t){return e.instantiationPromise.then((function(){r(t)}))}))}.bind(this),o=[],r=function(e){e.data instanceof Object&&(e.data.type,o.forEach((function(t){try{t.call(this,e)}catch(e){console.error("ServiceWorker message handler threw",e)}})))};this.addMessageEventListener=function(e){o.push(e)},this.removeMessageEventListener=function(e){var t=o.indexOf(e);t>=0&&o.splice(t,1)},n()}}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o,r;o=[n(54)],void 0===(r=function(e){return function(t){var n,o=new t._protected.Promise.Deferred;return t._protected.Config=new function(){var r=null;n=function(){t._protected.Blocker.category("ready").add("config"),t.preInstantiationPromise.then((function(){Promise.all([t._protected.Options.getModuleInitializationPromise(),t._protected.Storage.getModuleInitializationPromise()]).then((function(){i()}))}))},this.isConfigLoaded=function(){return!!r},this.getModuleInitializationPromise=function(){return o.promise};var i=function(){let n,o;if(t._protected.Options.getWebKey()){const r=t._protected.Constants.CONFIG_URL_PATTERN.replace(/\${webkey}/,t._protected.Options.getWebKey())+"?_="+ +new Date;n=new e.FetchRemoteConfigFetcher(new URL(r)),o=new e.IndexDbRemoteConfigStorage(t._protected.Storage)}else n=new e.NoneRemoteConfigFetcher,o=new e.InMemoryRemoteConfigStorage;const r={broadcast:(e,n)=>{t._protected.Integration.getModuleInitializationPromise().then(()=>t._protected.Integration.broadcast(e,n))},addBroadcastListener:(e,n)=>{t._protected.Integration.getModuleInitializationPromise().then(()=>t._protected.Integration.addBroadcastListener(e,n))}};this.remoteConfigManager=new e.RemoteConfigManager(n,o,r),this.remoteConfigManager.read().then(e=>{a(e.data)}).catch(e=>console.log("Could not fetch config. Please try again later.",e))}.bind(this),s=[];this.addConfigProcessor=function(e){s.push(e)};var a=function(e){a=function(){},s.forEach((function(t){t(e)})),r=e,c()},c=function(){var e=r.options||{},n=e.defaults||{},i=e.override||{};t._protected.Options.merge(n,i),t._protected.Blocker.category("ready").remove("config"),o.resolve()};this.invalidateConfig=function(){return this.remoteConfigManager?this.remoteConfigManager.invalidate():Promise.reject()}},n(),o.promise}}.apply(t,o))||(e.exports=r)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(2),r=n(55);class i extends Error{constructor(e){super(e),Object.setPrototypeOf(this,i.prototype)}}t.InvalidFormatError=i;class s extends Error{constructor(e){super(e),Object.setPrototypeOf(this,s.prototype)}}var a;t.FetchRateLimitError=s,function(e){e[e.ascending=-1]="ascending",e[e.same=0]="same",e[e.descending=1]="descending"}(a=t.ComparisonResult||(t.ComparisonResult={}));t.disableConfigFetchKey="disableConfigFetch",t.remoteConfigStorageKey="remoteConfig";const c="[remoteconfig]";class p{constructor(e,t,n=new Date,o=0,r=0){this.data=e,this.version=t,this.fetchDate=n,this.maxAge=o,this.minAge=r}static compareVersions(e,t){const n=r.validate(e),o=r.validate(t);return!n&&o?a.ascending:!o&&n?a.descending:n||o?r(e,t):a.same}toJSON(){return{data:this.data,version:this.version,fetchDate:this.fetchDate.getTime(),maxAge:this.maxAge,minAge:this.minAge}}static fromJSON(e){if("object"!=typeof e)return;const{data:t,version:n,fetchDate:o,maxAge:r,minAge:i}=e;return"string"==typeof n?new p("object"==typeof t?t:{},n,"number"==typeof o?new Date(o):new Date(0),"number"==typeof r?r:0,"number"==typeof i?i:0):void 0}hasHigherVersionThan(e){return p.compareVersions(this.version,e.version)===a.descending}get isExpired(){return this.maxAge>0&&+new Date-this.fetchDate.getTime()>this.maxAge}get hasReachedMinAge(){return+new Date-this.fetchDate.getTime()>=this.minAge}}t.RemoteConfig=p,t.RemoteConfigUpdatedBroadcastType="RemoteConfigUpdated",t.RemoteConfigToUpdateBroadcastType="RemoteConfigToUpdate",t.RemoteConfigManager=class{constructor(e,n,r){this.remoteConfigFetcher=e,this.remoteConfigStorage=n,this.broadcastInterface=r,this.minimumFetchInterval=5e3,this.minimumConfigAge=0,this.maximumConfigAge=864e6,this.isFetching=!1,this.queuedHandlers=[],r.addBroadcastListener(t.RemoteConfigToUpdateBroadcastType,(e,t)=>{const n=p.fromJSON(t);n&&(this.storedConfig&&!n.hasHigherVersionThan(this.storedConfig)||(this.storedHighestVersion=n.version,this.storedConfig=n,this.remoteConfigStorage.storeRemoteConfig(n).catch(e=>o.error(c,"[RemoteConfigManager] Could not store config",e)).then(()=>this.remoteConfigStorage.declareVersion(n.version)).catch(e=>o.error(c,"[RemoteConfigManager] Could not declare config version",e))))})}invalidate(){return this.remoteConfigStorage.invalidate()}declareVersion(e){return this.remoteConfigStorage.declareVersion(e).then(()=>(this.storedHighestVersion&&p.compareVersions(this.storedHighestVersion,e)!==a.ascending||(this.storedHighestVersion=e),this.readConfigAndHighestDeclaredVersionFromStorage()),e=>(o.error(c,"[declareVersion]","Error declaring version to storage",e),this.readConfigAndHighestDeclaredVersionFromStorage())).then(([t,n])=>{var o;if(t){if(+new Date-t.fetchDate.getTime()<this.minimumConfigAge||!t.hasReachedMinAge)return;if(p.compareVersions(t.version,e)===a.same){const e=new p(t.data,t.version,new Date,t.maxAge,t.minAge);return void this.remoteConfigStorage.storeRemoteConfig(e).then(()=>{this.storedConfig=e})}if(n&&p.compareVersions(t.version,n)!==a.ascending)return}const r=+new Date-((null===(o=this.lastFetchDate)||void 0===o?void 0:o.getTime())||0);if(!(this.lastFetchDate&&r<this.minimumFetchInterval))return this.fetchAndStoreConfigWithVersion(n,t)}).catch(e=>{o.error(c,"[declareVersion]","Could not get RemoteConfig from storage",e)}).then(()=>{})}read(){return this.isFetching?new Promise((e,t)=>{this.queuedHandlers.push({resolve:e,reject:t})}):this.readConfigAndHighestDeclaredVersionFromStorage().then(([e,t])=>{var n;const o=+new Date-((null===(n=this.lastFetchDate)||void 0===n?void 0:n.getTime())||0);if(!e){if(this.lastFetchDate&&o<this.minimumFetchInterval)throw new s;return this.fetchAndStoreConfigWithVersion(void 0,e)}const r=a.ascending==p.compareVersions(e.version,t||"");let i=r,c=t;const d=+new Date-e.fetchDate.getTime();i&&(d<this.minimumConfigAge||d<e.minAge)&&(i=!1);const u=d>this.maximumConfigAge||e.isExpired;return!i&&u&&(i=!0,r||(c=e.version)),i&&this.lastFetchDate&&o<this.minimumFetchInterval&&(i=!1),i?this.fetchAndStoreConfigWithVersion(c,e).catch(t=>e):e})}readConfigAndHighestDeclaredVersionFromStorage(){return this.storedConfig&&this.storedHighestVersion?Promise.resolve([this.storedConfig,this.storedHighestVersion]):this.remoteConfigStorage.loadRemoteConfigAndHighestDeclaredVersion().then(([e,t])=>(e&&(this.storedConfig=e),t&&(this.storedHighestVersion=t),[e,t]))}resolveHandlers(e){this.queuedHandlers.splice(0,this.queuedHandlers.length).forEach(t=>t.resolve(e))}rejectHandlers(e){this.queuedHandlers.splice(0,this.queuedHandlers.length).forEach(t=>t.reject(e))}fetchAndStoreConfigWithVersion(e,n){return n&&n.data[t.disableConfigFetchKey]?Promise.resolve(n):this.isFetching?new Promise((e,t)=>{this.queuedHandlers.push({resolve:e,reject:t})}):(this.isFetching=!0,this.lastFetchDate=new Date,this.remoteConfigFetcher.fetchConfigWithVersion(e).catch(e=>{throw o.error(c,"[fetchAndStoreConfigWithVersion]","Could not fetch RemoteConfig from server",e),this.rejectHandlers(e),this.isFetching=!1,e}).then(e=>n&&n.hasHigherVersionThan(e)?(this.resolveHandlers(n),this.isFetching=!1,n):this.remoteConfigStorage.storeRemoteConfig(e).catch(e=>{throw o.error(c,"[fetchAndStoreConfigWithVersion]","Could not store RemoteConfig",e),this.rejectHandlers(e),this.isFetching=!1,e}).then(()=>this.remoteConfigStorage.declareVersion(e.version).catch(e=>{o.error(c,"[fetchAndStoreConfigWithVersion]","Error declaring version to storage",e)}).then(()=>(this.storedConfig=e,this.isFetching=!1,n&&!e.hasHigherVersionThan(n)||(this.broadcastInterface.broadcast(t.RemoteConfigToUpdateBroadcastType,e.toJSON()),this.broadcastInterface.broadcast(t.RemoteConfigUpdatedBroadcastType,e.toJSON())),this.resolveHandlers(e),e)))))}},t.IndexDbRemoteConfigStorage=class{constructor(e){this.storageModule=e}invalidate(){return this.storageModule.bulk([{test:{key:t.remoteConfigStorageKey,defaultValue:null,operationsCb:function(e){if(!e)return[];const{serializedConfig:n}=e;return n?(n.fetchDate=0,{put:{key:t.remoteConfigStorageKey,value:e}}):[]}}}]).then(()=>{})}declareVersion(e){return this.storageModule.bulk([{test:{key:t.remoteConfigStorageKey,defaultValue:{},operationsCb:function(n){const o=n.highestVersion;return o&&p.compareVersions(e,o)!==a.descending||(n.highestVersion=e),{put:{key:t.remoteConfigStorageKey,value:n}}}}}]).then(()=>{})}loadRemoteConfigAndHighestDeclaredVersion(){return this.storageModule.get(t.remoteConfigStorageKey,{}).then(e=>{const t=null==e?void 0:e.highestVersion;return[(null==e?void 0:e.serializedConfig)?p.fromJSON(e.serializedConfig):void 0,t]})}storeRemoteConfig(e){return this.storageModule.bulk([{test:{key:t.remoteConfigStorageKey,defaultValue:{},operationsCb:function(n){const o=n.serializedConfig?p.fromJSON(n.serializedConfig):void 0;return o&&o.hasHigherVersionThan(e)?{}:(n.serializedConfig=e.toJSON(),{put:{key:t.remoteConfigStorageKey,value:n}})}}}]).then(()=>{})}},t.NoneRemoteConfigFetcher=class{fetchConfigWithVersion(e){return Promise.resolve(new p({},"0"))}};class d{constructor(e){this.url=e}fetchConfigWithVersion(e){const t=new URL(this.url.toString());return fetch(t.toString()).then(e=>e.json()).then(e=>d.parseConfigJSON(e))}static parseConfigJSON(e){let t=e.version;if("number"==typeof t&&(t=""+t),"string"!=typeof t)throw new i;const n=t;let o=e.maxAge;void 0===o&&(o=e.cacheTtl);const r="number"==typeof o?o:0;let s=e.minAge;void 0===s&&(s=e.cacheMinAge);const a="number"==typeof s?s:0;return new p(e,n,new Date,r,a)}}t.FetchRemoteConfigFetcher=d,t.InMemoryRemoteConfigStorage=class{declareVersion(e){return this.storedHighestVersion&&p.compareVersions(this.storedHighestVersion,e)!==a.ascending||(this.storedHighestVersion=e),Promise.resolve()}loadRemoteConfigAndHighestDeclaredVersion(){return this.error?Promise.reject(this.error):Promise.resolve([this.storedConfig,this.storedHighestVersion])}storeRemoteConfig(e){return this.storedConfig=e,this.error?Promise.reject(this.error):Promise.resolve()}invalidate(){return this.storedConfig&&(this.storedConfig=new p(this.storedConfig.data,this.storedConfig.version,new Date(0),this.storedConfig.maxAge,this.storedConfig.minAge)),Promise.resolve(void 0)}}},function(e,t,n){var o,r;void 0===(r="function"==typeof(o=function(){var e=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function t(e){var t,n=e.replace(/^v/,"").replace(/\+.*$/,""),o=("-",-1===(t=n).indexOf("-")?t.length:t.indexOf("-")),r=n.substring(0,o).split(".");return r.push(n.substring(o+1)),r}function n(e){return isNaN(Number(e))?e:Number(e)}function o(t){if("string"!=typeof t)throw new TypeError("Invalid argument expected string");if(!e.test(t))throw new Error("Invalid argument not valid semver ('"+t+"' received)")}function r(e,r){[e,r].forEach(o);for(var i=t(e),s=t(r),a=0;a<Math.max(i.length-1,s.length-1);a++){var c=parseInt(i[a]||0,10),p=parseInt(s[a]||0,10);if(c>p)return 1;if(p>c)return-1}var d=i[i.length-1],u=s[s.length-1];if(d&&u){var l=d.split(".").map(n),h=u.split(".").map(n);for(a=0;a<Math.max(l.length,h.length);a++){if(void 0===l[a]||"string"==typeof h[a]&&"number"==typeof l[a])return-1;if(void 0===h[a]||"string"==typeof l[a]&&"number"==typeof h[a])return 1;if(l[a]>h[a])return 1;if(h[a]>l[a])return-1}}else if(d||u)return d?-1:1;return 0}var i=[">",">=","=","<","<="],s={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};return r.validate=function(t){return"string"==typeof t&&e.test(t)},r.compare=function(e,t,n){!function(e){if("string"!=typeof e)throw new TypeError("Invalid operator type, expected string but got "+typeof e);if(-1===i.indexOf(e))throw new TypeError("Invalid operator, expected one of "+i.join("|"))}(n);var o=r(e,t);return s[n].indexOf(o)>-1},r})?o.apply(t,[]):o)||(e.exports=r)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.Helper.supportsVAPID=function(){return"undefined"!=typeof PushSubscriptionOptions&&"applicationServerKey"in PushSubscriptionOptions.prototype}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.Time={},e._protected.Time.getRealTime=function(){return Date.now()}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.Constants.SERVICE_WORKER_URL="wonderpush-worker-loader.min.js?webKey=${webKey}",e._protected.Constants.FRAME_URL="wonderpush.min.html",e._protected.Constants.MANIFEST_URL="wonderpush-manifest.json",e._protected.Constants.REDIRECT_URL="wonderpush-redirect.html?url=${url}",e.prototype.Constants={},e.prototype.Constants.SDK_VERSION="1.1.32.8",e.prototype.Constants.SDK_SHORT_VERSION=e.prototype.Constants.SDK_VERSION.split(".").slice(0,2).join("."),e._protected.Constants.ROOT_API_URL="api.wonderpush.com",e._protected.Constants.API_VERSION="v1",e._protected.Constants.MEASUREMENTS_API_BASE_URL="https://measurements-api.wonderpush.com/v1",e._protected.Constants.DEFAULT_LANGUAGE_CODE="en",e._protected.Constants.VALID_LANGUAGE_CODES=["af","ar","be","bg","bn","ca","cs","da","de","el","en","en_GB","en_US","es","es_ES","es_MX","et","fa","fi","fr","fr_FR","fr_CA","he","hi","hr","hu","id","is","it","ja","ko","lt","lv","mk","ms","nb","nl","pa","pl","pt","pt_PT","pt_BR","ro","ru","sk","sl","sq","sr","sv","sw","ta","th","tl","tr","uk","vi","zh","zh_CN","zh_TW","zh_HK"],e._protected.Constants.DEFAULT_DOMAIN_SUFFIX=".by.wonderpush.com",e._protected.Constants.CDN_ROOT_HREF="https://cdn"+e._protected.Constants.DEFAULT_DOMAIN_SUFFIX+"/",e._protected.Constants.CONFIG_URL_PATTERN=e._protected.Constants.CDN_ROOT_HREF+"config/webkeys/${webkey}",e._protected.Constants.PLUGIN_ROOT_URL=e._protected.Constants.CDN_ROOT_HREF+"plugins/",e._protected.Constants.PARTNER_DOMAIN_DEFAULT_URL_SUFFIX="sdk/",e._protected.Constants.CONFIG_FETCH_WAIT_BEFORE_RETRY_MS=1e4,e._protected.Constants.CONFIG_FETCH_MAX_TRIES=3,e._protected.Constants.CONFIG_CACHE_DEFAULT_TTL=432e5,e._protected.Constants.CONFIG_MISSING_CACHE_TTL=9e5,e._protected.Constants.GET_DELIVERIES_TRIES=3,e._protected.Constants.GET_DELIVERIES_ERROR_WAIT_MS=1e4,e._protected.Constants.GET_DELIVERIES_RANDOM_WAIT_MIN_MS=0,e._protected.Constants.GET_DELIVERIES_RANDOM_WAIT_MAX_MS=5e3,e._protected.Constants.GEOLOCATION_SUPPORTED="geolocation"in navigator,e._protected.Constants.GEOLOCATION_MAXIMUM_AGE=3e5,e._protected.Constants.GEOLOCATION_OPTIONS_FIRST_FIX={enableHighAccuracy:!1,timeout:0,maximumAge:e._protected.Constants.GEOLOCATION_MAXIMUM_AGE},e._protected.Constants.GEOLOCATION_OPTIONS={enableHighAccuracy:!1,timeout:e._protected.Constants.GEOLOCATION_MAXIMUM_AGE,maximumAge:e._protected.Constants.GEOLOCATION_MAXIMUM_AGE},e._protected.Constants.DIFFERENT_SESSION_REGULAR_MIN_TIME_GAP=18e5,e._protected.Constants.DIFFERENT_SESSION_NOTIFICATION_MIN_TIME_GAP=9e5,e._protected.Constants.INSTALLATION_CORE_PROPERTIES_CACHE=6048e5,e._protected.Constants.INSTALLATION_PUSH_TOKEN_CACHE=e._protected.Constants.INSTALLATION_CORE_PROPERTIES_CACHE,e._protected.Constants.SW_MAX_PAGELOAD_MS=6e4,e._protected.Constants.SW_CHECK_PAGELOADED_INTERVAL_MS=250,e._protected.Constants.SW_PING_TIMEOUT_MS=2e3,e._protected.Constants.SUBSCRIPTION_SWITCH_ELEMENT_ID_DEFAULT="wonderpush-subscription-switch",e._protected.Constants.SUBSCRIPTION_MODE_DEFAULT="visits",e._protected.Constants.SUBSCRIPTION_MIN_VISITS_DEFAULT=2,e._protected.Constants.SUBSCRIPTION_MIN_PAGES_DEFAULT=3,e._protected.Constants.SUBSCRIPTION_DELAY_DEFAULT=0,e._protected.Constants.SUBSCRIPTION_SNOOZE_DEFAULT=6048e5,e._protected.Constants.POPUP_AUTOCLOSE_SLEEP=3e3,e._protected.Constants.PUSH_MANAGER_SUBSCRIBE_TOO_LONG=5e3,e._protected.Constants.ACTION_METHOD="method",e._protected.Constants.ACTION_LINK="link",e._protected.Constants.ACTION_TRACK_EVENT="trackEvent",e._protected.Constants.ACTION_UPDATE_INSTALLATION="updateInstallation",e._protected.Constants.ACTION_SUBSCRIBE_TO_NOTIFICATIONS="subscribeToNotifications",e._protected.Constants.ACTION_ADD_PROPERTY="addProperty",e._protected.Constants.ACTION_REMOVE_PROPERTY="removeProperty",e._protected.Constants.ACTION_RESYNC_INSTALLATION="resyncInstallation",e._protected.Constants.ACTION_ADD_TAG="addTag",e._protected.Constants.ACTION_REMOVE_TAG="removeTag",e._protected.Constants.ACTION_REMOVE_ALL_TAGS="removeAllTags",e._protected.Constants.ACTION__OVERRIDE_NOTIFICATION_RECEIPT="_overrideNotificationReceipt",e._protected.Constants.PER_USER_INSTALLATION_CUSTOM_PROPERTIES_STORAGE_KEY="perUserInstallationCustomProperties",e._protected.Constants.EVENTS_STORAGE_KEY="events",e._protected.Constants.JSON_SYNC_MAX_INFLIGHT_TIME=Math.round(1.1*e._protected.Constants.REQUEST_TIMEOUT_MS)+1e3,e._protected.Constants.CACHED_INSTALLATION_CUSTOM_PROPERTIES_MIN_DELAY=0,e._protected.Constants.CACHED_INSTALLATION_CUSTOM_PROPERTIES_MAX_DELAY=0,e._protected.Constants.FEDERATED_FRAME_URL=e._protected.Constants.CDN_ROOT_HREF+e._protected.Constants.PARTNER_DOMAIN_DEFAULT_URL_SUFFIX+e.prototype.Constants.SDK_VERSION+"/"+e._protected.Constants.FRAME_URL,e._protected.Constants.STORELOOP_WEBKEY="d94e437fcebe9b6abd33b391daf02ae151cefd9838ec80d287869abfbcd8e89b",e._protected.Constants.GOOGLE_ANALYTICS_PROPERTY_ID="UA-56491200-3",e._protected.Constants.GOOGLE_ANALYTICS_STORAGE_DATABASE_NAME="WP_analytics",e._protected.Constants.PRESENCE_ANTICIPATED_TIME_MS=3e5,e._protected.Constants.PRESENCE_UPDATE_SAFETY_MARGIN=6e4,e._protected.Constants.BROADCAST_TYPE_SET_USER_CONSENT="setUserConsent",e._protected.Constants.DEFAULT_LAST_RECEIVED_NOTIFICATION_CHECK_DELAY=6048e5,e._protected.Constants.LAST_RECEIVED_NOTIFICATION_CHECK_DATE_STORAGE_KEY="lastReceivedNotificationCheckDate",e._protected.Constants.LAST_RECEIVED_NOTIFICATION_CHECK_DATE_INSTALLATION_KEY="lastReceivedNotificationCheckDate",e._protected.Constants.LAST_RECEIVED_NOTIFICATION_CHECK_DELAY_PAYLOAD_KEY="lastReceivedNotificationCheckDelay",e._protected.Constants.FORCED_INAPPS_STORAGE_KEY="forcedInApps",e._protected.Constants.INVALID_ACCESS_TOKEN_ERROR_CODE=11003}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(){}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t,n=new e._protected.Promise.Deferred,o={},r={},i=function(e){var t=r[e];t&&o[e]&&(o[e].forEach((function(e){e.resolve(t)})),delete o[e])};return e._protected.Analytics=new function(){var s;this.getModuleInitializationPromise=function(){return n.promise};var a={},c=function(t,n){for(var o=e._protected.Constants.ANALYTICS_EXPERIMENTS||{},r=0;o[t]&&r<o[t].variants.length;r++)if(o[t].variants[r].name===n)return r;return-1};t=function(){if(e._protected.RunModes.Behaviors.Analytics)return e._protected.Analytics.getUserData().then((function(t){return(s=t).experiments&&Object.keys(s.experiments).forEach((function(t){e._protected.Analytics.activateExperimentVariant(t,s.experiments[t])})),e._protected.Blocker.category("analytics").wait()})).then(n.resolve).catch(n.reject);n.resolve()},this.setExperimentVariant=function(t,n){(e._protected.Constants.ANALYTICS_EXPERIMENTS||{})[t]?(s&&s.experiments&&(s.experiments[t]=n),e._protected.Analytics.activateExperimentVariant(t,n),e._protected.Analytics.saveExperimentVariantToDatabase(t,n)):e._protected.Helper.warn("[analytics   ]","Experiment not found:"+t)},this.activateExperimentVariant=function(t,n){t&&n&&(e._protected.RunModes.Behaviors.ModeFrame&&e._protected.Integration.callOnParentWindow("SDK._protected.Analytics.activateExperimentVariant",[t,n]),r[t]=n,i(t))},this.saveExperimentVariantToDatabase=e._protected.Integration.proxifyToCustomDomain("SDK._protected.Analytics.saveExperimentVariantToDatabase",(function(t,n){e._protected.Storage.get(e._protected.Constants.GOOGLE_ANALYTICS_USER_DATA_STORAGE_KEY,{},e._protected.Constants.GOOGLE_ANALYTICS_STORAGE_DATABASE_NAME).then((function(o){var r=o.experiments||{};return r[t]=n,o.experiments=r,e._protected.Storage.set(e._protected.Constants.GOOGLE_ANALYTICS_USER_DATA_STORAGE_KEY,o,e._protected.Constants.GOOGLE_ANALYTICS_STORAGE_DATABASE_NAME)}))})),this.getUserData=e._protected.Integration.proxifyToCustomDomain("SDK._protected.Analytics.getUserData",(function(){var t;return e._protected.Storage.bulk([{test:{key:e._protected.Constants.GOOGLE_ANALYTICS_USER_DATA_STORAGE_KEY,defaultValue:{},operationsCb:function(n){if(n.cid||(n.cid=e._protected.Helper.uuidv4()),e._protected.RunModes.Behaviors.AnalyticsExperiments){n.experiments||(n.experiments={});var o=e._protected.Constants.ANALYTICS_EXPERIMENTS||{};Object.keys(o).forEach((function(t){n.experiments[t]&&-1<c(t,n.experiments[t])||(n.experiments[t]=function(t){var n=(e._protected.Constants.ANALYTICS_EXPERIMENTS||{})[t];if(n)for(var o=Math.random(),r=0,i=0;i<n.variants.length;i++)if(o<(r+=n.variants[i].weight))return n.variants[i].name}(t))}))}return t=n,{put:{key:e._protected.Constants.GOOGLE_ANALYTICS_USER_DATA_STORAGE_KEY,value:n}}}}}],e._protected.Constants.GOOGLE_ANALYTICS_STORAGE_DATABASE_NAME).then((function(){return t}))})),this.setCustomDimension=function(e,t){a[e]=t},this.sendEvent=function(t,n,o,r,i){if(!e._protected.RunModes.Behaviors.Analytics)return!1;var p="/events/"+(t||"null")+"/"+(n||"null");if(i||(i=e._protected.Options.getWebKey()),!s.cid)return Promise.reject(new e.prototype.Errors.InternalError("Could not find google CID"));var d="";e._protected.RunModes.Behaviors.AnalyticsExperiments&&(d="exp="+encodeURIComponent(Object.keys(s.experiments).map((function(t){var n=s.experiments[t],o=function(t){var n=e._protected.Constants.ANALYTICS_EXPERIMENTS||{};return n[t]?n[t].identifier:null}(t);if(!n||!o)return"";var r=c(t,n);return-1===r?"":o+"."+r})).join("!")));var u="undefined"!=typeof navigator&&navigator.userAgent||"",l="undefined"!=typeof screen&&screen.availWidth&&screen.availHeight&&screen.availWidth+"x"+screen.availHeight||"",h="undefined"!=typeof window&&window.innerWidth&&window.innerHeight&&window.innerWidth+"x"+window.innerHeight||"",g="undefined"!=typeof document&&document.characterSet||"",f="undefined"!=typeof screen&&screen.colorDepth&&screen.colorDepth+"-bit"||"",m="undefined"!=typeof navigator&&navigator.language&&navigator.language.toLowerCase()||"",_="v=1&cid="+encodeURIComponent(s.cid)+"&tid="+encodeURIComponent(e._protected.Constants.GOOGLE_ANALYTICS_PROPERTY_ID)+(u&&"&ua="+encodeURIComponent(u)||"")+(l&&"&sr="+encodeURIComponent(l)||"")+(h&&"&vp="+encodeURIComponent(h)||"")+(g&&"&de="+encodeURIComponent(g)||"")+(f&&"&sd="+encodeURIComponent(f)||"")+(m&&"&ul="+encodeURIComponent(m)||"")+(i?"&cs="+encodeURIComponent(i):"")+"&"+d+"&"+Object.keys(a).map((function(e){return encodeURIComponent(e.replace("dimension","cd"))+"="+encodeURIComponent(""+a[e])})).join("&"),v="https://www.google-analytics.com/batch",w=[_+"&t=event&ec="+(t?encodeURIComponent(t):"")+"&ea="+(n?encodeURIComponent(n):"")+"&el="+(o?encodeURIComponent(o):"")+(r?"&ev="+r:""),_+"&t=pageview"+(o?"&dt="+encodeURIComponent(o):"")+"&dh="+encodeURIComponent(e._protected.Integration.getHomeUrlObject().hostname)+"&dp="+p].join("\n");if("undefined"!=typeof navigator&&navigator.sendBeacon)return navigator.sendBeacon(v,w);var y=new e._protected.Promise.Deferred;return e._protected.Request.request("POST",v,w,void 0,void 0,{onload:function(){y.resolve()},onerror:function(e){y.reject(e)}},void 0),y.promise},this.onExperiment=function(t){var n=new e._protected.Promise.Deferred;return o[t]=o[t]||[],o[t].push(n),i(t),n.promise}},e.preInstantiationPromise.then((function(){return Promise.all([e._protected.Storage.getModuleInitializationPromise(),e._protected.Integration.getModuleInitializationPromise(),e._protected.Locking.getModuleInitializationPromise()])})).then(t),n.promise}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e.prototype.Errors.ConsentError=function(t){e.prototype.Errors.Error.apply(this,arguments)},e.prototype.Errors.ConsentError.prototype=Object.create(e.prototype.Errors.Error.prototype,{name:{value:"WonderPushSDK.Errors.ConsentError"},constructor:{value:e.prototype.Errors.ConsentError}}),e.prototype.Errors.PermissionError=function(t,n,o){e.prototype.Errors.Error.call(this,t),this.permission=n,this.state=o},e.prototype.Errors.PermissionError.prototype=Object.create(e.prototype.Errors.Error.prototype,{name:{value:"WonderPushSDK.Errors.PermissionError"},constructor:{value:e.prototype.Errors.PermissionError}}),e.prototype.Errors.UserCancellationError=function(t){e.prototype.Errors.Error.apply(this,arguments)},e.prototype.Errors.UserCancellationError.prototype=Object.create(e.prototype.Errors.Error.prototype,{name:{value:"WonderPushSDK.Errors.UserCancellationError"},constructor:{value:e.prototype.Errors.UserCancellationError}}),e.prototype.Errors.RegistrationInProgressError=function(t){e.prototype.Errors.Error.apply(this,arguments)},e.prototype.Errors.RegistrationInProgressError.prototype=Object.create(e.prototype.Errors.Error.prototype,{name:{value:"WonderPushSDK.Errors.RegistrationInProgressError"},constructor:{value:e.prototype.Errors.RegistrationInProgressError}}),e.prototype.Errors.PushNotificationsNotSupportedError=function(t){e.prototype.Errors.Error.apply(this,arguments)},e.prototype.Errors.PushNotificationsNotSupportedError.prototype=Object.create(e.prototype.Errors.Error.prototype,{name:{value:"WonderPushSDK.Errors.PushNotificationsNotSupportedError"},constructor:{value:e.prototype.Errors.PushNotificationsNotSupportedError}}),e.prototype.Errors.PopupError=function(t){e.prototype.Errors.Error.apply(this,arguments)},e.prototype.Errors.PopupError.prototype=Object.create(e.prototype.Errors.Error.prototype,{name:{value:"WonderPushSDK.Errors.PopupError"},constructor:{value:e.prototype.Errors.PopupError}}),e.prototype.Errors.NotificationPayloadError=function(t){e.prototype.Errors.Error.apply(this,arguments)},e.prototype.Errors.NotificationPayloadError.prototype=Object.create(e.prototype.Errors.Error.prototype,{name:{value:"WonderPushSDK.Errors.NotificationPayloadError"},constructor:{value:e.prototype.Errors.NotificationPayloadError}}),e.prototype.Errors.PluginError=function(t){e.prototype.Errors.Error.apply(this,arguments)},e.prototype.Errors.PluginError.prototype=Object.create(e.prototype.Errors.Error.prototype,{name:{value:"WonderPushSDK.Errors.PluginError"},constructor:{value:e.prototype.Errors.PluginError}}),e._protected.Errors.InternalConfigUnavailableError=function(t){e.prototype.Errors.InternalError.apply(this,arguments)},e._protected.Errors.InternalConfigUnavailableError.prototype=Object.create(e.prototype.Errors.InternalError.prototype,{name:{value:"WonderPushSDK.Errors.InternalConfigUnavailableError"},constructor:{value:e._protected.Errors.InternalConfigUnavailableError}}),e._protected.Errors.InternalWrongDomainError=function(t){e.prototype.Errors.InternalError.apply(this,arguments)},e._protected.Errors.InternalWrongDomainError.prototype=Object.create(e.prototype.Errors.InternalError.prototype,{name:{value:"WonderPushSDK.Errors.InternalWrongDomainError"},constructor:{value:e._protected.Errors.InternalWrongDomainError}}),e._protected.Errors.InternalWrongTargetError=function(t){e.prototype.Errors.InternalError.apply(this,arguments)},e._protected.Errors.InternalWrongTargetError.prototype=Object.create(e.prototype.Errors.InternalError.prototype,{name:{value:"WonderPushSDK.Errors.InternalWrongTargetError"},constructor:{value:e._protected.Errors.InternalWrongTargetError}}),e.prototype.Errors.SubscriptionStateError=function(t,n,o){e.prototype.Errors.Error.call(this,t),this.expectedValues=n,this.subscriptionState=o},e.prototype.Errors.SubscriptionStateError.prototype=Object.create(e.prototype.Errors.Error.prototype,{name:{value:"WonderPushSDK.Errors.SubscriptionStateError"},constructor:{value:e.prototype.Errors.SubscriptionStateError}})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.RunModes.registerBehavior("CoreProperties",(function(t){return[e._protected.RunModes.Modes.WebSite,e._protected.RunModes.Modes.ServiceWorker,e._protected.RunModes.Modes.Popup].indexOf(t)>=0})),e._protected.RunModes.registerBehavior("Federated",(function(t){return t===e._protected.RunModes.Modes.Slave&&e._protected.Integration.isOnFederatedDomain()})),e._protected.RunModes.registerBehavior("Plugins",(function(t){return[e._protected.RunModes.Modes.WebSite,e._protected.RunModes.Modes.Frame,e._protected.RunModes.Modes.Popup,e._protected.RunModes.Modes.ServiceWorker].indexOf(t)>=0})),e._protected.RunModes.registerBehavior("Manifest",(function(t){return[e._protected.RunModes.Modes.WebSite,e._protected.RunModes.Modes.Popup,e._protected.RunModes.Modes.Frame].indexOf(t)>=0})),e._protected.RunModes.registerBehavior("Stylesheets",(function(){return e._protected.RunModes.Behaviors.Visible})),e._protected.RunModes.registerBehavior("Modal",(function(){return!1})),e._protected.RunModes.registerBehavior("NotificationPermission",(function(t){return[e._protected.RunModes.Modes.WebSite,e._protected.RunModes.Modes.Popup].indexOf(t)>=0})),e._protected.RunModes.registerBehavior("GeolocationPermission",(function(t){return t===e._protected.RunModes.Modes.WebSite})),e._protected.RunModes.registerBehavior("RegisterServiceWorker",(function(t){return[e._protected.RunModes.Modes.Frame,e._protected.RunModes.Modes.Popup].indexOf(t)>=0||t===e._protected.RunModes.Modes.WebSite&&e._protected.Integration.isOnRightDomain()})),e._protected.RunModes.registerBehavior("UnregisterServiceWorker",(function(t){return t===e._protected.RunModes.Modes.ServiceWorker||e._protected.RunModes.Behaviors.RegisterServiceWorker})),e._protected.RunModes.registerBehavior("CanRegisterServiceWorker",(function(t){return[e._protected.RunModes.Modes.Frame,e._protected.RunModes.Modes.WebSite,e._protected.RunModes.Modes.Popup].indexOf(t)>=0&&!!navigator.serviceWorker&&!!self.isSecureContext})),e._protected.RunModes.registerBehavior("RefreshPushToken",(function(t){var n=e._protected.Helper.detectBrowser();return"Chrome"===n.name&&t===e._protected.RunModes.Modes.Frame&&parseInt(n.version)>=71?e._protected.Integration.areTopWindowAndSelfOnRightDomain():e._protected.RunModes.Behaviors.SubscribeToPush&&t!==e._protected.RunModes.Modes.Popup})),e._protected.RunModes.registerBehavior("SubscribeToPush",(function(t){return e._protected.RunModes.Behaviors.RegisterServiceWorker||t===e._protected.RunModes.Modes.ServiceWorker&&e._protected.Helper.supportsVAPID()})),e._protected.RunModes.registerBehavior("UnsubscribeToPush",(function(t){return t===e._protected.RunModes.Modes.ServiceWorker||e._protected.RunModes.Behaviors.RegisterServiceWorker})),e._protected.RunModes.registerBehavior("OptionsSource",(function(t){return t===e._protected.RunModes.Modes.WebSite||t===e._protected.RunModes.Modes.Popup})),e._protected.RunModes.registerBehavior("Analytics",(function(e){return!1})),e._protected.RunModes.registerBehavior("ReadCurrentOrigin",(function(t){return[e._protected.RunModes.Modes.Frame,e._protected.RunModes.Modes.Popup,e._protected.RunModes.Modes.ServiceWorker,e._protected.RunModes.Modes.Slave].indexOf(t)>=0||t===e._protected.RunModes.Modes.WebSite&&e._protected.Integration.isOnRightDomain()}))}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){const{EventAttributionManager:t,ReportingDataUtil:o}=n(5);var r="[events      ]";e._protected.Events=new function(){this.WonderPushTrackEventEvent=function(t){return{event:t,name:e._protected.Events.WonderPushTrackEventEvent.TYPE,type:e._protected.Events.WonderPushTrackEventEvent.TYPE}},this.WonderPushTrackEventEvent.TYPE="trackEvent",this.WonderPushNotificationOpenedEvent=function(t){return{event:t,name:e._protected.Events.WonderPushNotificationOpenedEvent.TYPE,type:e._protected.Events.WonderPushNotificationOpenedEvent.TYPE}},this.WonderPushNotificationOpenedEvent.TYPE="notificationOpened",this.WonderPushSessionEvent=function(t){return{name:e._protected.Events.WonderPushSessionEvent.TYPE,type:e._protected.Events.WonderPushSessionEvent.TYPE,state:t}},this.WonderPushSessionEvent.TYPE="session",this.WonderPushSubscriptionEvent=function(t){return{name:e._protected.Events.WonderPushSubscriptionEvent.TYPE,type:e._protected.Events.WonderPushSubscriptionEvent.TYPE,state:t}},this.WonderPushSubscriptionEvent.TYPE="subscription",this.NewAppOpen=function(t){return{type:e._protected.Events.NewAppOpen.TYPE,visitCount:t}},this.NewAppOpen.TYPE="newAppOpen",this.NewPageView=function(){return{type:e._protected.Events.NewPageView.TYPE}},this.NewPageView.TYPE="newPageView",this.MethodCall=function(t,n){return{type:e._protected.Events.MethodCall.TYPE,method:t,methodArg:n}},this.MethodCall.TYPE="methodCall",this.fire=function(t){t.WonderPushSDK=e.this,e._protected.Helper.fireEvent(e._protected.gscope,"WonderPushEvent",t)},this.fireOnParentWindow=e._protected.Integration.proxifyToParentWindow("WonderPushSDK._protected.Events.fireOnParentWindow",(function(t){e._protected.Events.fire(t)})),this.listen=function(t){var n=self._wp_worker_addEventListener||function(t,n){e._protected.Helper.listenEvent(e._protected.gscope,t,n)};try{n("WonderPushEvent",t)}catch(t){console.warn(r,"Cannot listen to WonderPushEvent")}},this.unlisten=function(t){var n=self._wp_worker_removeEventListener||function(t,n){e._protected.Helper.unlistenEvent(e._protected.gscope,t,n)};try{n("WonderPushEvent",t)}catch(t){console.warn(r,"Cannot remove listener to WonderPushEvent")}},this.sendEvent=function(t,n,r,i,s){e._protected.Events.getCurrentAttribution().then(a=>{var c={};n=n||{};var p={};for(var d in n)n.hasOwnProperty(d)&&(p[d]=n[d]);o.assignEventData(p,a),p.type=t,p.actionDate=p.actionDate||e._protected.Time.getRealTime(),p.location=p.location||e._protected.Geo.getGeolocation(),p.location||delete p.location,r&&"object"==typeof r&&(p.custom=r),c.body=JSON.stringify(p),e._protected.Events.fireOnParentWindow(new e._protected.Events.WonderPushTrackEventEvent(p)),e._protected.Storage.getModuleInitializationPromise().then(()=>e._protected.Storage.bulk([{test:{key:e._protected.Constants.EVENTS_STORAGE_KEY,operationsCb:t=>{const n="@CAMPAIGN_TRIGGER"===p.type?"campaign":"last";t=(t=Array.isArray(t)?t:[]).filter(e=>!(!("last"!==n||"last"!==e.collapsing&&e.collapsing)&&p.type&&e.type===p.type||"campaign"===n&&"campaign"===e.collapsing&&p.campaignId&&e.campaignId===p.campaignId));const o=JSON.parse(JSON.stringify(p));return o.collapsing=n,t.push(o),[{put:{key:e._protected.Constants.EVENTS_STORAGE_KEY,value:t}}]}}}]));const u=s&&s.useMeasurementsApi?e._protected.Options.getMeasurementsApiUrlPrefix()+"/events":"/events",l=()=>s&&s.useBeacon?e._protected.Consent.awaitUserConsent().then(()=>e.this.Rest.postBeacon(u,c,i)):s&&s.postImmediately?e._protected.Consent.awaitUserConsent().then(()=>e.this.Rest.post(u,c,void 0)):(e.this.Rest.postEventually(u,c,void 0),Promise.resolve());return s&&s.useMeasurementsApi?(c.clientId=e._protected.Options.getWebKey(),c.devicePlatform="Web",e._protected.getUserId().then(t=>(t&&(c.userId=t),e._protected.Init.getDeviceId())).then(e=>(c.deviceId=e,l()))):l()})},this.getCurrentAttribution=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Events.getCurrentAttribution",(function(){return new t(e._protected.Storage).currentAttribution()})),this.getAllEvents=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Events.getAllEvents",(function(){return e._protected.Storage.getModuleInitializationPromise().then(()=>e._protected.Storage.get(e._protected.Constants.EVENTS_STORAGE_KEY,[]).then(e=>e.map(e=>(e.creationDate||(e.creationDate=e.actionDate),e))))}))}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o,r;o=[n(65)],void 0===(r=function(e){return function(t){var n=new t._protected.Promise.Deferred,o=function(){if(t._protected.RunModes.Behaviors.Stylesheets){const n=t._protected.Options.getStylesheetUrl();n&&"wonderpush.min.css"!==n?t._protected.Integration.injectStylesheetLink(n):t._protected.Integration.injectStylesheetInline(e.toString())}if(s(),t._protected.RunModes.Behaviors.ModeWebSite){var n=t._protected.gscope._wp_loaderScriptUrl;if(n){delete t._protected.gscope._wp_loaderScriptUrl;var o=(n.match(/by\.wonderpush\.com\/sdk\/([0-9\.]*)\//)||[])[1];o&&t._protected.Integration.getFrameReadyPromise().then((function(){t._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.Storage.set",["sdkLoaderUrlVersion",o])}))}}(t._protected.RunModes.Behaviors.ModeFrame||t._protected.RunModes.Behaviors.ModeWebSite&&t._protected.Integration.isOnRightDomain())&&t._protected.Storage.set("sdkVersion",t._protected.Constants.SDK_VERSION)},r=function(e){var n,o=t._protected.Options.getCustomDomain()||("undefined"!=typeof registration?registration.scope:void 0)||location.origin;try{n=new URL(o)}catch(r){o.indexOf(".")<0&&"localhost"!==o&&(o+=t._protected.Constants.DEFAULT_DOMAIN_SUFFIX),o.endsWith("/")||(o+="/"),o="full"===e?"https://"+o+t._protected.Constants.PARTNER_DOMAIN_DEFAULT_URL_SUFFIX+t._protected.Constants.SDK_VERSION+"/":"short"===e?"https://"+o+t._protected.Constants.PARTNER_DOMAIN_DEFAULT_URL_SUFFIX+t._protected.Constants.SDK_SHORT_VERSION+"/":"https://"+o+t._protected.Constants.PARTNER_DOMAIN_DEFAULT_URL_SUFFIX,n=new URL(o)}return n.protocol="https:","/"!==n.href.slice(-1)&&(n=new URL(n.href+"/")),n},i=function(e){return r(e).href};t._protected.Integration.getCurrentOperatingOrigin=function(){return t._protected.RunModes.Behaviors.ReadCurrentOrigin?location.origin:null},t._protected.Integration.getHomeUrlObject=function(){return r()},t._protected.Integration.getServiceWorkerUrl=function(){var e=new URL(t._protected.Options.getServiceWorkerUrl(),i("none"));return e.protocol="https:",e.href},t._protected.Integration.getFrameUrl=function(){var e=new URL(t._protected.Options.getFrameUrl(),i("full"));return e.protocol="https:",e.href},t._protected.Integration.getRedirectionPageUrl=function(e){var n=new URL(t._protected.Options.getRedirectionPageUrl(e),i("full"));return n.protocol="https:",n.href},t._protected.Integration.getManifestInjectedPromise=function(){return n.promise};var s=function(){if(t._protected.RunModes.Behaviors.Manifest&&!document.head.querySelector('link[rel=manifest][href^="'+t._protected.Integration.getHomeOrigin()+'"]')){var e=document.createElement("link");e.rel="manifest",e.href=((o=new URL(t._protected.Options.getManifestUrl(),i("full"))).protocol="https:",o.href),document.head.appendChild(e)}var o;n.resolve()};t._protected.Integration.isOnFederatedDomain=function(){return location.origin===new URL(t._protected.Constants.FEDERATED_FRAME_URL).origin},t.preInstantiationPromise.then((function(){t._protected.Integration.getModuleInitializationPromise().then(o)}))}}.apply(t,o))||(e.exports=r)},function(e,t,n){var o=n(6),r=n(66),i=n(67);(t=o(!1)).i(r),t.i(i),t.push([e.i,"\n",""]),e.exports=t},function(e,t,n){(t=n(6)(!1)).push([e.i,"BODY.modal-open {\n  overflow: hidden;\n}\n\n.wp-modal {\n  z-index: 10000;\n  position: fixed;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background-color: rgba(0, 0, 0, 0.75);\n  overflow: auto;\n}\n\n.wp-modal > .wp-modal-wrapper-outer {\n  display: flex;\n  height: 100%;\n}\n\n.wp-modal > .wp-modal-wrapper-outer > .wp-modal-wrapper-inner {\n  margin: auto;\n  max-height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n\n.wp-modal > .wp-modal-wrapper-outer > .wp-modal-wrapper-inner > .wp-modal-block {\n  display: flex;\n  flex-direction: column;\n  max-width: 30em;\n  max-height: 50em;\n  border: 1px solid #E0E0E0;\n  border-radius: 2px;\n  box-shadow: 0 0.2em 2em black;\n  background-color: #FFF;\n  color: #333;\n  margin: 1em;\n}\n\n.wp-modal-block > .wp-modal-title {\n  border-bottom: 2px solid #10ACFF;\n  color: #10ACFF;\n  padding: 0.7em 0.6em;\n  line-height: 1.2em;\n  font-size: 125%;\n  flex-shrink: 0;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n}\n\n.wp-modal-title > .wp-modal-title-icon {\n  background-size: 2em 2em;\n  background-position: 50% 50%;\n  background-repeat: no-repeat;\n  width: 2em;\n  height: 2em;\n  flex-shrink: 0;\n  flex-grow: 0;\n  margin-right: 0.7em;\n}\n\n.wp-modal-title > .wp-modal-title-text {\n  flex-grow: 1;\n}\n\nwp-modal-block > .wp-modal-content {\n  overflow: auto;\n}\n\n.wp-modal-content > .wp-modal-text {\n  padding: 0.7em 0.6em;\n}\n\n.wp-modal-block > .wp-modal-buttons {\n  flex-shrink: 0;\n  display: flex;\n  flex-direction: row;\n  border-top: 1px solid #E0E0E0;\n}\n\n.wp-modal-buttons > .wp-modal-button {\n  flex: 1;\n  -moz-user-select: none;\n  border-right: 1px solid #E0E0E0;\n  cursor: pointer;\n  font-weight: normal;\n  line-height: 1.2em;\n  padding: 0.7em 0.6em;\n  text-align: center;\n  vertical-align: middle;\n  white-space: nowrap;\n}\n\n.wp-modal-buttons > .wp-modal-button:hover {\n  background-color: #f0f0f0;\n}\n\n.wp-modal-buttons > .wp-modal-button:last-child {\n  border-right: 0;\n}\n",""]),e.exports=t},function(e,t,n){(t=n(6)(!1)).push([e.i,".wp-popup {\n  position: absolute;\n  left: 0;\n  top: 0;\n  bottom: 0;\n  right: 0;\n  font-family: arial;\n  text-align: center;\n  padding-left: 10px;\n  padding-right: 10px;\n}\n.wp-popup .wp-popup-content {\n  display: flex;\n  flex-flow: column;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  margin: 0 auto;\n  max-width: 350px;\n  min-width: 231px;\n}\n.wp-popup .wp-popup-title {\n  font: bold 18px arial;\n  margin-bottom: 12px;\n}\n.wp-popup .wp-popup-message {\n  font: 15px arial;\n  color: #777;\n  margin-bottom: 25px;\n}\n.wp-popup .wp-popup-example {\n  background-color: #fff;\n  height: 80px;\n  box-shadow: 0 0 20px #888888;\n  margin-bottom: 20px;\n  flex-flow: row nowrap;\n  display: flex;\n  align-self: stretch;\n}\n\n/* When used inside the notification example */\n.wp-popup .wp-popup-example .wp-popup-icon {\n  flex-basis: 80px;\n  width: 80px;\n  height: 80px;\n  flex-grow: 0;\n  flex-shrink: 0;\n  background-color: #efefef;\n  background-size: contain;\n  background-repeat: no-repeat;\n  background-position: 50% 50%;\n}\n\n/* When used directly on the popup */\n.wp-popup #logo.wp-popup-icon {\n  background-size: contain;\n  background-repeat: no-repeat;\n  background-position: 50% 50%;\n}\n\n.wp-popup .wp-popup-example-text {\n  text-align: left;\n  flex: 1 auto;\n  padding: 10px 17px 8px 17px;\n  display: flex;\n  flex-flow: column nowrap;\n}\n.wp-popup .wp-popup-example-text>div {\n  flex: 0 auto;\n}\n\n.wp-popup .wp-popup-example-text .wp-popup-example-title {\n  font: 13px arial;\n  color: #3c3c3c;\n  margin-bottom: 5px;\n}\n.wp-popup .wp-popup-example-text .wp-popup-example-message {\n  flex-grow: 1;\n  font: 12px arial;\n  color: #3c3c3c;\n}\n.wp-popup .wp-popup-example-text .wp-popup-example-url {\n  font: 10px arial;\n  color: #9d9d9d;\n}\n.wp-popup .wp-popup-disclaimer {\n  font: 10px arial;\n  font-style: italic;\n  color: #b0b0b0;\n}\n.wp-popup .wp-popup-buttons {\n  padding: 20px;\n}\n\n.wp-popup .wp-popup-buttons .wp-popup-negative-button {\n  border: none;\n  background: none;\n  color: #777;\n  text-decoration: underline;\n  padding: 15px;\n  font-size:12px;\n  cursor: pointer;\n}\n.wp-popup .wp-popup-buttons .wp-popup-positive-button {\n  border: none;\n  background: #1a73e8;\n  color: white;\n  font-weight: bold;\n  text-decoration: none;\n  border-radius: 5px;\n  padding: 15px;\n  cursor: pointer;\n  font-size:20px;\n}",""]),e.exports=t},function(e,t,n){var o;void 0===(o=function(){return function(e){var t=e._protected.Consulate.createConsulate("federated");e._protected.Federated=new function(){this.ensureSetup=function(){if(e._protected.RunModes.Behaviors.ContextWindow){if(e._protected.RunModes.Behaviors.ModeSlave,e._protected.RunModes.Behaviors.Federated)throw new e._protected.Errors.InternalWrongTargetError("Must not create a frame on federated domain from a frame on federated domain");if(!t.isSetup()){var o=e._protected.Options.exportInitial(),r={_mode:e._protected.RunModes.Modes.Slave};"debug"in o&&(r.debug=o.debug),t.setup(n(),r)}}},this.getReadyPromise=function(){return t.getReadyPromise()},this.call=function(n,o){return e._protected.Federated.ensureSetup(),e._protected.Federated.getReadyPromise().then((function(){return e._protected.Integration.callOnSlave(t.getPostMessageTarget(),n,o)}))};var n=function(){return e._protected.Constants.FEDERATED_FRAME_URL}}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.Storage.getDatabaseName=function(){return e._protected.RunModes.Behaviors.Federated?(e._protected.Helper.debug("[storage     ]","using federated database"),"WP_federated"):"WP_"+e._protected.Options.getWebKey()},e._protected.CustomDomainStorage=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.CustomDomainStorage",{getModuleInitializationPromise:e._protected.Storage.getModuleInitializationPromise,getDatabaseName:e._protected.Storage.getDatabaseName,getKeyValueStorageStoreName:e._protected.Storage.getKeyValueStorageStoreName,getMutexStoreName:e._protected.Storage.getMutexStoreName,get:e._protected.Storage.get,set:e._protected.Storage.set,rm:e._protected.Storage.rm,listObjectStores:e._protected.Storage.listObjectStores,deleteDatabase:e._protected.Storage.deleteDatabase})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){let t=new e._protected.Promise.DynamicPromise;const n=new e._protected.Promise.Deferred;return e._protected.Consent={},e._protected.Consent.getUserConsent=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Consent.getUserConsent",(function(){return e._protected.Storage.get("userConsent").then(e=>{e=e||{};const{state:t}=e;return t})})),e._protected.Consent.hasUserConsent=function(){return e._protected.Consent.getUserConsent().then(t=>{const n=e._protected.Options.getRequiresUserConsent();return void 0!==t?t:!n})},e._protected.Consent.setUserConsent=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Consent.setUserConsent",(function(t){e._protected.Helper.debug("[consent     ]","[setUserConsent]",t);const n={state:!!t,updateDate:+new Date};return e._protected.Storage.set("userConsent",n).then(()=>{e._protected.Integration.broadcast(e._protected.Constants.BROADCAST_TYPE_SET_USER_CONSENT,n)})})),e._protected.Consent.awaitUserConsent=function(){return t.promise},e._protected.Consent.getModuleInitializationPromise=()=>n.promise,e.preInstantiationPromise.then(()=>Promise.all([e._protected.Integration.getModuleInitializationPromise(),e._protected.Options.getModuleInitializationPromise()])).then(()=>{n.resolve(),e._protected.RunModes.Behaviors.ModeWebSite&&e._protected.Blocker.category("ready").add("consent"),e._protected.Consent.hasUserConsent().then(n=>{n?(e._protected.Blocker.category("ready").remove("consent"),t.setResolved()):t.setPending()}),e._protected.Integration.addBroadcastListener(e._protected.Constants.BROADCAST_TYPE_SET_USER_CONSENT,()=>{e._protected.Consent.hasUserConsent().then(n=>{n?(t.setResolved(),e._protected.Blocker.category("ready").remove("consent")):t.setPending()})})}),n.promise}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e.prototype.SessionState={INIT_FAILED:-1,INIT_UNSTARTED:0,INIT_INPROGRESS:1,INIT_SUCCESS:2},Object.freeze(e.prototype.SessionState)}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t,n,o=[],r=Object.freeze({supportLevels:{optOut:{accessToken:!1,internalEvents:!1,customEvents:!1},optIn:{accessToken:!0,internalEvents:!0,customEvents:!1}}});t=function(){s(),e._protected.Config.addConfigProcessor((function(t){n=t;var o=t.options||{},r=o.defaults||{},i=o.override||{};"string"==typeof e._protected.Options.getNotificationIcon()&&"string"==typeof r.notificationIcon&&e._protected.Options.getNotificationIcon().startsWith("http://")&&r.notificationIcon.startsWith("https://")&&(i.notificationIcon=r.notificationIcon)})),e._protected.Blocker.category("accessToken").add("config"),e._protected.Blocker.category("integration").add("config"),e._protected.Config.getModuleInitializationPromise().then((function(){e._protected.RunModes.Behaviors.AccessToken&&e._protected.Integration.isOnRightDomain()&&c(),e._protected.Blocker.category("accessToken").remove("config"),e._protected.Blocker.category("integration").remove("config")}))};var i=function(){if(!e._protected.Config.isConfigLoaded())throw new e._protected.Errors.InternalConfigUnavailableError("Config not loaded yet");switch(e.prototype.Notification.getSubscriptionState()){default:case e.prototype.SubscriptionState.UNSUPPORTED:case e.prototype.SubscriptionState.UNSUBSCRIBED:case e.prototype.SubscriptionState.NOT_SUBSCRIBED:return"optOut";case e.prototype.SubscriptionState.SUBSCRIBED:return"optIn"}},s=function(){e._protected.Events.listen((function(e){n&&"subscription"===(e.detail||{}).name&&a()}))},a=function(){e._protected.RunModes.Behaviors.AccessToken&&e._protected.Integration.isOnRightDomain()&&c()},c=function(){var e=function(){var e=i();return(n.supportLevels||{})[e]||r.supportLevels[e]}(),t=i(),o=[];e.accessToken||o.push("config_"+t+"_accessToken"),p(o)},p=function(t){var n;for(n=0;n<t.length;++n)o.indexOf(t[n])>=0||e._protected.Blocker.category("accessToken").add(t[n]);for(n=0;n<o.length;++n)t.indexOf(o[n])>=0||e._protected.Blocker.category("accessToken").remove(o[n]);o=t.slice()};e._protected.Config.getPluginsRegistry=function(){return n&&n.pluginsRegistry||{}},e._protected.Config.getInAppConfig=function(){return e._protected.Config.getModuleInitializationPromise().then(()=>e._protected.Config.remoteConfigManager.read()).then(e=>e&&e.data&&e.data.inAppConfig||{campaigns:[]})},e._protected.Config.getAutomaticActions=function(){return e._protected.Config.getModuleInitializationPromise().then(()=>e._protected.Config.remoteConfigManager.read()).then(e=>e&&e.data&&e.data.automaticActions||[])},t()}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o,r;o=[n(19),n(20)],void 0===(r=function(e,t){return function(e){var t,n=new e._protected.Promise.Deferred;return e._protected.Session=new function(){t=function(){e.preInstantiationPromise.then((function(){e._protected.Blocker.category("accessToken").add("currentSession"),Promise.all([e._protected.Options.getModuleInitializationPromise(),e._protected.Storage.getModuleInitializationPromise()]).then((function(){n.resolve(),e._protected.Blocker.category("accessToken").remove("currentSession")}))}))},this.getModuleInitializationPromise=function(){return n.promise},this.listUsedUserIds=function(){return e._protected.Storage.get("sessions",{}).then((function(e){return Object.keys(e).map((function(e){return""===e?null:e}))}))},this.getSession=function(t){return t||(t=""),e._protected.Storage.get("sessions",{}).then((function(e){return e[t]?e[t]:{}}))},this.getCurrentSession=function(){return e._protected.getUserId().then(t=>e._protected.Session.getSession(t)).then((function(e){return e}))},this.deleteSession=function(t){return t||(t=""),e._protected.Storage.get("sessions",{}).then((function(n){return delete n[t],e._protected.Storage.set("sessions",n)}))},this.setSession=function(t){return e._protected.Storage.get("sessions",{}).then((function(n){return n[t.userId||""]=t,e._protected.Storage.set("sessions",n)}))},this.reset=function(){return e._protected.Storage.rm("sessions")},this.serialize=function(){return e._protected.Storage.get("sessions",{}).then((function(e){return JSON.stringify(e)}))},this.deserialize=function(t){var n=JSON.parse(t||"{}");e._protected.Storage.set("sessions",n)}},t(),n.promise}}.apply(t,o))||(e.exports=r)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t=function(t,n,o){return n=n||{},(o?Promise.resolve(o):e._protected.Session.getSession(t)).then((function(t){n.sdkVersion="Web-"+e.this.Constants.SDK_VERSION;var o=t.lang||e._protected.gscope.navigator.language;return n.lang=e._protected.Helper.inArray(o,e._protected.Constants.VALID_LANGUAGE_CODES)?o:e._protected.Constants.DEFAULT_LANGUAGE_CODE,t.accessToken&&(n.accessToken=t.accessToken),t.userId&&(n.userId=t.userId),n}))},n=function(t){return t&&(t.startsWith("https://")||t.startsWith("http://"))?t:(t&&t.length>0&&"/"!==t.charAt(0)&&(t="/"+t),e._protected.Options.getApiUrlPrefix()+t)},o=function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")};e.prototype.Rest=new function(){this.get=function(t,n,o,r){return e._protected.getUserId().then(i=>e._protected.Rest.get(i,t,n,o,r))},this.post=function(t,n,o,r,i){return e._protected.getUserId().then(s=>e._protected.Rest.post(s,t,n,o,r,i))},this.postEventually=function(t,n,o){return e._protected.getUserId().then(r=>e._protected.Rest.postEventually(r,t,n,o))},this.postBeacon=function(r,i,s){return e.prototype.getInitializationPromise().then((function(){return e._protected.getUserId().then(e=>t(e,i,s)).then((function(e){var t=n(r),i=o(e);return navigator.sendBeacon(t,new Blob([i],{type:"application/x-www-form-urlencoded"}))}))}))},this.delete=function(t,n,o,r){return e._protected.getUserId().then(i=>e._protected.Rest.delete(i,t,n,o,r))},this.fetch=function(e,t,n,o){return"GET"===e?this.get(t,n,void 0,{fetch:!0}):"POST"===e?this.post(t,n,o,void 0,{fetch:!0}):"PUT"===e?this.put(t,n,o,void 0,{fetch:!0}):"PATCH"===e?this.patch(t,n,o,void 0,{fetch:!0}):"DELETE"===e?this.delete(t,n,void 0,{fetch:!0}):Promise.reject("Unsupported method "+e+" for fetch")},this.put=function(t,n,o,r,i){return e._protected.getUserId().then(o=>e._protected.Rest.put(o,t,n,r,i))},this.patch=function(t,n,o,r,i){return e._protected.getUserId().then(o=>e._protected.Rest.patch(o,t,n,r,i))}},e._protected.Rest=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Rest",new function(){this.destroy=function(){},this.get=function(r,i,s,a,c){return t(r,s).then((function(t){var r=n(i),s=o(t);return s&&(r=r+"?"+s),e._protected.Request.request("GET",r,"",void 0,{},a,c)}))},this.post=function(r,i,s,a,c,p){return t(r,s).then((function(t){var r=n(i),s=o(t);return e._protected.Request.request("POST",r,s,a,{"Content-type":"application/x-www-form-urlencoded"},c,p)}))},this.postEventually=function(r,i,s,a){return e.prototype.getInitializationPromise().then((function(){const c=t=>{if(t.accessToken){var r=n(i),s=o(t);return e._protected.Request.requestEventually("POST",r,s,a,{"Content-type":"application/x-www-form-urlencoded"})}e._protected.Helper.error("[rest        ]","[postEventually] We have no accessToken! Cannot call WonderPush API.")};return t(r,s).then((function(n){n.accessToken?c(n):e._protected.getUserId().then(o=>e._protected.Init.fetchAccessTokenIfNeeded(o,()=>{t(o,n).then((function(e){c(e)}))},()=>{c(n)}))}))}))},this.delete=function(r,i,s,a,c){return t(r,s).then((function(t){var r=n(i),s=o(t);return s&&(r=r+"?"+s),e._protected.Request.request("DELETE",r,"",void 0,{},a,c)}))},this.fetch=function(e,t,n,o,r){return"GET"===t?this.get(e,n,o,void 0,{fetch:!0}):"POST"===t?this.post(e,n,o,r,void 0,{fetch:!0}):"PUT"===t?this.put(e,n,o,r,void 0,{fetch:!0}):"PATCH"===t?this.patch(e,n,o,r,void 0,{fetch:!0}):"DELETE"===t?this.delete(e,n,o,void 0,{fetch:!0}):Promise.reject("Unsupported method "+t+" for fetch")},this.fetchJson=function(e,t,n,o,r){return this.fetch(e,t,n,o,r).then((function(e){return e.json()}))},this.put=function(r,i,s,a,c,p){return t(r,s).then((function(t){var r=n(i),s=o(t);return e._protected.Request.request("PUT",r,s,a,{"Content-type":"application/x-www-form-urlencoded"},c,p)}))},this.patch=function(r,i,s,a,c,p){return t(r,s).then((function(t){var r=n(i),s=o(t);return e._protected.Request.request("PATCH",r,s,a,{"Content-type":"application/x-www-form-urlencoded"},c,p)}))}}),e.preInstantiationPromise.then(()=>{e._protected.Request.addGlobalErrorHandler(async t=>{const n=t&&t.target&&t.target.responseJSON;if(n&&n.error&&n.error.code===e._protected.Constants.INVALID_ACCESS_TOKEN_ERROR_CODE){const t=await e._protected.getUserId();e._protected.Session.setSession({accessToken:null,sid:null,installationId:null,userId:t}).then(()=>{e._protected.RunModes.Behaviors.CoreProperties&&e._protected.Installation.updateInstallationCoreProperties({force:!0}),e._protected.ServiceWorkerClient.getPushSubscriptionFromServiceWorker().then((function(t){e._protected.Installation.addInstallationPushToken(t,!0)})),e._protected.JsonSyncInstallationCustom.receiveServerStateForUser(t,{}),e._protected.JsonSyncInstallationCustom.flush();var n={preferences:{subscriptionStatus:e.prototype.Notification.getSubscriptionState()===e.prototype.SubscriptionState.UNSUBSCRIBED?"optOut":"optIn"}};e.this.Rest.postEventually("/installation",{body:JSON.stringify(n),overwrite:!1})})}})})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){const{EventAttributionManager:t,ReportingDataUtil:o}=n(5);e.prototype.subscribeToNotifications=function(t){return e._protected.Notification.setNotificationEnabled(!0,t)},e.prototype.isSubscribedToNotifications=function(){return Promise.resolve(e.prototype.getNotificationEnabled())},e.prototype.unsubscribeFromNotifications=function(){return e._protected.Notification.setNotificationEnabled(!1)},e.prototype.isAllowedSubscriptionDomain=function(t){return Promise.resolve(e._protected.Notification.isAllowedSubscriptionDomain(t))},e.prototype.trackEvent=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.trackEvent",(function(t,n){return"string"!=typeof t||""===t||"@"===t.charAt(0)?Promise.reject(new e.prototype.Errors.InvalidArgumentError("Bad event type")):(e._protected.Events.sendEvent(t,null,n),Promise.resolve())})),e.prototype.getProperties=function(){return e._protected.Installation.getProperties()},e.prototype.putProperties=function(t){return e._protected.Installation.putProperties(t)},e.prototype.setProperty=function(t,n){return e._protected.Installation.setProperty(t,n)},e.prototype.unsetProperty=function(t){return e._protected.Installation.unsetProperty(t)},e.prototype.addProperty=function(t,n){return e._protected.Installation.addProperty.apply(null,arguments)},e.prototype.removeProperty=function(t,n){return e._protected.Installation.removeProperty.apply(null,arguments)},e.prototype.getPropertyValue=function(t){return e._protected.Installation.getPropertyValue(t)},e.prototype.getPropertyValues=function(t){return e._protected.Installation.getPropertyValues(t)},e.prototype.addTag=function(t){return e._protected.Installation.addTag.apply(null,Array.from(arguments))},e.prototype.removeTag=function(t){return e._protected.Installation.removeTag.apply(null,Array.from(arguments))},e.prototype.removeAllTags=function(){return e._protected.Installation.removeAllTags()},e.prototype.addRemoveTags=function(t,n){return e._protected.Installation.addRemoveTags(t,n)},e.prototype.getTags=function(){return e._protected.Installation.getTags()},e.prototype.hasTag=function(t){return e._protected.Installation.hasTag(t)},e.prototype.useGeolocation=function(t){return e.prototype.Geo.useGeolocation(t)},e.prototype.showSubscriptionDialog=function(){const t=e.prototype.Plugins.get("optin-dialog");return t?(t.showDialog(),Promise.resolve()):Promise.resolve()},e.prototype.showSubscriptionBell=function(t){const n=e.prototype.Plugins.get("optin-bell");return n?(t?n.showBell():n.hideBell(),Promise.resolve()):Promise.resolve()},e.prototype.showSubscriptionSwitch=function(t,n){const o=e._protected.Options.getPlugins(),r=e.prototype.Plugins.get("optin-switch"),{document:i}=e._protected.gscope;if(!t||!r||!i)return Promise.resolve();const s=i.createElement("div");s.id=o["optin-switch"]&&o["optin-switch"].switchElementId||"wonderpush-subscription-switch";for(const e in n)s.setAttribute("data-"+e,n[e]);return t.appendChild(s),r.setupSubscriptionSwitch(),Promise.resolve()},e.prototype.showTagSwitches=function(t,n){const o=e._protected.Options.getPlugins(),r=e.prototype.Plugins.get("tag-switch"),{document:i}=e._protected.gscope;return t&&r&&i?Array.isArray(n)?(n.forEach(e=>{const n=i.createElement("div");n.classList.add(o["tag-switch"]&&o["tag-switch"].switchElementClass||"wonderpush-tag-switch");for(const t in e)n.dataset[t]=e[t];t.appendChild(n)}),r.setupTagSwitch(),Promise.resolve()):(console.warn("WonderPush.showTagSwitches() expects an array as second argument"),Promise.resolve()):Promise.resolve()},e.prototype.showTagSwitch=e.prototype.showTagSwitches,e.prototype.setInAppMessagingDisplayCallback=function(t){e._protected.InAppMessaging.setDisplayCallback(t)},e.prototype.setInAppMessagesSuppressed=function(t){return e._protected.InAppMessaging.setMessagesSuppressed(t)},e.prototype.getInAppMessagesSuppressed=function(){return e._protected.InAppMessaging.getMessagesSuppressed()},e.prototype.getDisplayedInAppMessage=function(){return e._protected.InAppMessaging.getDisplayedInAppMessage()},e.prototype.getUserConsent=function(){return e._protected.Consent.getUserConsent()},e.prototype.setUserConsent=function(t){return e._protected.Consent.setUserConsent(t)},e.prototype.clearAllData=function(){return e.prototype.Data.clearAll()},e.prototype.clearEventsHistory=function(){return e.prototype.Data.clearEventsHistory()},e.prototype.clearPreferences=function(){return e.prototype.Data.clearPreferences()},e.prototype.downloadAllData=function(){return e.prototype.Data.downloadExport()},e.prototype.addPageView=function(){return e.prototype.newPageLoaded(),Promise.resolve()},e.prototype.setUserId=function(t){return e._protected.setUserId(t)},e.prototype.getUserId=function(){return e._protected.getUserId()};var r,i=!1;e._protected.getUserId=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.getUserId",(function(){return i||e._protected.Helper.warn("[sdk         ]","userId requested before being initialized"),e._protected.Storage.get("userId",null).then(e=>e&&e.userId||null)})),e._protected.setUserId=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.setUserId",(function(t){i=!0;var n=!1;return t=t||null,e._protected.Storage.bulk([{test:{key:"userId",defaultValue:null,operationsCb:function(e){return e&&t===e.userId?null:(n=!0,{put:{key:"userId",value:{userId:t,updateDate:+new Date}}})}}}]).then(()=>{n&&e._protected.Init.fetchAccessTokenIfNeeded(t,()=>{e._protected.Installation.updateInstallationCoreProperties(),e._protected.Installation.sendCachedPushToken()},()=>{})})})),e.prototype.sendSelfNotification=function(t){return e._protected.sendSelfNotification(t)},e._protected.sendSelfNotification=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.sendSelfNotification",(function(t){const n={};return"object"==typeof t&&null!==t&&(t.notification&&(n.notification=JSON.stringify(t.notification)),t.campaignId&&(n.campaignId=t.campaignId),t.notificationId&&(n.notificationId=t.notificationId),t.notificationOverride&&(n.notificationOverride=JSON.stringify(t.notificationOverride)),t.notificationParams&&(n.notificationParams=JSON.stringify(t.notificationParams))),0===Object.keys(n).length&&(n.notification=JSON.stringify({alert:{title:"Test notification",text:"If you can read this, everything works as it should."}})),e._protected.Consent.awaitUserConsent().then(()=>{const t=e.prototype.Notification.getSubscriptionState();if(t!==e.prototype.SubscriptionState.SUBSCRIBED)throw new e.prototype.Errors.SubscriptionStateError("The user must be subscribed before sending a notification",[e.prototype.SubscriptionState.SUBSCRIBED],t)}).then(()=>e.this.Rest.post("/deliveries",n,void 0)).then(()=>{})})),e.prototype.getSessionState=function(){return e._protected.Init.getSessionState()},e.prototype.getNotificationIcon=function(){return e._protected.Options.getNotificationIcon()},e.prototype.isNativePushNotificationSupported=function(){return e._protected.Notification.isNativePushNotificationSupported()},e.prototype.askNativePushNotificationPermission=function(){e.prototype.setNotificationEnabled(!0).catch((function(e){console.warn(e)}))},e.prototype.unsubscribeFromPushNotification=function(){return e.prototype.setNotificationEnabled(!1)},e.prototype.isRegistrationInProgress=function(){return e._protected.Notification.isRegistrationInProgress()},e.prototype.setNotificationEnabled=function(t,n){return e._protected.Notification.setNotificationEnabled(t,n)},e.prototype.getNotificationEnabled=function(){return e.prototype.Notification.getSubscriptionState()===e.prototype.SubscriptionState.SUBSCRIBED},e.prototype.isOnRightDomain=function(){return e._protected.Integration.isOnRightDomain()},e.preInstantiationPromise.then((function(){return e.prototype.getInitializationPromise()})).then((function(){return e._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.Session.getCurrentSession")})).then((function(e){r=e})),e.prototype.trackEventOnUnload=function(t,n){return"string"!=typeof t||""===t||"@"===t.charAt(0)?Promise.reject(new e.prototype.Errors.InvalidArgumentError("Bad event type")):e._protected.Events.sendEvent(t,null,n,r,{useBeacon:!0})},e._protected.trackEventWithInternalData=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.trackEventWithInternalData",(function(t,n,o){if("string"!=typeof t||""===t||"@"===t.charAt(0))throw new e.prototype.Errors.InvalidArgumentError("Bad event type");e._protected.Events.sendEvent(t,n,o)})),e._protected.trackInternalEvent=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.trackInternalEvent",(function(t,n,o){if("@"!==t.charAt(0))throw new e.prototype.Errors.InvalidArgumentError("This method must only be called for internal events, starting with an '@'");e._protected.Events.sendEvent(t,n,o)})),e._protected.trackInternalEventWithMeasurementsApi=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.trackInternalEventWithMeasurementsApi",(function(t,n,o){if("@"!==t.charAt(0))throw new e.prototype.Errors.InvalidArgumentError("This method must only be called for internal events, starting with an '@'");e._protected.Events.sendEvent(t,n,o,void 0,{useMeasurementsApi:!0,postImmediately:!0})})),e._protected.trackInternalEventWithAppropriateApi=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.trackInternalEventWithAppropriateApi",(function(t,n,o,r){return Promise.all([e._protected.Session.getCurrentSession(),r&&r.overrideNotificationReceiptOnly?e._protected.Storage.get("_overrideNotificationReceipt",!1):Promise.resolve(!0)]).then(([r,i])=>r&&r.accessToken&&i?e._protected.trackInternalEvent(t,n,o):e._protected.trackInternalEventWithMeasurementsApi(t,n,o))})),e.prototype.getInstallationId=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.getInstallationId",(function(){return e._protected.Session.getCurrentSession().then((function(e){return e.installationId}))})),e.prototype.getPushToken=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.getPushToken",(function(){return e._protected.Installation.getCachedInstallationPushToken()})),e.prototype.getDeviceId=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.getDeviceId",(function(){return e._protected.Init.getDeviceId()})),e.prototype.getInstallation=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.getInstallation",(function(){return e._protected.Helper.warn("WonderPush","WonderPushSDK.getInstallation() is deprecated. Please use WonderPushSDK.getInstallationCustomProperties()."),Promise.all([e._protected.Session.getCurrentSession(),e._protected.JsonSyncInstallationCustom.getInstallationCustomPropertiesForUser(e._protected.Options.getUserId()),e._protected.Init.getDeviceId(),e._protected.Installation.getCachedInstallationPushToken()]).then((function(e){var t=e[0],n=e[1],o=e[2],r=e[3];return{id:t.installationId,userId:t.userId,device:{id:o},pushToken:{data:r},custom:n}}))})),e.prototype.getInstallationCustomProperties=function(){return e._protected.Installation.getProperties()},e.prototype.putInstallationCustomProperties=function(t){return e._protected.Installation.putProperties(t)},e.prototype.getAttendance=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.getAttendance",(function(){return e._protected.Storage.bulk([{get:{key:"visitPageViews",defaultValue:1}},{get:{key:"pageViews",defaultValue:1}},{get:{key:"visitCount",defaultValue:1}}]).then((function(e){return{visitPageViews:e.results.byKey.visitPageViews,pageViews:e.results.byKey.pageViews,visitCount:e.results.byKey.visitCount}}))})),e._protected.onInteraction=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.onInteraction",(function(n){const r=new t(e._protected.Storage);return e._protected.Storage.bulk([{get:{key:"lastInteractionDate",defaultValue:0}},{get:{key:"lastAppOpenDate",defaultValue:0}},{get:{key:"lastAppOpenInfoJson",defaultValue:{}}},{get:{key:"lastAppCloseDate",defaultValue:0}},{get:{key:"lastReceivedNotificationInfoJson",defaultValue:{}}},{get:{key:"lastOpenedNotificationInfoJson",defaultValue:{}}}]).then((function(t){var i=[],a=t.results.byKey,c=a.lastInteractionDate,p=a.lastAppOpenDate,d=a.lastAppOpenInfoJson,u=a.lastAppCloseDate,l=a.lastReceivedNotificationInfoJson.actionDate||Number.MAX_SAFE_INTEGER,h=a.lastOpenedNotificationInfoJson,g=h.actionDate||Number.MAX_SAFE_INTEGER,f=e._protected.Time.getRealTime(),m=f-c>=e._protected.Constants.DIFFERENT_SESSION_REGULAR_MIN_TIME_GAP||l>c&&f-c>=e._protected.Constants.DIFFERENT_SESSION_NOTIFICATION_MIN_TIME_GAP;if(n)m||i.push(e._protected.Storage.set("lastInteractionDate",f));else{if(m){if(u<p){var _=e._protected.Helper.plainObjectCopy(d),v=c;_.actionDate=v,_.openedTime=v-p,i.push(e._protected.Storage.set("lastAppCloseDate",v))}var w={};w.actionDate=f,l<=f&&(w.lastReceivedNotificationTime=f-l),f-g<6e4&&(o.assignEventData(w,o.extract(h)),i.push(e._protected.Storage.rm("lastOpenedNotificationInfoJson"))),i.push(s()),i.push(e._protected.Storage.set("lastAppOpenDate",f)),i.push(e._protected.Storage.set("lastAppOpenInfoJson",w))}else r.renewCurrentAttribution(e._protected.Constants.DIFFERENT_SESSION_REGULAR_MIN_TIME_GAP);i.push(e._protected.Storage.set("lastInteractionDate",f))}return e._protected.ensureAppOpenSent(),Promise.all(i).then((function(){}))}))})),e._protected.reportBeforeUnload=e._protected.Integration.proxifyToServiceWorker("WonderPushSDK._protected.reportBeforeUnload",(function(){const t=new e._protected.Promise.Deferred;return setTimeout(()=>{self.clients.matchAll({includeUncontrolled:!0,type:"window"}).then(n=>{n.length||e._protected.extendPresence(0,{force:!0}),t.resolve()})},5e3),t.promise})),e._protected.getLastPresenceInfo=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.getLastPresenceInfo",(function(){return e._protected.Storage.get("lastPresenceInfo",void 0)})),e._protected.extendPresence=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.extendPresence",(function(t,n={}){return self.isSecureContext?e._protected.Storage.bulk([{test:{key:"lastPresenceInfo",defaultValue:{},operationsCb:function(o){const r=new Date,i=o.untilDate?o.untilDate-r.getTime():0;if(!n.force&&i>e._protected.Constants.PRESENCE_UPDATE_SAFETY_MARGIN){const o=i-e._protected.Constants.PRESENCE_UPDATE_SAFETY_MARGIN;return void setTimeout(()=>e._protected.extendPresence(t,n),o)}let s;s=i<0?r:o.fromDate?new Date(o.fromDate):r;const a=new Date(r.getTime()+t),c={fromDate:s.getTime(),untilDate:a.getTime(),elapsedTime:a.getTime()-s.getTime()};if(n&&n.skipEvent||e._protected.trackInternalEvent("@PRESENCE",{presence:c}),n.autoRenew){const o=t-e._protected.Constants.PRESENCE_UPDATE_SAFETY_MARGIN;setTimeout(()=>e._protected.extendPresence(t,n),o)}return[{put:{key:"lastPresenceInfo",value:c}}]}}}]):Promise.resolve()})),e._protected.ensureAppOpenSent=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.ensureAppOpenSent",(function(){const t=(t,n,o)=>e._protected.Storage.bulk([{test:{key:"lastAppOpenDate",defaultValue:0,operationsCb:function(r){return[{test:{key:n,defaultValue:0,operationsCb:function(i){if(i<r)return[{test:{key:"lastAppOpenInfoJson",operationsCb:function(i){const s=new Date,a=e._protected.Constants.PRESENCE_ANTICIPATED_TIME_MS,c=self.isSecureContext?{fromDate:s.getTime(),elapsedTime:a,untilDate:new Date(s.getTime()+a).getTime()}:{},p=Object.assign({},i,{presence:c});o?e._protected.trackInternalEventWithMeasurementsApi(t,p):e._protected.trackInternalEvent(t,p);const d=[{put:{key:n,value:r}}];return self.isSecureContext&&d.push({put:{key:"lastPresenceInfo",value:c}}),d}}}]}}}]}}}]),n={autoRenew:!0,skipEvent:!0};return e._protected.extendPresence(e._protected.Constants.PRESENCE_ANTICIPATED_TIME_MS,n),t("@VISIT","lastVisitSentDate",!0),e.prototype.getInitializationPromise().then((function(){return n.skipEvent=!1,t("@APP_OPEN","lastAppOpenSentDate")})).catch((function(e){})).then((function(){}))})),e.prototype.newPageLoaded=function(){e._protected.newPageLoadedProxifiedIncrements().then(()=>(e._protected.Events.fire(new e._protected.Events.NewPageView),e._protected.Plugins.runRegisteredTriggersCheck()))},e._protected.newPageLoadedProxifiedIncrements=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.newPageLoadedProxifiedIncrements",(function(){Promise.all([e._protected.onInteraction(!1),e._protected.Integration.incrementPageViews(),e._protected.incrementVisitPageViews()])})),e.prototype.newUserInteraction=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.newUserInteraction",(function(){e._protected.onInteraction(!1).then(()=>e._protected.Plugins.runRegisteredTriggersCheck())}));var s=function(){return e._protected.Storage.getModuleInitializationPromise().then((function(){return e._protected.Storage.bulk([{test:{key:"visitCount",defaultValue:0,operationsCb:function(e){return{put:{key:"visitCount",value:++e}}}}},{put:{key:"visitPageViews",value:1}}])}))};return e._protected.incrementVisitPageViews=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.incrementVisitPageViews",(function(){return e._protected.Storage.getModuleInitializationPromise().then((function(){return e._protected.Storage.bulk([{test:{key:"visitPageViews",defaultValue:0,operationsCb:function(e){return{put:{key:"visitPageViews",value:++e}}}}}])}))})),e.instantiationPromise.then(()=>e._protected.Events.fire(new e._protected.Events.NewPageView)),e._protected.Integration.getModuleInitializationPromise().then((function(){if(e._protected.Integration.isOnRightDomain()&&(e._protected.RunModes.Behaviors.ModeFrame||e._protected.RunModes.Behaviors.ModeWebSite)&&e._protected.Options.hasUserId()){const t=e._protected.Options.getUserId();e._protected.setUserId(t)}if(i=!0,(e._protected.RunModes.Behaviors.ModeFrame||e._protected.RunModes.Behaviors.ModeWebSite&&e._protected.Integration.isOnRightDomain())&&window.isSecureContext&&window.addEventListener("beforeunload",()=>e._protected.reportBeforeUnload()),e._protected.RunModes.Behaviors.ModeWebSite){var t=function(){e._protected.onInteraction(!0)};return window.addEventListener("hashchange",(function(){e._protected.onInteraction(!1)})),window.addEventListener("beforeunload",t),window.addEventListener("unload",t),e._protected.incrementVisitPageViews().catch((function(){})).then((function(){return e._protected.onInteraction(!1)}))}}))}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t=null,n=null,o=null;e.prototype.Geo={},e.prototype.Geo.useGeolocation=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.Geo.useGeolocation",(function(n){e._protected.Constants.GEOLOCATION_SUPPORTED&&r().then((function(o){"auto"===n&&(n="granted"===o),n?t||(t=navigator.geolocation.watchPosition(s,a,e._protected.Constants.GEOLOCATION_OPTIONS),navigator.geolocation.getCurrentPosition(s,a,e._protected.Constants.GEOLOCATION_OPTIONS_FIRST_FIX)):t&&(navigator.geolocation.clearWatch(t),t=void 0)}))})),e.prototype.Geo.fake=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.Geo.fake",(function(e){e?"lat"in e&&"lon"in e&&(o={lat:e.lat,lon:e.lon}):o=null})),e._protected.Geo={},e._protected.Geo.getGeolocation=function(){return o?{lat:o.lat,lon:o.lon}:!n||new Date-n.timestamp>e._protected.Constants.GEOLOCATION_MAXIMUM_AGE?null:{lat:n.coords.latitude,lon:n.coords.longitude}};var r=function(){return e._protected.Storage.get("geolocationPermission","prompt")},i=function(t){return e._protected.Storage.set("geolocationPermission",t)},s=function(t){i("granted"),!t||new Date-t.timestamp>e._protected.Constants.GEOLOCATION_MAXIMUM_AGE||(!n||t.timestamp>n.timestamp)&&(n=t)},a=function(t){t.code===t.PERMISSION_DENIED&&(i("denied"),e.prototype.Geo.useGeolocation(!1))};e._protected.RunModes.Behaviors.GeolocationPermission&&e._protected.Config.getModuleInitializationPromise().then((function(){var t=function(){e._protected.Consent.hasUserConsent().then(t=>{t?e.prototype.Geo.useGeolocation(e._protected.Options.getGeolocation()):(e.prototype.Geo.useGeolocation(!1),n=null)})};e._protected.Integration.addBroadcastListener(e._protected.Constants.BROADCAST_TYPE_SET_USER_CONSENT,()=>{t()}),t()}))}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o,r;o=[n(78)],void 0===(r=function(e){return function(t){var n="[installation]";t._protected.Installation={},t._protected.Installation.updateInstallationCoreProperties=t._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Installation.updateInstallationCoreProperties",(function(e){return t.prototype.getInitializationPromise().then((function(){return t._protected.Session.getCurrentSession().then((function(n){return t._protected.Installation.Profile.getCoreProperties().then((function(o){if(o)return t._protected.Storage.bulk([{test:{key:"installationCoreProperties",defaultValue:null,operationsCb:function(r){if(t._protected.RunModes.Behaviors.ContextServiceWorker&&null===r)return;r=r||{date:0,json:"{}"};var i=JSON.parse(r.json),s={};t._protected.RunModes.Behaviors.ContextServiceWorker&&t._protected.Helper.mergeObjectInplaceRecursive(s,i);const a=(o.application||{}).integrator;return t._protected.Helper.stripObject(o),t._protected.Helper.mergeObjectInplaceRecursive(s,o),t._protected.Helper.stripObject(s),void 0!==a&&(s.application||(s.application={}),s.application.integrator=a),e&&e.force||!t._protected.JsonUtil.equal(s,i)||r.userId!==n.userId||r.installationId!==n.installationId||!(+new Date<r.date+t._protected.Constants.INSTALLATION_CORE_PROPERTIES_CACHE)?(t.this.Rest.postEventually("/installation",{body:JSON.stringify(s),overwrite:"false"}),{put:{key:"installationCoreProperties",value:{json:JSON.stringify(s),installationId:n.installationId,userId:n.userId,date:+new Date}}}):void 0}}}])}))}))}))})),t._protected.Installation.getInstallationFromServer=t._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Installation.getInstallationFromServer",(function(){return t.this.getInitializationPromise().then((function(){var e=new t._protected.Promise.Deferred,n=function(){e.reject()},o={onload:function(t){e.resolve(t&&t.json&&t.json()||this.responseJSON)},onerror:n,ontimeout:n,onabort:n};return t.this.Rest.get("/installation",{},o,{}),e.promise}))})),t._protected.Installation.addInstallationPushToken=function(e,n){e=t._protected.Helper.plainObjectCopy(e),t._protected.Notification.getManuallyUnsubscribed().then((function(n){n||(e?t._protected.Notification.setSubscriptionState(t.prototype.SubscriptionState.SUBSCRIBED):t._protected.Notification.setSubscriptionState(t.prototype.SubscriptionState.NOT_SUBSCRIBED))}));var o=!0,r=t._protected.Integration.getCurrentOperatingOrigin(),i=null,s=null,a=null,c=null,p=null,d=null;let u;return e?(i=e.subscriptionId&&-1===e.endpoint.indexOf(e.subscriptionId)?e.endpoint+"/"+e.subscriptionId:e.endpoint,s=e.expirationTime,"object"==typeof e.keys&&(a=e.keys.p256dh,c=e.keys.auth),"object"==typeof e.options&&(p=e.options.applicationServerKey,d=e.options.userVisibleOnly)):o=t._protected.Blocker.category("accessToken").unblocked(),(o?t.prototype.getInitializationPromise():Promise.resolve()).then((function(){return t._protected.Session.getCurrentSession().then((function(e){return t._protected.Storage.bulk([{test:{key:"pushTokenCache",defaultValue:{pushTokenOrigin:null,pushTokenData:null,pushTokenExpirationDate:null,pushTokenP256dh:null,pushTokenAuth:null,pushTokenApplicationServerKey:null,pushTokenUserVisibleOnly:null,userId:e.userId,installationId:e.installationId,date:+new Date},operationsCb:function(l){if(16002288e5<=l.date&&l.date<=16002684e5&&(n=!0),n||l.pushTokenOrigin!==r||l.pushTokenData!==i||l.pushTokenExpirationDate!==s||l.pushTokenP256dh!==a||l.pushTokenAuth!==c||l.pushTokenApplicationServerKey!==p||l.pushTokenUserVisibleOnly!==d||l.userId!==e.userId||l.installationId!==e.installationId||!(+new Date<l.date+t._protected.Constants.INSTALLATION_PUSH_TOKEN_CACHE))return o&&(u=t.this.Rest.postEventually("/installation",{overwrite:"false",body:JSON.stringify({pushToken:{origin:r,data:i,expirationDate:s,p256dh:a,auth:c,applicationServerKey:p,userVisibleOnly:d}})},void 0)),{put:{key:"pushTokenCache",value:{pushTokenOrigin:r,pushTokenData:i,pushTokenExpirationDate:s,pushTokenP256dh:a,pushTokenAuth:c,pushTokenApplicationServerKey:p,pushTokenUserVisibleOnly:d,userId:e.userId,installationId:e.installationId,date:+new Date}}}}}}])}))})).then(()=>Promise.resolve(u))},t._protected.Installation.getCachedInstallationPushToken=function(){return t._protected.Storage.get("pushTokenCache",{pushTokenData:null}).then((function(e){return e.pushTokenData}))},t._protected.Installation.removeInstallationPushToken=function(){t._protected.Installation.addInstallationPushToken(null)},t._protected.Installation.sendCachedPushToken=t._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Installation.sendCachedPushToken",(function(){return t._protected.Storage.get("pushTokenCache",{}).then(e=>{e&&e.pushTokenData&&t.this.Rest.postEventually("/installation",{overwrite:"false",body:JSON.stringify({pushToken:{origin:e.pushTokenOrigin,data:e.pushTokenData,expirationDate:e.pushTokenExpirationDate,p256dh:e.pushTokenP256dh,auth:e.pushTokenAuth,applicationServerKey:e.pushTokenApplicationServerKey,userVisibleOnly:e.pushTokenUserVisibleOnly}})},void 0)})})),t._protected.Installation.getProperties=t._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Installation.getProperties",(function(){return t._protected.getUserId().then(e=>t._protected.JsonSyncInstallationCustom.getInstallationCustomPropertiesForUser(e)).then(e=>(Object.keys(e).forEach(t=>{("string"!=typeof t||t.indexOf("_")<0)&&delete e[t]}),e))})),t._protected.Installation.putProperties=t._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Installation.putProperties",(function(e){return e?e instanceof Object?(e=t._protected.Helper.plainObjectCopy(e),Object.keys(e).forEach(o=>{("string"!=typeof o||o.indexOf("_")<0)&&(t._protected.Helper.warn(n,"Dropping installation property with no prefix:",o,"=",e[o]),delete e[o])}),t._protected.getUserId().then(n=>t._protected.JsonSyncInstallationCustom.putInstallationCustomPropertiesForUser(n,e))):(console.error("WonderPushSDK.putProperties() expects an object as argument, got ",e),Promise.reject(new t.prototype.Errors.InvalidArgumentError("WonderPushSDK.putProperties() expects an object as argument"))):Promise.resolve()})),t._protected.Installation.setProperty=t._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Installation.setProperty",(function(e,n){return e?t._protected.Installation.putProperties({[e]:n}):Promise.resolve()})),t._protected.Installation.unsetProperty=t._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Installation.unsetProperty",(function(e){return e?t._protected.Installation.putProperties({[e]:null}):Promise.resolve()})),t._protected.Installation.addProperty=t._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Installation.addProperty",(function(e,n){if(!e||null==n)return Promise.resolve();const o=Array.isArray(n)?n:Array.from(arguments).slice(1);return t._protected.Installation.getPropertyValues(e).then(n=>(o.forEach(e=>{null!=e&&n.indexOf(e)<0&&n.push(e)}),t._protected.Installation.putProperties({[e]:n})))})),t._protected.Installation.removeProperty=t._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Installation.removeProperty",(function(e,n){if(!e||null==n)return Promise.resolve();const o=Array.isArray(n)?n:Array.from(arguments).slice(1);return t._protected.Installation.getPropertyValues(e).then(n=>(o.forEach(e=>{const t=n.indexOf(e);t>=0&&n.splice(t,1)}),t._protected.Installation.putProperties({[e]:n})))})),t._protected.Installation.getPropertyValue=t._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Installation.getPropertyValue",(function(e){return e?t._protected.Installation.getProperties().then(t=>{let n=t[e];return Array.isArray(n)&&(n=n[0]),null!=n||(n=null),n}):Promise.resolve(null)})),t._protected.Installation.getPropertyValues=t._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Installation.getPropertyValues",(function(e){return e?t._protected.Installation.getProperties().then(t=>{let n=t[e];return null!=n||(n=[]),Array.isArray(n)||(n=[n]),n}):Promise.resolve(null)})),t._protected.Installation.addTag=t._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Installation.addTag",(function(e){const n=(Array.isArray(e)?e:Array.from(arguments)).filter(e=>"string"==typeof e);return t._protected.Installation.getTags().then(e=>{const o=Array.from(new Set(e.concat(n)));return o.sort(),t._protected.getUserId().then(e=>t._protected.JsonSyncInstallationCustom.putInstallationCustomPropertiesForUser(e,{tags:o})).then(()=>{})})})),t._protected.Installation.removeTag=t._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Installation.removeTag",(function(e){const n=new Set(Array.isArray(e)?e:Array.from(arguments));return t._protected.Installation.getTags().then(e=>{const o=e.filter(e=>!n.has(e));return t._protected.getUserId().then(e=>t._protected.JsonSyncInstallationCustom.putInstallationCustomPropertiesForUser(e,{tags:o})).then(()=>{})})})),t._protected.Installation.removeAllTags=t._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Installation.removeAllTags",(function(){return t._protected.getUserId().then(e=>t._protected.JsonSyncInstallationCustom.putInstallationCustomPropertiesForUser(e,{tags:null})).then(()=>{})})),t._protected.Installation.addRemoveTags=t._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Installation.addRemoveTags",(function(e,o){t._protected.Helper.debug(n,"[addRemoveTags]",e,o);const r=e=>(Array.isArray(e)?e:"string"==typeof e?[e]:[]).filter(e=>"string"==typeof e);return e=r(e),o=r(o),t._protected.Installation.getTags().then(r=>{const i=new Set(r.concat(e));o.forEach(e=>i.delete(e));const s=Array.from(i);return s.sort(),t._protected.Helper.debug(n,"[addRemoveTags] newTags",s),t._protected.getUserId().then(e=>t._protected.JsonSyncInstallationCustom.putInstallationCustomPropertiesForUser(e,{tags:s})).then(()=>{})})})),t._protected.Installation.getTags=t._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Installation.getTags",(function(){return t._protected.getUserId().then(e=>t._protected.JsonSyncInstallationCustom.getInstallationCustomPropertiesForUser(e)).then(e=>{let t=(e||{}).tags;return Array.isArray(t)||(t=[]),t.sort(),t})})),t._protected.Installation.hasTag=t._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Installation.hasTag",(function(e){return t._protected.Installation.getTags().then(t=>t.indexOf(e)>=0)})),e(t)}}.apply(t,o))||(e.exports=r)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.Installation.Profile={},e._protected.Installation.Profile.getCoreProperties=function(t){return Promise.all([t?void 0:e._protected.Init.getFederatedDeviceId(),new Promise((function(t){return e._protected.RunModes.Behaviors.ModeWebSite?t(e._protected.Helper.getLocales()):e._protected.RunModes.Behaviors.ModeFrame?t(e._protected.Promise.timeout(e._protected.Integration.callOnParentWindow("WonderPushSDK._protected.Helper.getLocales",[]),100,e._protected.Helper.getLocales(),!0)):t([])})).then((function(e){return e[0]})),e._protected.Notification.getManuallyUnsubscribed(),e._protected.Notification.getTrustedOrCachedNotificationPermissionState()]).then((function(t){var n=t[0],o=t[1];const r=t[2],i=t[3];n&&(n="0:"+n);let s=void 0;const a={};return i!==e._protected.Notification.PERMISSION_UNKNOWN&&(s=i===e._protected.Notification.PERMISSION_GRANTED,a.osNotificationsVisible=s),a.subscriptionStatus=r||!1===s?"optOut":"optIn",a.subscribedToNotifications=!r,{application:{version:e._protected.Options.getApplicationVersion(),integrator:e._protected.Options.getIntegrator()||null,sdkVersion:e.this.Constants.SDK_VERSION,domain:function(){if(!e._protected.RunModes.Behaviors.ContextServiceWorker&&!e._protected.RunModes.Behaviors.ModeSlave){if(e._protected.RunModes.Behaviors.ContextFrame||e._protected.RunModes.Behaviors.ModePopup)try{return new URL(document.referrer).hostname}catch(e){}return location.hostname}}()},preferences:a,device:{federatedId:n,osVersion:e._protected.Helper.detectBrowser().version||null,brand:e._protected.Helper.detectBrowser().name||null,model:navigator.userAgent,screenWidth:"undefined"!=typeof screen&&screen.width||void 0,screenHeight:"undefined"!=typeof screen&&screen.height||void 0,configuration:{timeZone:function(){var e;if(!e&&Intl){var t=Intl.DateTimeFormat();t&&t.resolvedOptions&&(e=t.resolvedOptions().timeZone)}if(!e){var n={GMT:"GMT",EAT:"Africa/Addis_Ababa",CET:"Africa/Algiers",WAT:"Africa/Kinshasa",CAT:"Africa/Lubumbashi","CEST CET":"Europe/Berlin",SAST:"Africa/Johannesburg",EET:"Africa/Tripoli","HADT HAST":"America/Adak","AKDT AKST":"America/Anchorage",BRT:"America/Bahia",ART:"America/Buenos_Aires",EST:"America/Panama",AMT:"America/Manaus","AMST AMT":"America/Campo_Grande",MST:"America/Phoenix","PDT PST":"America/Los_Angeles","EDT EST":"America/New_York",ACT:"America/Rio_Branco","ADT AST":"America/Halifax",PST:"America/Metlakatla",FNT:"America/Noronha","CLST CLT":"America/Santiago","BRST BRT":"America/Sao_Paulo","NDT NST":"America/St_Johns",AWST:"Australia/West","NZDT NZST":"Pacific/Auckland",AQTT:"Asia/Aqtobe",TMT:"Asia/Ashgabat",ICT:"Asia/Bangkok",IST:"Asia/Kolkata",BDT:"Asia/Dhaka",GST:"Asia/Dubai",HKT:"Asia/Hong_Kong",WIB:"Asia/Jakarta","IDT IST":"Asia/Jerusalem",XJT:"Asia/Urumqi",NPT:"Asia/Katmandu",YAKT:"Asia/Yakutsk",MYT:"Asia/Kuala_Lumpur",WITA:"Asia/Makassar",KST:"Asia/Seoul",UZT:"Asia/Tashkent",SGT:"Asia/Singapore","IRDT IRST":"Asia/Tehran",BTT:"Asia/Thimphu",JST:"Asia/Tokyo",ULAT:"Asia/Ulaanbaatar",VLAT:"Asia/Vladivostok","AEDT AEST":"Australia/Victoria","ACDT ACST":"Australia/South",AEST:"Australia/Queensland",ACST:"Australia/North","LHDT LHST":"Australia/Lord_Howe","EASST EAST":"Pacific/Easter","GMT IST":"Europe/Dublin",UCT:"Etc/UCT",UTC:"UTC","BST GMT":"Europe/London",MSK:"Europe/Moscow",HST:"Pacific/Honolulu",MHT:"Pacific/Majuro","CHADT CHAST":"Pacific/Chatham",CHUT:"Pacific/Chuuk",ChST:"Pacific/Guam",SST:"Pacific/Samoa",PONT:"Pacific/Pohnpei"},o=[["America/Mexico_City",1396771200,360,300],["America/Chicago",1394352e3,360,300],["America/Havana",1394341200,300,240],["America/Denver",1394355600,420,360],["America/Chihuahua",1396774800,420,360],["America/Puerto_Rico",1420070400,240,240],["Asia/Baghdad",1420070400,-180,-180],["America/Guatemala",1420070400,360,360],["Asia/Chongqing",1420070400,-480,-480],["Africa/Cairo",1400191200,-120,-180],["Asia/Gaza",1395957600,-120,-180],["Asia/Istanbul",1396227600,-120,-180],["Europe/Athens",1396141200,-120,-180],["Africa/Casablanca",1396144800,0,-60],["Europe/Lisbon",1396141200,0,-60]];e=function(){for(var e=[],t=0;t<12;++t){var r=new Date(2014,t).toString().replace(/^.*\((.+)\)$/,"$1");-1===e.indexOf(r)&&e.push(r)}var i=e.sort().join(" ");if(i in n)return n[i];for(var s=0;s<o.length;++s){var a=o[s];if(new Date(1e3*a[1]-1).getTimezoneOffset()===a[2]&&new Date(1e3*a[1]).getTimezoneOffset()===a[3])return a[0]}return null}()}return e}(),locale:o},platform:"Web"}}}))}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e.prototype.SubscriptionState={DENIED:-3,UNSUPPORTED:-2,UNSUBSCRIBED:-1,UNDETERMINED:0,NOT_SUBSCRIBED:1,SUBSCRIBED:2},Object.freeze(e.prototype.SubscriptionState)}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){const{ReportingDataUtil:t}=n(5);var o="[notification]",r=new e._protected.Promise.Deferred,i="undefined"!=typeof Notification,s=null;e.prototype.Notification=new function(){this.requestPopupToFinalizeRegistration=function(t){return e._protected.Notification.setNotificationEnabled(!0)};var t={modalBoxIcon:null,modalBoxTitle:null,modalBoxMessage:"We will send you personalized notifications.<br/>You can always unsubscribe at any time.",modalBoxButton:"Got it!",modalBoxCancellable:!0,externalBoxWidth:500,externalBoxHeight:500,externalBoxLogoUrl:null,externalBoxLogoWidth:90,externalBoxLogoHeight:90,externalBoxProcessingMessage:"Subscribing...",externalBoxSuccessMessage:"Thanks for subscribing!",externalBoxFailureMessage:"Sorry, something went wrong.",externalBoxTooLongHint:"Poor connection or private browsing?",externalBoxCloseHint:"Close",externalBoxCloseDelay:e._protected.Constants.POPUP_AUTOCLOSE_SLEEP};this.setOptInOptions=function(n){e._protected.Helper.mergeObjectInplaceRecursive(t,n)},this.getOptInOptions=function(){var n=e._protected.Helper.plainObjectCopy(t);return n&&"Inscription en cours..."===n.externalBoxProcessingMessage&&(n=e._protected.Helper.assign({externalBoxMessage:"Nous aimerions vous envoyer des notifications",externalBoxExampleTitle:"Notification exemple",externalBoxExampleMessage:"Ceci est un exemple de notification",externalBoxDisclaimer:"Vous pouvez vous désinscrire à n'importe quel moment.",negativeButtonText:"Plus tard",positiveButtonText:"Je m'inscris"},n)),n};var n=function(e){var t=document.createElement("DIV");return t.innerHTML=e,t.textContent},o={requestPopupToFinalizeRegistration_icon:null,requestPopupToFinalizeRegistration_title:null,requestPopupToFinalizeRegistration_text:null,requestPopupToFinalizeRegistration_buttonLabel:null,requestPopupToFinalizeRegistration_popupContent_processing:null,requestPopupToFinalizeRegistration_popupContent_success:null,requestPopupToFinalizeRegistration_popupContent_failure:null};Object.defineProperties(this,{requestPopupToFinalizeRegistration_icon:{set:function(t){e.prototype.Notification.setOptInOptions({modalBoxIcon:t}),o.requestPopupToFinalizeRegistration_icon=t},get:function(){return o.requestPopupToFinalizeRegistration_icon}},requestPopupToFinalizeRegistration_title:{set:function(t){e.prototype.Notification.setOptInOptions({modalBoxTitle:t}),o.requestPopupToFinalizeRegistration_title=t},get:function(){return o.requestPopupToFinalizeRegistration_title}},requestPopupToFinalizeRegistration_text:{set:function(t){e.prototype.Notification.setOptInOptions({modalBoxMessage:t}),o.requestPopupToFinalizeRegistration_text=t},get:function(){return o.requestPopupToFinalizeRegistration_text}},requestPopupToFinalizeRegistration_buttonLabel:{set:function(t){e.prototype.Notification.setOptInOptions({modalBoxButton:t}),o.requestPopupToFinalizeRegistration_buttonLabel=t},get:function(){return o.requestPopupToFinalizeRegistration_buttonLabel}},requestPopupToFinalizeRegistration_popupContent_processing:{set:function(t){e.prototype.Notification.setOptInOptions({externalBoxProcessingMessage:n(t),externalBoxTooLongMessage:n(t)}),o.requestPopupToFinalizeRegistration_popupContent_processing=t},get:function(){return o.requestPopupToFinalizeRegistration_popupContent_processing}},requestPopupToFinalizeRegistration_popupContent_success:{set:function(t){e.prototype.Notification.setOptInOptions({externalBoxSuccessMessage:n(t)}),o.requestPopupToFinalizeRegistration_popupContent_success=t},get:function(){return o.requestPopupToFinalizeRegistration_popupContent_success}},requestPopupToFinalizeRegistration_popupContent_failure:{set:function(t){e.prototype.Notification.setOptInOptions({externalBoxFailureMessage:n(t)}),o.requestPopupToFinalizeRegistration_popupContent_failure=t},get:function(){return o.requestPopupToFinalizeRegistration_popupContent_failure}}}),e._protected.RunModes.Behaviors.OptionsSource?e._protected.Config.getModuleInitializationPromise().then((function(){e.prototype.Notification.setOptInOptions({modalBoxIcon:e._protected.Options.getNotificationIcon(),modalBoxTitle:e._protected.Options.getApplicationName(),externalBoxLogoUrl:e._protected.Options.getNotificationIcon()}),e.prototype.Notification.setOptInOptions(e._protected.Options.getOptInOptions()),o.requestPopupToFinalizeRegistration_icon=e._protected.Options.getNotificationIcon(),o.requestPopupToFinalizeRegistration_title=e._protected.Options.getApplicationName(),o.requestPopupToFinalizeRegistration_text="We will send you personalized notifications.<br/>You can always change your preferences later.",o.requestPopupToFinalizeRegistration_buttonLabel="Got it!",o.requestPopupToFinalizeRegistration_popupContent_processing='<div style="font-family: sans-serif; text-align: center;"><p><img id="logo" width="90" height="90" border="0" src="'+e._protected.Options.getNotificationIcon()+'"/></p><p>Subscribing...</p></div>',o.requestPopupToFinalizeRegistration_popupContent_toolong='<div style="font-family: sans-serif; text-align: center;"><p><img id="logo" width="90" height="90" border="0" src="'+e._protected.Options.getNotificationIcon()+'"/></p><p>Subscribing...</p><p><small>Poor connection or private browsing?</small></p></div>',o.requestPopupToFinalizeRegistration_popupContent_success='<div style="font-family: sans-serif; text-align: center;"><p><img id="logo" width="90" height="90" border="0" src="'+e._protected.Options.getNotificationIcon()+'"/></p><p>Thanks for subscribing!</p><p><a href="#" onclick="javascript:window.close();"><small>Close</small></a></p></div>',o.requestPopupToFinalizeRegistration_popupContent_failure='<div style="font-family: sans-serif; text-align: center;"><p><img id="logo" width="90" height="90" border="0" src="'+e._protected.Options.getNotificationIcon()+'"/></p><p>Sorry, something went wrong.</p><p><a href="#" onclick="javascript:window.close();"><small>Close</small></a></p></div>',r.resolve()})):r.resolve(),this.getSubscriptionState=function(){return s}},e._protected.Notification=new function(){this.PERMISSION_GRANTED="granted",this.PERMISSION_DENIED="denied",this.PERMISSION_DEFAULT="default",this.PERMISSION_UNKNOWN="unknown",this.getModuleInitializationPromise=function(){return r.promise},this.getTrustedNotificationPermissionState=function(){let t;return(t=navigator.permissions&&navigator.permissions.query?navigator.permissions.query({name:"notifications"}).then(e=>e.state).catch(t=>(e._protected.Helper.warn(o,'[getTrustedNotificationPermissionState] navigator.permissions.query({name: "notifications"}) rejected',t),e._protected.Notification.PERMISSION_UNKNOWN)):e._protected.RunModes.Behaviors.ModeServiceWorker&&"undefined"!=typeof Notification?Promise.resolve(Notification.permission):Promise.resolve(e._protected.Notification.PERMISSION_UNKNOWN)).then(t=>{if("prompt"===t&&(t=e._protected.Notification.PERMISSION_DEFAULT),e._protected.RunModes.Behaviors.ModeServiceWorker)return t;var n="undefined"!=typeof Notification?Notification.permission:e._protected.Notification.PERMISSION_UNKNOWN,o=e._protected.Helper.detectBrowser(),r=parseInt(o.version.substr(0,o.version.indexOf(".")));return!1!==e._protected.gscope.isSecureContext&&e._protected.Integration.areTopWindowAndSelfOnRightDomain()||"Chrome"===o.name&&r>=62&&n===e._protected.Notification.PERMISSION_DENIED&&(n=e._protected.Notification.PERMISSION_UNKNOWN),n})},this.getTrustedOrCachedNotificationPermissionState=function(){return e._protected.Notification.getTrustedNotificationPermissionState().then((function(t){return t===e._protected.Notification.PERMISSION_UNKNOWN?e._protected.Notification.getTrustedNotificationPermissionStateCached().then((function(t){var n=e._protected.Notification.PERMISSION_UNKNOWN;return t.checkVersion>=2&&(n=t.permission),n})):Promise.resolve(t)}))},this.getTrustedNotificationPermissionStateCached=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Notification.getTrustedNotificationPermissionStateCached",(function(){var t={permission:e._protected.Notification.PERMISSION_UNKNOWN,date:+new Date};return e._protected.Storage.get("notificationPermissionStateCached",t).then((function(e){return!e.checkVersion||e.checkVersion<2||"denied"===e.permission&&e.checkVersion<=3&&"Chrome"===e.browserName&&e.browserVersionMajor>=62&&e.framed&&e.isSecureContext?t:e}))})),this.updateTrustedNotificationPermissionCacheIfPossible=function(){var t=+new Date;return e._protected.Integration.isOnRightDomain()?e._protected.Notification.getTrustedNotificationPermissionState().then((function(n){if(n===e._protected.Notification.PERMISSION_UNKNOWN)return!1;var o=e._protected.Helper.detectBrowser(),r={permission:n,date:t,checkVersion:4,sdkVersion:e.prototype.Constants.SDK_VERSION,browserName:o.name,browserVersion:o.version,browserVersionMajor:parseInt(o.version.substr(0,o.version.indexOf("."))),userAgent:navigator.userAgent,isSecureContext:e._protected.gscope.isSecureContext,framed:void 0!==e._protected.gscope.parent&&e._protected.gscope!==e._protected.gscope.parent,origin:location.origin,runMode:e._protected.RunModes.getCurrentModeNotForBehaviorTestingPurpose()},i=!1;return e._protected.Storage.getModuleInitializationPromise().then((function(){return e._protected.Storage.bulk([{test:{key:"notificationPermissionStateCached",defaultValue:{permission:null,date:0},operationsCb:function(e){if(!(r.date<e.date))return i=!0,{put:{key:"notificationPermissionStateCached",value:r}}}}}])})).catch((function(e){})).then((function(){return i}))})):Promise.resolve(!1)},this.refreshSubscriptionState=function(){e._protected.Integration.isOnRightDomain()&&(e._protected.Notification.isNativePushNotificationSupported()?Promise.all([e._protected.Notification.getManuallyUnsubscribed(),e._protected.Notification.getTrustedOrCachedNotificationPermissionState()]).then((function([t,n]){if(n===e._protected.Notification.PERMISSION_DENIED)e._protected.Notification.setSubscriptionState(e.prototype.SubscriptionState.DENIED);else if(t)e._protected.Notification.setSubscriptionState(e.prototype.SubscriptionState.UNSUBSCRIBED);else{const t=function(t){t?e._protected.Notification.setSubscriptionState(e.prototype.SubscriptionState.SUBSCRIBED):e._protected.Notification.setSubscriptionState(e.prototype.SubscriptionState.NOT_SUBSCRIBED)},n=function(e){};e._protected.RunModes.Behaviors.CanRegisterServiceWorker&&e._protected.Integration.isOnRightDomain()?e._protected.ServiceWorkerClient.getPushSubscriptionAndRegisterServiceWorkerIfNecessary().then(t,n):e._protected.RunModes.Behaviors.ContextServiceWorker||navigator.serviceWorker&&navigator.serviceWorker.controller&&e._protected.Integration.isOnRightDomain()?e._protected.ServiceWorkerClient.getPushSubscriptionFromServiceWorker().then(t,n):e._protected.Installation.getCachedInstallationPushToken().then((function(t){if(!t)return Promise.reject();e._protected.Notification.setSubscriptionState(e.prototype.SubscriptionState.SUBSCRIBED)}),(function(e){return Promise.reject()})).catch((function(){e._protected.Notification.setSubscriptionState(e.prototype.SubscriptionState.NOT_SUBSCRIBED)}))}})):e._protected.Notification.setSubscriptionState(e.prototype.SubscriptionState.UNSUPPORTED))},this.setSubscriptionState=function(t){var n=s;s=t,e._protected.Blocker.category("ready").remove("refreshSubscriptionState"),n!==s&&(e._protected.Events.fire(e._protected.Events.WonderPushSubscriptionEvent(t)),e._protected.RunModes.Behaviors.ModeFrame&&e._protected.Notification.setSubscriptionStateOnParentWindow(t),e._protected.RunModes.Behaviors.ModeServiceWorker?e._protected.Notification.setSubscriptionStateOnServiceWorkerClients(t):(e._protected.RunModes.Behaviors.ModeFrame||e._protected.RunModes.Behaviors.ModeWebSite&&e._protected.Integration.isOnRightDomain())&&e._protected.Helper.supportsServiceWorker()&&e._protected.Notification.setSubscriptionStateOnServiceWorker(t))},this.setSubscriptionStateOnParentWindow=e._protected.Integration.proxifyToParentWindow("WonderPushSDK._protected.Notification.setSubscriptionStateOnParentWindow",(function(t){e._protected.Notification.setSubscriptionState(t)})),this.setSubscriptionStateOnServiceWorker=e._protected.Integration.proxifyToServiceWorker("WonderPushSDK._protected.Notification.setSubscriptionStateOnServiceWorker",(function(t){e._protected.Notification.refreshSubscriptionState()})),this.setSubscriptionStateOnServiceWorkerClients=e._protected.Integration.proxifyToServiceWorkerClients("WonderPushSDK._protected.Notification.setSubscriptionStateOnServiceWorkerClients",(function(t){e._protected.Notification.setSubscriptionState(t)})),this.setManuallyUnsubscribed=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Notification.setManuallyUnsubscribed",(function(t){return e._protected.Notification.getManuallyUnsubscribed().then((function(n){if(!!t!=!!n)return e._protected.Storage.set("unsubscribed",t).then(()=>e._protected.Installation.Profile.getCoreProperties()).then(n=>(e.this.Rest.postEventually("/installation/",{body:JSON.stringify({preferences:n.preferences}),overwrite:"false"}),t?e._protected.Notification.setSubscriptionState(e.prototype.SubscriptionState.UNSUBSCRIBED):e._protected.Notification.refreshSubscriptionState()))}))})),this.getManuallyUnsubscribed=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Notification.getManuallyUnsubscribed",(function(){return e._protected.Storage.get("unsubscribed",!1).then((function(e){return!!e}))})),this.isNativePushNotificationSupported=function(){return i&&e._protected.Helper.supportsPushManager()},this.needUserGestureToAskPermission=function(){var t=e._protected.Helper.detectBrowser();return"Firefox"===t.name&&parseInt(t.version)>=71},this.askPermission=function(){var t=new e._protected.Promise.Deferred;return e._protected.Notification.isNativePushNotificationSupported()?e._protected.Integration.isOnRightDomain()?e._protected.RunModes.Behaviors.NotificationPermission?(e._protected.ServiceWorkerClient.registerServiceWorker(),Notification.requestPermission((function(n){e._protected.Notification.updateTrustedNotificationPermissionCacheIfPossible().then((function(){return"denied"===(n=Notification.permission)?t.reject(new e.prototype.Errors.PermissionError("User denied notification permission","notification",n)):"granted"!==n?t.reject(new e.prototype.Errors.UserCancellationError("User neither granted or denied notification permission")):void t.resolve(n)}))})),t.promise):(t.reject(new e._protected.Errors.InternalWrongTargetError),t.promise):(t.reject(new e._protected.Errors.InternalWrongDomainError),t.promise):(t.reject(new e.prototype.Errors.PushNotificationsNotSupportedError),t.promise)},this.askPermissionAndRegisterInWindow=function(){var t,n,o=new e._protected.Promise.Deferred;if(!e._protected.Integration.isOnRightDomain())return o.reject(new e._protected.Errors.InternalWrongDomainError),o.promise;var r=function(e){t=+new Date,n=e},i=function(){e._protected.Analytics.sendEvent("askPermissionAndRegisterInWindow",n,null,+new Date-t)};return r("askPermission"),e._protected.Notification.askPermission().then((function(t){return i(),r("setManuallyUnsubscribed"),e._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.Notification.setManuallyUnsubscribed",[!1])})).then((function(){return i(),r("registerForPushNotifications"),e._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.ServiceWorkerClient.registerForPushNotifications")})).then((function(t){return i(),r("addInstallationPushToken"),e._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.Installation.addInstallationPushToken",[t])})).then((function(){i(),o.resolve()})).catch((function(r){e._protected.Analytics.sendEvent("askPermissionAndRegisterInWindow",n+"-error",r&&r.name,+new Date-t),o.reject(r)})),o.promise},this.openPopupAskPermissionAndRegister=function(t){var n=new e._protected.Promise.Deferred,o=new URL(e._protected.Integration.getFrameUrl()),r=e._protected.Options.exportInitial();r._mode=e._protected.RunModes.Modes.Popup,o.search="?wonderpushPopupUI=permission&wonderpushInitOpts="+encodeURIComponent(JSON.stringify(r));var i=e.prototype.Notification.getOptInOptions();const s=e._protected.Integration.openPopup(o.href,{width:i.externalBoxWidth,height:i.externalBoxHeight,center:"window"});if(!s)return void n.reject(new e.prototype.Errors.PopupError("Cannot open popup"));const a=Math.max(i.externalBoxCloseDelay,1e3);return e._protected.Integration.probeWindowObject(s,e._protected.Integration.getTargetOrigin(),{type:"isReady"},e=>e.data instanceof Object&&"readiness"===e.data.type&&e.data.ready).then(()=>{e._protected.Integration.callOnPopupWindow(s,"WonderPushSDK._protected.PopupUI.waitForSubscription").then(()=>(n.resolve(),setTimeout((function(){s.close()}),a),e._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.Notification.refreshSubscriptionState")),t=>{t instanceof e.prototype.Errors.UserCancellationError?s.close():setTimeout((function(){s.close()}),a),n.reject(t)})}).catch(e=>n.reject(e)),n.promise},this.presentModal=function(t,n){var o=e.prototype.Notification.getOptInOptions(),r={icon:o.modalBoxIcon,title:o.modalBoxTitle,text:o.modalBoxMessage,buttons:[{label:o.modalBoxButton,onclick:function(e,n){t(e)}}],cancellable:o.modalBoxCancellable,oncancel:function(t){n(new e.prototype.Errors.UserCancellationError("Modal cancelled by user"))}};e._protected.Modal.show(r)};var n=!1;this.isRegistrationInProgress=function(){return n},this.setNotificationEnabled=function(t,o){return e._protected.Notification.isNativePushNotificationSupported()?n?Promise.reject(new e.prototype.Errors.RegistrationInProgressError("Registration already in progress")):new Promise((function(r,i){var s=function(e){n=!1,i(e)},a=function(e){n=!1,r(e)},c=e.prototype.Notification.getSubscriptionState();if(t&&c===e.prototype.SubscriptionState.SUBSCRIBED)a();else if(t||c!==e.prototype.SubscriptionState.UNSUBSCRIBED)if(t){if(!e._protected.Notification.isAllowedSubscriptionDomain(window.location.origin))return e._protected.Helper.warn("Current origin is not allowed to subscribe"),void s(new e._protected.Errors.InternalWrongDomainError("Current origin is not allowed to subscribe"));n=!0;var p=e._protected.Integration.isOnRightDomain();p&&!1!==e._protected.gscope.isSecureContext?e._protected.Notification.askPermissionAndRegisterInWindow().then((function(){a()}),(function(e){s(e)})):(p&&!1===e._protected.gscope.isSecureContext&&e._protected.Helper.warn("Although on custom domain (location.href =",e._protected.gscope.location.href,"), isSecureContext is",e._protected.gscope.isSecureContext),o?e._protected.Notification.openPopupAskPermissionAndRegister(o).then(a,s):e._protected.RunModes.Behaviors.Modal?e._protected.Notification.presentModal((function(t){e._protected.Notification.openPopupAskPermissionAndRegister(t).then(a,s)}),s):t&&c===e.prototype.SubscriptionState.UNSUBSCRIBED?e._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.Notification.getTrustedOrCachedNotificationPermissionState").then((function(t){t===e._protected.Notification.PERMISSION_GRANTED?e._protected.Notification.setManuallyUnsubscribed(!1).then(a,s):s(new e._protected.Errors.InternalWrongTargetError("No user event was given and not allowed to show a modal box to collect a click"))})).catch(s):s(new e._protected.Errors.InternalWrongTargetError("No user event was given and not allowed to show a modal box to collect a click")))}else e._protected.ServiceWorkerClient.unsubscribeFromPush().then((function(){a()}),(function(t){s(new e._protected.Errors.InternalStorageError("Failed to store unsubscription"))}));else a()})):Promise.resolve()},this.isAllowedSubscriptionDomain=function(t){if((t=t||window.location.origin).startsWith("https://")||t.startsWith("http://")||(t="https://"+t),t===e._protected.Integration.getHomeOrigin())return!0;let n=e._protected.Options.getAllowedSubscriptionDomains();return null==n||(Array.isArray(n)||(n=[]),-1!==(n=n.map(t=>{const n=t.match(/^\/(.*)\/([gimsuy]*)$/);if(null!==n)try{return new RegExp(n[1],n[2])}catch(n){e._protected.Helper.warn(o,"Failed to construct regex from",t)}const r=t.match(/^(https?:\/\/)?([^\/]+)(?:\/.*)?$/);if(null===r)return/^$/;let[i,s,a,c]=r;return s||(s="https?:\\/\\/"),a=(a=e._protected.Helper.escapeRegExp(a)).replace(/\\\*/g,"[^.\\/]+"),new RegExp(`^${s}${a}(\\/.*)?$`)})).findIndex(e=>e.test(t)))},this.handleActions=function(t,n){if(Array.isArray(n)){const o=[];n.forEach((function(n){try{if(!(n instanceof Object))return;switch(n.type){case e._protected.Constants.ACTION_LINK:n.url&&o.push(n);break;case e._protected.Constants.ACTION_METHOD:u(n);break;case e._protected.Constants.ACTION_TRACK_EVENT:l(t,n);break;case e._protected.Constants.ACTION_UPDATE_INSTALLATION:g(n);break;case e._protected.Constants.ACTION_SUBSCRIBE_TO_NOTIFICATIONS:h(n);break;case e._protected.Constants.ACTION_ADD_PROPERTY:f(n);break;case e._protected.Constants.ACTION_REMOVE_PROPERTY:m(n);break;case e._protected.Constants.ACTION_RESYNC_INSTALLATION:_(n);break;case e._protected.Constants.ACTION_ADD_TAG:a(n);break;case e._protected.Constants.ACTION_REMOVE_TAG:c(n);break;case e._protected.Constants.ACTION_REMOVE_ALL_TAGS:p(n);break;case e._protected.Constants.ACTION__OVERRIDE_NOTIFICATION_RECEIPT:v(n);break;default:console.log("Unhandled action type ",n.type," for action ",n)}}catch(e){console.error("Unexpected error while handling action ",n,e)}})),o.length&&o.length<n.length?setTimeout(()=>d(o[0]),500):o.length&&d(o[0])}};var d=function(e){const{url:t}=e||{};t&&"undefined"!=typeof window&&(window.location=t)},u=function(t){const{method:n,methodArg:o}=t||{};if(n){const t=new e._protected.Events.MethodCall(n,o);e._protected.Events.fire(t)}},l=function(n,o){if(o.event instanceof Object){var r=o.event.type,i=o.event.custom,s=JSON.parse(JSON.stringify(o.event||{}));delete s.type,delete s.custom,!0===o.addCurrentUrl&&"undefined"!=typeof window&&(s.currentUrl=window.location.href),"@"===r.charAt(0)?e._protected.trackInternalEvent(r,t.withEventData(s,n),i):e._protected.trackEventWithInternalData(r,t.withEventData(s,n),i)}},h=function(t){e.prototype.subscribeToNotifications(t.domEvent)},g=function(t){var n=t.installation&&t.installation.custom?t.installation.custom:t.custom;n&&Object.keys(n).length&&(t.appliedServerSide?e._protected.getUserId().then(t=>e._protected.JsonSyncInstallationCustom.receiveDiffForUser(t,n)):e._protected.getUserId().then(t=>e._protected.JsonSyncInstallationCustom.putInstallationCustomPropertiesForUser(t,n)))},f=function(t){var n=t.installation&&t.installation.custom?t.installation.custom:t.custom;n&&Object.keys(n).length&&Object.keys(n).forEach(t=>{const o=n[t];e._protected.Installation.addProperty(t,o)})},m=function(t){var n=t.installation&&t.installation.custom?t.installation.custom:t.custom;n&&Object.keys(n).length&&Object.keys(n).forEach(t=>{const o=n[t];e._protected.Installation.removeProperty(t,o)})},_=function(t){var n=function(t){var n=t.installation,o=n?n.custom:null;if(!o){if(!n)return;o={}}t.reset?e._protected.getUserId().then(n=>e._protected.JsonSyncInstallationCustom.receiveStateForUser(n,o,!!t.force)):e._protected.getUserId().then(t=>e._protected.JsonSyncInstallationCustom.receiveServerStateForUser(t,o)),e._protected.Installation.updateInstallationCoreProperties(),e._protected.ServiceWorker.resendPushToken(!0);var r={preferences:{subscriptionStatus:e.prototype.Notification.getSubscriptionState()===e.prototype.SubscriptionState.UNSUBSCRIBED?"optOut":"optIn"}};e.this.Rest.postEventually("/installation",{body:JSON.stringify(r),overwrite:!1})};t.installation?n(t):e._protected.Installation.getInstallationFromServer().then((function(e){Object.keys(e).forEach((function(t){t.startsWith("_")&&delete e[t]})),t.installation=e,n(t)}),(function(e){}))},v=function(t){var n=t.force;e._protected.Helper.log(o,"OVERRIDE notification receipt:",n),e._protected.Storage.set("_overrideNotificationReceipt",n)}};var a=function(t){const n=t.tags;e._protected.Installation.addTag(n)},c=function(t){const n=t.tags;e._protected.Installation.removeTag(n)},p=function(t){e._protected.Installation.removeAllTags()};return Promise.all([e._protected.Integration.getModuleInitializationPromise(),e._protected.Consent.awaitUserConsent()]).then((function(){e._protected.Notification.updateTrustedNotificationPermissionCacheIfPossible()})),e._protected.Blocker.category("ready").add("refreshSubscriptionState"),e._protected.Integration.getModuleInitializationPromise().then((function(){if(e._protected.Integration.isOnRightDomain()&&(e._protected.Notification.refreshSubscriptionState(),"undefined"!=typeof navigator&&navigator.permissions&&navigator.permissions.query))try{navigator.permissions.query({name:"notifications"}).then((function(t){t&&t.addEventListener("change",(function(){e._protected.Notification.refreshSubscriptionState(),Promise.all([e._protected.Consent.hasUserConsent(),e._protected.Session.getCurrentSession()]).then(([t,n])=>{t&&n&&n.accessToken&&e._protected.Installation.Profile.getCoreProperties().then(t=>{e.this.Rest.post("/installation/",{body:JSON.stringify({preferences:t.preferences}),overwrite:"false"})})})}))}))}catch(e){}})),r.promise}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){const{EventAttributionManager:t,ReportingDataUtil:o}=n(5);if(e._protected.RunModes.Behaviors.ContextServiceWorker&&e._protected.Helper.supportsPushManager()){var r="[sw          ]",i=e._protected.gscope;e._protected.ServiceWorker.resendPushToken=function(t){return e.instantiationPromise.then((function(){return e.prototype.getInitializationPromise().then((function(){return e._protected.ServiceWorkerClient.refreshPushToken(registration).then((function(){}),(function(n){e._protected.ServiceWorkerClient.getPushSubscriptionFromServiceWorker().then((function(n){e._protected.Installation.addInstallationPushToken(n,t)}),(function(e){}))}))}))}))},e._protected.ServiceWorker.checkForCustomDomainChange=function(){return e.instantiationPromise.then((function(){return e.prototype.getInitializationPromise().then((function(){e._protected.Integration.getCurrentOperatingOrigin()!==e._protected.Integration.getHomeOrigin()&&Promise.all([e._protected.Init.getDeviceId(),e._protected.Init.getFederatedDeviceId(),e._protected.Storage.get("customDomainMigrationInfo")]).then((function(t){var n=t[0],o=t[1],r=t[2]||{};n===o||r.deviceId===n&&r.federatedDeviceId===o||(e._protected.trackInternalEvent("@WEB_CUSTOM_DOMAIN_MIGRATION"),r.deviceId=n,r.federatedDeviceId=o,r.eventDate=+new Date,e._protected.Storage.set("customDomainMigrationInfo",r))}))}))}))};var s=function(t){var n;if("data"in t&&t.data&&"object"==typeof t.data&&"json"in t.data){var r;console.info("[WonderPush] Received push data:",t.data.text());try{r=t.data.json(),console.info("[WonderPush] Parsed push data:",r)}catch(t){console.error("[WonderPush] Push data was not valid JSON",t)}r&&"object"==typeof r&&("_wp"in r?n=Promise.resolve(r):r.data&&"object"==typeof r.data&&"_wp"in r.data&&(n=Promise.resolve(r.data))),n||(console.error("[WonderPush] Failed to find the data in the PushEvent!"),n=Promise.reject())}else{var i=function(t,n){var o=(n=n||0)?e._protected.Constants.GET_DELIVERIES_ERROR_WAIT_MS:0;return o+=e._protected.Constants.GET_DELIVERIES_RANDOM_WAIT_MIN_MS+Math.random()*(e._protected.Constants.GET_DELIVERIES_RANDOM_WAIT_MAX_MS-e._protected.Constants.GET_DELIVERIES_RANDOM_WAIT_MIN_MS),e._protected.Promise.DelayedStartPromise((function(t,n){e.this.Rest.fetch("GET","/deliveries",{status:"pending"}).then(t,n)}),o).then((function(e){if(200!==e.status)throw console.error("Failed to fetch last notification, got status ",e.status,e.statusText,":",e),e;return e}),(function(e){throw e.status&&e.statusText?console.error("Failed to fetch last notification, got status ",e.status,e.statusText,":",e):console.error("Failed to fetch last notification:",e),e})).catch((function(e){if(t>0)return console.log("Will retry"),i(t-1,n+1);throw e}))};n=e.this.getInitializationPromise().then((function(){return i(e._protected.Constants.GET_DELIVERIES_TRIES-1)})).then((function(t){return t.json().then((function(t){if(t.deliveries.length>0){const e=t.deliveries[t.deliveries.length-1].data;return console.info("[WonderPush] Fetched push data:",e),e}throw new e.prototype.Errors.NotificationPayloadError("No received notification")}))}))}return n.then((function(t){if(t){if(t._wp&&t._wp.receiveActions){const n=o.extract(t._wp);e._protected.Notification.handleActions(n,t._wp.receiveActions)}return c(t).then((function(){p(t)}))}console.error("Got empty notification!")}),(function(e){console.error("Failed to display a notification",e)}))},a=function(t){return console.log("pushsubscriptionchange event",t),t.newSubscription?e._protected.Installation.addInstallationPushToken(t.newSubscription):e._protected.ServiceWorkerClient.refreshPushToken(registration).then((function(e){console.log("Push subscription renewed",e)}),(function(e){throw console.error("Failed to renew push subscription during the handling of a pushsubscriptionchange event",e),e}))},c=function(t){var n=t._wp||{};const s=o.extract(n);var a=n.alert||{},c=a.title||t.alertTitle||e._protected.Options.getApplicationName(),p=e._protected.Helper.plainObjectCopy(a);delete p.title,delete p.data,void 0!==p.body&&null!==p.body||(p.body=t.alert),void 0!==p.requireInteraction&&null!==p.requireInteraction||(p.requireInteraction=!0),p.icon||(p.icon=e._protected.Options.getNotificationIcon());var d=e._protected.Helper.detectBrowser();if("Chrome"===d.name&&"Macintosh"===d.platform&&parseInt(d.version)>=59){if(e._protected.Integration.getHomeOrigin().endsWith(e._protected.Constants.DEFAULT_DOMAIN_SUFFIX)){var u=[];c&&c!==e._protected.Options.getApplicationName()&&u.push(c),c=e._protected.Options.getApplicationName(),p.body&&u.push(p.body),u.length>0?p.body=u.join(" - "):delete p.body}p.image&&(p.icon=p.image,delete p.image)}return p.image&&"undefined"!=typeof Notification&&!Notification.prototype.hasOwnProperty("image")&&(p.icon=p.image,delete p.image),p.icon&&navigator.userAgent.indexOf("Linux")>=0&&"Firefox"===d.name&&parseInt(d.version)<50&&delete p.icon,"undefined"!=typeof Notification&&Notification.prototype.hasOwnProperty("data")?(p.data=t,null===p.tag?delete p.tag:"tag"in a||"string"!=typeof s.campaignId||(p.tag=s.campaignId)):p.tag=JSON.stringify(t),console.info("[WonderPush] Displaying notification. title:",c,p),i.registration.showNotification(c,p).then((function(e){}),(function(t){e._protected.Helper.error(r,"showNotification(",c,",",JSON.stringify(p),") rejected",t)}))},p=function(t){const n=(t||{})._wp||{};var i={actionDate:e._protected.Time.getRealTime()};o.assignEventData(i,o.extract(n)),e._protected.Storage.set("lastReceivedNotificationInfoJson",i);var s=n.receipt;return e._protected.Storage.bulk([{get:{key:"pushTokenCache",defaultValue:{}}},{get:{key:"_overrideNotificationReceipt",defaultValue:null}},{get:{key:e._protected.Constants.LAST_RECEIVED_NOTIFICATION_CHECK_DATE_STORAGE_KEY,defaultValue:null}}]).then((function(t){var o=t.results.byKey.pushTokenCache,a=t.results.byKey[e._protected.Constants.LAST_RECEIVED_NOTIFICATION_CHECK_DATE_STORAGE_KEY];const c=n[e._protected.Constants.LAST_RECEIVED_NOTIFICATION_CHECK_DELAY_PAYLOAD_KEY]||e._protected.Constants.DEFAULT_LAST_RECEIVED_NOTIFICATION_CHECK_DELAY;if("number"!=typeof a||+new Date-a>c){const t=+new Date;e.this.Rest.postEventually("/installation",{body:JSON.stringify({[e._protected.Constants.LAST_RECEIVED_NOTIFICATION_CHECK_DATE_INSTALLATION_KEY]:t}),overwrite:"false"}).then(()=>e._protected.Storage.set(e._protected.Constants.LAST_RECEIVED_NOTIFICATION_CHECK_DATE_STORAGE_KEY,t)).catch(t=>e._protected.Helper.warn(r,"Could not report last received notification check date",t))}var p=t.results.byKey._overrideNotificationReceipt;null!=p&&(s=p),o.pushTokenP256dh&&o.pushTokenAuth||(s=!0),s?e._protected.trackInternalEvent("@NOTIFICATION_RECEIVED",i):e._protected.trackInternalEventWithMeasurementsApi("@NOTIFICATION_RECEIVED",i)})),t},d=function(n){return new Promise((function(r,i){var s;if(n.notification.tag,"undefined"!=typeof Notification&&Notification.prototype.hasOwnProperty("data"))s=n.notification.data;else try{s=JSON.parse(n.notification.tag)}catch(e){}s&&"object"==typeof s||(s={});var a,c=s._wp||{},p=c.targetUrl,d=c.actions,l=(c.alert||{}).actions||[];"string"==typeof n.action&&(a=l.filter((function(e){return e&&"object"==typeof e&&e.action===n.action}))[0]),a&&(p=a.targetUrl||p,d=a.actions||d,s._wp&&(s._wp.notificationclickEventAction=n.action)),c.inApp&&c.inApp.content&&e._protected.InAppMessaging.forceDisplayOnNextEvent(["ON_FOREGROUND"],c.inApp),n.notification.close();const h=o.extract(c);var g={actionDate:e._protected.Time.getRealTime()};if(o.assignEventData(g,h),a&&(g.buttonLabel=a.title),new t(e._protected.Storage).setCurrentAttribution(h,e._protected.Constants.DIFFERENT_SESSION_REGULAR_MIN_TIME_GAP),e._protected.Storage.set("lastOpenedNotificationInfoJson",g),e._protected.trackInternalEvent("@NOTIFICATION_OPENED",g),e._protected.Notification.handleActions(h,d),p&&p.startsWith("wonderpush://")){if("wonderpush://notificationOpen/noop"===p)return;if("wonderpush://notificationOpen/broadcast"===p)return void e._protected.Events.fire(e._protected.Events.WonderPushNotificationOpenedEvent(n));p=void 0}u(s,p).then(r,i)}))},u=function(t,n){return clients.openWindow?(n=n||e._protected.Options.getDefaultNotificationUrl()||i.registration.scope,clients.openWindow(n).catch((function(t){if(e._protected.Helper.warn(r,"opening window rejected",t,n),t.code===t.SECURITY_ERR){var o=e._protected.Integration.getRedirectionPageUrl(n);return clients.openWindow(o.href)}})).then((function(n){if(n){var o=e._protected.Integration.probeWindowObject({postMessage:(e,t,o)=>{n.postMessage(e,o)}},e._protected.Integration.getTargetOrigin(),{type:"isReady"},e=>e.data instanceof Object&&"readiness"===e.data.type&&e.data.ready);return e._protected.Promise.timeout(o,e._protected.Constants.SW_MAX_PAGELOAD_MS).then((function(){return l(n,t,"Sending notification to new client")}),(function(){console.log("Waited "+e._protected.Constants.SW_MAX_PAGELOAD_MS/1e3+"s for the newly opened window to be ready before sending it the clicked notification, aborting. (Normal if opening an external website.)")}))}}))):Promise.reject(new e.prototype.Errors.InternalError("Cannot open new client window to display notification"))},l=function(t,n,o){var r=function(){o&&console.log(o),t.postMessage({sdk:e._protected.sdkName,type:"nativeNotificationOpen",data:n})};return t.focus().then(r,r)};e._protected.ServiceWorker.addEventListener("install",(function(t){return e.instantiationPromise.then((function(){return i.skipWaiting()}))})),e._protected.ServiceWorker.addEventListener("activate",(function(e){return i.clients.claim()})),e._protected.ServiceWorker.addEventListener("push",(function(t){return e.instantiationPromise.then((function(){return s(t)}))})),e._protected.ServiceWorker.addEventListener("pushsubscriptionchange",(function(t){return e.instantiationPromise.then((function(){return a(t)}))})),e._protected.ServiceWorker.addEventListener("notificationclick",(function(t){return e.instantiationPromise.then((function(){return d(t)}))})),e._protected.ServiceWorker.resendPushToken(),e._protected.ServiceWorker.checkForCustomDomainChange(),"undefined"!=typeof navigator&&navigator.permissions&&navigator.permissions.query&&navigator.permissions.query({name:"notifications"}).then(t=>{t&&t.addEventListener("change",t=>{const n=t.target instanceof PermissionStatus?t.target:void 0;if(n&&"granted"===(n.state||n.status)){const t=()=>{e._protected.Init.getSessionState()===e.this.SessionState.INIT_INPROGRESS&&(e._protected.Notification.refreshSubscriptionState(),setTimeout(t,3e3))};setTimeout(t,3e3)}})})}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t,n="[sw-client   ]";let o=!1;var r;e.instantiationPromise.then(()=>{o=!0}),t=function(){e._protected.Integration.getModuleInitializationPromise().then((function(){e._protected.RunModes.Behaviors.ModeWebSite&&i(),e._protected.RunModes.Behaviors.RegisterServiceWorker&&e._protected.Helper.supportsServiceWorker()&&e._protected.Helper.supportsPushManager()&&"https:"===location.protocol&&e.instantiationPromise.then((function(){s()}))}))};var i=function(){addEventListener("focus",p),document.hasFocus()&&p()},s=function(){e._protected.Notification.getTrustedOrCachedNotificationPermissionState().then((function(t){t===e._protected.Notification.PERMISSION_GRANTED&&e._protected.ServiceWorkerClient.registerServiceWorker().then((function(t){return e._protected.Notification.getManuallyUnsubscribed().then((function(n){n||(e._protected.RunModes.Behaviors.RefreshPushToken?e._protected.ServiceWorkerClient.refreshPushToken(t).then((function(){}),(function(e){})):e._protected.ServiceWorkerClient.getPushSubscriptionAndRegisterServiceWorkerIfNecessary().then(t=>{e._protected.Installation.addInstallationPushToken(t)}))}))}))}))};e._protected.ServiceWorkerClient.refreshPushToken=function(t){return e._protected.gscope.isSecureContext,e._protected.Notification.getTrustedNotificationPermissionState().then((function(n){return n!==e._protected.Notification.PERMISSION_GRANTED?(n!==e._protected.Notification.PERMISSION_UNKNOWN&&e._protected.Installation.removeInstallationPushToken(),Promise.reject(new e.prototype.Errors.PermissionError("Notification permission is not granted","notification",n))):e._protected.Integration.getManifestInjectedPromise().then((function(){return a(t)})).then((function(t){return t?(e._protected.Installation.addInstallationPushToken(t),t):Promise.reject(new e.prototype.Errors.InternalError("Could not get push token"))})).catch((function(e){throw e}))}))};var a=function(t){if(!t||!t.pushManager)return Promise.reject(new e.prototype.Errors.InvalidArgumentError("No valid registration given"));if(!t.active)return new e._protected.Promise.Poll(()=>t.active,1e4,50).wait().then(()=>a(t));var o={userVisibleOnly:!0,applicationServerKey:e._protected.Helper.arrayBufferFromBase64UrlSafe(e._protected.Options.getApplicationServerKey()||"")};o.applicationServerKey||delete o.applicationServerKey;var r=2*e._protected.Constants.PUSH_MANAGER_SUBSCRIBE_TOO_LONG,i=3*e._protected.Constants.PUSH_MANAGER_SUBSCRIBE_TOO_LONG,s=new e._protected.Locking.ExpiringUnfairNamedGlobalMutex("pushManager.subscribe",r),c=+new Date;return s.acquire({interval:500,timeout:i}).then((function(){var r,i=!1;return setTimeout((function(){i||console.warn("Subscribing to push notifications seems to take too long… Are you on a slow network or using private browsing?")}),e._protected.Constants.PUSH_MANAGER_SUBSCRIBE_TOO_LONG),e._protected.Promise.do(e._protected.Storage.get("pushTokenCache",{}).then((function(e){r=e.date})).then((function(){return t.pushManager.getSubscription()})).catch((function(t){return e._protected.Helper.warn(n,"[subscribeAppropriately] pushManager.getSubscription() rejected",t),null})).then((function(t){if(t){const i=e._protected.Helper.plainObjectCopy(t.options),s=e._protected.Helper.plainObjectCopy(o);if("userVisibleOnly"in PushSubscriptionOptions.prototype||delete s.userVisibleOnly,t.options&&!e._protected.JsonUtil.equal(i,s)||t.expirationTime&&((new Date).getTime()>=t.expirationTime||r&&(new Date).getTime()>(t.expirationTime+r)/2))return e._protected.Helper.info(n,"[subscribeAppropriately] We'll unsubscribe the existing subscription to update its applicationServerKey"),t.unsubscribe().then((function(e){}),(function(t){e._protected.Helper.warn(n,"[subscribeAppropriately] existingSubscription.unsubscribe() rejected",t)}))}})).then((function(){return t.pushManager.subscribe(o)})).then((function(t){return e._protected.Analytics.sendEvent("serviceWorkerClient","subscribeAppropriately",null,+new Date-c),t}),(function(t){e._protected.Helper.error(n,"[subscribeAppropriately] pushManager.subscribe(",o,") rejected",t);var r="";throw t&&(t.name&&(r+=t.name),t.message&&(r+=": "+t.message)),e._protected.Analytics.sendEvent("serviceWorkerClient","subscribeAppropriately-error",r,+new Date-c),t})),(function(){i=!0,s.release()}))}),(function(e){throw e}))};e._protected.ServiceWorkerClient.registerForPushNotifications=function(){return e._protected.Integration.isOnRightDomain()?(!1===e._protected.gscope.isSecureContext&&e._protected.Helper.log(n,"[registerForPushNotifications] isSecureContext=false, likely because of opener, continuing anyway"),e._protected.RunModes.Behaviors.ContextServiceWorker?Promise.reject(new e._protected.Errors.InternalWrongTargetError):"granted"!==Notification.permission?Promise.reject(new e.prototype.Errors.PermissionError("registerForPushNotifications called without permission granted")):navigator.serviceWorker?e._protected.ServiceWorkerClient.registerServiceWorker().then((function(e){return a(e)})).then((function(e){return e})).catch((function(e){throw e})):new Promise((e,t)=>{})):Promise.reject(new e._protected.Errors.InternalWrongDomainError)};const c=e._protected.ServiceWorkerClient.registerServiceWorker;e._protected.ServiceWorkerClient.registerServiceWorker=function(){if(!e._protected.RunModes.Behaviors.CanRegisterServiceWorker)return Promise.reject("Cannot register service worker from here.");var t=e._protected.Integration.getServiceWorkerUrl();return navigator.serviceWorker&&navigator.serviceWorker.controller&&navigator.serviceWorker.controller.scriptURL&&navigator.serviceWorker.controller.scriptURL!==t&&(e._protected.Helper.warn(n,"[registerServiceWorker] Existing service worker detected! Registering",t,"in place of",navigator.serviceWorker.controller.scriptURL),e._protected.Helper.warn(n,"[registerServiceWorker] Push notifications and offline support might not work."),e._protected.Helper.warn(n,"[registerServiceWorker] Please follow this guide: https://docs.wonderpush.com/docs/service-worker-integration")),c.apply(this,arguments)},e._protected.ServiceWorkerClient.unsubscribeFromPush=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.ServiceWorkerClient.unsubscribeFromPush",(function(){return e._protected.Notification.setManuallyUnsubscribed(!0).then((function(){return!0})).catch((function(){return!1}))}));var p=function(){e._protected.ServiceWorkerClient._focusHandlerCalled()};e._protected.ServiceWorkerClient._focusHandlerCalled=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.ServiceWorkerClient._focusHandlerCalled",(function(){r=+new Date})),e._protected.ServiceWorkerClient.addMessageEventListener((function(t){if(("undefined"==typeof ServiceWorkerMessageEvent||t instanceof ServiceWorkerMessageEvent)&&t.data instanceof Object&&t.data.sdk===e._protected.sdkName)switch(t.data.type){case"getLastFocusTimestamp":"ports"in t&&t.ports.length>0&&t.ports[0].postMessage({type:"getLastFocusTimestamp",data:r});break;case"isReady":t.ports&&t.ports.length>0&&t.ports[0].postMessage({type:"readiness",ready:o});break;case"nativeNotificationOpen":(((t.data||{}).data||{})._wp||{}).notificationclickEventAction}})),t()}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o,r;o=[n(10)],void 0===(r=function(e){return function(t){t._protected.Modal=new function(){var n=null,o=function(t,n){n instanceof Node?t.appendChild(n):n&&(t.innerHTML=e.sanitize(n))};this.show=t._protected.Integration.proxifyToParentWindow("WonderPushSDK._protected.Modal.show",(function(r){if(t._protected.RunModes.Behaviors.Visible&&(r=r||{},!n)){modal=document.createElement("div"),modal.classList.add("wp-modal");var i=document.createElement("div");i.classList.add("wp-modal-wrapper-outer"),!1!==r.cancellable&&i.addEventListener("click",(function(e){e.target===i&&("function"==typeof r.oncancel&&r.oncancel.call(this,e),t._protected.Modal.close())})),modal.appendChild(i);var s=document.createElement("div");s.classList.add("wp-modal-wrapper-inner"),i.appendChild(s);var a=document.createElement("div");if(a.classList.add("wp-modal-block"),s.appendChild(a),r.title){var c=document.createElement("div");if(c.classList.add("wp-modal-title"),a.appendChild(c),r.icon){var p=document.createElement("div");p.classList.add("wp-modal-title-icon"),p.style.backgroundImage='url("'+encodeURI(r.icon)+'")',c.appendChild(p)}var d=document.createElement("div");d.classList.add("wp-modal-title-text"),o(d,r.title),c.appendChild(d)}var u=document.createElement("div");if(u.classList.add("wp-modal-content"),a.appendChild(u),r.content)o(u,r.content);else if(r.text){var l=document.createElement("div");l.classList.add("wp-modal-text"),u.appendChild(l),o(l,r.text)}if(r.buttons&&r.buttons.length>0){var h=document.createElement("div");h.classList.add("wp-modal-buttons"),a.appendChild(h);for(var g=function(e){return function(n){"function"==typeof e.onclick&&e.onclick.call(this,n,e),t._protected.Modal.close()}},f=0;f<r.buttons.length;++f){var m=r.buttons[f],_=document.createElement("div");for(var v in m.attributes||{})_.setAttribute(v,m.attributes[v]);_.classList.add("wp-modal-button"),o(_,m.label),_.outerHTML=e.sanitize(_.outerHTML),_.addEventListener("click",g(m)),h.appendChild(_)}}return document.body.classList.add("modal-open"),document.body.appendChild(modal),n=modal,modal}})),this.close=t._protected.Integration.proxifyToParentWindow("WonderPushSDK._protected.Modal.close",(function(){document.body.classList.remove("modal-open"),document.documentElement.classList.remove("modal-open"),n&&(n.parentNode.removeChild(n),n=null)}))}}}.apply(t,o))||(e.exports=r)},function(e,t,n){var o,r;o=[n(10)],void 0===(r=function(e){return function(t){var n=new t._protected.Promise.Deferred;return t._protected.PopupUI=new function(){var o,r,i=new t._protected.Promise.Deferred;let s=!t._protected.Notification.needUserGestureToAskPermission();Promise.all([t._protected.Integration.getModuleInitializationPromise(),t._protected.Notification.getModuleInitializationPromise()]).then((function(){var e=t._protected.Integration.getFrameUrl();o=new URL(e).origin,r=t.prototype.Notification.getOptInOptions(),n.resolve()}));const a=function(t){const n=t(),o=document.getElementById("whole-content");o.innerHTML=e.sanitize(n);const r=e=>{e.addEventListener("click",(function(e){e.preventDefault(),window.close()}))};o.querySelectorAll(".wonderpush-close-button").forEach(r),o.querySelectorAll(".wp-popup-negative-button").forEach(r),o.querySelectorAll(".wp-popup-positive-button").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),this.subscribeToNotifications(e)})})}.bind(this);var c=function(e,n){var o=t.prototype.Notification.getOptInOptions();return'<div class="wp-popup"><div class="wp-popup-content"><div id="logo" class="wp-popup-icon" style="width: '+o.externalBoxLogoWidth+"px; height:"+o.externalBoxLogoHeight+"px;"+(o.externalBoxLogoUrl?" background-image: url("+o.externalBoxLogoUrl+");":"")+'"></div><p>'+e+"</p>"+(n?"<p><small>"+n+"</small></p>":"")+"</div></div>"};const p=this.permissionUI=function(){var e=r.externalBoxTitle||t._protected.Options.getApplicationName(),n=void 0===r.externalBoxMessage?"We'd like to send you notifications":r.externalBoxMessage,i=r.externalBoxExampleTitle||"Example notification",a=r.externalBoxExampleMessage||"This is an example notification",c=o.replace(/^https?\:\/\//,""),p=r.externalBoxDisclaimer||"You can always unsubscribe at anytime.";const d=t._protected.Options.getNotificationIcon();return'<div class="wp-popup"><div class="wp-popup-content"><div class="wp-popup-title">'+e+"</div>"+(n?'<div class="wp-popup-message">'+n+"</div>":"")+'<div class="wp-popup-example"><div class="wp-popup-icon"'+(d?' style="background-image: url('+d+')"':"")+'></div><div class="wp-popup-example-text"><div class="wp-popup-example-title">'+i+'</div><div class="wp-popup-example-message">'+a+'</div><div class="wp-popup-example-url">'+c+'</div></div></div><div class="wp-popup-disclaimer">'+p+"</div>"+(s?"":'<div class="wp-popup-buttons"><button class="wp-popup-negative-button">'+(r.negativeButtonText||"Later")+'</button><button class="wp-popup-positive-button">'+(r.positiveButtonText||"Subscribe")+"</button></div>")+"</div></div>"};this.subscribeToNotifications=()=>{t.this.subscribeToNotifications().then(()=>{this.presentSuccessUI(),i.resolve()},e=>{e instanceof t.prototype.Errors.UserCancellationError||this.presentFailureUI(),i.reject(e)})},this.presentPermissionUI=()=>{a(p),s&&this.subscribeToNotifications()},this.waitForSubscription=()=>i.promise;const d=this.processingUI=function(){var e=t.prototype.Notification.getOptInOptions();return c(e.externalBoxProcessingMessage)};this.presentProcessingUI=a.bind(this,d);const u=this.timeoutUI=function(){var e=t.prototype.Notification.getOptInOptions();return c(e.externalBoxProcessingMessage,e.externalBoxTooLongHint)};this.presentTimeoutUI=a.bind(this,u);const l=this.successUI=function(){var e=t.prototype.Notification.getOptInOptions(),n='<a href="#" class="wonderpush-close-button">'+e.externalBoxCloseHint+"</a>";return c(e.externalBoxSuccessMessage,n)};this.presentSuccessUI=a.bind(this,l);const h=this.failureUI=function(){var e=t.prototype.Notification.getOptInOptions(),n='<a href="#" class="wonderpush-close-button">'+e.externalBoxCloseHint+"</a>";return c(e.externalBoxFailureMessage,n)};this.presentFailureUI=a.bind(this,h),this.getModuleInitializationPromise=function(){return n.promise}},n.promise}}.apply(t,o))||(e.exports=r)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.JsonUtil=new function(){this.stripNulls=function(t){t instanceof Object&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){var o=t[n];null==o?delete t[n]:e._protected.JsonUtil.stripNulls(o)}))},this.deepCopy=function(e){if(void 0!==e)return null===e?null:JSON.parse(JSON.stringify(e))},this.equal=function(e,t){if(!e||!t)return e==t;var n=this.diff(e,t);return n&&0===Object.keys(n).length},this.merge=function(t,n,o){if(o=!1!==o,t&&n)for(var r in n){var i=n[r];if(r in t)if(Array.isArray(i))t[r]=e._protected.JsonUtil.deepCopy(i);else if(i instanceof Object){var s=t[r];Array.isArray(s)||"object"!=typeof s?t[r]=e._protected.JsonUtil.deepCopy(i):e._protected.JsonUtil.merge(s,i,o)}else null==i&&o?delete t[r]:t[r]=i;else o&&null==i||(t[r]=e._protected.JsonUtil.deepCopy(i))}},this.diff=function(t,n){if("object"!=typeof t||"object"!=typeof n||Array.isArray(t)||Array.isArray(n))throw new e.prototype.Errors.InvalidArgumentError("diff only accept objects as arguments");if(null==n)return null;if(null==t)return e._protected.JsonUtil.deepCopy(n);var o,r,i={};for(o in t){r=o in n?n[o]:null;var s=t[o];if(s!==r)if(Array.isArray(r))if(Array.isArray(s)&&r.length===s.length){for(var a=!1,c=0;c<s.length;++c)if(null==s[c]||null==r[c]||"object"!=typeof s[c]||"object"!=typeof r[c]||Array.isArray(t)||Array.isArray(n)){if(s[c]!==r[c]){a=!0;break}}else{var p=e._protected.JsonUtil.diff(s[c],r[c]);if(0!==Object.keys(p).length){a=!0;break}}a&&(i[o]=e._protected.JsonUtil.deepCopy(r))}else i[o]=e._protected.JsonUtil.deepCopy(r);else null==s||null==r||"object"!=typeof s||"object"!=typeof r||Array.isArray(s)||Array.isArray(r)?i[o]="object"==typeof r?e._protected.JsonUtil.deepCopy(r):r:(i[o]=e._protected.JsonUtil.diff(s,r),0===Object.keys(i[o]).length&&delete i[o])}for(o in n)o in t||(r=n[o],i[o]=e._protected.JsonUtil.deepCopy(r));return i}}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t=e._protected.JsonUtil;e._protected.JsonSyncCallbackBuilder=function(){var e=this,t={save:function(e){return Promise.resolve()},schedulePatchCall:function(){return Promise.resolve()},serverPatchInstallation:function(e){}};e.onSave=function(n){return t.save=n,e},e.onSchedulePatchCall=function(n){return t.schedulePatchCall=n,e},e.onServerPatchInstallation=function(n){return t.serverPatchInstallation=n,e},e.build=function(){return t}},e._protected.JsonSync=function(n,o,r,i,s,a,c,p){if(!n)throw new e.prototype.Errors.InvalidArgumentError("callbacks cannot be null");o=t.deepCopy(o||{}),r=t.deepCopy(r||{}),i=t.deepCopy(i||{}),s=t.deepCopy(s||{}),a=t.deepCopy(a||{}),c=!!c,p="number"==typeof p?p:0,t.stripNulls(o),t.stripNulls(r);var d=function(){var e={_syncStateVersion:1};return e.sdkState=o,e.serverState=r,e.putAccumulator=i,e.inflightDiff=s,e.inflightPutAccumulator=a,e.scheduledPatchCall=c,e.inflightPatchCallDeadline=p,Promise.resolve(n.save(e))},u=function(){return 0!==p},l=function(){return u()&&+new Date>p},h=function(){return c=!0,d().then((function(){return Promise.resolve(n.schedulePatchCall())}))};this.callPatch_onSuccess=function(){return p=0,a={},t.merge(r,s,!0),s={},d()},this.callPatch_onFailure=function(){return p=0,t.merge(a,i,!1),i=a,a={},h()},this.getSdkState=function(){return t.deepCopy(o)},this.hasInflightPatchCall=u,this.hasInflightPatchCallTimedout=l,this.hasScheduledPatchCall=function(){return c},this.performScheduledPatchCall=function(){return c?function(){if(u())return c?d():h();c=!1;try{s=t.diff(r,o)}catch(t){e._protected.Helper.error("[jsonsync    ]","[callPatch] Failed to diff server state and sdk state to send installation custom diff",r,o,t),s={}}if(!Object.keys(s).length)return d();p=+new Date+e._protected.Constants.JSON_SYNC_MAX_INFLIGHT_TIME,a=t.deepCopy(i),i={};var l=d();return l.then((function(){n.serverPatchInstallation(s)})),l}():Promise.resolve()},this.put=function(e){return e||(e={}),t.merge(o,e,!0),t.merge(i,e,!1),h()},this.receiveDiff=function(e){return e||(e={}),t.merge(r,e,!0),this.put(e)}.bind(this),this.receiveState=function(e,n){return e||(e={}),r=t.deepCopy(e),t.stripNulls(r),o=t.deepCopy(r),n?i={}:(t.merge(o,s,!0),t.merge(o,i,!0)),h()},this.receiveServerState=function(e){return e||(e={}),r=t.deepCopy(e),t.stripNulls(r),h()},this.save=d;var g=new Promise(function(e,t){l()?e(this.callPatch_onFailure()):this.hasScheduledPatchCall()?e(h()):e()}.bind(this));this.ready=function(){return g}},e._protected.JsonSync.fromSavedState=function(t,n){return n||(n={}),n._syncStateVersion,new e._protected.JsonSync(t,n.sdkState,n.serverState,n.putAccumulator,n.inflightDiff,n.inflightPutAccumulator,null==n.scheduledPatchCall||n.scheduledPatchCall,n.inflightPatchCallDeadline)}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t="[jsonsyncinst]";e._protected.JsonSyncInstallationCustom=function(r,a){var c=function(){return e.prototype.getInitializationPromise().then((function(){return n((function(){return o(r).then((function(e){return d=0,e.sync.performScheduledPatchCall()}))}))}))}.bind(this);this.flush=function(){null!==p&&(clearTimeout(p),p=null),c()};var p=null,d=0;r=r||null;var u=(new e._protected.JsonSyncCallbackBuilder).onServerPatchInstallation((function(n){return function(n){var o={body:JSON.stringify({custom:n}),overwrite:!1},a={onload:function(e){("function"==typeof e.json?e.json():Promise.resolve(this.responseJSON)).then((function(e){e&&!0===e.success?i(r):s(r)}),(function(e){s(r)}))},onerror:function(e){s(r)},ontimeout:function(e){s(r)},onabort:function(e){s(r)}};e._protected.Session.getSession(r).then(n=>{if(!n.accessToken)return e._protected.Helper.error(t,"We have no accessToken! Cannot call WonderPush API."),void setTimeout(()=>{s(r)},3e4);e._protected.Consent.hasUserConsent().then(t=>t&&e._protected.Rest.post(r,"/installation",o,void 0,a))})}(n)})).onSchedulePatchCall((function(){return function(){null!==p&&(clearTimeout(p),p=null);var t=+new Date;0===d&&(d=t);var n=Math.max(0,Math.min(e._protected.Constants.CACHED_INSTALLATION_CUSTOM_PROPERTIES_MIN_DELAY,d+e._protected.Constants.CACHED_INSTALLATION_CUSTOM_PROPERTIES_MAX_DELAY-t));p=setTimeout(c,n)}()})).onSave((function(t){return function(t){var n=r||"";return e._protected.Storage.get(e._protected.Constants.PER_USER_INSTALLATION_CUSTOM_PROPERTIES_STORAGE_KEY,{}).then((function(o){return o[n]=t,e._protected.Storage.set(e._protected.Constants.PER_USER_INSTALLATION_CUSTOM_PROPERTIES_STORAGE_KEY,o)}))}(t)})).build();this.sync=e._protected.JsonSync.fromSavedState(u,a),this.getSdkState=this.sync.getSdkState,this.put=this.sync.put,this.receiveServerState=this.sync.receiveServerState,this.receiveState=this.sync.receiveState,this.receiveDiff=this.sync.receiveDiff,this.callPatch_onSuccess=this.sync.callPatch_onSuccess,this.callPatch_onFailure=this.sync.callPatch_onFailure;var l=new e._protected.Promise.Deferred;this.sync.ready().then(function(){l.resolve(this)}.bind(this)).catch((function(e){l.reject(e)})),this.ready=function(){return l.promise}};var n=function(n){var o=new e._protected.Locking.ExpiringUnfairNamedGlobalMutex("jsonSyncInstallationCustom",5e3);return o.acquire({timeout:6e3}).then((function(){var e=n();return o.renewWhile({interval:2500,release:!0},e),e}),(function(n){throw e._protected.Helper.warn(t,"cannot enter synchronized section",n),n}))};e._protected.JsonSyncInstallationCustom.getInstallationCustomPropertiesForUser=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.JsonSyncInstallationCustom.getInstallationCustomPropertiesForUser",(function(t){return e.instantiationPromise.then((function(){return n((function(){return o(t).then((function(e){return e.getSdkState()}))}))}))})),e._protected.JsonSyncInstallationCustom.putInstallationCustomPropertiesForUser=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.JsonSyncInstallationCustom.putInstallationCustomPropertiesForUser",(function(t,r){return e.instantiationPromise.then((function(){return n((function(){return o(t).then((function(e){return e.put(r)}))}))}))})),e._protected.JsonSyncInstallationCustom.receiveDiffForUser=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.JsonSyncInstallationCustom.receiveDiffForUser",(function(t,r){return e.instantiationPromise.then((function(){return n((function(){return o(t).then((function(e){return e.receiveDiff(r)}))}))}))})),e._protected.JsonSyncInstallationCustom.receiveStateForUser=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.JsonSyncInstallationCustom.receiveStateForUser",(function(t,r,i){return e.instantiationPromise.then((function(){return n((function(){return o(t).then((function(e){return e.receiveState(r,i)}))}))}))})),e._protected.JsonSyncInstallationCustom.receiveServerStateForUser=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.JsonSyncInstallationCustom.receiveServerStateForUser",(function(t,r){return e.instantiationPromise.then((function(){return n((function(){return o(t).then((function(e){return e.receiveServerState(r)}))}))}))})),e._protected.JsonSyncInstallationCustom.deleteForUser=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.JsonSyncInstallationCustom.deleteForUser",(function(t){return e.instantiationPromise.then((function(){return n((function(){return r(t)}))}))}));var o=function(t){return t=t||"",e._protected.Storage.get(e._protected.Constants.PER_USER_INSTALLATION_CUSTOM_PROPERTIES_STORAGE_KEY,{}).then((function(n){return new e._protected.JsonSyncInstallationCustom(t,n[t]||null).ready()}))},r=function(t){return t=t||"",e._protected.Storage.bulk([{test:{key:e._protected.Constants.PER_USER_INSTALLATION_CUSTOM_PROPERTIES_STORAGE_KEY,defaultValue:{},operationsCb:function(n){return delete n[t],[{put:{key:e._protected.Constants.PER_USER_INSTALLATION_CUSTOM_PROPERTIES_STORAGE_KEY,value:n}}]}}}]).then((function(){}))},i=function(t){e._protected.Promise.catchNoop(n((function(){return o(t).then((function(e){return e.callPatch_onSuccess()})).then((function(){}))})))},s=function(t){e._protected.Promise.catchNoop(n((function(){return o(t).then((function(e){return e.callPatch_onFailure()})).then((function(){}))})))},a=null,c=function(){null===a&&e._protected.RunModes.Behaviors.AccessToken&&e._protected.Integration.isOnRightDomain()&&n((function(){return e._protected.Storage.get(e._protected.Constants.PER_USER_INSTALLATION_CUSTOM_PROPERTIES_STORAGE_KEY,{}).then((function(n){Promise.all(Object.keys(n).map((function(o){return new e._protected.JsonSyncInstallationCustom(o||"",n[o]).ready().catch((function(n){e._protected.Helper.error(t,"Failed to initialize JsonSyncInstallationCustom for user",o,":",n)}))})))}))})).catch((function(n){e._protected.Helper.warn(t,"Periodic check rejected with",n)})).then((function(){var t=Math.round(e._protected.Constants.REQUEST_VAULT_IDLE_WAIT_MS*(1+.2*Math.random()));a=setTimeout((function(){a=null,c()}),t)}))};Promise.all([e._protected.Locking.getModuleInitializationPromise(),e._protected.Config.getModuleInitializationPromise()]).then((function(){e._protected.RunModes.Behaviors.AccessToken&&e._protected.Integration.isOnRightDomain()&&(e.prototype.getInitializationPromise().then(()=>Promise.all([e._protected.Storage.get(e._protected.Constants.PER_USER_INSTALLATION_CUSTOM_PROPERTIES_STORAGE_KEY,null),e._protected.getUserId()])).then((function([t,r]){if(!((r||"")in(t||{})))return n((function(){return o(r).then((function(t){return function(t){return e.preInstantiationPromise.then((function(){var n=new e._protected.Promise.Deferred,o=function(){n.reject()},r={onload:function(e){var t=e&&e.json&&e.json()||this.responseJSON;n.resolve(t&&t.custom||{})},onerror:o,ontimeout:o,onabort:o};return e._protected.Rest.get(t,"/installation",{},r,{}),n.promise}))}(r).then((function(e){t.receiveState(e,!1)}))}))}))})),e._protected.Locking.getModuleInitializationPromise().then((function(){c()})))}))}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){var t="[data        ]";e._protected.Data=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Data",new function(){this.exportAsBlob=function(){var t=[],n=function(e){t.push(JSON.stringify(e)),t.push("\n")};return Promise.all([e._protected.Storage.listObjectStores().then((function(t){return Promise.all(t.map((function(t){return e._protected.Storage.listKeyValuePairs(t).then((function(e){n({indexedDbStoreKeyValuePairs:{[t]:e}})}))})))})),e._protected.Session.listUsedUserIds().then((function(t){return Promise.all(t.map((function(t){return function(t){var o=e._protected.Rest.fetchJson(t,"GET","/authentication/accessToken",{},void 0).then((function(e){return{accessToken:e}})).then(n),r=(null==t||""===t?Promise.resolve(null):e._protected.Rest.fetchJson(t,"GET","/user",{},void 0)).then((function(e){return{user:e}})).then(n),i=e._protected.Rest.fetchJson(t,"GET","/installation",{},void 0).then((function(e){return{installation:e}})).then(n),s=function(o){return function(n){var o=n?e._protected.Helper.decodeQueryString(new URL(n).search):{limit:1e3};return e._protected.Rest.fetchJson(t,"GET","/events",o,void 0)}(o).then((function(e){n({eventsPage:e.data||[]});var t=(e.pagination||{}).next;if(t)return s(t)}))};return Promise.all([o,i,r,s(void 0)])}(t)})))}))]).then((function(){return new Blob(t,{type:"application/json"})}))},this.downloadExport=function(){return Promise.all([e.this.getUserId(),e.this.getInstallationId(),e._protected.Data.exportAsBlob()]).then((function(e){var t=e[0],n=e[1],o=e[2];null!=t||(t="");var r=document.createElement("a");r.href=window.URL.createObjectURL(o),r.download="wonderpush-web-dataexport-"+encodeURIComponent(t).replace("-","%2D")+"-"+encodeURIComponent(n).replace("-","%2D")+"-"+(new Date).toISOString()+".json",document.body.appendChild(r),r.click(),document.body.removeChild(r)})).then((function(){}))},this.clearEventsHistory=function(t){return e._protected.Rest.fetchJson(t,"DELETE","/events",{},void 0).then((function(){}))},this.clearPreferences=function(t){e._protected.JsonSyncInstallationCustom.getInstallationCustomPropertiesForUser(t).then((function(n){return Object.keys(n).forEach((function(e){n[e]=null})),Promise.all([e._protected.JsonSyncInstallationCustom.putInstallationCustomPropertiesForUser(t,n),t?e._protected.Rest.fetchJson(t,"PUT","/user",{body:JSON.stringify({custom:null})},void 0):Promise.resolve()])})).then((function(){}))},this.clearInstallation=function(n){return e._protected.Rest.fetchJson(n,"DELETE","/installation",{},void 0).catch((function(o){e._protected.Helper.error(t,"Failed to delete installation for userId",n,":",o),e._protected.Helper.info(t,"Continuing cleanup anyway")})).then((function(){return Promise.all([e._protected.Session.deleteSession(n),e._protected.JsonSyncInstallationCustom.deleteForUser(n)])})).then((function(){}))},this.clearAllLocalStorage=function(){const t=e._protected.Storage.getKeyValueStorageStoreName();return e._protected.Storage.listKeyValuePairs(t).then((function(t){e._protected.Storage.bulk(t.map((function(e){return{delete:{key:e[0]}}})))}))}}),e.prototype.Data=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK.prototype.Data",new function(){this.exportAsBlob=function(){return e._protected.Data.exportAsBlob()},this.downloadExport=function(){return e._protected.Data.downloadExport()},this.clearEventsHistory=function(){return e._protected.Session.listUsedUserIds().then((function(t){return Promise.all(t.map((function(t){return e._protected.Data.clearEventsHistory(t)})))})).then(()=>{})},this.clearPreferences=function(){return e._protected.Session.listUsedUserIds().then((function(t){return Promise.all(t.map((function(t){return e._protected.Data.clearPreferences(t)})))})).then(()=>{})},this.clearAll=function(){return e._protected.Session.listUsedUserIds().then((function(t){return Promise.all(t.map((function(t){return e._protected.Data.clearInstallation(t)}))).then((function(){return e._protected.Data.clearAllLocalStorage()}))})).then(()=>{})}})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){if(e._protected.RunModes.Behaviors.ContextWindow){var t,n,o,r="[ui          ]",i=[],s={},a=(t=e._protected.sdkName.toLowerCase(),(o=(n=document.querySelector('HEAD>META[name="'+t+'-integration"]'))?(n.content||n.getAttribute("content")).trim().split(/\s*,\s*/):[]).indexOf("frame")<0&&o.indexOf("popup")<0),c=function(t,n){a||window.postMessage({type:"display",sdk:e._protected.sdkName,[t]:n},window.location.origin)},p=c.bind(null,"text-content");c.bind(null,"main-content"),c.bind(null,"whole-content"),s.clear=function(){p("")},s.close=function(){p("You can now close the window."),window.close()},s.wait=function(e){return new Promise((function(t){setTimeout((function(){t()}),e.ms||1e3)}))},s.reload=function(){p("Reloading…");var t=new URL(window.location.href),n=e._protected.Helper.decodeQueryString(location.search);delete n.wonderpushUi,delete n.wonderpushUI,n.wonderpushUI=d(),t.search="",Object.keys(n).forEach((function(e){t.search+=(t.search?"&":"?")+encodeURIComponent(e)+(null===n[e]?"":"="+encodeURIComponent(n[e]))})),e._protected.Helper.info(r,"[reload] Navigating to",t.href),window.location.href=t.href},s.downloadDataExport=function(){return p("Gathering data for export…"),e.this.Data.downloadExport().then((function(){p("See downloaded file.")}),(function(e){throw p("An error occurred"),e}))},s.clearEventsHistory=function(){return p("Clearing all events…"),e.this.Data.clearEventsHistory().then((function(){p("All events are cleared.")}),(function(e){throw p("An error occurred"),e}))},s.clearPreferences=function(){return p("Clearing preferences…"),e.this.Data.clearPreferences().then((function(){p("Preferences are cleared.")}),(function(e){throw p("An error occurred"),e}))},s.clearAllData=function(){return p("Clearing all local and server-side data…"),e.this.Data.clearAll().then((function(){p("All local and server-side data is cleared.")}),(function(e){throw p("An error occurred"),e}))},s.optIn=function(){return p("Opt-in you in…"),e.this.setNotificationEnabled(!0).then((function(){p("You are now opted in.")}),(function(e){throw p("An error occurred"),e}))},s.optOut=function(){return p("Opt-in you out…"),e.this.setNotificationEnabled(!1).then((function(){p("You are now opted out.")}),(function(e){throw p("An error occurred"),e}))},s.addTag=function(){const t=window.location.search.split(/[\?&]/);let n=[];for(const o of t){if(!o)continue;const t=o.split("="),r=t[0];"wonderpushOptIn"===r&&e.this.subscribeToNotifications(),"tag"===r&&decodeURIComponent(t[1]||"").split(",").forEach(e=>{e&&n.push(e)})}e.this.addTag(n),p("Added "+n.length+" tag"+(1===n.length?"":"s")+": "+n.join(", "))},s.invalidateConfig=function(){return p("Invalidating cached configuration…"),e.this.Developer.invalidateConfig().then((function(){p("Cached configuration now invalidated")}),(function(e){throw p("An error occurred"),e}))},s.copyInstallationId=function(){e.prototype.getInstallationId().then(t=>{const n=document.createElement("div");n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.right="0",n.style.bottom="0",n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="center",n.style.background="white",n.style.justifyContent="center",n.style.font="13px arial";const o=e=>{const t=document.createElement("input");t.type="text",t.value=e,t.style.border="none",t.style.background="transparent",t.style.width="100%",t.style.textAlign="center",n.appendChild(t);const o=document.createElement("button");o.addEventListener("click",()=>{t.focus(),t.select(),document.execCommand("copy"),t.blur(),r.style.display="inline"}),o.textContent="Copy to clipboard",o.style.marginTop="10px",n.appendChild(o);const r=document.createElement("span");r.textContent="Copied!",r.style.display="none",n.appendChild(r)};if(t)o(t);else{const t=document.createElement("span");t.textContent="You do not have an Installation ID. Please make sure you have subscribed to push notifications.";const r=document.createElement("button");r.textContent="Subscribe to notifications",r.addEventListener("click",t=>{e.prototype.subscribeToNotifications(t).then(()=>e.prototype.getInstallationId()).then(e=>{n.innerHTML="",e?o(e):n.innerText="An error occurred, please try again."})}),n.appendChild(t),n.appendChild(r)}(document.getElementById("main-content")||document.body).appendChild(n)})};var d=function(){return i.map((function(e){return e.originalCall})).join(";")},u=function(){var e=i.shift();return void 0===e?Promise.resolve():Promise.resolve(e()).then(u)};WonderPush.ready((function(){var t=e._protected.Helper.decodeQueryString(location.search),n=t.wonderpushUI||t.wonderpushUi;(i=(n||"").split(";").map((function(t){var n=t.split("?");n.length>2&&n.push(n.splice(1).join("?"));var o=n[0],i=e._protected.Helper.decodeQueryString(n[1]);if(!s.hasOwnProperty(o))return null;var a=function(){return e._protected.Helper.info(r,"Launching UI",o,i,"…"),Promise.resolve(s[o](i)).then((function(){e._protected.Helper.info(r,"Launching UI",o,"done")}),(function(t){e._protected.Helper.info(r,"Launching UI",o,"failed:",t)}))};return a.originalCall=t,a})).filter((function(e){return e instanceof Function}))).length&&i.unshift(s.clear.bind(null,{})),u()}))}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o,r;o=[n(91)],void 0===(r=function(e){return function(t){var n,o="[plugins     ]",r={},i={},s={},a={},c={};t.prototype.Plugins=new function(){this.get=function(e){return t._protected.Plugins.get(e)},this.getVersion=function(e){return t._protected.Plugins.getVersion(e)}};var p=function(e){this.getLocales=function(){return t._protected.Helper.getLocales()},this.Storage=new function(){this.get=t._protected.Plugins.pluginStorageGet.bind(null,e.name),this.set=t._protected.Plugins.pluginStorageSet.bind(null,e.name)},this.loadStylesheet=function(){if(window)for(var t=new URL(".",e.url),n=0;n<arguments.length;n++){var o=arguments[n];if(o){var r=new URL(o,t);if(!o.match(/^https?\:/)&&r.href.startsWith(t.href)){var i=window.document.createElement("link");i.rel="stylesheet",i.href=r.href,window.document.head.appendChild(i)}else this.logError("Invalid stylesheet: stylesheets must be relative to the plugin file.")}}else this.logError("No window to add stylesheet to.")}.bind(this),this.logTrace=t._protected.Helper.trace.bind(null,"[plugin      ]","["+e.name+"]"),this.logDebug=t._protected.Helper.debug.bind(null,"[plugin      ]","["+e.name+"]"),this.log=t._protected.Helper.log.bind(null,"[plugin      ]","["+e.name+"]"),this.logInfo=t._protected.Helper.info.bind(null,"[plugin      ]","["+e.name+"]"),this.logWarn=t._protected.Helper.warn.bind(null,"[plugin      ]","["+e.name+"]"),this.logError=t._protected.Helper.error.bind(null,"[plugin      ]","["+e.name+"]"),this.checkTriggers=function(e,n,o){n=n||function(){},o=o||function(){},t._protected.Plugins.checkTriggersForPlugin(this,e).then(e=>{e?n():o()})}.bind(this),this.waitTriggers=function(e){return t._protected.Plugins.checkTriggersForPlugin(this,e).then(n=>n?Promise.resolve():t._protected.Plugins.registerTriggersCheck(this,e))}.bind(this),this.resetTriggers=function(){return Promise.all([this.getAttendance(),this.Storage.get("_triggersInfo")]).then(function(e){var t=e[0],n=e[1]._triggersInfo||{};return n.resetDate=(new Date).getTime(),n.resetVisits=t.visitCount,n.resetPages=t.pageViews,this.Storage.set("_triggersInfo",n).then((function(){}))}.bind(this))}.bind(this),this.snoozeTriggers=function(e){return"number"==typeof e&&(e+=(new Date).getTime()),this.Storage.get("_triggersInfo").then(function(t){var n=t._triggersInfo||{};return n.snoozeUntilDate=e,this.Storage.set("_triggersInfo",n).then((function(){}))}.bind(this))}.bind(this)};p.prototype=new t.constructor,t._protected.Plugins=new function(){var p=function(e,n){this.key=e,this.options=n;var o=e.match(/^([-_a-zA-Z0-9]+)(?::(\d+(?:\.\d+(?:\.\d+)?)?))?$/);if(o){var r=[];this.name=o[1],o[2]?(r=o[2].split(".").map((function(e){return""+parseInt(e)})),this.version=r.join(".")):(this.version="latest",r=[this.version]),3===r.length?this.url=new URL(t._protected.Constants.PLUGIN_ROOT_URL+this.name+"/"+this.version+"/"+this.name+".js"):this.url=new URL(t._protected.Constants.PLUGIN_ROOT_URL+this.name+"/"+this.version)}else{var i;try{i=new URL(e.endsWith(".js")?e:e+".js")}catch(n){throw Error('Invalid plugin name (allowed characters: a-z, A-Z, 0-9, "-", "_") or version (3 dot-separated digits): '+e)}if(i.pathname.endsWith("/"))throw Error("Invalid plugin URL (should end with the name of your plugin, not /): "+e);if("https:"!==i.protocol)throw Error("Invalid plugin URL (HTTP is not supported, please use HTTPS): "+e);this.name=i.pathname.replace(/^(?:.*\/)?([^\/]*?)(?:\.js)?$/,"$1"),this.url=i,this.version=i}this.resolveVersion=function(){if("string"!=typeof this.version||3===this.version.split(".").length)return Promise.resolve(this);var e=this;return new Promise((function(n,o){var r=function(t){(t&&t.text?t.text():Promise.resolve("string"==typeof t?t:this.responseText)).then((function(t){t=t.trim(),n(new p(e.name+":"+t,e.options))}))},i=function(n){console.error("Failed to resolve full version for plugin "+e.name+":"+e.version,n),o(new t.prototype.Errors.InternalError("Failed to resolve full version for plugin "+e.name+":"+e.version))};const s=c&&c[e.name],a=s&&s.shortVersions,d=a&&a[e.version];d?r(d):t._protected.Request.request("GET",e.url.href,null,null,null,{onload:r,onerror:i,ontimeout:i,onabort:i})}))}.bind(this)};n=function(){e(t);t._protected.Blocker.category("ready").add("plugin");var n=[t._protected.Config,t._protected.Integration];Promise.all(n.map((function(e){return e.getModuleInitializationPromise()}))).then((function(){!function(){c=t._protected.Config.getPluginsRegistry(),Object.keys(a).forEach(e=>{const n=a[e].loaderByVersion||{};Object.keys(n).forEach(n=>{const o=n.split("."),r=o[0],i=`${o[0]}.${o[1]}`;e in c||(c[e]={}),c[e].shortVersions||(c[e].shortVersions={}),["latest",r,i].forEach(o=>{const r=c[e].shortVersions[o];(!r||t._protected.Helper.compareVersions(n,r)>0)&&(c[e].shortVersions[o]=n)})})});var e,n,s=function(e){var n={"optin-switch":{switchElementId:e.switchElementId||t._protected.Constants.SUBSCRIPTION_SWITCH_ELEMENT_ID_DEFAULT},"tag-switch":{}};if("visits"===e.mode?n["optin-dialog"]={triggers:{minVisits:void 0!==e.minVisits?e.minVisits:t._protected.Constants.SUBSCRIPTION_MIN_VISITS_DEFAULT}}:"pages"===e.mode?n["optin-dialog"]={triggers:{minPages:void 0!==e.minPages?e.minPages:t._protected.Constants.SUBSCRIPTION_MIN_PAGES_DEFAULT}}:"direct"===e.mode&&(n["optin-dialog"]={triggers:{}}),n["optin-dialog"]&&n["optin-dialog"].triggers){n["optin-dialog"].triggers.delay=void 0!==e.delay?e.delay:t._protected.Constants.SUBSCRIPTION_DELAY_DEFAULT,n["optin-dialog"].triggers.snooze=void 0!==e.snooze?e.snooze:t._protected.Constants.SUBSCRIPTION_SNOOZE_DEFAULT;var o=t.prototype.Notification.getOptInOptions();o&&"Recevez désormais nos news en temps réel.<br/>Vous pouvez vous désinscrire à n'importe quel moment."===o.modalBoxMessage&&(n["optin-dialog"].title="Voulez-vous recevoir nos news en temps réel ?",n["optin-dialog"].message="Vous pouvez vous désinscrire à n'importe quel moment.",n["optin-dialog"].positiveButton="S'enregistrer",n["optin-dialog"].negativeButton="Plus tard")}return n}(t._protected.Options.getSubscriptionOptions()),u=t._protected.Options.getPlugins();if(t._protected.RunModes.Behaviors.ContextWindow?e=function(e){var t=document.createElement("script");t.src=e.url,t.charset="utf-8",document.body.appendChild(t)}:t._protected.RunModes.Behaviors.ContextServiceWorker,e){const t=e;e=function(e){const n=a[e.name],o=n&&n.loaderByVersion,r=o&&o[e.version];r?r():t(e)}}for(var l in e&&t._protected.RunModes.Behaviors.Plugins||(e=function(e){h[e.name].resolve()},u={},s={}),WonderPush.registerPlugin=function(e,n){var o,i;"function"==typeof n?o=n:"object"==typeof n&&("function"==typeof n.window&&(o=n.window),"function"==typeof n.serviceWorker&&(i=n.serviceWorker)),t._protected.RunModes.Behaviors.ModeWebSite?r[e]=o:t._protected.RunModes.Behaviors.ModeServiceWorker&&(r[e]=i);var s=h[e];s&&s.resolve()},i=d(u),s)l in i||(n=new p(l,s[l]),i[n.name]=n);!function(e){const n=[{initOption:"subscriptionNative",pluginName:"optin-automatic"},{initOption:"subscriptionDialog",pluginName:"optin-dialog"},{initOption:"subscriptionBell",pluginName:"optin-bell"},{initOption:"subscriptionSwitch",pluginName:"optin-switch",defaultValue:{}}];for(const o of n){let n=e[o.pluginName],r=t._protected.Options.get(o.initOption);void 0===r&&(r=o.defaultValue),void 0!==r&&(n||(e[(n=new p(o.pluginName)).name]=n),n.options=r)}}(i);var h={};Object.keys(i).forEach((function(n){try{var r=i[n];h[r.name]=new t._protected.Promise.Deferred,r.options?r.resolveVersion().then((function(t){i[t.name]=t,e(t)}),(function(e){console.error("Cannot load plugin "+r.name+" at "+r.url.href,e)})):h[r.name].resolve()}catch(e){t._protected.Helper.error(o,e.message)}})),Promise.all(Object.keys(h).map((function(e){return h[e].promise}))).then((function(){delete WonderPush.registerPlugin,t._protected.Blocker.category("ready").remove("plugin")}))}()}))};var d=function(e){var n={};for(var r in e)if(e.hasOwnProperty(r))try{var s=new p(r,e[r]);if(s.name in i){t._protected.Helper.error(o,"Multiple plugin versions specified for "+s.name),t._protected.Helper.error(o,"We had "+i[s.name].version+" and saw "+s.version),console.error(new t.prototype.Errors.PluginError("Multiple plugin versions specified for "+s.name));continue}n[s.name]=s}catch(e){t._protected.Helper.error(o,e.message)}return n};this.mergeOptionsPlugins=function(e,n){for(var o=[{}],r=0;r<arguments.length;r++)o.push(d(arguments[r]||{}));return function(e){var t={};for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];t[o.key]=o.options}return t}(t._protected.Helper.assign.apply(null,o))},this.get=function(e){return s[e]},this.getVersion=function(e){var t=(i[e]||{}).version;return t instanceof URL&&(t=new URL(t.href)),t},this.pluginStorageGet=t._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Plugins.pluginStorageGet",(function(e){var n=Array.prototype.slice.call(arguments);return n.shift(),t._protected.Storage.get("pluginsStorage:"+e,{}).then((function(e){var t={};return n.forEach((function(n){t[n]=e[n]})),t}))})),this.pluginStorageSet=t._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.Plugins.pluginStorageSet",(function(e){var n;return 3!==arguments.length||arguments[1]instanceof Object?n=arguments[1]:(n={})[arguments[1]]=arguments[2],t._protected.Storage.bulk([{test:{key:"pluginsStorage:"+e,defaultValue:{},operationsCb:function(o){return t._protected.Helper.assign(o,n),[{put:{key:"pluginsStorage:"+e,value:o}}]}}}]).then((function(){}))})),this.preregisterInlinedPlugin=function(e,t,n){a[e]||(a[e]={loaderByVersion:{}}),a[e].loaderByVersion[t]=n};var u=[];this.registerTriggersCheck=function(e,n){const o=new function(e,n){this.pluginSdk=e,this.config=n,this.resolve=void 0,this.removable=!1,this.promise=new Promise(e=>{this.resolve=e});var o=()=>{this.resolve&&(this.pluginSdk.logDebug("[checkTriggers] finally passed, resolving promise"),this.resolve(),this.resolve=void 0),this.removable=!0};this.runCheck=()=>t._protected.Plugins.checkTriggersForPlugin(this.pluginSdk,this.config).then(e=>(e&&o(),e))}(e,n);return u.push(o),o.promise},this.runRegisteredTriggersCheck=function(){return Promise.all(u.map(e=>e.runCheck())).then(()=>{u=u.filter(e=>!e.removable)})},this.checkTriggersForPlugin=function(e,n){e.logDebug("[checkTriggers] config =",n),n?!0===n?n={}:(n.autoReset=null==n.autoReset||n.autoReset,n.delay=null!=n.delay?n.delay:0,n.snooze=null!=n.snooze?n.snooze:432e5):n={manual:!0};var o=null,r=null,i=null,s=t.prototype.getAttendance().then((function(e){o=e})),a=e.Storage.get("_triggersInfo").then((function(e){r=e._triggersInfo||{}})),c=t._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.Notification.getTrustedOrCachedNotificationPermissionState").then((function(e){i=e===t._protected.Notification.PERMISSION_DENIED}));return Promise.all([s,a,c]).then((function(){var s=!0;t._protected.Notification.isAllowedSubscriptionDomain(window.location.origin)||(e.logDebug("[checkTriggers] rejects (allowedSubscriptionDomains)",{domain:window.location.origin,allowed:t._protected.Options.getAllowedSubscriptionDomains()}),s=!1),i&&(e.logDebug("[checkTriggers] rejects (permission)",{permissionDenied:i}),s=!1);var a=t.prototype.Notification.getSubscriptionState();return a!==t.prototype.SubscriptionState.NOT_SUBSCRIBED&&(e.logDebug("[checkTriggers] rejects (subscription state)",{subscriptionState:a}),s=!1),n.manual&&(e.logDebug("[checkTriggers] rejects (manual)",{manual:n.manual}),s=!1),(!0===r.snoozeUntilDate||"number"==typeof r.snoozeUntilDate&&r.snoozeUntilDate>(new Date).getTime())&&(e.logDebug("[checkTriggers] rejects (snoozeUntilDate)",{snoozeUntilDate:r.snoozeUntilDate}),s=!1),n.snooze&&r.resetDate&&r.resetDate+n.snooze>(new Date).getTime()&&(e.logDebug("[checkTriggers] rejects (snooze)",{snooze:n.snooze,resetDate:r.resetDate}),s=!1),n.minVisits&&o.visitCount<n.minVisits&&(e.logDebug("[checkTriggers] rejects (visits < minVisits)",{visits:o.visitCount,minVisits:n.minVisits}),s=!1),n.minVisitsSinceReset&&r.resetVisits&&o.visitCount-r.resetVisits<n.minVisitsSinceReset&&(e.logDebug("[checkTriggers] rejects (visitsSinceReset < minVisitsSinceReset)",{visitsSinceReset:o.visitCount-r.resetVisits,minVisitsSinceReset:n.minVisitsSinceReset}),s=!1),n.minPages&&o.pageViews<n.minPages&&(e.logDebug("[checkTriggers] rejects (pages < minPages)",{pages:o.pageViews,minPages:n.minPages}),s=!1),n.minPagesSinceReset&&r.resetPages&&o.pageViews-r.resetPages<n.minPagesSinceReset&&(e.logDebug("[checkTriggers] rejects (pagesSinceReset < minPagesSinceReset)",{pagesSinceReset:o.pageViews-r.resetPages,minPagesSinceReset:n.minPagesSinceReset}),s=!1),n.minVisitPages&&o.visitPageViews<n.minVisitPages&&(e.logDebug("[checkTriggers] rejects (visitPages < minVisitPages)",{visitPages:o.visitPageViews,minVisitPages:n.minVisitPages}),s=!1),e.logDebug("[checkTriggers]",s?"passed":"rejected"),s}),(function(t){return e.logError("[checkTriggers] failed to check",t),!1})).then(e=>t._protected.Promise.delay(Promise.resolve(e),e&&n.delay&&n.delay>0?n.delay:0)).then(t=>(t&&n.autoReset&&e.resetTriggers(),t))}},n(),t.preInstantiationPromise.then((function(){t._protected.Init.addWillBecomeReadyCallback((function(){Object.keys(i).forEach((function(e){var t=r[e];if(t){var n=i[e];s[e]=new t(new p(n),n.options),delete r[e]}}))}))}))}}.apply(t,o))||(e.exports=r)},function(e,t,n){var o,r;o=[n(92),n(93),n(94),n(95),n(96)],void 0===(r=function(){var e=Array.prototype.slice.call(arguments);return function(t){e.forEach(e=>e(t))}}.apply(t,o))||(e.exports=r)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.Plugins.preregisterInlinedPlugin("optin-automatic","1.0.2",(function(){WonderPush.registerPlugin("optin-automatic",(function(e,t){function n(e){e instanceof WonderPush.Errors.UserCancellationError||e instanceof WonderPush.Errors.PermissionError?console.warn(e):console.error(e)}e.waitTriggers?e.waitTriggers(t.triggers).then((function(){e.subscribeToNotifications().catch(n)})):e.checkTriggers(t.triggers,(function(){e.subscribeToNotifications().catch(n)}))}))}))}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.Plugins.preregisterInlinedPlugin("optin-dialog","1.3.13",(function(){WonderPush.registerPlugin("optin-dialog",(function(e,t){if(!e.isNativePushNotificationSupported())return{showDialog:function(){},hideDialog:function(){}};function n(e){return r.hasOwnProperty(i)&&r[i][e]?r[i][e]:e}var o,r={fr:{"Would you like to subscribe to push notifications?":"Souhaitez-vous vous inscrire aux notifications?","You can always unsubscribe at any time.":"Vous pouvez vous désinscrire à tout moment.",Subscribe:"Je m'inscris",Later:"Plus tard","Web push by WonderPush":"Push web par WonderPush"},es:{"Would you like to subscribe to push notifications?":"¿Desea suscribirse a las notificaciones push?","You can always unsubscribe at any time.":"Siempre puede darse de baja en cualquier momento",Subscribe:"Me suscribo",Later:"Más tarde","Web push by WonderPush":"Push web por WonderPush"},it:{"Would you like to subscribe to push notifications?":"Vuoi iscriverti alle notifiche push?","You can always unsubscribe at any time.":"Puoi annullare l'iscrizione in qualsiasi momento",Subscribe:"Mi iscrivo",Later:"Più tardi","Web push by WonderPush":"Push web di WonderPush"},de:{"Would you like to subscribe to push notifications?":"Möchten Sie Push-Benachrichtigungen abonnieren?","You can always unsubscribe at any time.":"Sie können sich jederzeit abmelden.",Subscribe:"Register",Later:"Später","Web push by WonderPush":"Web push von WonderPush"},pt:{"Would you like to subscribe to push notifications?":"Deseja se inscrever para receber notificações?","You can always unsubscribe at any time.":"Você pode cancelar a qualquer momento.",Subscribe:"Register",Later:"Mais tarde","Web push by WonderPush":"Push web da WonderPush"},nl:{"Would you like to subscribe to push notifications?":"Wilt u zich abonneren op pushmeldingen?","You can always unsubscribe at any time.":"U kunt zich altijd op elk gewenst moment afmelden.",Subscribe:"Abonneren",Later:"Later"},pl:{"Would you like to subscribe to push notifications?":"Czy chcesz subskrybować powiadomienia push?","You can always unsubscribe at any time.":"Zawsze możesz zrezygnować z subskrypcji w dowolnym momencie.",Subscribe:"Subskrybuj",Later:"Później"}},i=(e.getLocales&&e.getLocales()||[]).map((function(e){return e.split(/[-_]/)[0]}))[0]||(navigator.language||"").split("-")[0],s=void 0!==t.title?t.title:n("Would you like to subscribe to push notifications?"),a=void 0!==t.message?t.message:n("You can always unsubscribe at any time."),c=t.positiveButton||n("Subscribe"),p=t.negativeButton||n("Later"),d=t.style,u=void 0!==t.icon?t.icon:e.getNotificationIcon(),l=!!t.hidePoweredBy,h=void 0!==t.closeSnooze&&t.closeSnooze,g=void 0!==t.negativeSnooze?t.negativeSnooze:6048e5,f=t.triggers;(o=document.createElement("style")).type="text/css",o.appendChild(document.createTextNode(".wp-optin-dialog-container{z-index:10000;width:420px;max-width:100%;box-sizing:border-box;background-image:linear-gradient(to bottom,#eae9ea,#eeedee);position:fixed;top:0;left:50%;transform:translateX(-50%);padding:15px 20px 10px 20px;border:1px solid #dfdfdf;box-shadow:0 0 20px #888}.wp-optin-dialog-container .wp-optin-dialog-body{display:flex;flex-direction:row}.wp-optin-dialog-container .wp-optin-dialog-icon{flex-shrink:0;flex-basis:64px;width:64px;height:64px;background-size:contain;background-repeat:no-repeat;background-position:50% 50%;margin-right:20px}.wp-optin-dialog-container .wp-optin-dialog-text{display:flex;flex-direction:column;flex-grow:1}.wp-optin-dialog-container .wp-optin-dialog-text .wp-optin-dialog-title{font:bold 16px arial;margin-bottom:15px}.wp-optin-dialog-container .wp-optin-dialog-text .wp-optin-dialog-message{font:12px arial}.wp-optin-dialog-container .wp-optin-dialog-buttons{display:flex;flex-direction:row;margin-top:1em}.wp-optin-dialog-container .wp-optin-dialog-powered-by{flex-grow:1;align-self:flex-end;font:10px arial;color:#333;opacity:.8;background-position:bottom right;background-repeat:no-repeat;text-decoration:none;margin-right:.5em}.wp-optin-dialog-container .wp-optin-dialog-button{flex-grow:1;border-radius:4px;border:1px solid #d3d3d3;background:#fff;text-decoration:none;font:15px arial;color:#333;text-align:center;display:flex;min-width:5em;padding:.25em .5em}.wp-optin-dialog-container .wp-optin-dialog-button label{cursor:inherit;margin:auto}.wp-optin-dialog-container .wp-optin-dialog-button.wp-optin-dialog-positiveButton{border-color:#46a4f3;color:#fff;background-image:linear-gradient(to bottom,#62b3f4,#0486f6);margin-left:.5em}.wp-optin-dialog-container .wp-optin-dialog-close{position:absolute;top:4px;right:4px;width:10px;height:10px;text-decoration:none;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJCAYAAADgkQYQAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYxIDY0LjE0MDk0OSwgMjAxMC8xMi8wNy0xMDo1NzowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNS4xIE1hY2ludG9zaCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo1MDVDQUVGMDQzOUIxMUU3ODE2N0YyM0EyNDc4QTZCNyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo1MDVDQUVGMTQzOUIxMUU3ODE2N0YyM0EyNDc4QTZCNyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjI4NjdCN0UxNDM5QTExRTc4MTY3RjIzQTI0NzhBNkI3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjI4NjdCN0UyNDM5QTExRTc4MTY3RjIzQTI0NzhBNkI3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+JRvgJAAAAEdJREFUeNpiYmBgOAPEDP///8eKYfIMuBQiK8CqEEUBVABFIYYJSDoZsCkAyTGhmQhSYIJsNQNON6C5Eacv0K0+Q8iNAAEGAG9QVX0F8yI2AAAAAElFTkSuQmCC);background-size:cover;background-repeat:no-repeat;background-position:50% 50%}")),document.head.appendChild(o);var m,_,v=!1;e.waitTriggers?e.waitTriggers(f).then(function(){this.showDialog()}.bind(this)):e.checkTriggers(f,function(){this.showDialog()}.bind(this)),this.hideDialog=function(){_&&m.dispatchEvent(new Event("wonderpush-webplugin-optin-dialog.hide",{bubbles:!0,cancelable:!0}))&&(_(),v=!1,m=_=void 0)}.bind(this),this.showDialog=function(){var o=this;if(v)e.logDebug("Registration already in progress");else{if(window.WonderPush){var r=window.WonderPush.Notification.getSubscriptionState();if(r===window.WonderPush.SubscriptionState.SUBSCRIBED||r===window.WonderPush.SubscriptionState.UNSUPPORTED||r===window.WonderPush.SubscriptionState.DENIED)return}v=!0;var i="wp-optin-dialog-",f=document.createElement("div");if(f.className=i+"container",t.backgroundColor&&(f.style.backgroundColor=t.backgroundColor,f.style.backgroundImage="none",f.style.borderColor=t.backgroundColor),f.style.color=t.textColor||"black",d)for(var w in d)f.style[w]=d[w];_=function(){f.parentNode.removeChild(f)},m=f;var y=document.createElement("div");if(y.className=i+"body",f.appendChild(y),u){var b=document.createElement("div");b.className=i+"icon",b.style.backgroundImage="url("+u.replace("(","%28").replace(")","%29")+")",y.appendChild(b)}var S=document.createElement("div");if(S.className=i+"text",y.appendChild(S),s){var E=document.createElement("div");E.className=i+"title",E.innerHTML=s,S.appendChild(E)}if(a){var I=document.createElement("div");I.className=i+"message",I.innerHTML=a,S.appendChild(I)}var C=document.createElement("div");if(C.className=i+"buttons",f.appendChild(C),!l){var T=document.createElement("a");T.innerHTML=n("Web push by WonderPush"),T.href="https://docs.wonderpush.com/docs/manage-your-data-and-unsubscribe-from-web-push-notifications",T.className=i+"powered-by",T.setAttribute("title","Web and mobile push notifications"),C.appendChild(T)}var P={positiveButton:{label:c,backgroundColor:t.positiveButtonBackgroundColor||void 0,color:t.positiveButtonTextColor||void 0,click:function(t){t.target.dispatchEvent(new Event("wonderpush-webplugin-optin-dialog.positiveButton.click",{bubbles:!0,cancelable:!0}))&&(e.subscribeToNotifications(t).catch((function(e){e instanceof WonderPush.Errors.UserCancellationError||e instanceof WonderPush.Errors.PermissionError?console.warn(e):console.error(e)})),o.hideDialog())}},negativeButton:{label:p,backgroundColor:t.negativeButtonBackgroundColor||void 0,color:t.negativeButtonTextColor||void 0,click:function(t){void 0!==g&&!1!==g&&e.snoozeTriggers&&e.snoozeTriggers(g),t.target.dispatchEvent(new Event("wonderpush-webplugin-optin-dialog.negativeButton.click",{bubbles:!0,cancelable:!0}))&&o.hideDialog()}}};["negativeButton","positiveButton"].forEach((function(e){var t=document.createElement("a");t.href="#",t.className=i+"button "+i+e,P[e].backgroundColor&&(t.style.backgroundColor=P[e].backgroundColor,t.style.backgroundImage="none",t.style.borderColor=P[e].backgroundColor),P[e].color&&(t.style.color=P[e].color),t.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),P[e].click(t)})),C.appendChild(t);var n=document.createElement("label");n.innerHTML=P[e].label,t.appendChild(n)}));var N=document.createElement("a");f.appendChild(N),N.href="#",N.className=i+"close",N.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),void 0!==h&&!1!==h&&e.snoozeTriggers&&e.snoozeTriggers(h),t.target.dispatchEvent(new Event("wonderpush-webplugin-optin-dialog.closeButton.click",{bubbles:!0,cancelable:!0}))&&o.hideDialog()})),document.body.dispatchEvent(new Event("wonderpush-webplugin-optin-dialog.show",{bubbles:!0,cancelable:!0}))?document.body.appendChild(f):(v=!1,m=_=void 0)}}.bind(this)}))}))}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.Plugins.preregisterInlinedPlugin("optin-switch","1.0.4",(function(){WonderPush.registerPlugin("optin-switch",(function(e,t){if(!e.isNativePushNotificationSupported())return{setupSubscriptionSwitch:function(){}};var n;(n=document.createElement("style")).type="text/css",n.appendChild(document.createTextNode(".wp-switch{position:relative;display:inline-block;vertical-align:middle;width:auto;height:auto;padding:.2em;border-radius:1.25em;box-shadow:inset 0 -1px rgba(0,0,0,.05),inset 0 1px 1px rgba(0,0,0,.05);cursor:pointer;background-image:linear-gradient(to bottom,rgba(0,0,0,.2),rgba(255,255,255,.3) 1.5em)}.wp-switch-input{display:none}.wp-switch-label{position:relative;display:block;height:2em;font-size:60%;text-transform:uppercase;background:#eceeef;border-radius:inherit;box-shadow:inset 0 1px 2px rgba(0,0,0,.12),inset 0 0 2px rgba(0,0,0,.15);transition:.15s ease-out;transition-property:opacity,background}.wp-switch-label:after,.wp-switch-label:before{line-height:0;clear:both;transition:inherit;white-space:nowrap;display:inline-block}.wp-switch-label:before{content:attr(data-off);right:1em;color:#aaa;text-shadow:0 1px rgba(255,255,255,.5);float:right;margin-top:1em;margin-right:1em;margin-left:2.5em}.wp-switch-label:after{content:attr(data-on);left:1em;color:#fff;text-shadow:0 1px rgba(0,0,0,.2);opacity:0;float:left;margin-top:0;margin-left:1em;margin-right:2.5em}.wp-switch-input:checked~.wp-switch-label{background:#47a8d8;box-shadow:inset 0 1px 2px rgba(0,0,0,.15),inset 0 0 3px rgba(0,0,0,.2)}.wp-switch-input:checked~.wp-switch-label:before{opacity:0}.wp-switch-input:checked~.wp-switch-label:after{opacity:1}.wp-switch-handle{position:absolute;top:.24em;left:.24em;width:1.125em;height:1.125em;background:#fff;border-radius:100%;box-shadow:1px 1px 5px rgba(0,0,0,.2);background-image:linear-gradient(to bottom,#fff 40%,#f0f0f0);transition:.15s ease-out;transition-property:left,margin-left}.wp-switch-handle:before{content:'';position:absolute;top:0;left:0;margin:.1875em 0 0 .1875em;width:.75em;height:.75em;background:#f9f9f9;border-radius:100%;box-shadow:inset 0 1px rgba(0,0,0,.02);background-image:linear-gradient(to bottom,#eee,#fff)}.wp-switch-input:checked~.wp-switch-handle{left:100%;margin-left:-1.365em;box-shadow:-1px 1px 5px rgba(0,0,0,.2)}.wp-switch-input:disabled~.wp-switch-handle{background-image:linear-gradient(to bottom,silver 40%,grey)}.wp-switch-input:disabled~.wp-switch-handle:before{background:#b0b0b0}.wp-switch-input:disabled~.wp-switch-label{background:silver}.wp-switch-input:disabled~.wp-switch-label:before{color:#eee}.wp-switch-off-gray>.wp-switch-label{background:#eceeef}.wp-switch-off-gray>.wp-switch-label:before{color:#aaa;text-shadow:0 1px rgba(255,255,255,.5)}.wp-switch-off-grey>.wp-switch-label{background:#eceeef}.wp-switch-off-grey>.wp-switch-label:before{color:#aaa;text-shadow:0 1px rgba(255,255,255,.5)}.wp-switch-off-red>.wp-switch-label{background:#ed2121}.wp-switch-off-red>.wp-switch-label:before{color:#fff;text-shadow:0 1px rgba(0,0,0,.2)}.wp-switch-on-green>.wp-switch-input:checked~.wp-switch-label{background:#4fb845;text-shadow:0 1px rgba(0,0,0,.2)}.wp-switch-on-blue>.wp-switch-input:checked~.wp-switch-label{background:#47a8d8;text-shadow:0 1px rgba(0,0,0,.2)}")),document.head.appendChild(n);var o=null,r=function(){"loading"!==document.readyState?this.setupSubscriptionSwitch():document.addEventListener("DOMContentLoaded",function(){this.setupSubscriptionSwitch()}.bind(this))}.bind(this);this.setupSubscriptionSwitch=function(){var n,r,c,p,d,u,l,h,g,f,m,_;o||null!==t.switchElementId&&(n=t.switchElementId||"wonderpush-subscription-switch",r=document.querySelectorAll("#"+n),c=t.unsupported||"",p=t.classPrefix||"wp-",d=t.prepend||"",u=t.append||"",l=t.sentence||"",h=t.cssClass||"",g=t.on||"ON",f=t.off||"OFF",m=t.colorOn,_=t.colorOff,Array.prototype.slice.call(r).forEach((function(t){var n,r,v,w,y,b,S;t&&"true"!==t.dataset.wpInitialized&&((o=t).dataset.wpInitialized="true",e.isNativePushNotificationSupported()?(n=t.dataset.classPrefix||p,t.innerHTML=(t.dataset.prepend||d)+'<div class="'+n+'switch-wrapper"></div>'+(t.dataset.append||u),r=t.querySelector("."+n+"switch-wrapper"),(v=document.createElement("SPAN")).innerHTML=t.dataset.sentence||l,(w=document.createElement("LABEL")).classList.add(n+"switch"),w.className+=" "+(t.dataset.class||h),(t.dataset.colorOn||m)&&w.classList.add(n+"switch-on-"+(t.dataset.colorOn||m)),(t.dataset.colorOff||_)&&w.classList.add(n+"switch-off-"+(t.dataset.colorOff||_)),(y=document.createElement("INPUT")).id=t.id+"-input",y.type="checkbox",y.classList.add(n+"switch-input"),w.appendChild(y),(b=document.createElement("SPAN")).classList.add(n+"switch-label"),b.dataset.on=t.dataset.on||g,b.dataset.off=t.dataset.off||f,w.appendChild(b),(S=document.createElement("SPAN")).classList.add(n+"switch-handle"),w.appendChild(S),r.appendChild(v),r.appendChild(w),y.addEventListener("click",i),window.addEventListener("WonderPushEvent",a(y)),s(y,e.Notification.getSubscriptionState())):t.innerHTML=t.dataset.unsupported||c)})))};var i=function(t){var n=t.target.checked;return t.stopPropagation(),t.preventDefault(),e.setNotificationEnabled(n,t).catch((function(e){e instanceof WonderPush.Errors.UserCancellationError||e instanceof WonderPush.Errors.PermissionError?console.warn(e):console.error(e)})),!1},s=function(t,n){switch(n){case e.SubscriptionState.UNSUPPORTED:t.disabled=!0,t.checked=!1;break;case e.SubscriptionState.UNDETERMINED:case e.SubscriptionState.NOT_SUBSCRIBED:case e.SubscriptionState.UNSUBSCRIBED:t.disabled=!1,t.checked=!1;break;case e.SubscriptionState.SUBSCRIBED:t.disabled=!1,t.checked=!0}},a=function(e){return function(t){var n=(t.originalEvent||t).detail||{};"subscription"===n.name&&s(e,n.state)}};r()}))}))}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.Plugins.preregisterInlinedPlugin("optin-bell","1.0.13",(function(){WonderPush.registerPlugin("optin-bell",{window:function(e,t){if(!e.isNativePushNotificationSupported())return{showBell:function(){},hideBell:function(){},updateTexts:function(){},updateDiscretion:function(){}};function n(e){e instanceof WonderPush.Errors.UserCancellationError||e instanceof WonderPush.Errors.PermissionError?console.warn(e):console.error(e)}var o,r={fr:{"Manage Notifications":"Gestion des notifications","Your personal notification data:":"Vos données personnelles de notification :","WonderPush fully supports european GDPR":"WonderPush soutient pleinement la RGPD européenne",Clear:"Effacer",Download:"Télécharger","You've blocked notifications":"Vous avez bloqué les notifications",Unsubscribe:"Désinscription","You're subscribed to notifications":"Vous êtes abonné aux notifications",Subscribe:"Je m'abonne","You are not receiving any notifications":"Vous ne recevez pas de notifications",Loading:"Chargement","Click to subscribe to notifications":"Cliquez pour vous abonner aux notifications","You won't receive more notifications":"Vous ne recevrez plus de notifications","Thanks for subscribing!":"Merci de vous être abonné !"},es:{"Manage Notifications":"Administrar notificaciones","Your personal notification data:":"Sus datos personales de notificación :","WonderPush fully supports european GDPR":"WonderPush es totalmente compatible con GDPR europeo",Clear:"Borrar",Download:"Descargar","You've blocked notifications":"Has bloqueado las notificaciones",Unsubscribe:"Darse de baja de las notificaciones","You're subscribed to notifications":"Estás suscrito a notificaciones",Subscribe:"Suscribirse","You are not receiving any notifications":"No está recibiendo ninguna notificación",Loading:"Cargando","Click to subscribe to notifications":"Haga clic para suscribirse a las notificaciones","You won't receive more notifications":"No recibirá más notificaciones","Thanks for subscribing!":"¡Gracias por suscribirse!"},it:{"Manage Notifications":"Gestisci notifiche","Your personal notification data:":"I tuoi dati di notifica personali:","WonderPush fully supports european GDPR":"WonderPush supporta pienamente il GDPR europeo",Clear:"Eliminare",Download:"Scaricare","You've blocked notifications":"Notifiche bloccate",Unsubscribe:"Annulla iscrizione","You're subscribed to notifications":"Sei iscritto alle notifiche",Subscribe:"Mi iscrivo","You are not receiving any notifications":"Non ricevi alcuna notifica",Loading:"Carica","Click to subscribe to notifications":"Fai clic per iscriverti alle notifiche","You won't receive more notifications":"Non riceverai più notifiche","Thanks for subscribing!":"Grazie per esserti iscritto!"},de:{"Manage Notifications":"Benachrichtigungen verwalten","Your personal notification data:":"Ihre persönlichen Benachrichtigungsdaten:","WonderPush fully supports european GDPR":"WonderPush unterstützt die europäische GDPR",Clear:"Klar",Download:"Herunterladen","You've blocked notifications":"Sie haben Benachrichtigungen blockiert",Unsubscribe:"Abbestellen","You're subscribed to notifications":"Sie haben Benachrichtigungen abonniert",Subscribe:"Abonnieren","You are not receiving any notifications":"Sie erhalten keine Benachrichtigungen",Loading:"Wird geladen","Click to subscribe to notifications":"Klicken Sie hier, um Benachrichtigungen zu abonnieren","You won't receive more notifications":"Sie erhalten keine Benachrichtigungen mehr","Thanks for subscribing!":"Danke fürs Abonnieren!"},pt:{"Manage Notifications":"Gerenciar notificações","Your personal notification data:":"Os seus dados de notificação pessoal:","WonderPush fully supports european GDPR":"O WonderPush suporta totalmente o GDPR europeu",Clear:"Clear",Download:"Download","You've blocked notifications":"Você bloqueou as notificações",Unsubscribe:"Cancelar inscrição","You're subscribed to notifications":"Você está inscrito nas notificações",Subscribe:"Inscrever-se","You are not receiving any notifications":"Você não está recebendo nenhuma notificação",Loading:"Loading","Click to subscribe to notifications":"Clique para assinar as notificações","You won't receive more notifications":"Você não receberá mais notificações","Thanks for subscribing!":"Obrigado por se inscrever!"},nl:{"Manage Notifications":"Beheer pushmeldingen","Your personal notification data:":"Uw persoonlijke meldingsgegevens:","WonderPush fully supports european GDPR":"WonderPush ondersteunt de Europese GDPR volledig",Clear:"Clear",Download:"Downloaden","You've blocked notifications":"Je hebt pushmeldingen geblokkeerd",Unsubscribe:"Abonnement opzeggen","You're subscribed to notifications":"U bent aangemeld voor kennisgevingen",Subscribe:"Abonneren","You are not receiving any notifications":"Je ontvangt geen meldingen meer",Loading:"Bezig met laden","Click to subscribe to notifications":"Klik om u te abonneren op meldingen","You won't receive more notifications":"Je ontvangt geen meldingen meer","Thanks for subscribing!":"Bedankt voor het inschrijven!"},pl:{"Manage Notifications":"Zarządzaj powiadomieniami push","Your personal notification data:":"Twoje osobiste dane powiadomień:","WonderPush fully supports european GDPR":"WonderPush w pełni wspiera europejski RODO",Clear:"Wyczyść dane",Download:"Pobierz","You've blocked notifications":"Zablokowałeś powiadomienia",Unsubscribe:"Anuluj subskrypcje","You're subscribed to notifications":"Subskrybujesz powiadomienia",Subscribe:"Subskrybuj","You are not receiving any notifications":"Nie otrzymujesz żadnych powiadomień",Loading:"Ładowanie","Click to subscribe to notifications":"Kliknij, aby zasubskrybować powiadomienia","You won't receive more notifications":"Nie będziesz otrzymywać więcej powiadomień","Thanks for subscribing!":"Dzięki za subskrypcję!"}},i="wonderpush-",s=(e.getLocales&&e.getLocales()||[]).map((function(e){return e.split(/[-_]/)[0]}))[0]||(navigator.language||"").split("-")[0],a=function(e){return r.hasOwnProperty(s)&&r[s][e]?r[s][e]:e},c=function(e){return new Promise((function(t,n){var o=function(n){e.removeEventListener("transitionend",o),e.removeEventListener("transitioncancel",o),t()};e.addEventListener("transitionend",o),e.addEventListener("transitioncancel",o)}))};(t=t||{}).cssPrefix&&(i=t.cssPrefix),(o=document.createElement("style")).type="text/css",o.appendChild(document.createTextNode(".wonderpush-hidden{display:none!important}.wonderpush-bell{z-index:10000;direction:ltr;color:#333;font:13px arial;position:fixed;bottom:20px;left:20px;display:flex;justify-content:flex-start;align-items:center;height:44px;transition:all .2s ease-in;transform-origin:center}.wonderpush-bell.wonderpush-deactivated{transform:scaleY(0)}.wonderpush-bell a{color:#ff6f61!important;text-decoration:none!important}.wonderpush-bell .wonderpush-collapsed{transform:scale(0)!important;box-shadow:0 0 0 transparent!important}.wonderpush-bell.wonderpush-discrete{height:33px}.wonderpush-bell.wonderpush-discrete .wonderpush-icon-container{border-radius:16.5px;width:33px;opacity:.5}.wonderpush-bell.wonderpush-discrete:hover{height:44px}.wonderpush-bell.wonderpush-discrete:hover .wonderpush-icon-container{border-radius:22px;width:44px;opacity:1}.wonderpush-bell .wonderpush-icon-container{cursor:pointer;transform-origin:center center;transform:scale(1);transition:all .2s ease-in;width:44px;height:100%;border-radius:22px;background:#ff6f61;display:flex;align-items:center;justify-content:center;position:relative}.wonderpush-bell .wonderpush-icon-container .wonderpush-icon{mask-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gU3ZnIFZlY3RvciBJY29ucyA6IGh0dHA6Ly93d3cub25saW5ld2ViZm9udHMuY29tL2ljb24gLS0+DQo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMTAwMCAxMDAwIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAxMDAwIDEwMDAiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPG1ldGFkYXRhPiBTdmcgVmVjdG9yIEljb25zIDogaHR0cDovL3d3dy5vbmxpbmV3ZWJmb250cy5jb20vaWNvbiA8L21ldGFkYXRhPg0KPGc+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDAwMDAsNTEyLjAwMDAwMCkgc2NhbGUoMC4xMDAwMDAsLTAuMTAwMDAwKSI+PHBhdGggZD0iTTQ4NTQuMyw1MDAyLjhjLTExMS4yLTQyLjItMTg0LjEtMTAzLjYtMjI2LjMtMTkxLjhjLTM2LjQtNzQuOC00MC4zLTExNy00MC4zLTQyMHYtMzM1LjZsLTE2NC45LTMyLjZjLTI0MS42LTQ3LjktNDMxLjUtMTE1LjEtNjg4LjUtMjM5LjdjLTc5Mi4xLTM4Ny40LTEzNTAuMS0xMTA2LjYtMTU0NS44LTE5OTIuNmMtMzguNC0xNzQuNS00Mi4yLTI2MC44LTU1LjYtMTMzNi43Yy0xMy40LTEwNTIuOS0xNy4zLTExNjYtNTMuNy0xMzM0LjhjLTEyNC43LTU5MC43LTM5Ny0xMDgzLjYtODIwLjgtMTQ5NS45Yy0xODcuOS0xODAuMy0zNTAuOS0zMDYuOC01NTAuNC00MjMuOGwtMTMwLjQtNzQuOGw0Ni04MC41YzI0LjktNDQuMSw4Mi41LTE1MS41LDEyOC41LTIzNy44bDg0LjQtMTU5LjJINTAwMGg0MTYzLjVsODQuNCwxNTkuMmM0Niw4Ni4zLDEwMy42LDE5My43LDEyOC41LDIzNy44bDQ2LDgwLjVsLTEzNC4yLDc4LjZjLTIxOC42LDEyNi42LTQyMS45LDI4OS42LTYyNS4yLDUwMi41Yy0zODEuNywzOTUuMS02MjUuMiw4NjEuMS03NDIuMiwxNDEzLjRjLTM2LjQsMTY4LjgtNDAuMywyODMuOS01My43LDEzMjUuMmMtMTUuMywxMTQ0LjktMTkuMiwxMjA2LjMtOTUuOSwxNTAxLjZjLTI2NC42LDEwMzcuNS0xMTMxLjUsMTg1Ni40LTIxOTUuOSwyMDc1LjFsLTIxMSw0Mi4ybC05LjYsMzUyLjljLTkuNiwzMjcuOS0xMy40LDM1OC42LTUzLjcsNDI1LjdDNTIxMi45LDQ5NzkuNyw1MDAxLjksNTA1Ni41LDQ4NTQuMyw1MDAyLjh6IE00MzM4LjQsMzIxOS4yYzc2LjctMzguNCwxNDAtMTQ1LjgsMTI2LjYtMjIyLjVjLTE1LjMtMTAzLjYtNjEuNC0xNTEuNS0yMTguNi0yMzAuMWMtMzU4LjYtMTgwLjMtNjEzLjctNDM3LjMtNzk3LjgtODAzLjZjLTk5LjctMTk3LjUtMTk1LjYtMjUxLjItMzQ3LjEtMTg4Yy03Mi45LDMwLjctMTI0LjcsMTE1LjEtMTI0LjcsMjAxLjRjMCwxMzguMSwyMTguNiw1MDIuNSw0NDEuMSw3MzguNGMxNzIuNiwxODAuMywzNTguNiwzMjAuMyw1ODQuOSw0MzcuM0M0MTgxLjEsMzI0Niw0MjU1LjksMzI2MS40LDQzMzguNCwzMjE5LjJ6Ii8+PHBhdGggZD0iTTM5MjYtMzgwNy42YzM2LjQtMjY4LjUsMTM4LjEtNDc5LjUsMzE2LjQtNjU3LjhjMjEyLjktMjEyLjksNDU4LjQtMzE0LjUsNzU3LjUtMzE0LjVzNTQ0LjcsMTAxLjcsNzU3LjUsMzE0LjVjMTgwLjMsMTgwLjMsMjgzLjgsMzk1LjEsMzE0LjUsNjU3LjhsMTEuNSw5MC4xSDQ5OTguMUgzOTE0LjVMMzkyNi0zODA3LjZ6Ii8+PC9nPjwvZz4NCjwvc3ZnPg==);-webkit-mask-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gU3ZnIFZlY3RvciBJY29ucyA6IGh0dHA6Ly93d3cub25saW5ld2ViZm9udHMuY29tL2ljb24gLS0+DQo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMTAwMCAxMDAwIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAxMDAwIDEwMDAiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPG1ldGFkYXRhPiBTdmcgVmVjdG9yIEljb25zIDogaHR0cDovL3d3dy5vbmxpbmV3ZWJmb250cy5jb20vaWNvbiA8L21ldGFkYXRhPg0KPGc+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDAwMDAsNTEyLjAwMDAwMCkgc2NhbGUoMC4xMDAwMDAsLTAuMTAwMDAwKSI+PHBhdGggZD0iTTQ4NTQuMyw1MDAyLjhjLTExMS4yLTQyLjItMTg0LjEtMTAzLjYtMjI2LjMtMTkxLjhjLTM2LjQtNzQuOC00MC4zLTExNy00MC4zLTQyMHYtMzM1LjZsLTE2NC45LTMyLjZjLTI0MS42LTQ3LjktNDMxLjUtMTE1LjEtNjg4LjUtMjM5LjdjLTc5Mi4xLTM4Ny40LTEzNTAuMS0xMTA2LjYtMTU0NS44LTE5OTIuNmMtMzguNC0xNzQuNS00Mi4yLTI2MC44LTU1LjYtMTMzNi43Yy0xMy40LTEwNTIuOS0xNy4zLTExNjYtNTMuNy0xMzM0LjhjLTEyNC43LTU5MC43LTM5Ny0xMDgzLjYtODIwLjgtMTQ5NS45Yy0xODcuOS0xODAuMy0zNTAuOS0zMDYuOC01NTAuNC00MjMuOGwtMTMwLjQtNzQuOGw0Ni04MC41YzI0LjktNDQuMSw4Mi41LTE1MS41LDEyOC41LTIzNy44bDg0LjQtMTU5LjJINTAwMGg0MTYzLjVsODQuNCwxNTkuMmM0Niw4Ni4zLDEwMy42LDE5My43LDEyOC41LDIzNy44bDQ2LDgwLjVsLTEzNC4yLDc4LjZjLTIxOC42LDEyNi42LTQyMS45LDI4OS42LTYyNS4yLDUwMi41Yy0zODEuNywzOTUuMS02MjUuMiw4NjEuMS03NDIuMiwxNDEzLjRjLTM2LjQsMTY4LjgtNDAuMywyODMuOS01My43LDEzMjUuMmMtMTUuMywxMTQ0LjktMTkuMiwxMjA2LjMtOTUuOSwxNTAxLjZjLTI2NC42LDEwMzcuNS0xMTMxLjUsMTg1Ni40LTIxOTUuOSwyMDc1LjFsLTIxMSw0Mi4ybC05LjYsMzUyLjljLTkuNiwzMjcuOS0xMy40LDM1OC42LTUzLjcsNDI1LjdDNTIxMi45LDQ5NzkuNyw1MDAxLjksNTA1Ni41LDQ4NTQuMyw1MDAyLjh6IE00MzM4LjQsMzIxOS4yYzc2LjctMzguNCwxNDAtMTQ1LjgsMTI2LjYtMjIyLjVjLTE1LjMtMTAzLjYtNjEuNC0xNTEuNS0yMTguNi0yMzAuMWMtMzU4LjYtMTgwLjMtNjEzLjctNDM3LjMtNzk3LjgtODAzLjZjLTk5LjctMTk3LjUtMTk1LjYtMjUxLjItMzQ3LjEtMTg4Yy03Mi45LDMwLjctMTI0LjcsMTE1LjEtMTI0LjcsMjAxLjRjMCwxMzguMSwyMTguNiw1MDIuNSw0NDEuMSw3MzguNGMxNzIuNiwxODAuMywzNTguNiwzMjAuMyw1ODQuOSw0MzcuM0M0MTgxLjEsMzI0Niw0MjU1LjksMzI2MS40LDQzMzguNCwzMjE5LjJ6Ii8+PHBhdGggZD0iTTM5MjYtMzgwNy42YzM2LjQtMjY4LjUsMTM4LjEtNDc5LjUsMzE2LjQtNjU3LjhjMjEyLjktMjEyLjksNDU4LjQtMzE0LjUsNzU3LjUtMzE0LjVzNTQ0LjcsMTAxLjcsNzU3LjUsMzE0LjVjMTgwLjMsMTgwLjMsMjgzLjgsMzk1LjEsMzE0LjUsNjU3LjhsMTEuNSw5MC4xSDQ5OTguMUgzOTE0LjVMMzkyNi0zODA3LjZ6Ii8+PC9nPjwvZz4NCjwvc3ZnPg==);mask-size:contain;-webkit-mask-size:contain;mask-repeat:no-repeat;-webkit-mask-repeat:no-repeat;mask-position:center center;-webkit-mask-position:center center;background:#fff;width:60%;height:60%}.wonderpush-bell .wonderpush-icon-container .wonderpush-icon-badge{transition:transform .2s ease-in-out;transform-origin:center center;transform:scale(1);font-size:.8em;width:1.4em;height:1.4em;display:flex;border-radius:1em;background:#000;border:1px solid #fff;align-items:center;justify-content:center;position:absolute;left:10%;top:10%;color:#fff}.wonderpush-bell .wonderpush-paragraph{transition:transform .2s ease-in-out;transform-origin:left;transform:scale(1);background-color:rgba(0,0,0,.8);color:#fff;font-size:14px;font-family:arial,sans-serif;border-radius:4px;padding:.7em 1em;margin-left:12px;position:relative}.wonderpush-bell .wonderpush-paragraph:after{position:absolute;right:100%;bottom:.77em;border:7px solid transparent;border-right-color:rgba(0,0,0,.8);content:' ';width:0;height:0;box-sizing:border-box}.wonderpush-bell .wonderpush-help{transition:transform .2s ease-in-out;transform-origin:bottom left;transform:scale(1);background-size:contain;border:1px solid #ccc;background-repeat:no-repeat;width:280px;height:200px;position:absolute;left:0;bottom:59px;border-radius:4px;box-shadow:0 0 15px rgba(0,0,0,.4)}.wonderpush-bell .wonderpush-help:after,.wonderpush-bell .wonderpush-help:before{position:absolute;top:100%;left:11px;border:11px solid transparent;border-top-color:#fff;content:' ';width:0;height:0;box-sizing:border-box}.wonderpush-bell .wonderpush-help:before{left:10px;border-width:12px;border-top-color:#ccc}.wonderpush-bell .wonderpush-dialog{transition:transform .2s ease-in-out;transform-origin:bottom left;transform:scale(1);position:absolute;width:max-content;min-width:240px;left:0;bottom:59px;border:1px solid #ccc;border-radius:4px;background:#fff;box-shadow:0 0 15px rgba(0,0,0,.4)}.wonderpush-bell .wonderpush-dialog:after,.wonderpush-bell .wonderpush-dialog:before{position:absolute;top:100%;left:11px;border:11px solid transparent;border-top-color:#fff;content:' ';width:0;height:0;box-sizing:border-box}.wonderpush-bell .wonderpush-dialog:before{left:10px;border-width:12px;border-top-color:#ccc}.wonderpush-bell .wonderpush-dialog .wonderpush-dialog-title{color:#333;font-weight:700;text-align:center;font-size:1.1em;padding:1em;border-bottom:1px solid #e0e0e0}.wonderpush-bell .wonderpush-dialog .wonderpush-dialog-button-container{margin:10px;display:flex;justify-content:stretch;align-items:center}.wonderpush-bell .wonderpush-dialog .wonderpush-dialog-settings-button{width:25px;height:25px;background-color:#aaa;transition:background-color .3s ease-in-out;mask-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDQ4IDQ4Ij4KICAgIDxwYXRoIGQ9Ik0wIDBoNDh2NDhoLTQ4eiIgZmlsbD0ibm9uZSIvPgogICAgPHBhdGggZD0iTTM4Ljg2IDI1Ljk1Yy4wOC0uNjQuMTQtMS4yOS4xNC0xLjk1cy0uMDYtMS4zMS0uMTQtMS45NWw0LjIzLTMuMzFjLjM4LS4zLjQ5LS44NC4yNC0xLjI4bC00LTYuOTNjLS4yNS0uNDMtLjc3LS42MS0xLjIyLS40M2wtNC45OCAyLjAxYy0xLjAzLS43OS0yLjE2LTEuNDYtMy4zOC0xLjk3bC0uNzUtNS4zYy0uMDktLjQ3LS41LS44NC0xLS44NGgtOGMtLjUgMC0uOTEuMzctLjk5Ljg0bC0uNzUgNS4zYy0xLjIyLjUxLTIuMzUgMS4xNy0zLjM4IDEuOTdsLTQuOTgtMi4wMWMtLjQ1LS4xNy0uOTcgMC0xLjIyLjQzbC00IDYuOTNjLS4yNS40My0uMTQuOTcuMjQgMS4yOGw0LjIyIDMuMzFjLS4wOC42NC0uMTQgMS4yOS0uMTQgMS45NXMuMDYgMS4zMS4xNCAxLjk1bC00LjIyIDMuMzFjLS4zOC4zLS40OS44NC0uMjQgMS4yOGw0IDYuOTNjLjI1LjQzLjc3LjYxIDEuMjIuNDNsNC45OC0yLjAxYzEuMDMuNzkgMi4xNiAxLjQ2IDMuMzggMS45N2wuNzUgNS4zYy4wOC40Ny40OS44NC45OS44NGg4Yy41IDAgLjkxLS4zNy45OS0uODRsLjc1LTUuM2MxLjIyLS41MSAyLjM1LTEuMTcgMy4zOC0xLjk3bDQuOTggMi4wMWMuNDUuMTcuOTcgMCAxLjIyLS40M2w0LTYuOTNjLjI1LS40My4xNC0uOTctLjI0LTEuMjhsLTQuMjItMy4zMXptLTE0Ljg2IDUuMDVjLTMuODcgMC03LTMuMTMtNy03czMuMTMtNyA3LTcgNyAzLjEzIDcgNy0zLjEzIDctNyA3eiIvPgo8L3N2Zz4K);-webkit-mask-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDQ4IDQ4Ij4KICAgIDxwYXRoIGQ9Ik0wIDBoNDh2NDhoLTQ4eiIgZmlsbD0ibm9uZSIvPgogICAgPHBhdGggZD0iTTM4Ljg2IDI1Ljk1Yy4wOC0uNjQuMTQtMS4yOS4xNC0xLjk1cy0uMDYtMS4zMS0uMTQtMS45NWw0LjIzLTMuMzFjLjM4LS4zLjQ5LS44NC4yNC0xLjI4bC00LTYuOTNjLS4yNS0uNDMtLjc3LS42MS0xLjIyLS40M2wtNC45OCAyLjAxYy0xLjAzLS43OS0yLjE2LTEuNDYtMy4zOC0xLjk3bC0uNzUtNS4zYy0uMDktLjQ3LS41LS44NC0xLS44NGgtOGMtLjUgMC0uOTEuMzctLjk5Ljg0bC0uNzUgNS4zYy0xLjIyLjUxLTIuMzUgMS4xNy0zLjM4IDEuOTdsLTQuOTgtMi4wMWMtLjQ1LS4xNy0uOTcgMC0xLjIyLjQzbC00IDYuOTNjLS4yNS40My0uMTQuOTcuMjQgMS4yOGw0LjIyIDMuMzFjLS4wOC42NC0uMTQgMS4yOS0uMTQgMS45NXMuMDYgMS4zMS4xNCAxLjk1bC00LjIyIDMuMzFjLS4zOC4zLS40OS44NC0uMjQgMS4yOGw0IDYuOTNjLjI1LjQzLjc3LjYxIDEuMjIuNDNsNC45OC0yLjAxYzEuMDMuNzkgMi4xNiAxLjQ2IDMuMzggMS45N2wuNzUgNS4zYy4wOC40Ny40OS44NC45OS44NGg4Yy41IDAgLjkxLS4zNy45OS0uODRsLjc1LTUuM2MxLjIyLS41MSAyLjM1LTEuMTcgMy4zOC0xLjk3bDQuOTggMi4wMWMuNDUuMTcuOTcgMCAxLjIyLS40M2w0LTYuOTNjLjI1LS40My4xNC0uOTctLjI0LTEuMjhsLTQuMjItMy4zMXptLTE0Ljg2IDUuMDVjLTMuODcgMC03LTMuMTMtNy03czMuMTMtNyA3LTcgNyAzLjEzIDcgNy0zLjEzIDctNyA3eiIvPgo8L3N2Zz4K);mask-size:contain;-webkit-mask-size:contain;margin-right:5px;cursor:pointer}.wonderpush-bell .wonderpush-dialog .wonderpush-dialog-settings-button:hover{background-color:#777}.wonderpush-bell .wonderpush-dialog .wonderpush-dialog-button{padding:7px 10px;flex-grow:1;border-radius:4px;background-color:#ff6f61;color:#fff;text-align:center;cursor:pointer;text-transform:uppercase}.wonderpush-bell .wonderpush-dialog .wonderpush-notification{margin:15px;border:1px solid #ddd;border-radius:4px;overflow:hidden;height:63px;box-shadow:0 0 3px rgba(0,0,0,.3)}.wonderpush-bell .wonderpush-dialog .wonderpush-notification .wonderpush-notification-icon{width:53px;height:53px;float:left;margin-top:5px;margin-left:5px;background-color:#f3f3f3;background-size:cover}.wonderpush-bell .wonderpush-dialog .wonderpush-notification .wonderpush-notification-paragraph-small{height:6px;background-color:#eee;margin:8px 5px 0 63px;width:80px}.wonderpush-bell .wonderpush-dialog .wonderpush-notification .wonderpush-notification-paragraph-medium{height:6px;background-color:#eee;margin:8px 5px 0 63px;width:100px}.wonderpush-bell .wonderpush-dialog .wonderpush-notification .wonderpush-notification-paragraph-large{height:6px;background-color:#eee;margin:8px 5px 0 63px;width:120px}.wonderpush-bell .wonderpush-dialog .wonderpush-dialog-advanced-settings{transition:all .2s ease-in-out;height:57px;overflow:hidden;box-sizing:content-box;border-top:1px solid #efefef;padding:15px;text-align:center}.wonderpush-bell .wonderpush-dialog .wonderpush-dialog-advanced-settings.wonderpush-collapsed{height:0;padding:0}.wonderpush-bell .wonderpush-dialog .wonderpush-dialog-advanced-settings .wonderpush-dialog-advanced-settings-description{font-size:12px}.wonderpush-bell .wonderpush-dialog .wonderpush-dialog-advanced-settings .wonderpush-dialog-advanced-settings-button-container{margin:10px 0;display:flex;justify-content:stretch;align-items:center}.wonderpush-bell .wonderpush-dialog .wonderpush-dialog-advanced-settings .wonderpush-dialog-advanced-settings-button-container .wonderpush-dialog-advanced-settings-download-button{margin-right:5px}.wonderpush-bell .wonderpush-dialog .wonderpush-dialog-advanced-settings .wonderpush-dialog-advanced-settings-button-container .wonderpush-dialog-advanced-settings-clear-button,.wonderpush-bell .wonderpush-dialog .wonderpush-dialog-advanced-settings .wonderpush-dialog-advanced-settings-button-container .wonderpush-dialog-advanced-settings-download-button{opacity:.7;transition:all .15s ease-in-out;cursor:pointer;border-radius:4px;padding:3px 5px;text-align:center;flex-grow:1;background-color:#fff;color:#ff6f61;font-size:.9em;border:1px solid #ff6f61;text-transform:uppercase}.wonderpush-bell .wonderpush-dialog .wonderpush-dialog-advanced-settings .wonderpush-dialog-advanced-settings-button-container .wonderpush-dialog-advanced-settings-clear-button:hover,.wonderpush-bell .wonderpush-dialog .wonderpush-dialog-advanced-settings .wonderpush-dialog-advanced-settings-button-container .wonderpush-dialog-advanced-settings-download-button:hover{opacity:1}.wonderpush-bell .wonderpush-dialog .wonderpush-dialog-advanced-settings .wonderpush-dialog-advanced-settings-fineprint{font-size:10px;color:#aaa}.wonderpush-bell.wonderpush-right{left:unset;right:20px;flex-direction:row-reverse}.wonderpush-bell.wonderpush-right .wonderpush-paragraph{transition:transform .2s ease-in-out;transform-origin:right;transform:scale(1);margin-left:unset;margin-right:12px;pointer-events:none}.wonderpush-bell.wonderpush-right .wonderpush-paragraph:after{position:absolute;right:unset;left:100%;border-right-color:transparent;border-left-color:rgba(0,0,0,.8)}.wonderpush-bell.wonderpush-right .wonderpush-dialog{transition:transform .2s ease-in-out;transform-origin:bottom right;transform:scale(1);left:unset;right:0}.wonderpush-bell.wonderpush-right .wonderpush-dialog:after{left:unset;right:11px}.wonderpush-bell.wonderpush-right .wonderpush-help{transition:transform .2s ease-in-out;transform-origin:bottom right;transform:scale(1);left:unset;right:0}.wonderpush-bell.wonderpush-right .wonderpush-help:after{left:unset;right:11px}")),document.head.appendChild(o);var p=new function(e){e=e||{},this.element=window.document.createElement("div"),this.element.classList.add(i+"bell"),[{cls:"icon-container",name:"iconContainer"},{cls:"icon",name:"icon",parent:"iconContainer"},{cls:"icon-badge",name:"iconBadge",parent:"iconContainer"},{cls:"paragraph",name:"paragraph"},{cls:"help",name:"help"},{cls:"dialog",name:"dialog"},{cls:"dialog-title",name:"dialogTitle",parent:"dialog"},{cls:"notification",name:"notification",parent:"dialog"},{cls:"notification-icon",name:"notificationIcon",parent:"notification"},{cls:"notification-paragraph-large",parent:"notification"},{cls:"notification-paragraph-medium",parent:"notification"},{cls:"notification-paragraph-large",parent:"notification"},{cls:"notification-paragraph-small",parent:"notification"},{cls:"dialog-button-container",name:"dialogButtonContainer",parent:"dialog"},{cls:"dialog-settings-button",name:"dialogSettingsButton",parent:"dialogButtonContainer"},{cls:"dialog-button",name:"dialogButton",parent:"dialogButtonContainer"},{cls:"dialog-advanced-settings",name:"dialogAdvancedSettings",parent:"dialog"},{cls:"dialog-advanced-settings-description",name:"dialogAdvancedSettingsDescription",parent:"dialogAdvancedSettings"},{cls:"dialog-advanced-settings-button-container",name:"dialogAdvancedSettingsButtonContainer",parent:"dialogAdvancedSettings"},{cls:"dialog-advanced-settings-download-button",name:"dialogAdvancedSettingsDownloadButton",parent:"dialogAdvancedSettingsButtonContainer"},{cls:"dialog-advanced-settings-clear-button",name:"dialogAdvancedSettingsClearButton",parent:"dialogAdvancedSettingsButtonContainer"},{cls:"dialog-advanced-settings-fineprint",name:"dialogAdvancedSettingsFineprint",parent:"dialogAdvancedSettings"}].forEach(function(e){var t=window.document.createElement("div");e.name&&(this[e.name]=t),this[e.parent||"element"].appendChild(t),t.classList.add(i+e.cls)}.bind(this)),e.hidePrivacySettings&&(this.dialogSettingsButton.style.display="none"),this.isCollapsed=function(e){var t="string"==typeof e?this[e]:e;return!!t&&t.classList.contains(i+"collapsed")}.bind(this),this.collapse=function(e){var t="string"==typeof e?this[e]:e;if(t){if(t.classList.contains(i+"collapsed"))return Promise.resolve();t.classList.add(i+"collapsed");var n=this.element.parentNode?c(t):Promise.resolve();return t===this.dialog?n.then(function(){this.collapse(this.dialogAdvancedSettings)}.bind(this)):t===this.paragraph&&n.then(function(){this.paragraph.classList.add(i+"hidden")}.bind(this)),n}}.bind(this),this.uncollapse=function(e){var t="string"==typeof e?this[e]:e;if(t)return t.classList.contains(i+"collapsed")?(t.classList.remove(i+"collapsed"),t.classList.remove(i+"hidden"),c(t)):Promise.resolve()}.bind(this),this.toggleCollapse=function(e){var t="string"==typeof e?this[e]:e;if(t)return t.classList.contains(i+"collapsed")?this.uncollapse(t):this.collapse(t)}.bind(this),this.deactivate=function(){if(!this.element.classList.contains(i+"deactivated"))return this.element.classList.add(i+"deactivated"),c(this.element).then(function(){this.element.classList.add(i+"hidden")}.bind(this))}.bind(this),this.activate=function(){if(this.element.classList.contains(i+"deactivated"))return this.element.classList.remove(i+"hidden"),setTimeout(function(){this.element.classList.remove(i+"deactivated")}.bind(this),0),c(this.element)},e.notificationIcon&&(this.notificationIcon.style.backgroundImage="url("+e.notificationIcon.replace("(","%28").replace(")","%29")+")"),this.dialogTitle.textContent=e.dialogTitle||a("Manage Notifications"),this.dialogAdvancedSettingsDescription.textContent=e.advancedSettingsDescription||a("Your personal notification data:"),e.advancedSettingsFineprint?this.dialogAdvancedSettingsFineprint.textContent=e.advancedSettingsFineprint:this.dialogAdvancedSettingsFineprint.innerHTML=a("WonderPush fully supports european GDPR").replace("WonderPush",'<a href="https://www.wonderpush.com/">WonderPush</a>'),this.dialogAdvancedSettingsClearButton.textContent=e.clearDataButtonTitle||a("Clear"),this.dialogAdvancedSettingsDownloadButton.textContent=e.downloadDataButtonTitle||a("Download"),this.dialogSettingsButton.addEventListener("click",function(){this.toggleCollapse(this.dialogAdvancedSettings)}.bind(this)),this.iconBadge.textContent="1",this.collapse("help"),this.collapse("dialog"),this.collapse("paragraph"),this.collapse("iconBadge"),this.collapse("dialogAdvancedSettings")}({notificationIcon:t.notificationIcon||e.getNotificationIcon(),dialogTitle:t.dialogTitle,hidePrivacySettings:t.hidePrivacySettings,clearDataButtonTitle:t.clearDataButtonTitle,downloadDataButtonTitle:t.downloadDataButtonTitle,advancedSettingsDescription:t.advancedSettingsDescription,advancedSettingsFineprint:t.advancedSettingsFineprint});if(this.showBell=function(){function e(){window.document.body.appendChild(p.element)}"loading"===window.document.readyState?window.document.addEventListener("DOMContentLoaded",e):e()}.bind(this),this.hideBell=function(){p.element&&p.element.parentNode&&p.element.parentNode.removeChild(p.element)},this.updateTexts=function(){switch(e.Notification.getSubscriptionState()){case e.SubscriptionState.DENIED:p.dialogButton.textContent="",p.paragraph.textContent=t.blockedText||a("You've blocked notifications"),p.help.style.backgroundImage="url(https://cdn.by.wonderpush.com/plugins/optin-bell/1.0.0/allow-notifications.jpg)";break;case e.SubscriptionState.SUBSCRIBED:p.dialogButton.textContent=t.unsubscribeButtonTitle||a("Unsubscribe"),p.paragraph.textContent=t.alreadySubscribedText||a("You're subscribed to notifications");break;case e.SubscriptionState.UNSUBSCRIBED:p.dialogButton.textContent=t.subscribeButtonTitle||a("Subscribe"),p.paragraph.textContent=t.alreadyUnsubscribedText||a("You are not receiving any notifications");break;case e.SubscriptionState.UNDETERMINED:p.dialogButton.textContent=a("Loading"),p.paragraph.textContent=a("Loading");break;case e.SubscriptionState.NOT_SUBSCRIBED:p.dialogButton.textContent=a("Subscribe"),p.paragraph.textContent=t.subscribeInviteText||a("Click to subscribe to notifications")}},this.updateDiscretion=function(){e.Notification.getSubscriptionState()===e.SubscriptionState.SUBSCRIBED&&p.isCollapsed(p.dialog)&&p.isCollapsed(p.help)&&p.element.classList.add(i+"discrete")}.bind(this),window.addEventListener("WonderPushEvent",function(n){n.detail&&n.detail.state&&"subscription"===n.detail.name&&(this.updateTexts(),p.collapse(p.dialog),p.collapse(p.help),p.collapse(p.iconBadge),n.detail.state===e.SubscriptionState.UNSUBSCRIBED&&(p.paragraph.textContent=t.unsubscribedText||a("You won't receive more notifications"),setTimeout(function(){p.collapse(p.paragraph),this.updateTexts(),t.hideWhenSubscribed&&p.activate()}.bind(this),1200)),n.detail.state===e.SubscriptionState.SUBSCRIBED&&(p.paragraph.textContent=t.subscribedText||a("Thanks for subscribing!"),p.uncollapse(p.paragraph),setTimeout(function(){t.hideWhenSubscribed?p.deactivate():(p.element.classList.add(i+"discrete"),p.collapse(p.paragraph).then(function(){this.updateTexts()}.bind(this)))}.bind(this),1200)),n.detail.state===e.SubscriptionState.DENIED&&(p.element.classList.remove(i+"discrete"),p.uncollapse(p.paragraph),t.hideWhenSubscribed&&p.activate(),setTimeout(function(){p.collapse(p.paragraph)}.bind(this),1200)))}.bind(this)),p.dialogButton.addEventListener("click",(function(t){switch(e.Notification.getSubscriptionState()){case e.SubscriptionState.SUBSCRIBED:e.setNotificationEnabled(!1,t).then((function(){p.collapse(p.dialog),p.uncollapse(p.paragraph)}),n);break;case e.SubscriptionState.UNSUBSCRIBED:e.setNotificationEnabled(!0,t).catch(n),p.collapse(p.dialog)}})),p.dialogAdvancedSettingsDownloadButton.addEventListener("click",(function(t){e.Data.downloadExport()})),p.dialogAdvancedSettingsClearButton.addEventListener("click",function(t){window.confirm(a("This action will clear all the data used to send you targeted push notifications. Are you sure ?"))&&(p.collapse(p.dialog),e.Data.clearAll().then(function(){p.paragraph.textContent=a("Data successfully cleared"),p.uncollapse(p.paragraph),setTimeout(function(){p.collapse(p.paragraph),this.updateTexts()}.bind(this),1200)}.bind(this)))}.bind(this)),p.iconContainer.addEventListener("mouseenter",(function(){p.collapse(p.iconBadge),p.isCollapsed(p.dialog)&&p.uncollapse(p.paragraph)})),p.iconContainer.addEventListener("mouseleave",function(){this.updateDiscretion(),p.collapse(p.paragraph).then(function(){this.updateTexts()}.bind(this))}.bind(this)),p.iconContainer.addEventListener("click",(function(o){if(p.isCollapsed(p.dialog)){var r=e.Notification.getSubscriptionState();switch(r){case e.SubscriptionState.DENIED:e.isOnRightDomain()&&(p.uncollapse(p.help),p.collapse(p.paragraph),p.element.classList.remove(i+"discrete"));break;case e.SubscriptionState.SUBSCRIBED:case e.SubscriptionState.UNSUBSCRIBED:p.dialogSettingsButton.style.display=t.hidePrivacySettings?"none":r===e.SubscriptionState.SUBSCRIBED?"":"none",p.uncollapse(p.dialog),p.collapse(p.paragraph),p.element.classList.remove(i+"discrete");break;case e.SubscriptionState.NOT_SUBSCRIBED:e.setNotificationEnabled(!0,o).catch(n),p.collapse(p.dialog)}}else p.collapse(p.dialog)})),window.document.addEventListener("click",function(e){p.element.contains(e.srcElement)||(p.collapse(p.dialog),p.collapse(p.help),this.updateDiscretion(),this.updateTexts())}.bind(this)),t.style)for(var d in t.style)p.element.style[d]=t.style[d];"right"===t.position&&p.element.classList.add(i+"right"),t.color&&(p.iconContainer.style.backgroundColor=t.color,p.dialogButton.style.backgroundColor=t.color,p.dialogAdvancedSettingsClearButton.style.color=t.color,p.dialogAdvancedSettingsDownloadButton.style.color=t.color,p.dialogAdvancedSettingsClearButton.style.borderColor=t.color,p.dialogAdvancedSettingsDownloadButton.style.borderColor=t.color),t.bellIcon&&(p.icon.style.maskImage=p.icon.style.webkitMaskImage="url("+t.bellIcon+")"),this.showBell(),this.updateTexts(),e.Notification.getSubscriptionState()===e.SubscriptionState.SUBSCRIBED&&(p.element.classList.add(i+"discrete"),p.collapse(p.iconBadge)),t.hideWhenSubscribed&&e.Notification.getSubscriptionState()===e.SubscriptionState.SUBSCRIBED&&(p.element.classList.add(i+"hidden"),p.element.classList.add(i+"deactivated")),t.hasOwnProperty("showBadge")&&!t.showBadge||e.Storage.get("badgeShown").then((function(t){t.badgeShown||(e.Storage.set("badgeShown",!0),p.uncollapse(p.iconBadge))}))}})}))}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e._protected.Plugins.preregisterInlinedPlugin("tag-switch","1.1.4",(function(){WonderPush.registerPlugin("tag-switch",(function(e,t){var n;(n=document.createElement("style")).type="text/css",n.appendChild(document.createTextNode(".wp-tag-switch{position:relative;display:inline-block;vertical-align:middle;width:auto;height:auto;padding:.2em;border-radius:1.25em;box-shadow:inset 0 -1px rgba(0,0,0,.05),inset 0 1px 1px rgba(0,0,0,.05);cursor:pointer;background-image:linear-gradient(to bottom,rgba(0,0,0,.2),rgba(255,255,255,.3) 1.5em)}.wp-tag-switch-input{display:none!important}.wp-tag-switch-label{position:relative;display:block;height:2em;font-size:60%;text-transform:uppercase;background:#eceeef;border-radius:inherit;box-shadow:inset 0 1px 2px rgba(0,0,0,.12),inset 0 0 2px rgba(0,0,0,.15);transition:.15s ease-out;transition-property:opacity,background}.wp-tag-switch-label:after,.wp-tag-switch-label:before{line-height:0;clear:both;transition:inherit;white-space:nowrap;display:inline-block}.wp-tag-switch-label:before{content:attr(data-off);right:1em;color:#aaa;text-shadow:0 1px rgba(255,255,255,.5);float:right;margin-top:1em;margin-right:1em;margin-left:2.5em}.wp-tag-switch-label:after{content:attr(data-on);left:1em;color:#fff;text-shadow:0 1px rgba(0,0,0,.2);opacity:0;float:left;margin-top:0;margin-left:1em;margin-right:2.5em}.wp-tag-switch-input:checked~.wp-tag-switch-label{background:#47a8d8;box-shadow:inset 0 1px 2px rgba(0,0,0,.15),inset 0 0 3px rgba(0,0,0,.2)}.wp-tag-switch-input:checked~.wp-tag-switch-label:before{opacity:0}.wp-tag-switch-input:checked~.wp-tag-switch-label:after{opacity:1}.wp-tag-switch-handle{position:absolute;top:.24em;left:.24em;width:1.125em;height:1.125em;background:#fff;border-radius:100%;box-shadow:1px 1px 5px rgba(0,0,0,.2);background-image:linear-gradient(to bottom,#fff 40%,#f0f0f0);transition:.15s ease-out;transition-property:left,margin-left}.wp-tag-switch-handle:before{content:'';position:absolute;top:0;left:0;margin:.1875em 0 0 .1875em;width:.75em;height:.75em;background:#f9f9f9;border-radius:100%;box-shadow:inset 0 1px rgba(0,0,0,.02);background-image:linear-gradient(to bottom,#eee,#fff)}.wp-tag-switch-input:checked~.wp-tag-switch-handle{left:100%;margin-left:-1.365em;box-shadow:-1px 1px 5px rgba(0,0,0,.2)}.wp-tag-switch-input:disabled~.wp-tag-switch-handle{background-image:linear-gradient(to bottom,silver 40%,grey)}.wp-tag-switch-input:disabled~.wp-tag-switch-handle:before{background:#b0b0b0}.wp-tag-switch-input:disabled~.wp-tag-switch-label{background:silver}.wp-tag-switch-input:disabled~.wp-tag-switch-label:before{color:#eee}.wp-tag-switch-off-gray>.wp-tag-switch-label{background:#eceeef}.wp-tag-switch-off-gray>.wp-tag-switch-label:before{color:#aaa;text-shadow:0 1px rgba(255,255,255,.5)}.wp-tag-switch-off-grey>.wp-tag-switch-label{background:#eceeef}.wp-tag-switch-off-grey>.wp-tag-switch-label:before{color:#aaa;text-shadow:0 1px rgba(255,255,255,.5)}.wp-tag-switch-off-red>.wp-tag-switch-label{background:#ed2121}.wp-tag-switch-off-red>.wp-tag-switch-label:before{color:#fff;text-shadow:0 1px rgba(0,0,0,.2)}.wp-tag-switch-on-green>.wp-tag-switch-input:checked~.wp-tag-switch-label{background:#4fb845;text-shadow:0 1px rgba(0,0,0,.2)}.wp-tag-switch-on-blue>.wp-tag-switch-input:checked~.wp-tag-switch-label{background:#47a8d8;text-shadow:0 1px rgba(0,0,0,.2)}")),document.head.appendChild(n);var o=t.switchElementClass||"wonderpush-tag-switch",r=function(){"loading"!==document.readyState?this.setupTagSwitch():document.addEventListener("DOMContentLoaded",function(){this.setupTagSwitch()}.bind(this))}.bind(this);this.setupTagSwitch=function(){if(null!==t.switchElementClass){var n=document.querySelectorAll("."+o);if(n.length){var r=t.unsupported||"",s="true"===t.includeUnsupported,a=t.classPrefix||"wp-tag-",c=t.prepend||"",p=t.append||"",d=t.sentence||"",u=t.cssClass||"",l=t.label,h=t.on||l||"ON",g=t.off||l||"OFF",f=t.colorOn,m=t.colorOff;return Promise.all([e.getProperties(),e.getTags()]).then((function(t){var o=t[0],_=t[1];Array.prototype.slice.call(n).forEach((function(t){if(t&&"true"!==t.dataset.wpInitialized){t.dataset.wpInitialized="true";var n=s||"true"===t.dataset.includeUnsupported;if(n||e.isNativePushNotificationSupported()){var v=!!t.dataset.tag,w=!!t.dataset.field&&!!t.dataset.value;if(v&&w&&e.logWarn("In the presence of a tag data attribute, field and value data attributes are ignored for",t),v||w){var y=t.dataset.classPrefix||a;t.innerHTML=(t.dataset.prepend||c)+'<div class="'+y+'switch-wrapper"></div>'+(t.dataset.append||p);var b=t.querySelector("."+y+"switch-wrapper"),S=document.createElement("SPAN");S.innerHTML=t.dataset.sentence||d;var E=document.createElement("LABEL");E.classList.add(y+"switch"),E.className+=" "+(t.dataset.class||u),(t.dataset.colorOn||f)&&E.classList.add(y+"switch-on-"+(t.dataset.colorOn||f)),(t.dataset.colorOff||m)&&E.classList.add(y+"switch-off-"+(t.dataset.colorOff||m));var I=document.createElement("INPUT");I.id=t.id+"-input",I.type="checkbox",I.classList.add(y+"switch-input"),E.appendChild(I);var C=document.createElement("SPAN");C.classList.add(y+"switch-label"),C.dataset.on=t.dataset.label||t.dataset.on||l||h,C.dataset.off=t.dataset.label||t.dataset.off||l||g,E.appendChild(C);var T,P=document.createElement("SPAN");if(P.classList.add(y+"switch-handle"),E.appendChild(P),I.addEventListener("click",i),I.disabled=!e.isNativePushNotificationSupported()&&!n,v)I.checked=0<=_.indexOf(t.dataset.tag);else{var N=null==(T=o[t.dataset.field])?[]:Array.isArray(T)?T:[T];I.checked=0<=N.indexOf(t.dataset.value)}b.appendChild(S),b.appendChild(E)}else e.logWarn("Missing tag, or both field and value data attribute for",t)}else t.innerHTML=t.dataset.unsupported||r}}))}))}}};var i=function(t){var n=t.target.closest("."+o),r=t.target.checked;r&&e.isNativePushNotificationSupported()&&e.subscribeToNotifications(t),n.dataset.tag?r?WonderPush.addTag(n.dataset.tag):WonderPush.removeTag(n.dataset.tag):r?WonderPush.addProperty(n.dataset.field,n.dataset.value):WonderPush.removeProperty(n.dataset.field,n.dataset.value)};r()}))}))}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e.prototype.Developer=new function(){this.invalidateConfig=function(){return Promise.all([e._protected.Config.invalidateConfig(),e._protected.Integration.callOnCustomDomain("WonderPushSDK._protected.Config.invalidateConfig",[])]).then((function(){}),(function(t){throw e._protected.Helper.warn("[developer   ]","Failed to invalidate config",t),new e.prototype.Errors.InternalError("Failed to invalidate config")}))}}}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){return function(e){e.preInstantiationPromise.then(()=>(e._protected.Blocker.category("requestvault").add("consent"),e._protected.Consent.awaitUserConsent())).then(()=>{e._protected.Blocker.category("requestvault").remove("consent")})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o;void 0===(o=function(){let e=!1;const t=new Set(["constructor"]);return function(n){const o=new n._protected.Promise.Deferred,r=new Set(["init","ready","push","registerPlugin","Constants","Errors","setUserConsent","getUserConsent","clearAllData","clearEventsHistory","clearPreferences","downloadAllData"]);n._protected.Api={},n._protected.Api.proxify=(o,r,i=new Set)=>new Proxy(o,{get:(o,s)=>{if(!(t.has(s)||i.has(s)||e))switch(typeof o[s]){case"object":return n._protected.Api.proxify(o[s],`${r}.${s}`);case"function":return()=>Promise.reject(new n.prototype.Errors.ConsentError(`Cannot call ${r}.${s} without user consent. Consider calling WonderPush.setUserConsent(true) after prompting the user.`));default:return o[s]}return o[s]}}),n._protected.Api.proxifyPublicSDK=function(){n.this=n._protected.Api.proxify(n.this,"WonderPush",r)};const i=()=>n._protected.Consent.hasUserConsent().then(t=>{e=t});return n.preInstantiationPromise.then(()=>n._protected.Consent.getModuleInitializationPromise()).then(()=>{n._protected.Integration.addBroadcastListener(n._protected.Constants.BROADCAST_TYPE_SET_USER_CONSENT,()=>{i()}),i().then(o.resolve)}),o.promise}}.apply(t,[]))||(e.exports=o)},function(e,t,n){var o,r;let i,s;o=[n(101),n(17),n(102)],void 0===(r=function(e,t,n){return function(o){switch(o._protected.Helper.decodeQueryString(location.search).amp){case"frame":(i=new e.AmpWebPushHelperFrame({debug:!1,WonderPushSDK:o})).run();break;case"dialog":o._protected.PopupUI.getModuleInitializationPromise().then(()=>{(s=new n.AmpWebPushPermissionDialog({debug:!1,defaultHTML:o._protected.PopupUI.permissionUI(),needUserGestureToAskPermission:o._protected.Notification.needUserGestureToAskPermission(),PromisePoll:o._protected.Promise.Poll})).run()})}if(o._protected.RunModes.Behaviors.ContextServiceWorker){const e=()=>o._protected.Config.getModuleInitializationPromise().then(()=>({applicationServerKey:o._protected.Helper.arrayBufferFromBase64UrlSafe(o._protected.Options.getApplicationServerKey()||""),onSubscribe:e=>e?Promise.all([o._protected.Notification.setManuallyUnsubscribed(!1),o._protected.Installation.addInstallationPushToken(e)]):Promise.resolve(),onUnsubscribe:()=>o._protected.Notification.setManuallyUnsubscribed(!0),getManuallyUnsubscribed:()=>o._protected.Notification.getManuallyUnsubscribed()}));t.registerListeners(e,o._protected.ServiceWorker.addEventListener)}}}.apply(t,o))||(e.exports=r)},function(e,t,n){"use strict";n.r(t),n.d(t,"HelperFrameOptions",(function(){})),n.d(t,"ServiceWorkerMessage",(function(){})),n.d(t,"ServiceWorkerRegistrationMessage",(function(){})),n.d(t,"NotificationPermissionStateMessage",(function(){})),n.d(t,"StorageGetMessage",(function(){})),n.d(t,"AmpWebPushHelperFrame",(function(){return a}));var o=n(0),r=n(1),i=n(4),s=n(17);class a{constructor(e){this.WonderPushSDK_=e&&e.WonderPushSDK,this.debug_=e&&e.debug,this.window_=e.windowContext||window,this.ampMessenger_=new r.a({debug:this.debug_,windowContext:this.window_}),this.allowedWorkerMessageTopics_={}}replyToFrameWithPayload_(e,t,n,o){e({success:t,error:t?void 0:n,result:t?o:void 0})}onAmpPageMessageReceivedNotificationPermissionState_(e,t){if(e&&e.isQueryTopicSupported){let n=!1;for(const t in r.a.Topics)e.isQueryTopicSupported===r.a.Topics[t]&&(n=!0);this.replyToFrameWithPayload_(t,!0,null,n)}else this.replyToFrameWithPayload_(t,!0,null,Notification.permission)}onAmpPageMessageReceivedStorageGet_(e,t){let n=null;try{e&&e.key&&this.window_.localStorage?n=this.window_.localStorage.getItem(e.key):console.warn(o.c,"LocalStorage retrieval failed.")}catch(e){}this.replyToFrameWithPayload_(t,!0,null,n)}onAmpPageMessageReceivedServiceWorkerState_(e,t){const n={isControllingFrame:!!this.window_.navigator.serviceWorker.controller,url:this.window_.navigator.serviceWorker.controller?this.window_.navigator.serviceWorker.controller.scriptURL:null,state:this.window_.navigator.serviceWorker.controller?this.window_.navigator.serviceWorker.controller.state:null};this.replyToFrameWithPayload_(t,!0,null,n)}onAmpPageMessageReceivedServiceWorkerRegistration_(e,t){if(!e||!e.workerUrl||!e.registrationOptions)throw new Error("Expected arguments workerUrl and registrationOptions in message, got:",e);this.window_.navigator.serviceWorker.register(e.workerUrl,e.registrationOptions).then(()=>{this.replyToFrameWithPayload_(t,!0,null,null)}).catch(e=>{this.replyToFrameWithPayload_(t,!0,null,e?e.message||e.toString():null)})}messageServiceWorker(e){this.window_.navigator.serviceWorker.controller.postMessage({command:e.topic,payload:e.payload})}onAmpPageMessageReceivedServiceWorkerQuery_(e,t){if(!e||!e.topic)throw new Error("Expected argument topic in message, got:",e);new Promise(t=>{this.allowedWorkerMessageTopics_[e.topic]=t,this.waitUntilWorkerControlsPage().then(()=>{this.messageServiceWorker(e)})}).then(n=>(delete this.allowedWorkerMessageTopics_[e.topic],this.replyToFrameWithPayload_(t,!0,null,n)))}getParentOrigin_(){const e=Object(i.a)(this.window_.location.search);if(!e.parentOrigin)throw new Error("Expecting parentOrigin URL query parameter.");return e.parentOrigin}onPageMessageReceivedFromServiceWorker_(e){const{command:t,payload:n}=e.data,o=this.allowedWorkerMessageTopics_[t];t===s.WorkerMessengerCommand.AMP_SUBSCRIBE&&this.WonderPushSDK_&&this.WonderPushSDK_._protected.Installation.updateInstallationCoreProperties(),"function"==typeof o&&o(n)}isWorkerControllingPage_(){return this.window_.navigator.serviceWorker&&this.window_.navigator.serviceWorker.controller&&"activated"===this.window_.navigator.serviceWorker.controller.state}waitUntilWorkerControlsPage(){return new Promise(e=>{this.isWorkerControllingPage_()?e():this.window_.navigator.serviceWorker.addEventListener("controllerchange",()=>{this.isWorkerControllingPage_()?e():this.window_.navigator.serviceWorker.controller.addEventListener("statechange",()=>{this.isWorkerControllingPage_()&&e()})})})}run(e){this.ampMessenger_.on(r.a.Topics.NOTIFICATION_PERMISSION_STATE,this.onAmpPageMessageReceivedNotificationPermissionState_.bind(this)),this.ampMessenger_.on(r.a.Topics.SERVICE_WORKER_STATE,this.onAmpPageMessageReceivedServiceWorkerState_.bind(this)),this.ampMessenger_.on(r.a.Topics.SERVICE_WORKER_REGISTRATION,this.onAmpPageMessageReceivedServiceWorkerRegistration_.bind(this)),this.ampMessenger_.on(r.a.Topics.SERVICE_WORKER_QUERY,this.onAmpPageMessageReceivedServiceWorkerQuery_.bind(this)),this.ampMessenger_.on(r.a.Topics.STORAGE_GET,this.onAmpPageMessageReceivedStorageGet_.bind(this)),this.waitUntilWorkerControlsPage().then(()=>{this.window_.navigator.serviceWorker.addEventListener("message",this.onPageMessageReceivedFromServiceWorker_.bind(this))}),this.ampMessenger_.listen([e||this.getParentOrigin_()])}}},function(e,t,n){"use strict";n.r(t),n.d(t,"PermissionDialogOptions",(function(){})),n.d(t,"AmpWebPushPermissionDialog",(function(){return a}));var o=n(0),r=n(1),i=n(4);const s=n(10);class a{constructor(e){this.debug_=e&&e.debug,this.PromisePoll=e&&e.PromisePoll,this.window_=e.windowContext||window,this.defautHTML_=e.defaultHTML,this.needUserGestureToAskPermission=e.needUserGestureToAskPermission,this.ampMessenger_=new r.a({debug:this.debug_,windowContext:this.window_})}isCurrentDialogPopup(){return!!this.window_.opener&&this.window_.opener!==this.window_}requestNotificationPermission(){return this.needUserGestureToAskPermission?new this.PromisePoll(()=>"default"!==Notification.permission,Number.POSITIVE_INFINITY,250).wait().then(()=>Notification.permission):new Promise((e,t)=>{try{this.window_.Notification.requestPermission(t=>e(t))}catch(e){t(e)}})}run(){this.onCloseIconClick_(),this.storeNotificationPermission_(),this.showTargetPermissionSection_(),this.showPostloadSection_(),this.showDefaultUI_(),this.window_.Notification.permission!==o.a.DENIED?this.onPermissionDefaultOrGranted_():this.onPermissionDenied_()}showDefaultUI_(){const e=this.defautHTML_,t=this.window_.document.querySelector("#whole-content");if(e&&t){t.innerHTML=s.sanitize(e);const n=e=>{e.addEventListener("click",(function(e){e.preventDefault(),window.close()}))};t.querySelectorAll(".wonderpush-close-button").forEach(n),t.querySelectorAll(".wp-popup-negative-button").forEach(n),t.querySelectorAll(".wp-popup-positive-button").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),WonderPush.subscribeToNotifications(e)})})}}onCloseIconClick_(){const e=this.window_.document.querySelector("#close");e&&e.addEventListener("click",()=>{this.closeDialog()})}closeDialog(){if(this.isCurrentDialogPopup())this.window_.close();else{const e=this.window_.fakeLocation||this.window_.location,t=Object(i.a)(e.search);if(!t.return)throw new Error("Missing required parameter.");const n=Object(i.c)(t.return);this.redirectToUrl(n)}}onPermissionDenied_(){navigator.permissions.query({name:"notifications"}).then(e=>{e.onchange=()=>{switch(this.storeNotificationPermission_(),this.window_.Notification.permission){case o.a.DEFAULT:case o.a.GRANTED:this.onPermissionDefaultOrGranted_()}}})}storeNotificationPermission_(){this.window_.localStorage.setItem(o.b.NOTIFICATION_PERMISSION,this.window_.Notification.permission)}showTargetPermissionSection_(){const e=this.window_.document.querySelectorAll("[permission]");for(let t=0;t<e.length;t++){const n=e[t];this.setDomElementVisibility_(n,!1)}const t=this.window_.document.querySelector(`[permission=${this.window_.Notification.permission}]`);t&&this.setDomElementVisibility_(t,!0)}showPostloadSection_(){const e=this.window_.document.querySelector("#preload"),t=this.window_.document.querySelector("#postload");e&&t&&(this.setDomElementVisibility_(e,!1),this.setDomElementVisibility_(t,!0))}setDomElementVisibility_(e,t){e&&(t?e.classList.remove("invisible"):e.classList.add("invisible"))}onPermissionDefaultOrGranted_(){return this.requestNotificationPermission().then(e=>{if(this.storeNotificationPermission_(),this.isCurrentDialogPopup())return this.ampMessenger_.connect(opener,"*"),this.ampMessenger_.send(r.a.Topics.NOTIFICATION_PERMISSION_STATE,e).then(e=>{const t=e[0];t&&t.closeFrame&&this.closeDialog()});this.closeDialog()})}redirectToUrl(e){const t=Object(i.b)(e);!t||"http:"!==t.protocol&&"https:"!==t.protocol||(this.window_.location.href=e)}}},function(e,t,n){var o;let r=null;void 0===(o=function(){return function(e){e._protected.InAppMessaging=new function(){this.setMessagesSuppressed=function(e){r&&(r.messagesSuppressed=e)},this.getMessagesSuppressed=function(){return!!r&&r.messagesSuppressed},this.setDisplayCallback=function(e){r&&r.setDisplayCallback(e)},this.getDisplayedInAppMessage=function(){return r&&r.display.inAppMessage||null},this.forceDisplayOnNextEvent=(t,n)=>{Array.isArray(t)&&e._protected.CustomDomainStorage.get(e._protected.Constants.FORCED_INAPPS_STORAGE_KEY,[]).then(o=>{const r=Array.from(o||[]);return r.push({eventTypes:t,notification:n}),e._protected.CustomDomainStorage.set(e._protected.Constants.FORCED_INAPPS_STORAGE_KEY,r)})};const{RateLimiter:t}=n(21);let o;const i=()=>e._protected.Locking.getModuleInitializationPromise().then(()=>(o||(o=new t(e._protected.Storage,e._protected.Locking)),o));this.rateLimiter=e._protected.Integration.proxifyToCustomDomain("WonderPushSDK._protected.InAppMessaging.rateLimiter",{increment:e=>i().then(t=>t.increment(e)),isRateLimited:e=>i().then(t=>t.isRateLimited(e))})},e.preInstantiationPromise.then(()=>{if(e._protected.RunModes.Behaviors.ModeWebSite){const{InAppMessaging:t}=n(104);r=new t(e)}})}}.apply(t,[]))||(e.exports=o)},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(105),i=n(106),s=n(107),a=n(108),c=n(3),p=n(2),d=n(109),u=n(22),l=n(24),h=n(5),g="[inapp       ]";class f extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class m extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class _{constructor(e){this.messagesSuppressed=!1,this.internalEvents=e._protected,this.protectedNotifications=e._protected.Notification,this.publicNotifications=e.prototype.Notification,this.subscriptionStates=e.prototype.SubscriptionState,this.events=e._protected.Events,this.presence=e._protected,this.installation=e._protected.Installation,this.locking=e._protected.Locking,this.rateLimiter=e._protected.InAppMessaging.rateLimiter,this.eventTriggerListener=new r.WonderPushEventTriggerListener(e._protected.Events),this.consentModule=e._protected.Consent,this.eventTriggerListener.subscribe(e=>{this.triggerEvent(e)}),this.eventTriggerListener.start(),this.fetcher=new i.Fetcher(e._protected.Config),this.bookkeeper=new s.Bookkeeper(e._protected.CustomDomainStorage),this.customDomainStorage=e._protected.CustomDomainStorage,this.display=new d.Display(this),this.displayCallback=this.display.callback,this.FORCED_INAPPS_STORAGE_KEY=e._protected.Constants.FORCED_INAPPS_STORAGE_KEY}setDisplayCallback(e){this.displayCallback=e||this.display.callback}nextForcedInApp(e){return this.customDomainStorage.get(this.FORCED_INAPPS_STORAGE_KEY,[]).then(t=>{const n=(t||[]).find(t=>(e=>e&&e.notification&&e.eventTypes)(t)&&t.eventTypes.indexOf(e)>=0);if(n){const e=(t||[]).filter(e=>e!==n);return this.customDomainStorage.set(this.FORCED_INAPPS_STORAGE_KEY,e).then(()=>n)}})}triggerEvent(e){return o(this,void 0,void 0,(function*(){if(p.debug(g,"[triggerEvent]","event",e),this.messagesSuppressed)return void p.debug(g,"[triggerEvent]","skipping in-app messages because messagesSuppressed is true");const t={};let n;(yield this.consentModule.hasUserConsent())&&Promise.all([this.bookkeeper.impressionRecords,this.locking.remoteMutexManager.create("InAppMessaging.triggerEvent",5e3)]).then(([e,o])=>((e||[]).forEach(e=>{"string"==typeof e.reporting.campaignId&&(t[e.reporting.campaignId]=e)}),n=o,this.locking.remoteMutexManager.acquire(n,{timeout:1e4}))).then(()=>this.nextForcedInApp(e)).then(t=>{if(p.debug(g,"[triggerEvent] forcedInApp",t),t){const e=_.inAppFromNotification(t.notification);throw e&&this.displayInAppMessage(e),new m}const n=u.EventRateLimits.filter(t=>t.eventType===e);return p.debug(g,"[triggerEvent]","enforcing rate limits",n),Promise.all(n.map(e=>this.rateLimiter.isRateLimited(e)))}).then(e=>{if(e.filter(e=>e).length)throw new f;return Promise.all([this.fetcher.fetchConfig(),this.installation.getProperties(),this.installation.Profile.getCoreProperties(!0),this.events.getAllEvents(),this.presence.getLastPresenceInfo(),this.installation.getTags()])}).then(n=>{const o=n[0],r=n[1],i=n[2],s=n[3],a=n[4],d=new Set(n[5]);let u=o.campaigns.map(e=>new c.CampaignWrapper(e));u=u.filter(n=>{if(!n.active)return!1;if(!n.triggersMatchingEvent(e).length)return!1;if(n.campaign.segment){const e=this.publicNotifications.getSubscriptionState(),t=e===this.subscriptionStates.SUBSCRIBED?"optIn":e===this.subscriptionStates.UNSUBSCRIBED?"softOptOut":"optOut",o=new l.Segmenter(n.campaign.segment,i,r,d,s,a,t).matches();if(p.debug(g,"[triggerEvent]","segmenter matches",n.campaign.segment,o),!o)return!1}const o=t[n.campaignId];return!(o&&o.count>=(n.campaign.capping?n.campaign.capping.maxImpressions:1)||o&&+new Date-o.impressionTime<=(n.campaign.capping?n.campaign.capping.snoozeTime:0)||n.campaign.notifications.length<1||"undefined"!=typeof window&&!c.urlPassesFilters(new URL(window.location.href),n.campaign.urlFilters)&&(p.debug(g,"[triggerEvent]","campaign discarded from url filter",n.campaign,window.location.href),1))}),p.debug(g,"[triggerEvent]","eligible campaigns",u);let h=void 0,f=0;if(u.length){const t=u[0];f=t.triggersMatchingEvent(e)[0].delay||0;const n=t.campaign.notifications[0];h=_.inAppFromNotification(n)}h&&this.displayInAppMessage(h,{delay:f,eventType:e})}).catch(e=>{if(e instanceof f)p.debug(g,"[triggerEvent]","rate limit reached");else{if(!(e instanceof m))throw p.error(g,"[triggerEvent]","error, releasing mutex",e),n&&this.locking.remoteMutexManager.release(n),e;p.debug(g,"[triggerEvent]","forced in-app")}}).then(()=>this.locking.remoteMutexManager.release(n))}))}displayInAppMessage(e,t={}){const n=new a.Reporter(this.internalEvents,this.protectedNotifications,this.rateLimiter,this.bookkeeper,t.eventType);this.displayCallback(e,n,t.delay||0)||this.display.callback(e,n,t.delay||0)}static inAppFromNotification(e){let t;const n=h.ReportingDataUtil.extract(e);return e.content.modal?t=new c.InAppMessage(c.InAppMessageType.MODAL,e.content.modal,n,e.payload):e.content.card?t=new c.InAppMessage(c.InAppMessageType.CARD,e.content.card,n,e.payload):e.content.imageOnly?t=new c.InAppMessage(c.InAppMessageType.IMAGEONLY,e.content.imageOnly,n,e.payload):e.content.banner?t=new c.InAppMessage(c.InAppMessageType.BANNER,e.content.banner,n,e.payload):p.error(g,"[triggerEvent]","unknown in-app message type",e),t}}t.InAppMessaging=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),r=n(2),i="[inapp-trigg…]";t.WonderPushEventTriggerListener=class extends class{constructor(){this.subscribers=new Set}report(e){this.subscribers.forEach(t=>t(e))}subscribe(e){this.subscribers.add(e)}unsubscribe(e){this.subscribers.delete(e)}}{constructor(e){super(),this.events=e,this.started=!1,this.exitEventListener=e=>{"mouseleave"===e.type&&(r.debug(i,"detected mouseleave, reporting ON_EXIT",e),this.report(o.SystemEvent.ON_EXIT))},this.wonderPushEventListener=e=>{if(!(e instanceof CustomEvent))return;const t=e.detail.type;if(t===this.events.WonderPushTrackEventEvent.TYPE){if(!e.detail.event)return;const{type:t}=e.detail.event;"@VISIT"===t?(r.debug(i,"detected @VISIT, reporting APP_LAUNCH too",e),this.report(o.SystemEvent.APP_LAUNCH),r.debug(i,"detected @VISIT, translating to @APP_OPEN for consistency with mobile SDKs",e),this.report("@APP_OPEN")):"@APP_OPEN"===t?r.debug(i,"detected @APP_OPEN, ignoring it in favor of a more timely @VISIT that already translates to an @APP_OPEN",e):(r.debug(i,"detected custom event, reporting",t,e),this.report(t))}else t===this.events.NewPageView.TYPE&&(r.debug(i,"detected new page view, reporting ON_FOREGROUND",e),this.report(o.SystemEvent.ON_FOREGROUND))}}start(){this.started||(this.started=!0,this.events.listen(this.wonderPushEventListener),"undefined"!=typeof document&&document.addEventListener("mouseleave",this.exitEventListener))}stop(){this.started=!1,this.events.unlisten(this.wonderPushEventListener),"undefined"!=typeof document&&document.removeEventListener("mouseleave",this.exitEventListener)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Fetcher=class{constructor(e){this.config=e}fetchConfig(){return this.config.getInAppConfig()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(5),r="inAppImpressions";t.Bookkeeper=class{constructor(e){this.storage=e}recordImpression(e){return this.storage.get(r,[]).then(t=>{const n=Array.from(t||[]),o={reporting:e,impressionTime:+new Date,count:1};let i=!1;for(let t=0;n&&t<n.length;t++){const r=n[t];if(r.reporting.campaignId&&r.reporting.campaignId===e.campaignId){i=!0,o.count=(r.count||0)+1,n[t]=o;break}}return i||n.push(o),this.storage.set(r,n)}).then(()=>{})}get impressionRecords(){return this.storage.get(r,[]).then(e=>Array.isArray(e)?e.filter(e=>(e=>!!e&&o.isReportingData(e.reporting)&&"number"==typeof e.impressionTime&&"number"==typeof e.count)(e)):[])}get campaignIdsFromImpressions(){return this.impressionRecords.then(e=>new Set(e.map(e=>e.reporting.campaignId).filter(e=>"string"==typeof e)))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(22),r=n(2),i=n(5),s="[inapp-repor…]";t.Reporter=class{constructor(e,t,n,o,r){this.internalEvents=e,this.notifications=t,this.rateLimiter=n,this.bookkeeper=o,this.eventType=r}log(e,t,n,o){const r=Object.assign({actionDate:+new Date},o?{buttonLabel:o}:{});i.ReportingDataUtil.assignEventData(r,t.reportingData),this.internalEvents.trackInternalEventWithAppropriateApi(e,r,void 0,{overrideNotificationReceiptOnly:n})}logImpression(e){r.debug(s,"[logImpressi…]",e),this.bookkeeper.recordImpression(e.reportingData),this.eventType&&o.EventRateLimits.filter(e=>e.eventType===this.eventType).forEach(e=>this.rateLimiter.increment(e)),this.log("@INAPP_VIEWED",e,!0)}logClick(e,t,n){r.debug(s,"[logClick    ]",e,t),t.forEach(e=>e.domEvent=n),this.notifications.handleActions(e.reportingData,t),this.log("@INAPP_CLICKED",e,!1,e.buttonTypeOfActions(t))}logDismiss(e,t){r.debug(s,"[logDismiss  ]",e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(2),r=n(3);n(110);const i=n(112),s=n(115),a=n(2),c=n(118),p=n(121),d="[inapp-displ…]";t.Display=class{constructor(e){this.messageDisplayControl=e}get inAppMessage(){return this._inAppMessage}get callback(){return(e,t,n)=>this._inAppMessage||this.messageDisplayControl.messagesSuppressed?(o.debug(d,"[callback    ]","skipping inAppMessage because",this.messageDisplayControl.messagesSuppressed?"messages are suppressed":"a message is already showing",e),!0):(o.debug(d,"[callback    ]","displaying inAppMessage",e),this._inAppMessage=e,n?setTimeout(()=>this.displayMessage(e,t),n):this.displayMessage(e,t),!0)}displayMessage(e,t){let n=void 0;switch(e.messageType){case r.InAppMessageType.BANNER:n=new i.BannerController(Object.assign(Object.assign({},e.content),{autoDismissTime:1e4}));break;case r.InAppMessageType.CARD:n=new s.CardController(Object.assign({},e.content));break;case r.InAppMessageType.IMAGEONLY:n=new c.ImageOnlyController(Object.assign({},e.content));break;case r.InAppMessageType.MODAL:n=new p.ModalController(Object.assign({},e.content));break;default:a.error(d,"[displayMess…]","unknown in-app message type",e.messageType)}n&&(n.dismissCallback=n=>{this._inAppMessage=void 0,t.logDismiss(e,n)},n.clickCallback=(n,o)=>{this._inAppMessage=void 0,t.logClick(e,n,o)},n.attachAndAnimateEntry().then(()=>{t.logImpression(e)}))}}},function(e,t,n){var o=n(8),r=n(111);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var i=(o(r,{insert:"head",singleton:!1}),r.locals?r.locals:{});e.exports=i},function(e,t,n){(t=n(6)(!1)).push([e.i,".wpiam-message#wpiam-message {\n  line-height: normal;\n  z-index: 2147483646;\n}\n.wpiam-message#wpiam-message * {\n  box-sizing: content-box;\n  margin: initial;\n  padding: initial;\n  width: initial;\n  height: initial;\n  min-width: initial;\n  min-height: initial;\n  max-width: initial;\n  max-height: initial;\n  border: initial;\n  background: initial;\n  font-weight: initial;\n  color: initial;\n  opacity: initial;\n  display: initial;\n}\n.wpiam-message#wpiam-message button {\n  display: inline-block;\n}\n.wpiam-message#wpiam-message p,\n.wpiam-message#wpiam-message h2,\n.wpiam-message#wpiam-message div,\n.wpiam-message#wpiam-message section {\n  display: block;\n}\n.wpiam-message#wpiam-message h2 {\n  letter-spacing: normal;\n  font-weight: bold;\n}\n.wpiam-message#wpiam-message .wpiam-card {\n  border-radius: 8px;\n  position: relative;\n}\n.wpiam-message#wpiam-message button {\n  padding: 1px 7px 2px 7px;\n}\n.wpiam-message#wpiam-message section {\n  margin-bottom: 0;\n}\n.wpiam-fullscreen-container {\n  position: fixed;\n  left: 0;\n  top: 0;\n  bottom: 0;\n  right: 0;\n}\n.wpiam-fullscreen-container .wpiam-dim-background {\n  position: absolute;\n  left: 0;\n  top: 0;\n  bottom: 0;\n  right: 0;\n  background-color: rgba(0, 0, 0, 0.5) !important;\n  z-index: -1;\n}\n",""]),e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),r=n(11);n(113),t.BannerController=class extends r.Controller{constructor(e){super(e),this.options=e,this.containerElement=document.createElement("div"),this.containerElement.id="wpiam-message",this.containerElement.className="wpiam-banner-message wpiam-message wpiam-banner-message-position-"+(e.bannerPosition||"top");const t=document.createElement("div");if(this.cardElement=t,this.containerElement.appendChild(t),t.className="wpiam-banner-card wpiam-card",this.options.backgroundHexColor&&(t.style.backgroundColor=this.options.backgroundHexColor),this.options.imageUrl){const e=new Image;e.src=this.options.imageUrl,t.appendChild(e),e.className="wpiam-banner-picture-frame wpiam-landscape"}const n=document.createElement("div");n.className="wpiam-banner-content wpiam-landscape",t.appendChild(n);const r=document.createElement("h2");if(n.appendChild(r),r.innerText=this.options.title.text,this.options.title.hexColor&&(r.style.color=this.options.title.hexColor),this.options.body){const e=document.createElement("p");n.appendChild(e),e.innerText=this.options.body.text,this.options.body.hexColor&&(e.style.color=this.options.body.hexColor)}this.options.autoDismissTime&&setTimeout(()=>this.dismiss(o.DismissType.AUTO),this.options.autoDismissTime),this.containerElement.addEventListener("click",e=>{this.options.actions.length?this.click(this.options.actions,e):this.dismiss(o.DismissType.TAP)})}get active(){return!!this.containerElement.parentElement&&!this.dismissType}performEntryAnimation(){return new Promise(e=>{const t=("bottom"===this.options.bannerPosition?1:-1)*this.containerElement.clientHeight,n=this.cardElement.animate([{transform:"translateY("+Math.round(t)+"px)"},{transform:"translateY(0)"}],{duration:250});n.onfinish=n.oncancel=()=>e()})}attach(){return window.document.body.appendChild(this.containerElement),Promise.resolve()}performExitAnimation(){return new Promise(e=>{const t=("bottom"===this.options.bannerPosition?1:-1)*this.containerElement.clientHeight,n=this.cardElement.animate([{transform:"translateY(0)"},{transform:"translateY("+Math.round(t)+"px)"}],{duration:250});n.onfinish=n.oncancel=()=>e()})}detach(){var e;return null===(e=this.containerElement.parentElement)||void 0===e||e.removeChild(this.containerElement),Promise.resolve()}handleResize(){}get animationElement(){return null}get dimBackgroundElement(){return null}}},function(e,t,n){var o=n(8),r=n(114);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var i=(o(r,{insert:"head",singleton:!1}),r.locals?r.locals:{});e.exports=i},function(e,t,n){(t=n(6)(!1)).push([e.i,".wpiam-message.wpiam-banner-message#wpiam-message {\n  position: fixed;\n  top: 0px;\n  left: 0px;\n  right: 0px;\n  padding: 12px 12px 0px 12px;\n  display: flex;\n  justify-content: center;\n  font-size: 16px;\n}\n.wpiam-message.wpiam-banner-message#wpiam-message.wpiam-banner-message-position-bottom {\n  top: unset;\n  bottom: 0px;\n  padding: 0px 12px 12px 12px;\n}\n.wpiam-message.wpiam-banner-message#wpiam-message .wpiam-card.wpiam-banner-card {\n  display: flex;\n  padding: 8px;\n  flex-grow: 1;\n  max-width: 750px;\n  cursor: pointer;\n}\n.wpiam-message.wpiam-banner-message#wpiam-message .wpiam-card.wpiam-banner-card .wpiam-banner-content {\n  flex-grow: 1;\n}\n.wpiam-message.wpiam-banner-message#wpiam-message .wpiam-card.wpiam-banner-card .wpiam-banner-content h2 {\n  font-size: 1em;\n  margin: 0 0 4px;\n  overflow-wrap: break-word;\n  word-wrap: break-word;\n}\n.wpiam-message.wpiam-banner-message#wpiam-message .wpiam-card.wpiam-banner-card .wpiam-banner-content p {\n  font-size: 1em;\n  margin: 0;\n  overflow-wrap: break-word;\n  word-wrap: break-word;\n}\n.wpiam-message.wpiam-banner-message#wpiam-message .wpiam-card.wpiam-banner-card .wpiam-banner-picture-frame {\n  max-width: 40%;\n  max-height: 2.8em;\n  margin-right: 8px;\n}\n.wpiam-message.wpiam-banner-message#wpiam-message .wpiam-card.wpiam-banner-card .wpiam-banner-picture-frame.wpiam-landscape {\n  max-width: 20%;\n}\n",""]),e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),r=n(11);n(116),t.CardController=class extends r.Controller{constructor(e){super(e),this.options=e,this.element=document.createElement("div"),this.element.id="wpiam-message",this.element.className="wpiam-message wpiam-card-message wpiam-fullscreen-container",this.backgroundElement=document.createElement("div"),this.backgroundElement.className="wpiam-dim-background",this.element.appendChild(this.backgroundElement);const t=document.createElement("div");this.containerElement=t,this.element.appendChild(t),t.className="wpiam-card-container",t.addEventListener("click",e=>{e.target===t&&(e.stopPropagation(),e.preventDefault(),this.dismiss(o.DismissType.TAP))});const n=document.createElement("div");t.appendChild(n),n.className="wpiam-card",this.options.backgroundHexColor&&(n.style.backgroundColor=this.options.backgroundHexColor);const r=document.createElement("div");n.appendChild(r),r.className="wpiam-card-content";const i=document.createElement("div");i.className="wpiam-img-container",this.imgContainerElement=i,r.appendChild(i);const s=document.createElement("section");r.appendChild(s);const a=document.createElement("div");if(a.className="wpiam-msg-content",s.appendChild(a),this.options.title){const e=document.createElement("h2");a.appendChild(e),e.innerText=this.options.title.text,this.options.title.hexColor&&(e.style.color=this.options.title.hexColor)}if(this.options.body){const e=document.createElement("p");a.appendChild(e),e.innerText=this.options.body.text,this.bodyElement=e,this.options.body.hexColor&&(e.style.color=this.options.body.hexColor)}const c=document.createElement("div");if(c.className="wpiam-actions",s.appendChild(c),this.options.secondaryActionButton){const e=document.createElement("button");c.appendChild(e),e.className="wpiam-secondary-btn",this.options.secondaryActionButton.buttonHexColor&&(e.style.backgroundColor=this.options.secondaryActionButton.buttonHexColor),e.innerText=this.options.secondaryActionButton.text.text,this.options.secondaryActionButton.text.hexColor&&(e.style.color=this.options.secondaryActionButton.text.hexColor),e.addEventListener("click",e=>{e.stopPropagation(),e.preventDefault(),this.options.secondaryActions.length?this.click(this.options.secondaryActions,e):this.dismiss(o.DismissType.TAP)})}if(this.options.primaryActionButton){const e=document.createElement("button");c.appendChild(e),e.className="wpiam-primary-btn",this.options.primaryActionButton.buttonHexColor&&(e.style.backgroundColor=this.options.primaryActionButton.buttonHexColor),e.innerText=this.options.primaryActionButton.text.text,this.options.primaryActionButton.text.hexColor&&(e.style.color=this.options.primaryActionButton.text.hexColor),e.addEventListener("click",e=>{e.stopPropagation(),e.preventDefault(),this.options.primaryActions.length?this.click(this.options.primaryActions,e):this.dismiss(o.DismissType.TAP)})}}handleResize(){let e=!1;e=this.element.clientWidth>600||this.isLandscape;const t=this.element.querySelector(".wpiam-card");t&&(t.className="wpiam-card "+(e?"wpiam-landscape":"wpiam-portrait"));const n=(e?this.options.landscapeImageUrl:this.options.portraitImageUrl)||this.options.landscapeImageUrl||this.options.portraitImageUrl;this.imgContainerElement&&(this.imgContainerElement.style.display=n?"":"none",this.imgContainerElement.style.backgroundImage=n?"url("+n+")":"none")}get active(){return!!this.element.parentElement&&!this.dismissType}attach(){return window.document.body.appendChild(this.element),this.handleResize(),Promise.resolve()}detach(){var e;return null===(e=this.element.parentElement)||void 0===e||e.removeChild(this.element),Promise.resolve()}get animationElement(){return this.containerElement}get dimBackgroundElement(){return this.backgroundElement}}},function(e,t,n){var o=n(8),r=n(117);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var i=(o(r,{insert:"head",singleton:!1}),r.locals?r.locals:{});e.exports=i},function(e,t,n){(t=n(6)(!1)).push([e.i,".wpiam-card-message.wpiam-message#wpiam-message {\n  font-size: 15px;\n}\n.wpiam-card-message.wpiam-message#wpiam-message .wpiam-card-container {\n  align-items: center;\n  display: flex;\n  height: 100%;\n  justify-content: center;\n}\n.wpiam-card-message.wpiam-message#wpiam-message .wpiam-card-container .wpiam-card .wpiam-card-content {\n  border-radius: inherit;\n}\n.wpiam-card-message.wpiam-message#wpiam-message .wpiam-card-container .wpiam-card .wpiam-card-content .wpiam-img-container {\n  background-size: cover;\n  background-position: center;\n  flex-shrink: 0;\n}\n.wpiam-card-message.wpiam-message#wpiam-message .wpiam-card-container .wpiam-card .wpiam-card-content section {\n  padding: 24px;\n  display: flex;\n  flex-direction: column;\n  justify-content: stretch;\n  overflow-y: auto;\n}\n.wpiam-card-message.wpiam-message#wpiam-message .wpiam-card-container .wpiam-card .wpiam-card-content section .wpiam-msg-content {\n  flex-grow: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: stretch;\n  overflow-y: auto;\n}\n.wpiam-card-message.wpiam-message#wpiam-message .wpiam-card-container .wpiam-card .wpiam-card-content section .wpiam-msg-content h2 {\n  font-size: 1.1em;\n  margin: 0;\n  overflow-wrap: break-word;\n  word-wrap: break-word;\n  flex-shrink: 0;\n}\n.wpiam-card-message.wpiam-message#wpiam-message .wpiam-card-container .wpiam-card .wpiam-card-content section .wpiam-msg-content p {\n  flex-grow: 1;\n  overflow-wrap: break-word;\n  word-wrap: break-word;\n  margin: 24px 0;\n  overflow-y: auto;\n}\n.wpiam-card-message.wpiam-message#wpiam-message .wpiam-card-container .wpiam-card .wpiam-card-content section .wpiam-actions {\n  flex-shrink: 0;\n  display: flex;\n  justify-content: flex-end;\n}\n.wpiam-card-message.wpiam-message#wpiam-message .wpiam-card-container .wpiam-card .wpiam-card-content section .wpiam-actions button {\n  cursor: pointer;\n  background: none;\n  border: 0;\n  font-size: 1em;\n  border-radius: 2px;\n  padding: 5px 9px 5px 9px;\n  font-weight: bold;\n  outline: none;\n}\n.wpiam-card-message.wpiam-message#wpiam-message .wpiam-card-container .wpiam-card .wpiam-card-content section .wpiam-actions button + button {\n  margin-left: 4px;\n}\n.wpiam-card-message.wpiam-message#wpiam-message .wpiam-card-container .wpiam-card.wpiam-landscape .wpiam-card-content {\n  display: flex;\n  flex-direction: row;\n  align-items: stretch;\n  width: 500px;\n  height: 260px;\n}\n.wpiam-card-message.wpiam-message#wpiam-message .wpiam-card-container .wpiam-card.wpiam-landscape .wpiam-card-content .wpiam-img-container {\n  height: 260px;\n  flex-basis: 260px;\n  border-bottom-left-radius: inherit;\n  border-top-left-radius: inherit;\n  border-bottom-right-radius: 0px;\n  border-top-right-radius: 0px;\n  flex-grow: 0;\n  flex-shrink: 0;\n}\n.wpiam-card-message.wpiam-message#wpiam-message .wpiam-card-container .wpiam-card.wpiam-landscape .wpiam-card-content section {\n  flex-grow: 1;\n}\n.wpiam-card-message.wpiam-message#wpiam-message .wpiam-card-container .wpiam-card.wpiam-portrait .wpiam-card-content {\n  display: flex;\n  flex-direction: column;\n  justify-content: stretch;\n  max-height: 420px;\n  width: 260px;\n}\n.wpiam-card-message.wpiam-message#wpiam-message .wpiam-card-container .wpiam-card.wpiam-portrait .wpiam-card-content .wpiam-img-container {\n  height: 173px;\n  border-bottom-left-radius: 0px;\n  border-top-left-radius: inherit;\n  border-bottom-right-radius: 0px;\n  border-top-right-radius: inherit;\n}\n.wpiam-card-message.wpiam-message#wpiam-message .wpiam-card-container .wpiam-card.wpiam-portrait .wpiam-card-content section {\n  flex-grow: 1;\n}\n@media only screen and (min-width: 385px) and (min-height: 680px) {\n  .wpiam-card-message.wpiam-message#wpiam-message .wpiam-portrait {\n    transform: scale(1.2);\n  }\n}\n@media only screen and (min-width: 480px) and (min-height: 850px) {\n  .wpiam-card-message.wpiam-message#wpiam-message .wpiam-portrait {\n    transform: scale(1.4);\n  }\n}\n@media only screen and (min-width: 640px) and (min-height: 1136px) {\n  .wpiam-card-message.wpiam-message#wpiam-message .wpiam-portrait {\n    transform: scale(1.6);\n  }\n}\n@media only screen and (min-width: 680px) and (min-height: 385px) {\n  .wpiam-card-message.wpiam-message#wpiam-message .wpiam-landscape {\n    transform: scale(1.2);\n  }\n}\n@media only screen and (min-width: 850px) and (min-height: 480px) {\n  .wpiam-card-message.wpiam-message#wpiam-message .wpiam-landscape {\n    transform: scale(1.4);\n  }\n}\n@media only screen and (min-width: 1136px) and (min-height: 640px) {\n  .wpiam-card-message.wpiam-message#wpiam-message .wpiam-landscape {\n    transform: scale(1.6);\n  }\n}\n",""]),e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),r=n(11);n(119);const i=n(23);t.ImageOnlyController=class extends r.Controller{constructor(e){super(e),this.options=e,this.element=document.createElement("div"),this.element.id="wpiam-message",this.element.className="wpiam-imageonly-message wpiam-fullscreen-container wpiam-message",this.backgroundElement=document.createElement("div"),this.backgroundElement.className="wpiam-dim-background",this.element.appendChild(this.backgroundElement);const t=document.createElement("div");this.containerElement=t,this.element.appendChild(t),t.className="wpiam-imageonly-card-container",t.addEventListener("click",e=>{e.target===t&&(e.stopPropagation(),e.preventDefault(),this.dismiss(o.DismissType.TAP))});const n=document.createElement("div");t.appendChild(n),n.className="wpiam-imageonly-card wpiam-card",n.addEventListener("click",e=>{this.options.actions.length?this.click(this.options.actions,e):this.dismiss(o.DismissType.TAP)});const r=new Image;r.src=this.options.imageUrl,n.appendChild(r),this.options.actions.length&&(r.style.cursor="pointer");const s=i.DisplayHelper.makeCloseButton();s.classList.add("position-"+(e.closeButtonPosition||"outside")),n.appendChild(s),s.addEventListener("click",()=>{this.dismiss(o.DismissType.TAP)})}handleResize(){const{isLandscape:e}=this,t=this.element.querySelector(".wpiam-imageonly-card-container"),n=this.element.querySelector("img");n.className=e?"wpiam-landscape":"",n.style.maxHeight=Math.round(.8*t.offsetHeight)+"px",n.style.maxWidth=Math.round(.8*t.offsetWidth)+"px"}get active(){return!!this.element.parentElement&&!this.dismissType}attach(){return window.document.body.appendChild(this.element),this.handleResize(),Promise.resolve()}detach(){var e;return null===(e=this.element.parentElement)||void 0===e||e.removeChild(this.element),Promise.resolve()}get animationElement(){return this.containerElement}get dimBackgroundElement(){return this.backgroundElement}}},function(e,t,n){var o=n(8),r=n(120);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var i=(o(r,{insert:"head",singleton:!1}),r.locals?r.locals:{});e.exports=i},function(e,t,n){(t=n(6)(!1)).push([e.i,".wpiam-imageonly-message.wpiam-message#wpiam-message .wpiam-imageonly-card-container {\n  align-items: center;\n  display: flex;\n  height: 100%;\n  justify-content: center;\n}\n.wpiam-imageonly-message.wpiam-message#wpiam-message .wpiam-cancel-button {\n  position: absolute;\n  right: -8px;\n  top: -8px;\n  cursor: pointer;\n}\n.wpiam-imageonly-message.wpiam-message#wpiam-message .wpiam-cancel-button.position-inside {\n  top: 4px;\n  right: 4px;\n}\n.wpiam-imageonly-message.wpiam-message#wpiam-message .wpiam-cancel-button.position-none {\n  display: none;\n}\n.wpiam-imageonly-message.wpiam-message#wpiam-message .wpiam-card.wpiam-imageonly-card {\n  cursor: pointer;\n  padding: 0;\n  max-width: 80%;\n  max-height: 80%;\n  display: inline-block;\n}\n.wpiam-imageonly-message.wpiam-message#wpiam-message .wpiam-card.wpiam-imageonly-card img {\n  display: block;\n}\n",""]),e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(11),r=n(3);n(122);const i=n(23);t.ModalController=class extends o.Controller{constructor(e){super(e),this.options=e,this.element=document.createElement("div"),this.element.id="wpiam-message",this.element.className="wpiam-message wpiam-modal-message wpiam-fullscreen-container",this.backgroundElement=document.createElement("div"),this.backgroundElement.className="wpiam-dim-background",this.element.appendChild(this.backgroundElement);const t=document.createElement("div");this.containerElement=t,this.element.appendChild(t),t.className="wpiam-modal-card-container",t.addEventListener("click",e=>{e.target===t&&(e.stopPropagation(),e.preventDefault(),this.dismiss(r.DismissType.TAP))});const n=document.createElement("div");this.cardElement=n,t.appendChild(n),n.className="wpiam-card",this.options.backgroundHexColor&&(n.style.backgroundColor=this.options.backgroundHexColor),this.options.title.hexColor&&(n.style.color=this.options.title.hexColor);const o=i.DisplayHelper.makeCloseButton();o.classList.add("position-"+(e.closeButtonPosition||"outside")),n.appendChild(o),o.addEventListener("click",e=>{e.stopPropagation(),e.preventDefault(),this.dismiss(r.DismissType.TAP)});const s=document.createElement("div");this.modalContainerElement=s,n.appendChild(s),s.className="wpiam-modal-container";const a=document.createElement("h2");if(this.titleElement=a,s.appendChild(a),a.innerText=this.options.title.text,this.options.title.hexColor&&(a.style.color=this.options.title.hexColor),this.options.imageUrl&&(this.img=document.createElement("img"),s.appendChild(this.img),this.img.src=this.options.imageUrl),this.options.body){const e=document.createElement("p");this.bodyElement=e,s.appendChild(e),e.innerText=this.options.body.text,this.options.body.hexColor&&(e.style.color=this.options.body.hexColor)}if(this.options.actionButton){const e=document.createElement("button");this.buttonElement=e,s.appendChild(e),e.innerText=this.options.actionButton.text.text,this.options.actionButton.text.hexColor&&(e.style.color=this.options.actionButton.text.hexColor),this.options.actionButton.buttonHexColor&&(e.style.backgroundColor=this.options.actionButton.buttonHexColor),e.addEventListener("click",e=>{e.stopPropagation(),e.preventDefault(),this.click(this.options.actions,e)})}}get active(){return!!this.element.parentNode&&!this.dismissType}attach(){const e=()=>{window.document.body.appendChild(this.element),this.handleResize()};if(this.img){const t=this.img;return new Promise((n,o)=>{t.onload=()=>{e(),n()},t.onerror=()=>{o(new Error("error loading image"))}})}return e(),Promise.resolve()}detach(){var e;return null===(e=this.element.parentNode)||void 0===e||e.removeChild(this.element),Promise.resolve()}handleResize(){var e,t;const n=this.isLandscape||this.element.clientWidth>=650;if(this.cardElement.className="wpiam-card "+(n?"wpiam-landscape":"wpiam-portrait"),n){!this.imgContainer&&this.img&&(this.imgContainer=document.createElement("div"),this.imgContainer.className="wpiam-img-container",this.imgContainer.style.display=this.options.imageUrl?"default":"none",this.modalContainerElement.appendChild(this.imgContainer),this.img&&this.imgContainer.appendChild(this.img)),this.contentContainer||(this.contentContainer=document.createElement("div"),this.contentContainer.className="wpiam-content-container",this.modalContainerElement.appendChild(this.contentContainer),[this.titleElement,this.bodyElement,this.buttonElement].forEach(e=>{var t;e&&(null===(t=this.contentContainer)||void 0===t||t.appendChild(e))})),this.cardElement.style.width="";const e=Math.min(390,Math.round(this.img?this.element.clientWidth/2:2*this.element.clientWidth/3)-48);this.contentContainer.style.width=e+"px";const t=this.element.clientHeight-96;if(this.contentContainer.style.maxHeight=t+"px",this.img){const t=this.element.clientHeight-96,n=Math.floor(2*(e+72)/3);let o=Math.min(n,this.img.width),r=o*(this.img.height/this.img.width);r>t&&(o=(r=t)*(this.img.width/this.img.height)),this.img.style.height=Math.floor(r)+"px",this.img.style.width=Math.floor(o)+"px"}}else this.cardElement.style.width=this.element.clientWidth-48+"px",[this.titleElement,this.img,this.bodyElement,this.buttonElement].forEach(e=>{var t;e&&e.parentNode!==this.modalContainerElement&&(null===(t=this.modalContainerElement)||void 0===t||t.appendChild(e))}),this.imgContainer&&(null===(e=this.imgContainer.parentNode)||void 0===e||e.removeChild(this.imgContainer)),this.imgContainer=void 0,this.contentContainer&&(null===(t=this.contentContainer.parentNode)||void 0===t||t.removeChild(this.contentContainer)),this.contentContainer=void 0,this.img&&(this.img.style.height="",this.img.style.width="",this.img.style.maxHeight="",this.img.style.maxWidth="");const o=this.element.clientHeight-96;this.modalContainerElement.style.maxHeight=Math.min(o,1e3)+"px"}get animationElement(){return this.containerElement}get dimBackgroundElement(){return this.backgroundElement}}},function(e,t,n){var o=n(8),r=n(123);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var i=(o(r,{insert:"head",singleton:!1}),r.locals?r.locals:{});e.exports=i},function(e,t,n){(t=n(6)(!1)).push([e.i,".wpiam-modal-message.wpiam-message#wpiam-message {\n  font-size: 15px;\n}\n.wpiam-modal-message.wpiam-message#wpiam-message .wpiam-modal-card-container {\n  display: flex;\n  align-items: center;\n  height: 100%;\n  width: 100%;\n  justify-content: center;\n  box-sizing: border-box;\n  padding: 24px;\n}\n.wpiam-modal-message.wpiam-message#wpiam-message .wpiam-modal-card-container .wpiam-card {\n  max-height: 100%;\n  max-width: 100%;\n  box-sizing: border-box;\n  padding: 24px;\n}\n.wpiam-modal-message.wpiam-message#wpiam-message .wpiam-modal-card-container .wpiam-card .wpiam-modal-container {\n  box-sizing: content-box;\n  max-height: 1000px;\n}\n.wpiam-modal-message.wpiam-message#wpiam-message .wpiam-modal-card-container .wpiam-card .wpiam-modal-container h2 {\n  font-size: 1.1em;\n  margin: 0 0 24px;\n  overflow-wrap: break-word;\n  word-wrap: break-word;\n  flex-shrink: 0;\n}\n.wpiam-modal-message.wpiam-message#wpiam-message .wpiam-modal-card-container .wpiam-card .wpiam-modal-container p {\n  overflow-wrap: break-word;\n  word-wrap: break-word;\n  margin-bottom: 24px;\n}\n.wpiam-modal-message.wpiam-message#wpiam-message .wpiam-modal-card-container .wpiam-card .wpiam-modal-container button {\n  cursor: pointer;\n  font-size: 1em;\n  border: 0;\n  border-radius: 2px;\n  box-shadow: 0 1px 2px 0 rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n  padding: 4px 8px;\n  outline: none;\n  flex-shrink: 0;\n}\n.wpiam-modal-message.wpiam-message#wpiam-message .wpiam-modal-card-container .wpiam-card.wpiam-landscape .wpiam-modal-container {\n  display: flex;\n  flex-direction: row;\n  align-items: stretch;\n  align-content: stretch;\n  max-width: 650px;\n}\n.wpiam-modal-message.wpiam-message#wpiam-message .wpiam-modal-card-container .wpiam-card.wpiam-landscape .wpiam-modal-container .wpiam-img-container {\n  flex: 0 0 auto;\n  margin-right: 24px;\n  display: flex;\n  align-items: center;\n}\n.wpiam-modal-message.wpiam-message#wpiam-message .wpiam-modal-card-container .wpiam-card.wpiam-landscape .wpiam-modal-container .wpiam-content-container {\n  align-self: center;\n  flex-grow: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  text-align: center;\n  align-content: safe flex-start;\n}\n.wpiam-modal-message.wpiam-message#wpiam-message .wpiam-modal-card-container .wpiam-card.wpiam-landscape .wpiam-modal-container .wpiam-content-container h2 {\n  max-height: 3em;\n  overflow-y: auto;\n}\n.wpiam-modal-message.wpiam-message#wpiam-message .wpiam-modal-card-container .wpiam-card.wpiam-landscape .wpiam-modal-container .wpiam-content-container p {\n  overflow-y: auto;\n}\n.wpiam-modal-message.wpiam-message#wpiam-message .wpiam-modal-card-container .wpiam-card.wpiam-portrait .wpiam-modal-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  text-align: center;\n  align-content: safe flex-start;\n}\n.wpiam-modal-message.wpiam-message#wpiam-message .wpiam-modal-card-container .wpiam-card.wpiam-portrait .wpiam-modal-container img {\n  flex: 1 3 auto;\n  min-height: 0;\n  object-fit: scale-down;\n  margin-bottom: 24px;\n  max-width: 100%;\n}\n.wpiam-modal-message.wpiam-message#wpiam-message .wpiam-modal-card-container .wpiam-card.wpiam-portrait .wpiam-modal-container p {\n  flex: 1 0 auto;\n  overflow-y: auto;\n  max-height: 6em;\n}\n.wpiam-modal-message.wpiam-message#wpiam-message .wpiam-modal-card-container .wpiam-card.wpiam-portrait .wpiam-modal-container h2 {\n  flex: 1 0 auto;\n  max-height: 3em;\n  overflow-y: auto;\n}\n.wpiam-modal-message.wpiam-message#wpiam-message .wpiam-modal-card-container .wpiam-card.wpiam-portrait .wpiam-modal-container button {\n  flex: 0 0 auto;\n}\n.wpiam-modal-message.wpiam-message#wpiam-message .wpiam-modal-card-container .wpiam-cancel-button {\n  position: absolute;\n  right: -8px;\n  top: -8px;\n  color: rgba(0, 0, 0, 0.87);\n  cursor: pointer;\n}\n.wpiam-modal-message.wpiam-message#wpiam-message .wpiam-modal-card-container .wpiam-cancel-button.position-inside {\n  top: 4px;\n  right: 4px;\n}\n.wpiam-modal-message.wpiam-message#wpiam-message .wpiam-modal-card-container .wpiam-cancel-button.position-none {\n  display: none;\n}\n",""]),e.exports=t},function(e,t,n){"use strict";function o(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),o(n(7)),o(n(12)),o(n(13)),o(n(25)),o(n(26)),o(n(125)),o(n(33)),o(n(31)),o(n(9)),o(n(16)),o(n(29)),o(n(28)),o(n(15)),o(n(30)),o(n(14)),o(n(32)),o(n(27))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(27),r=n(25),i=n(14),s=n(9),a=n(26),c=n(28),p=n(15),d=n(16),u=n(29),l=n(30),h=n(31),g=n(32),f=n(12),m=n(13);class _ extends o.ConfigurableValueNodeParser{constructor(){super(),this.registerExactNameParser("date",_.parseDate),this.registerExactNameParser("duration",_.parseDuration),this.registerExactNameParser("geolocation",_.parseGeolocation),this.registerExactNameParser("geobox",_.parseGeobox),this.registerExactNameParser("geocircle",_.parseGeocircle),this.registerExactNameParser("geopolygon",_.parseGeopolygon)}static parseDate(e,t,n){if("number"==typeof n){const t=n;return new r.DateValueNode(e,t)}if("string"==typeof n){const t=n;if(/^(\+|-)?P/.test(t)){const n=i.ISO8601Duration.parse(t);return new r.RelativeDateValueNode(e,n)}const o=/^(\d\d\d\d(?:-\d\d(?:-\d\d)?)?)(?:T(\d\d(?::\d\d(?::\d\d(?:.\d\d\d)?)?)?))?(Z|[+-]\d\d(?::\d\d(?::\d\d(?:.\d\d\d)?)?)?)?$/.exec(t);if(null!==o){let t=o[1],n=o[2]||"",i=o[3]||"";t+="1970-01-01".substr(t.length),n+="00:00:00.000000".substr(n.length),"Z"===i&&(i=""),i=(i+="+00:00".substr(i.length)).substr(0,6);const s=new Date(t+"T"+n+i);return new r.DateValueNode(e,s.getTime())}}throw new s.BadInputError(`"${t}" values expect a number or a string value`)}static parseDuration(e,t,n){if("number"==typeof n){const t=n;return new r.DurationValueNode(e,t)}if("string"==typeof n){const o=n;if(/^(\+|-)?P/.test(o)){const t=i.ISO8601Duration.parse(o);return new r.DurationValueNode(e,t)}const a=/^\s*([+-]?[0-9\.]+(?:[eE][+-]?[0-9]+)?)\s*([a-zA-Z]*)?\s*$/.exec(o);if(null!==a){const n=parseFloat(a[1]),o=a[2];if(["ns","nanos","nanosecond","nanoseconds"].indexOf(o)>=0)return new r.DurationValueNode(e,n/1e6);if(["us","micros","microsecond","microseconds"].indexOf(o)>=0)return new r.DurationValueNode(e,n/1e3);if(["ms","millis","millisecond","milliseconds"].indexOf(o)>=0)return new r.DurationValueNode(e,n);if(["s","sec","secs","second","seconds"].indexOf(o)>=0)return new r.DurationValueNode(e,1e3*n);if(["m","min","minute","minutes"].indexOf(o)>=0)return new r.DurationValueNode(e,60*n*1e3);if(["h","hr","hour","hours"].indexOf(o)>=0)return new r.DurationValueNode(e,60*n*60*1e3);if(["d","day","days"].indexOf(o)>=0)return new r.DurationValueNode(e,24*n*60*60*1e3);if(["w","week","weeks"].indexOf(o)>=0)return new r.DurationValueNode(e,7*n*24*60*60*1e3);throw new s.BadInputError(`"${t}" string values expect a valid unit`)}}throw new s.BadInputError(`"${t}" values expect a number or a valid string value`)}static parseGeolocation(e,t,n){if("string"==typeof n){const t=n;return new a.GeoLocationValueNode(e,c.Geohash.parse(t).toGeoLocation())}if("object"!=typeof n||Array.isArray(n)||"number"!=typeof n.lat||"number"!=typeof n.lon)throw new s.BadInputError(`"${t}" values expect an object with a "lat" and "lon" numeric fields`);const o=n.lat,r=n.lon;return new a.GeoLocationValueNode(e,new p.GeoLocation(o,r))}static parseGeobox(e,t,n){if("string"==typeof n){const t=n;return new a.GeoBoxValueNode(e,c.Geohash.parse(t).toGeoBox())}if("object"!=typeof n||Array.isArray(n))throw new s.BadInputError(`"${t}" values expect an object`);if(null!=n.topLeft&&null!=n.bottomRight)return new a.GeoBoxValueNode(e,d.GeoBox.fromTopLeftAndBottomRight(_.parseGeolocation(e,"geolocation",n.topLeft).value,_.parseGeolocation(e,"geolocation",n.bottomRight).value));if(null!=n.topRight&&null!=n.bottomLeft)return new a.GeoBoxValueNode(e,d.GeoBox.fromTopRightAndBottomLeft(_.parseGeolocation(e,"geolocation",n.topRight).value,_.parseGeolocation(e,"geolocation",n.bottomLeft).value));if("number"==typeof n.top&&"number"==typeof n.right&&"number"==typeof n.bottom&&"number"==typeof n.left)return new a.GeoBoxValueNode(e,d.GeoBox.fromTopRightBottomLeft(n.top,n.right,n.bottom,n.left));throw new s.BadInputError(`"${t}" did not receive an object with a handled format`)}static parseGeocircle(e,t,n){if("object"!=typeof n||Array.isArray(n))throw new s.BadInputError(`"${t}" values expect an object`);if("number"!=typeof n.radius)throw new s.BadInputError(`"${t}" needs a radius numeric field`);if(null!=n.center)return new a.GeoCircleValueNode(e,new u.GeoCircle(_.parseGeolocation(e,"geolocation",n.center).value,n.radius));throw new s.BadInputError(`"${t}" did not receive an object with a handled format`)}static parseGeopolygon(e,t,n){if(!Array.isArray(n)||n.length<3)throw new s.BadInputError(`"${t}" values expect an array of at least 3 geolocations`);return new a.GeoPolygonValueNode(e,new l.GeoPolygon(n.map(t=>_.parseGeolocation(e,"geolocation",t).value)))}}t.DefaultValueNodeParser=_;class v extends o.ConfigurableCriterionNodeParser{constructor(){super(),this.registerDynamicNameParser(v.parseDynamicDotField),this.registerExactNameParser("and",v.parseAnd),this.registerExactNameParser("or",v.parseOr),this.registerExactNameParser("not",v.parseNot),this.registerExactNameParser("segment",v.parseSegment),this.registerExactNameParser("lastActivityDate",v.parseLastActivityDate),this.registerExactNameParser("presence",v.parsePresence),this.registerExactNameParser("geo",v.parseGeo),this.registerExactNameParser("subscriptionStatus",v.parseSubscriptionStatus),this.registerExactNameParser("pushUnsupported",v.parsePushUnsupported),this.registerExactNameParser("user",v.parseUser),this.registerExactNameParser("installation",v.parseInstallation),this.registerExactNameParser("currentUrl",v.parseCurrentUrl),this.registerExactNameParser("event",v.parseEvent),this.registerExactNameParser("eq",v.parseEq),this.registerExactNameParser("any",v.parseAny),this.registerExactNameParser("all",v.parseAll),this.registerExactNameParser("gt",v.parseGt),this.registerExactNameParser("gte",v.parseGte),this.registerExactNameParser("lt",v.parseLt),this.registerExactNameParser("lte",v.parseLte),this.registerExactNameParser("prefix",v.parsePrefix),this.registerExactNameParser("suffix",v.parseSuffix),this.registerExactNameParser("contains",v.parseContains),this.registerExactNameParser("inside",v.parseInside)}static parseDynamicDotField(e,t,n){if("."===t.charAt(0)){const o=new h.FieldSource(e.dataSource,h.FieldPath.parse(t.substr(1))),r=e.withDataSource(o);return e.parser.parseCriterion(r,n)}return null}static parseAnd(e,t,n){const o=v.ensureArrayOfObjects(t,n);return new f.AndCriterionNode(e,o.map(t=>e.parser.parseCriterion(e,t)))}static parseOr(e,t,n){const o=v.ensureArrayOfObjects(t,n);return new f.OrCriterionNode(e,o.map(t=>e.parser.parseCriterion(e,t)))}static parseNot(e,t,n){const o=v.ensureObject(t,n);return new f.NotCriterionNode(e,e.parser.parseCriterion(e,o))}static parseSegment(e,t,n){if(e.dataSource.getRootDataSource()!==e.dataSource)throw new s.BadInputError(`"${t}" is not supported in the context of a field`);const o=v.ensureObject(t,n),r=v.ensureString(t+".id",o.id);if(r.length<1)throw new s.BadInputError(`"${t}.id" expects a valid id`);return new f.SegmentCriterionNode(e,r)}static parseLastActivityDate(e,t,n){if(!(e.dataSource instanceof h.InstallationSource))throw new s.BadInputError(`"${t}" is only supported in the context of "installation"`);const o=v.ensureObject(t,n),r=new h.LastActivityDateSource(e.dataSource),i=e.parser.parseCriterion(e.withDataSource(r),o);return new f.LastActivityDateCriterionNode(e,i)}static parsePresence(e,t,n){if(!(e.dataSource instanceof h.InstallationSource))throw new s.BadInputError(`"${t}" is only supported in the context of "installation"`);const o=v.ensureObject(t,n),r=v.ensureBoolean(t+".present",n.present),i=new h.PresenceSinceDateSource(e.dataSource,r),a="sinceDate"in o?e.parser.parseCriterion(e.withDataSource(i),v.ensureObject(t+".sinceDate",n.sinceDate)):void 0,c=new h.PresenceElapsedTimeSource(e.dataSource,r),p="elapsedTime"in o?e.parser.parseCriterion(e.withDataSource(c),v.ensureObject(t+".elapsedTime",n.elapsedTime)):void 0;return new f.PresenceCriterionNode(e,r,a,p)}static parseGeo(e,t,n){if(!(e.dataSource instanceof h.InstallationSource))throw new s.BadInputError(`"${t}" is only supported in the context of "installation"`);const o=v.ensureObject(t,n),r=new h.GeoLocationSource(e.dataSource),i="location"in o?e.parser.parseCriterion(e.withDataSource(r),v.ensureObject(t+".location",n.location)):void 0,a=new h.GeoDateSource(e.dataSource),c="date"in o?e.parser.parseCriterion(e.withDataSource(a),v.ensureObject(t+".date",n.date)):void 0;return new f.GeoCriterionNode(e,i,c)}static parseSubscriptionStatus(e,t,n){if(!(e.dataSource instanceof h.InstallationSource))throw new s.BadInputError(`"${t}" is only supported in the context of "installation"`);const o=v.ensureString(t,n);if("optIn"!==o&&"optOut"!==o&&"softOptOut"!==o)throw new s.BadInputError('"'+t+'" must be one of "optIn", "optOut" or "softOptOut"');return new f.SubscriptionStatusCriterionNode(e,o)}static parsePushUnsupported(e,t,n){if(!(e.dataSource instanceof h.InstallationSource))throw new s.BadInputError(`"${t}" is only supported in the context of "installation"`);const o=v.ensureBoolean(t,n);return new f.PushUnsupportedCriterionNode(e,o)}static parseUser(e,t,n){const o=e.dataSource.getRootDataSource(),r=v.ensureObject(t,n),i=e.withDataSource(new h.UserSource);if(o instanceof h.UserSource)return e.parser.parseCriterion(i,r);if(o instanceof h.InstallationSource)return new f.JoinCriterionNode(i,e.parser.parseCriterion(i,r));if(o instanceof h.EventSource){const t=e.withDataSource(new h.InstallationSource),n=t.withDataSource(new h.UserSource);return new f.JoinCriterionNode(t,new f.JoinCriterionNode(n,e.parser.parseCriterion(n,r)))}throw new s.BadInputError(`"${t}" is not supported in this context`)}static parseCurrentUrl(e,t,n){const o=v.ensureObject(t,n),r=e.withDataSource(new h.CurrentUrlSource);return new f.JoinCriterionNode(r,e.parser.parseCriterion(r,o))}static parseInstallation(e,t,n){const o=e.dataSource.getRootDataSource(),r=v.ensureObject(t,n),i=e.withDataSource(new h.InstallationSource);if(o instanceof h.UserSource||o instanceof h.EventSource)return new f.JoinCriterionNode(i,e.parser.parseCriterion(i,r));if(o instanceof h.InstallationSource)return e.parser.parseCriterion(i,r);throw new s.BadInputError(`"${t}" is not supported in this context`)}static parseEvent(e,t,n){const o=e.dataSource.getRootDataSource(),r=v.ensureObject(t,n),i=e.withDataSource(new h.EventSource);if(o instanceof h.UserSource){const t=e.withDataSource(new h.InstallationSource),n=t.withDataSource(new h.EventSource);return new f.JoinCriterionNode(t,new f.JoinCriterionNode(n,e.parser.parseCriterion(n,r)))}if(o instanceof h.InstallationSource)return new f.JoinCriterionNode(i,e.parser.parseCriterion(i,r));if(o instanceof h.EventSource)return e.parser.parseCriterion(i,r);throw new s.BadInputError(`"${t}" is only supported in the context of "installation"`)}static parseEq(e,t,n){if(e.dataSource.getRootDataSource()===e.dataSource)throw new s.BadInputError(`"${t}" is only supported in the context of a field`);return new f.EqualityCriterionNode(e,e.parser.parseValue(e,n))}static parseAny(e,t,n){if(e.dataSource.getRootDataSource()===e.dataSource)throw new s.BadInputError(`"${t}" is only supported in the context of a field`);const o=v.ensureArray(t,n);return new f.AnyCriterionNode(e,o.map(t=>e.parser.parseValue(e,t)))}static parseAll(e,t,n){if(e.dataSource.getRootDataSource()===e.dataSource)throw new s.BadInputError(`"${t}" is only supported in the context of a field`);const o=v.ensureArray(t,n);return new f.AllCriterionNode(e,o.map(t=>e.parser.parseValue(e,t)))}static parseGtGteLtLte(e,t,n,o){if(e.dataSource.getRootDataSource()===e.dataSource)throw new s.BadInputError(`"${t}" is only supported in the context of a field`);return new f.ComparisonCriterionNode(e,o,e.parser.parseValue(e,n))}static parseGt(e,t,n){return v.parseGtGteLtLte(e,t,n,"gt")}static parseGte(e,t,n){return v.parseGtGteLtLte(e,t,n,"gte")}static parseLt(e,t,n){return v.parseGtGteLtLte(e,t,n,"lt")}static parseLte(e,t,n){return v.parseGtGteLtLte(e,t,n,"lte")}static parsePrefix(e,t,n){if(e.dataSource.getRootDataSource()===e.dataSource)throw new s.BadInputError(`"${t}" is only supported in the context of a field`);const o=e.parser.parseValue(e,n);if(!(o instanceof m.StringValueNode))throw new s.BadInputError(`"${t}" expects a string value`);return new f.PrefixCriterionNode(e,o)}static parseSuffix(e,t,n){if(e.dataSource.getRootDataSource()===e.dataSource)throw new s.BadInputError(`"${t}" is only supported in the context of a field`);const o=e.parser.parseValue(e,n);if(!(o instanceof m.StringValueNode))throw new s.BadInputError(`"${t}" expects a string value`);return new f.SuffixCriterionNode(e,o)}static parseContains(e,t,n){if(e.dataSource.getRootDataSource()===e.dataSource)throw new s.BadInputError(`"${t}" is only supported in the context of a field`);const o=e.parser.parseValue(e,n);if(!(o instanceof m.StringValueNode))throw new s.BadInputError(`"${t}" expects a string value`);return new f.ContainsCriterionNode(e,o)}static parseInside(e,t,n){if(e.dataSource.getRootDataSource()===e.dataSource)throw new s.BadInputError(`"${t}" is only supported in the context of a field`);const o=e.parser.parseValue(e,n);if(!(o instanceof a.GeoAbstractAreaValueNode))throw new s.BadInputError(`"${t}" expects a compatible geo value`);return new f.InsideCriterionNode(e,o)}static ensureArray(e,t){if(!Array.isArray(t))throw new s.BadInputError('"'+e+'" expects an array');return t}static ensureArrayOfObjects(e,t){if(!Array.isArray(t))throw new s.BadInputError('"'+e+'" expects an array');if(t.some(e=>"object"!=typeof e||null===e||Array.isArray(e)))throw new s.BadInputError('"'+e+'" expects an array of objects');return t}static ensureObject(e,t){if(null===t||"object"!=typeof t||Array.isArray(t))throw new s.BadInputError('"'+e+'" expects an object');return t}static ensureString(e,t){if("string"!=typeof t)throw new s.BadInputError('"'+e+'" expects a string');return t}static ensureBoolean(e,t){if("boolean"!=typeof t)throw new s.BadInputError('"'+e+'" expects a boolean');return t}}t.DefaultCriterionNodeParser=v,t.defaultParser=new g.SegmentationDSLParser({throwOnUnknownCriterion:!0,throwOnUnknownValue:!0,valueParser:new _,criterionParser:new v}),t.defaultParserLenient=new g.SegmentationDSLParser({throwOnUnknownCriterion:!1,throwOnUnknownValue:!1,valueParser:new _,criterionParser:new v})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(2),r=n(24),i=n(21),s=n(5),a=n(3),c="[auto-actions]";t.default=e=>{e._protected.AutomaticActions=new p(e)};class p{constructor(e){this.SDK=e,this.listener=e=>{if(!(e instanceof CustomEvent))return;const t=e.detail.type;if(t===this.events.WonderPushTrackEventEvent.TYPE){if(!e.detail.event)return;const{type:t}=e.detail.event;"@VISIT"===t?(o.debug(c,"detected @VISIT, reporting APP_LAUNCH too",e),this.onSystemEvent(a.SystemEvent.APP_LAUNCH),o.debug(c,"detected @VISIT, translating to @APP_OPEN for consistency with mobile SDKs",e),this.onCustomEvent("@APP_OPEN")):"@APP_OPEN"===t?o.debug(c,"detected @APP_OPEN, ignoring it in favor of a more timely @VISIT that already translates to an @APP_OPEN",e):(o.debug(c,"detected custom event, reporting",t,e),this.onCustomEvent(t))}else t===this.events.NewPageView.TYPE&&(o.debug(c,"detected new page view, reporting ON_FOREGROUND",e),this.onSystemEvent(a.SystemEvent.ON_FOREGROUND))},this.rateLimiterPromise=this.SDK._protected.Locking.getModuleInitializationPromise().then(()=>new i.RateLimiter(this.SDK._protected.Storage,this.SDK._protected.Locking)),this.events.listen(this.listener)}get events(){return this.SDK._protected.Events}get config(){return this.SDK._protected.Config}get installation(){return this.SDK._protected.Installation}get presence(){return this.SDK._protected}onSystemEvent(e){this.config.getAutomaticActions().then(t=>{this.checkTriggeredActions(t.filter(t=>t.triggers.findIndex(t=>t.systemEvent===e)>=0))})}onCustomEvent(e){this.config.getAutomaticActions().then(t=>{this.checkTriggeredActions(t.filter(t=>t.triggers.findIndex(t=>{var n;return(null===(n=t.event)||void 0===n?void 0:n.type)===e})>=0))})}checkTriggeredActions(e){const t=e.filter(e=>e.mode===this.SDK._protected.RunModes.getCurrentMode());return o.debug(c,"[checkTriggeredActions]",t),t.length?Promise.all([this.installation.getProperties(),this.installation.Profile.getCoreProperties(!0),this.events.getAllEvents(),this.presence.getLastPresenceInfo(),this.installation.getTags()]).then(e=>{o.debug(c,"[checkTriggeredActions] got installation data",e);const n=e[0],i=e[1],a=e[2],p=e[3],d=new Set(e[4]),u=this.SDK.prototype.Notification.getSubscriptionState(),l=u===this.SDK.prototype.SubscriptionState.SUBSCRIBED?"optIn":u===this.SDK.prototype.SubscriptionState.UNSUBSCRIBED?"softOptOut":"optOut";return Promise.all(t.map(e=>{if(!new r.Segmenter(e.segment,i,n,d,a,p,l).matches())return void o.debug(c,"[checkTriggeredActions] did not match segment",e);o.debug(c,"[checkTriggeredActions] matched segment",e);const{rateLimit:t}=e;return(t?this.rateLimiterPromise.then(e=>e.increment(t)):Promise.resolve()).then(()=>{o.debug(c,"[checkTriggeredActions] Running actions",e.actions);const t=s.ReportingDataUtil.extract(e);this.SDK._protected.Notification.handleActions(t,e.actions)},t=>o.debug(c,"[checkTriggeredActions] action is rate-limited",e,t))})).then(()=>{})}):Promise.resolve()}}t.AutomaticActionsModule=p}]);